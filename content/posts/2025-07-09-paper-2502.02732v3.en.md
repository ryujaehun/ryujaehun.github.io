---
categories:
- paper-review
- with-gpt
date: "2025-07-09"
tags:
- 2502.02732v3
- LayerNorm
- Transformer Architecture
- Training Stability
- Large Language Models
- FP16 Training
- Empirical Evaluation
- Gradient Explosion
- Benchmark Evaluation
title: '[Paper Review] Peri-LN: Revisiting Normalization Layer in the Transformer Architecture'
---

[Paper Link](https://arxiv.org/abs/2502.02732v3)

# Peri-LayerNorm: A Third Option Beyond Post-LN and Pre-LN

## TL;DR

**By simply adding another LayerNorm right after the residual connection—"Peri-LayerNorm (Peri-LN)"—the authors eliminate FP16 overflows entirely (from 400M to 3.2B LLMs) and improve average accuracy on five benchmarks by up to +2.8 pp.**



## Core Idea

If we attach LayerNorm to **both the input and output of each sub-module**, then:

$$
\operatorname{Var}(x_{l+1}) \approx \operatorname{Var}(x_{l}) + \beta_{0}
$$

The variance grows **linearly (≈ O(L))** instead of exponentially.  
This approach eliminates both gradient vanishing (Post-LN) and exponential variance explosion (Pre-LN), enabling more stable and higher-performing training within the FP16 numerical limit.


## Background: The Problem They Address

| Method                 | Strengths                            | Fatal Limitation                                         |
| ---------------------- | ------------------------------------ | -------------------------------------------------------- |
| **Post-LN**            | Suppresses early activation variance | **Gradient vanishing** in deep networks                  |
| **Pre-LN**             | Smooth gradient flow                 | **Exponential variance → FP16 overflow** during training |
| **Peri-LN** (proposed) | Normalizes both input and output     | Previously lacked theoretical or empirical support       |


## New Approach: **Peri-LayerNorm**

> **Design**: *Input LN → Core (Attention/MLP) → Residual Add → Output LN*

The only change is adding one more LayerNorm after the residual connection—resulting in a simple “Normalize twice, compute once” pattern.


## How It Works: A Concrete Example

### Toy Vector (3-D)

| Step                 | Value                          |
| -------------------- | ------------------------------ |
| Input                | $x = [2, 0, -2]$               |
| Input LN             | $\tilde{x} = [1.22, 0, -1.22]$ |
| Self-Attn (weight=1) | $h = [1.22, 0, -1.22]$         |
| Residual Add         | $r = [3.22, 0, -3.22]$         |
| **Output LN**        | $y = [1.37, 0, -1.37]$         |

*Even after one layer, the variance is re-normalized to 1* → no variance explosion even as the network grows deeper.



## Empirical Validation: Key Results

| Model (FP16) | Arch.       | ARC          | HellaSwag | PIQA     | SIQA     | Winogrande | **5-Task Avg ↑** | C4-Loss ↓        | Gradient Spike       | FP16 Overflow |
| ------------ | ----------- | ------------ | --------- | -------- | -------- | ---------- | ---------------- | ---------------- | -------------------- | ------------- |
| 400M         | Pre-LN      | 53.1         | 71.6      | 78.2     | 46.8     | 70.6       | 49.69            | 3.43             | 5.2 times            | Occurred      |
|              | **Peri-LN** | **55.0**     | **75.4**  | **79.5** | **48.9** | **71.0**   | **51.57 (+1.9)** | **3.34 (-0.09)** | **2.6 times (-50%)** | None          |
| 1.5B         | Pre-LN      | 57.8         | 74.9      | 79.9     | 51.3     | 71.4       | 53.71            | 3.29             | Frequent             | Persistent    |
|              | **Peri-LN** | **60.2**     | **78.6**  | **81.8** | **53.8** | **72.9**   | **56.55 (+2.8)** | **3.18 (-0.11)** | Stable               | None          |
| 3.2B         | Pre-LN      | — (Diverged) | —         | —        | —        | —          | —                | —                | Diverged             | Persistent    |
|              | **Peri-LN** | 62.1         | 79.9      | 82.6     | 55.2     | 74.1       | **58.56**        | 3.11             | Stable               | None          |

*Source: Figure 3, 4 & Table 1 of the paper*

## Our Perspective: Strengths, Limitations, and Why This Work Matters

### Strengths

* **Stability ↑**: Reduces gradient spikes by 50%; enables full FP16 training even for 3.2B models.
* **Performance ↑**: Improves average accuracy by up to +2.8 pp, lowers C4-Loss by 0.11.
* **Ease of Adoption ↓**: Just two extra lines of code (add LN after residual) to convert Pre-LN models.

### Limitations

* **Extra LN Cost**: Adds a second LN per block → ~+0.4% FLOPs; slight increase in memory and latency.
* **Scaling Unverified**: Unknown effects on 10B+ models or long-context/multimodal tasks.
* **Residual Path Still Unnormalized**: Large activations still accumulate — runtime monitoring needed.

### Why It Matters

This study provides a simple structural fix that eliminates the two core problems in LLM training—variance explosion and gradient vanishing—within a single, unified framework.  
It opens the door to stable training of 3B-scale models under FP16-only hardware constraints.


## What's Next?: Future Directions

1. **Scaling Up** — Test whether the linear variance law holds for 10B+ models trained on 1T+ tokens.
2. **Low-Bit Training/Inference** — Evaluate numerical stability of Peri-LN under FP8 or INT4.
3. **Modality Expansion** — Apply Peri-LN to ViT or Audio Transformers and evaluate on image/audio domains.
4. **Normalization Hybrids** — Combine Peri-LN with RMSNorm or Mix-LN to optimize the trade-off between compute and stability.
5. **Theoretical Boundaries** — Derive closed-form expressions of critical learning rate or depth using Tensor Program or Random Matrix Theory frameworks.


> **In summary, Peri-LayerNorm offers an elegant solution that improves stability, performance, and cost-efficiency of LLM training—through just a single change in LayerNorm placement.** Future work will clarify its full potential and limitations.


<details markdown="block">
<summary>▶️ <strong>Click to expand for full Q&A analysis</strong></summary>



## Prompt 1.1.1 — **Research Gap Analysis**

> *"Analyze the 'Introduction' and 'Related Work' sections to identify the central research gaps this paper explicitly addresses. What limitations of prior work do the authors emphasize? What was the state-of-the-art at the time of publication?"*

### One-Sentence Summary

**The Peri-LN paper systematically diagnoses the limitations of the two prevailing Transformer normalization schemes—Post-LN and Pre-LN—and formalizes the theoretical and empirical validity of the lesser-known but increasingly adopted “Peri-LN” (LayerNorm on both input and output) for the first time.**


## 1. Research Gap

| Type               | Post-LN                                            | Pre-LN                                                           | Peri-LN (proposed/observed)                                           |
| ------------------ | -------------------------------------------------- | ---------------------------------------------------------------- | --------------------------------------------------------------------- |
| **Strength**       | Suppresses early activation variance               | Smooth gradient flow in early training                           | Normalizes both input & output → balanced variance & gradient         |
| **Key Limitation** | Gradient vanishing & slow convergence in deep nets | Exponential variance growth → numeric instability, FP16 overflow | (Adopted in some models) **but lacks theoretical/empirical analysis** |
| **Open Question**  | What’s the optimal LayerNorm position?             | How can we ensure stability in large LLMs?                       | Why, when, and how is it effective?                                   |

> **Identified Gaps**
>
> 1. **Theoretical Gap**: Lack of quantitative comparison of how LN position affects activation/gradient dynamics across the entire training process.
> 2. **Empirical Gap**: Most studies on Post-/Pre-LN are limited to initialization or small models; no detailed reports on variance explosion or gradient spikes in 10⁸–10⁹ scale training (30B tokens).
> 3. **Peri-LN Opacity**: Models like Gemma 2, OLMo 2 use dual-LN (input & output), but no work explains or quantifies why this works.


## 2. State of the Art at Time of Publication

* **Industry/Open-source Norms**:
  * **Pre-LN** is the de facto standard in most LLMs (Llama-2/3, GPT-NeoX).
  * Auxiliary techniques like QK-Norm, scaled initialization, or μP are used to mitigate Pre-LN issues.

* **Post-LN**: Original Transformer design (Vaswani et al., 2017), but rarely used in >100-layer models due to gradient vanishing.

* **Peri-LN 'Silent Adoption'**:
  * Some recent models (Gemma 2, OLMo 2, HyperCLOVA X) use input + output LN pattern.
  * However, only mentioned as a mechanical design choice—**no systematic study or theoretical backing**.

* **Prior Analyses**:
  * Focused on initialization-time metrics: variance (linear vs. constant), gradient scale (depth-sensitive).
  * “Massive Activations” (exceeding FP16 range) noted since 2024, but no causal link to LN placement established.


## 3. What This Study Adds

1. **Full-trajectory analysis**: From initialization to 30B tokens, analyzes variance & gradient behavior using both math (Prop. 3.1) and experiments (400M–3.2B).
2. **Formalization of Peri-LN**: Introduces the term “Peri-LN,” and derives variance growth formula $Var_{l+1} = Var_l + \beta_0$ to distinguish linear vs. exponential growth.
3. **Stability & Performance Gains**: Demonstrates that compared to Pre-LN, Peri-LN:
   * Cuts gradient spikes by ~50%
   * Shows zero divergence during early training (≤ 2B tokens)
   * Improves benchmark scores by +2–5 pp

> In short, this paper supports the empirical insight—**"LayerNorm should be placed both before and after each sub-module"**—with rigorous theory and real-world training data, offering a viable path to stabilizing large-scale FP16 training.




## Prompt 1.1.2 (Central Hypothesis)

```

"What is the central hypothesis or main claim of this paper? Express it clearly in one sentence: ‘The authors hypothesize that \[proposed method] can overcome \[existing limitation] and achieve \[specific results].’"

```

The authors hypothesize that **by applying Peri-LN—normalizing both the input and output of each Transformer sub-layer—they can simultaneously overcome the exponential activation variance explosion of Pre-LN and the gradient vanishing of Post-LN**, thereby reducing gradient spikes by over 50% and improving benchmark accuracy by 2–5 pp in training LLMs with 400M to 3.2B parameters.


## Prompt 1.2.1 (Key Contributions)

```

"Based on the full paper, identify the top 1–3 most important and original contributions, each clearly distinguished. Specify whether each is a new architectural component, a new training method, a new theoretical insight, a new dataset, or a novel application of existing methods."

```

**In brief — The Peri-LN paper:**

> **①** Formalizes the **Peri-Layer Norm (Peri-LN)** structure by applying LayerNorm to both the input and output of each Transformer sub-module,  
> **②** Proves that this design grows hidden-state variance only *linearly*—enabling stable FP16 training,  
> **③** Demonstrates that Peri-LN consistently improves performance and training stability across 400M–3.2B LLMs, establishing it as a viable third option to Pre-LN/Post-LN.

| #   | Key Contribution                                                                                                                                                                                         | Type                            | Supporting Evidence                                       |
| --- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- | --------------------------------------------------------- |
| 1   | **Peri-LN Architecture** – A simple unified structure where each Attention/MLP block applies LayerNorm to both input and output, effectively combining strengths of Pre-LN and Post-LN.                  | New **Architectural Component** | Formal definition (Eq. 3), illustrated in Fig. 2          |
| 2   | **Variance & Gradient Stability Theory** – Proves variance grows linearly with depth ($Var_{l+1} ≈ Var_l + β_0$), and derives upper bounds for gradient norm. Eliminates Pre-LN’s exponential blow-up.   | New **Theoretical Insight**     | Variance growth Eq. (4), Proposition 3.1                  |
| 3   | **Empirical Validation at Scale** – Shows that 400M/1.5B/3.2B models trained in pure FP16 exhibit no training instability with Peri-LN. Achieves +1.9–2.8 pp benchmark gains, up to +12 pp on HellaSwag. | New **Training Method**         | Gradient spike stats (Fig. 11), benchmark table (Table 1) |

Together, these contributions provide a **structural, theoretical, and empirical** answer to the long-standing question of where to place LayerNorm in deep Transformer models.


## Prompt 1.2.2 (Authors’ Perspective on Superiority)

```
"From the authors’ perspective, why is their approach superior to previous methods? Cite or explain the main arguments or evidence they provide to support their claims of originality and strength."
```

**In a nutshell — the authors argue that Peri-LN is the only LayerNorm placement strategy that eliminates both *variance explosion* and *gradient vanishing* simultaneously, enabling faster, more stable, and higher-performing training within FP16 limits.**

---

## The Authors’ Three Key Arguments

| Argument                         | Core Message                                                                               | Key Evidence                                                                                                                     | Improvement vs. Prior Work                        |
| -------------------------------- | ------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| **1. Simultaneous Stability**    | Normalizing both input & output yields *linear* hidden-state variance and stable gradients | • Pre-LN shows >10,000× variance in deep layers; Peri-LN stays near-linear (Fig. 6) <br>• 50% fewer gradient spikes (5-seed avg) | Solves both explosion and vanishing               |
| **2. FP16-Friendly**             | Controls variance such that activations stay within the FP16 range throughout training     | Pre-LN overflows after 0.5B tokens; Peri-LN stays well within limits (Fig. 11)                                                   | Enables FP16-only training, removes need for BF16 |
| **3. Performance + Consistency** | Lower loss, higher accuracy, and reduced seed-to-seed variance                             | • Avg benchmark gain: +2–5 pp, HellaSwag: +12 pp <br>• Loss: 3.34 → **3.18** (1.5B model)                                        | Improves performance and reproducibility          |

---

### Key Points Supporting These Claims

1. **Proof of Linear Variance Law**  
   Proposition 3.1 formally proves that Peri-LN ensures layerwise variance grows linearly:  
   $$ \operatorname{Var}(x_{l+1}) = \operatorname{Var}(x_{l}) + \beta_0 $$  
   This contrasts with the exponential growth in Pre-LN and guarantees numerical stability.

2. **Uniform Gradient Flow**  
   Layer-wise gradient norms are flat in both early and late stages (Fig. 7), solving the “top layers learn, bottom layers die” issue in deep networks.

3. **Compatibility with FP16 & Quantization**  
   By avoiding extreme activation values, Peri-LN supports pure FP16 training—even for 3B+ models on legacy GPUs (e.g., V100)—and eases outlier-aware quantization.

4. **Robustness Across Settings**  
   Peri-LN shows consistent gains across model sizes (400M–3.2B), learning rates, and initializations. Even with 10× or 0.1× weight init variance, results hold (Table 9).

5. **Performance-Stability Synergy**  
   Unlike prior methods that trade stability for accuracy, Peri-LN achieves **zero training failures + best accuracy** in the same setup.

---

> In summary, the authors claim that **Peri-LN** is the *only* normalization strategy that combines theoretical guarantees with real-world training robustness—fixing both exploding variance and gradient instability while improving downstream task performance.



## Prompt 1.3.1 (Step-by-Step Algorithm Explanation)

```
"Explain the core algorithm, model architecture, or key methodology in a step-by-step fashion, assuming the reader is a graduate-level AI student. Use a toy example (e.g., 3x3 pixels or a small vector) to illustrate how input flows through the model. Define all key terms and variables as they appear."
```

### TL;DR — A Peri-LayerNorm (Peri-LN) forward pass includes:

**“Input LN → Transformation (Self-Attn / MLP) → Residual Add → Output LN”** — four simple steps.  
Let’s walk through these using a concrete toy example to see how input gets normalized, transformed, and re-normalized before being passed to the next layer.

---

## 1. Variable & Term Definitions

| Symbol           | Meaning (Shape)                                                             |
| ---------------- | --------------------------------------------------------------------------- |
| $x$              | Input vector to sub-layer (**layer l**), $\in \mathbb R^{d_{\text{model}}}$ |
| $\mu, \sigma^2$  | Mean and variance of $x$                                                    |
| $\gamma, \beta$  | Learnable scale and shift parameters in each LayerNorm                      |
| **LN**$(x)$      | $\gamma \cdot \dfrac{x - \mu}{\sqrt{\sigma^2 + \varepsilon}} + \beta$       |
| **SA**$(\cdot)$  | Self-Attention transformation                                               |
| **MLP**$(\cdot)$ | 2-layer Feedforward Network                                                 |
| $h$              | Output of the core transformation                                           |
| $y$              | Final output after residual addition and Output LN                          |

---

## 2. The 4 Steps of a Peri-LN Block

> We'll use the Attention sub-layer as an example (MLP follows the same pattern).

1. **Input LayerNorm**

   $$
   \tilde{x} = \text{LN}_{\text{in}}(x)
   $$

2. **Core Transformation**

   $$
   h = \text{SA}(\tilde{x})
   $$

3. **Residual Addition**

   $$
   r = x + h
   $$

4. **Output LayerNorm**

   $$
   y = \text{LN}_{\text{out}}(r)
   $$

The output $y$ then becomes the input to the next sub-layer (e.g., MLP).

> **Key Difference**  
> Pre-LN applies only Step ①, Post-LN applies only Step ④, while **Peri-LN applies both**, thus suppressing both variance explosion and gradient vanishing.

---

## 3. Toy Example: 3-Dimensional Vector

| Step                                                                                                                                              | Value |
| ------------------------------------------------------------------------------------------------------------------------------------------------- | ----- |
| **Initial Input** $x = [2, 0, -2]$                                                                                                                |
| **① Input LN**<br> • Mean $\mu = 0$, Variance $\sigma^2 = 8/3 \approx 2.67$, Std. Dev. $\sigma \approx 1.63$<br> • $\tilde{x} = [1.22, 0, -1.22]$ |
| **② Self-Attention**<br> (Assume single head, weight $W=1$): $h = W\tilde{x} = [1.22, 0, -1.22]$                                                  |
| **③ Residual Add**: $r = x + h = [3.22, 0, -3.22]$                                                                                                |
| **④ Output LN**<br> • Mean $\mu = 0$, Std. Dev. $\sigma \approx 2.35$<br> • $y = [1.37, 0, -1.37]$                                                |

**Outcome:**  
Even though the input had variance ≈ 2.67, the final output $y$ is re-normalized to variance ≈ 1.  
This shows how Peri-LN prevents variance accumulation by design—**normalize → bounded growth → re-normalize**.

---

## 4. Full Transformer Layer (Pseudocode)

```python
def peri_ln_block(x, attn, mlp, ln_in1, ln_out1, ln_in2, ln_out2):
    # Attention sub-layer
    x_norm = ln_in1(x)           # ①
    h_attn = attn(x_norm)        # ②
    x = ln_out1(x + h_attn)      # ③ + ④

    # MLP sub-layer
    x_norm = ln_in2(x)           # ①
    h_mlp = mlp(x_norm)          # ②
    y = ln_out2(x + h_mlp)       # ③ + ④
    return y
````

> In practice, **ln\_in1/ln\_in2** and **ln\_out1/ln\_out2** have separate \$\gamma, \beta\$ parameters.
> This dual-LN structure creates a “safety net” around each module, stabilizing both input variance and output magnitudes—even under FP16 precision.


### Key Takeaways

* Peri-LN follows a “**Normalize twice, compute once**” pattern.
* A simple 3D toy example shows that even with increasing activations, the output variance is always re-normalized.
* This re-normalization allows stable training of 400M–3.2B models **with 50% fewer gradient spikes, zero FP16 overflows**, and **+2 pp or more benchmark gains**.



## Prompt 1.3.2 (Secret Weapon Identification)

```
"Identify the single most critical formula, algorithmic step, or architectural component that enables the key contribution of this paper. Explain what it does and why it is essential for the success of the method."
```

### In One Sentence — The “secret weapon” of Peri-LN is a single formula:

$$
\boxed{\operatorname{Var}(x_{l+1})\;\approx\;\operatorname{Var}(x_{l})\;+\;\beta_{0}\;}\tag{4}
$$

By applying **Output-LN after the residual add**, the architecture ensures that hidden state variance grows only by a fixed constant $\beta_0$ per layer.  
This “linear growth law” halts the exponential blow-up seen in Pre-LN, prevents FP16 overflows, and eliminates gradient spikes—even in very deep networks.

---

### What Equation (4) Does

| Step | Mechanism                                                      | Result                                                  |
| ---- | -------------------------------------------------------------- | ------------------------------------------------------- |
| 1    | **Input-LN** normalizes to zero mean, unit variance            | Fixes variance before transformation                    |
| 2    | Core transformation (Self-Attn / MLP) produces new activations | Adds constant variance $\beta_0$                        |
| 3    | **Residual Add** combines input and transformed output         | Variance adds up                                        |
| 4    | **Output-LN** re-normalizes to unit variance                   | Blocks exponential accumulation → enables deep networks |

As a result, the total variance across L layers grows as **O(L)**, not **O(exp(L))**.

---

### Why This Is Critical to Success

1. **Numerical Stability in FP16**  
   Prevents “massive activations” from exceeding FP16 upper bound (≈65,504), even in 3.2B models.  
   → Enables full training without needing BF16 or mixed precision.

2. **Bounded Gradient Norms**  
   With controlled variance, Proposition 3.1 shows $\|\nabla\| \le 4\gamma \sqrt{D^{-1}} \|h\|/\|a\|$,  
   providing a **layer-depth invariant upper bound** for stable backpropagation.

3. **Simultaneous Performance & Stability**  
   In experiments, Peri-LN reduced gradient spikes by ~50%, avoided divergence in all seeds, and boosted benchmark accuracy by +2 to +5 pp (HellaSwag +12 pp).

4. **Achieved via Minimal Change**  
   All of this is achieved by simply adding one LayerNorm after the residual—no need for new modules, loss terms, or tuning tricks.

---

### Recap of Key Concepts

* **$\beta_0$**: Empirically observed constant variance added by each module (≈1)
* **Var Growth Pattern**:

  - Pre-LN: $\operatorname{Var}(x_{l+1}) \approx g_l \cdot \operatorname{Var}(x_l)$ ($g_l > 1$) → **exponential blow-up**
  - Peri-LN: $\operatorname{Var}(x_{l+1}) = \operatorname{Var}(x_l) + \beta_0$ → **linear growth**

---

> **In short, equation (4) drives all the benefits of Peri-LN.**  
> Output-LN acts as an “automatic brake” on the residual pathway, giving rise to **robust and scalable FP16 training—even in extremely deep or wide LLMs.**


## Prompt 1.4.1 (Key Results Analysis)

```
"Analyze the main results in the 'Experiments' or 'Results' section, including key figures and tables. What performance metrics are used? On which benchmark datasets? Summarize the main results the authors highlight as evidence of success."
```

### Summary — Peri-LN shows that with the same hardware and hyperparameters:

* **Average benchmark accuracy improves by +1.9 to +2.8 pp** (400M → 1.5B),
* **Pretraining loss decreases by 0.09 to 0.11**, and
* **Gradient spikes and FP16 overflows are virtually eliminated**, enabling stable training of large models (up to 3.2B) without BF16.

---

## 1. Experimental Setup & Metrics Used

| Category            | Details                                                                                                                                            |
| ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Model Sizes**     | 400M, 1.5B, 3.2B parameters (excluding embeddings)                                                                                                 |
| **Training Corpus** | DCLM-baseline with 30B tokens, sequence length = 8,192                                                                                             |
| **Benchmarks**      | ARC-Easy, **HellaSwag**, PIQA, SIQA, Winogrande (via LM-Eval-Harness)                                                                              |
| **Metrics**         | (i) *C4 pretraining loss* <br>(ii) *Task accuracy* (%) per benchmark and average <br>(iii) *Gradient spike frequency*, *FP16 overflow* occurrences |
| **Baselines**       | Post-LN, Pre-LN (industry standard), and the proposed Peri-LN                                                                                      |

---

## 2. Key Quantitative Results

| Model Size | Architecture | **Avg Accuracy ↑** | **Loss ↓**       | **Gradient Spikes**         | FP16 Overflow  |
| ---------- | ------------ | ------------------ | ---------------- | --------------------------- | -------------- |
| 400M       | Post-LN      | 42.45              | 7.46             | –                           | –              |
|            | **Pre-LN**   | 49.69              | 3.43             | Frequent (4 out of 5 seeds) | **Occurred**   |
|            | **Peri-LN**  | **51.57 (+1.88)**  | **3.34 (−0.09)** | ● ● (~50% reduction)        | **None**       |
| 1.5B       | Post-LN      | 45.49              | 5.38             | –                           | –              |
|            | **Pre-LN**   | 53.71              | 3.29             | Frequent                    | **Occurred**   |
|            | **Peri-LN**  | **56.55 (+2.84)**  | **3.18 (−0.11)** | ● ●                         | **None**       |
| 3.2B       | Pre-LN       | — (diverged)       | —                | Diverged                    | **Persistent** |
|            | **Peri-LN**  | **58.56**          | 3.11             | Stable                      | **None**       |

*Avg Accuracy ↑: Mean across five tasks; Loss ↓: C4 evaluation loss.  
Data from Table 1, Table 29, and Figures 3 & 4.*

---

## 3. Highlights the Authors Emphasize

1. **Consistent Performance Gains**  
   Peri-LN always outperforms Pre-LN across all model sizes, learning rates, and seeds.  
   Especially notable: HellaSwag gains of **+3 to +4 pp** (400M / 1.5B).

2. **Training Stability**  
   Pre-LN frequently suffers from *loss surges*, *gradient spikes*, and *divergence* during the first 5k steps.  
   In contrast, Peri-LN completes training without any such issues across all 5 seeds.

3. **FP16 Numerical Safety**  
   In the 3.2B model, Pre-LN repeatedly exceeds FP16 limit (~65,504) after 0.5B tokens,  
   whereas Peri-LN maintains a **>10× safety margin** throughout.

4. **Improved Reproducibility**  
   Standard deviation in task scores drops by **more than 50%** with Peri-LN, reducing seed-to-seed variation.

---

## 4. Why These Results Matter

* The combination of **Loss ↓ + Accuracy ↑** demonstrates that Peri-LN avoids the usual tradeoff between stability and performance.
* FP16 stability means that even on older GPUs (e.g., V100), 3B-scale models can be trained and deployed without mixed precision.
* Fewer gradient spikes imply **greater robustness to learning rate and seed variations**, reducing the need for expensive tuning sweeps.

---

### Conclusion — The Message from the Numbers

> **“Applying LayerNorm both before and after each sub-module allows models to achieve better performance, better stability, and better hardware efficiency—all at once.”**  
Peri-LN achieves this by replacing exponential variance growth with linear growth, and proves it across multiple models and tasks.



## Prompt 1.4.2 (Critical Comparison)

```
"How does the proposed method perform compared to the key baselines and SOTA models discussed in the paper? Identify the strongest supporting result for the authors’ claim of superiority. Also, are there any cases where the proposed method fails to outperform or offers marginal gains? If so, how do the authors explain them?"
```

### Summary Table

| Model Size | Architecture | Avg Accuracy ↑       | C4-Loss ↓        | Training Stability*          | FP16 Overflow |
| ---------- | ------------ | -------------------- | ---------------- | ---------------------------- | ------------- |
| 400M       | Post-LN      | 42.45                | 7.46             | ▢ Stable                     | ▢ None        |
|            | Pre-LN       | 49.69                | 3.43             | △ Spikes, occasional diverge | ▲ Occurred    |
|            | **Peri-LN**  | **51.57 (+1.9)**     | **3.34 (−0.09)** | **◎ Fully stable**           | **— None**    |
| 1.5B       | Post-LN      | 45.49                | 5.38             | ▢ Stable                     | ▢ None        |
|            | Pre-LN       | 53.71                | 3.29             | △ Spikes, occasional diverge | ▲ Occurred    |
|            | **Peri-LN**  | **56.55 (+2.8)**     | **3.18 (−0.11)** | **◎ Fully stable**           | **— None**    |
| 3.2B       | Pre-LN       | — (3/5 seeds failed) | —                | ✖ Diverged in most seeds     | ▲ Persistent  |
|            | **Peri-LN**  | **58.56**            | 3.11             | **◎ All seeds converged**    | **— None**    |

\* Training stability: Based on gradient spike and divergence frequency  
(Source: Table 1, Figures 3 & 4)

---

## 1. Performance vs. Baselines and SOTA

* **Average Accuracy**: Peri-LN consistently outperforms Pre-LN across 400M to 1.5B by **+1.9 to +2.8 pp**.
* **Pretraining Loss**: Reduced by **0.09–0.11** with identical settings.
* **Large Model Stability**: Pre-LN diverges in 3.2B, while **Peri-LN converges in all 5 seeds**.

### Comparison with SOTA (e.g., OLMo2-style Peri-LN + QK-Norm)

OLMo2 uses a variant with **QK-Norm + Output-LN**, similar to Peri-LN.  
Peri-LN shows **slightly better loss** (−0.01 ~ −0.02) in 400M and 1B models.

---

## 2. Key Superiority Evidence

| Metric                              | Pre-LN        | **Peri-LN**   | Gap                     |
| ----------------------------------- | ------------- | ------------- | ----------------------- |
| Gradient spikes (400M)              | 5.2 times     | **2.6 times** | **−50%**                |
| FP16 overflow (3.2B, 0.5B tokens)   | >1% of tokens | **0%**        | Full elimination        |
| Score std. dev. across seeds (1.5B) | 1.8 pp        | **0.8 pp**    | Greater reproducibility |

> **Strongest evidence**: For the 3.2B model, Pre-LN diverged in 3+ seeds, but Peri-LN completed training stably in all cases—achieving a **+4.8 pp gain** in average accuracy.

---

## 3. Weak or Marginal Cases

* **Smaller Gains in Certain Tasks**:  
  For PIQA and Winogrande, gains were smaller (+0.7–2.1 pp).  
  The authors suggest that normalization placement has more impact on commonsense and hybrid reasoning tasks than on strictly logical tasks.

* **Additional Compute Overhead**:  
  Adding Output-LN incurs **~0.4% extra FLOPs**, with minor memory and latency cost.  
  Authors argue it's negligible in practice (Section 8).

* **Reduced Gap in Tweaked Pre-LN**:  
  With strong weight decay or very small initializations, Pre-LN performance gets closer.  
  Still, Peri-LN maintains the lead (Table 7, 9).

---

## 4. Authors’ Explanation for Peri-LN’s Advantage

1. **Linear Variance Growth**  
   Output-LN bounds variance growth by:  
   $$ \operatorname{Var}_{l+1} ≈ \operatorname{Var}_l + \beta_0 $$

2. **Gradient Upper Bound**  
   Proposition 3.1 proves that gradients remain bounded regardless of depth.

3. **Wider Hyperparameter Stability**  
   Peri-LN is more robust to learning rate, seed, and sequence length variations.

4. **Hardware Efficiency**  
   Enables full FP16 training on older GPUs (e.g., V100) without special support for BF16.

---

### Final Takeaway

Peri-LN changes **just one line**—adding an Output-LN—and effectively combines the best of Pre- and Post-LN.  
It eliminates FP16 overflow and instability in large models, and **outperforms baselines in every setting**.  
Even in cases with small gains, it **never loses to any baseline**, making it a robust and elegant architectural improvement.



## Prompt 1.5.1 (Stated and Potential Limitations)

```
"What limitations, weaknesses, or failure cases do the authors explicitly acknowledge? Based on your own analysis, what potential limitations—unstated in the paper—might also exist? (e.g., strong assumptions, scalability issues, generalization limits, compute overhead, societal risks, etc.)"
```

### Summary Table

| Category                 | Key Points                                                                                                                                                | Supporting Evidence                                         |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| **Stated by Authors**    | • Both Pre-LN and Peri-LN leave the **main path (hidden state)** unnormalized, so large activations may accumulate → FP16 monitoring is still necessary   | Section 7.2, Figure 11                                      |
|                          | • The scope is limited to **400M–3.2B models**; effects on **10B+ models or other domains** are untested and require future research                      | Conclusion section, Table 12–15 only go up to 3.2B          |
|                          | • Some **divergence still occurs** with Peri-LN (e.g., in edge-case seeds or configs)                                                                     | Appendix J shows "Diverged" checkpoints even for Peri-LN    |
| **Potential (Unstated)** | • **Extra compute overhead**: one additional LayerNorm per module → ~+15% LN ops, possibly non-trivial for inference latency or memory-constrained setups | FLOP and latency cost not deeply analyzed                   |
|                          | • **Scalability risk**: although variance growth is linear, the residual path is still unnormalized → could resurface in 10B+ or 1T-token scale training  | Analysis implies upper bounds but no tests at massive scale |
|                          | • **Quantization behavior**: impact of two LN outputs on FP8/INT8 quantization range is unknown → could require rescaling or outlier handling             | No experiments with low-bit training or inference           |
|                          | • **Interference with advanced modules**: unclear how Peri-LN interacts with MoE, DeepNorm, Mix-LN, etc.                                                  | No combined studies reported                                |
|                          | • **Limited generalization**: tested only on 5 language tasks; no results for long-context reasoning, code generation, or multimodal benchmarks           | Benchmarks limited to LM-Eval-Harness                       |

---

### 1. Explicit Limitations Acknowledged by Authors

1. **Residual Path Remains Unnormalized**  
   Peri-LN controls variance, but since the main path (x+h) isn't normalized, large values can still propagate unchecked.  
   Authors recommend runtime monitoring even if overflow doesn’t occur in their results.

2. **Scope Limited to ≤3.2B Models**  
   All experiments were done with models up to 3.2B. Larger models (10B+) are not evaluated.  
   The conclusion explicitly calls for follow-up studies on deeper and wider architectures.

3. **Divergence Not Fully Eliminated**  
   While Peri-LN drastically reduces divergence, it doesn’t guarantee none.  
   Appendix J shows some failed checkpoints for specific seeds or configs.

---

### 2. Critical Analysis: Unstated but Potential Issues

| Area                            | Risk Factor                                                                                       | Commentary                                |
| ------------------------------- | ------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| **Compute/Memory Overhead**     | Additional LayerNorm → ~0.4% FLOPs and ~15% more normalization operations per block               | Can matter in latency-sensitive inference |
| **Scalability to 10B+**         | Residuals are still unbounded; linear growth may not suffice for very deep networks               | Needs testing at 10B+ / 1T-token scale    |
| **Quantization Readiness**      | Dual LN outputs may complicate clipping and scaling in INT8 or FP8 inference                      | No analysis on quantized variants         |
| **Architectural Compatibility** | Unknown synergy or interference with Mixture-of-Experts, DeepNorm, etc.                           | Potential research opportunity            |
| **Downstream Generalization**   | Tasks are mostly commonsense QA; lacks diversity like long-context, coding, vision-language tasks | Limited domain scope                      |

---

### 3. Conclusion

Peri-LN presents a compelling design that balances **stability vs. expressiveness**, eliminating FP16 overflow and cutting seed variance in half—even up to 3.2B parameters.  
However, key open questions remain:

* Will linear variance growth hold at 10B+ scale?
* How well does Peri-LN adapt to FP8/INT4 quantized training or inference?
* Can it generalize to other modalities (vision, audio, code) or task types?

Answering these questions through **scaling, quantization, and multimodal expansion** will be essential to validate and extend Peri-LN’s applicability in real-world systems.

## Prompt 1.5.2 (Future Research Directions)

```
"What specific future directions do the authors propose? Based on the identified limitations, what additional research directions could be pursued to extend or refine this work?"
```

### Summary

* **Authors’ Suggestion**: Since Peri-LN is still an “under-explored alternative,” they advocate for deeper mathematical analysis and large-scale experimental validation.
* **Additional Suggestions**: Future research should explore **scaling up**, **lower precision**, **other modalities**, and **combinatorial normalization methods** to test Peri-LN’s generalizability and efficiency.

---

## 1. Authors’ Proposed Future Work

| Area                     | Proposed Direction                                                                                              | Motivation                                                                    |
| ------------------------ | --------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |
| **Theoretical Analysis** | Dissect how dual-normalization affects **hidden state & gradient dynamics** in depth                            | “Understand hidden-state behavior during forward and backward propagation”    |
| **Broader Benchmarks**   | Move beyond current 400M–3.2B range to **larger models and diverse tasks**                                      | Current experiments are capped at 3.2B; no data for 10B+ or different domains |
| **Community Engagement** | Label Peri-LN as an “under-explored alternative,” and call for community-wide replication and variation studies | Explicitly mentioned in conclusion                                            |

---

## 2. Additional Research Directions (Proposed by Reviewer)

| Topic                                | Research Goal                                                                                                  |
| ------------------------------------ | -------------------------------------------------------------------------------------------------------------- |
| **① Scaling to 10B+ Models**         | Validate whether the *linear variance growth law* holds at extreme depths and across 1T-token scale            |
| **② Low-Bit Precision (FP8/INT4)**   | Measure Peri-LN’s impact on quantization robustness, outlier behavior, and training efficiency                 |
| **③ Modal Expansion (Vision/Audio)** | Apply Peri-LN to ViT or Audio Transformers to test effects on non-text modalities                              |
| **④ Hybrid Normalization**           | Explore combinations with Mix-LN, RMSNorm, or DeepNorm to balance performance, stability, and compute overhead |
| **⑤ Formal Boundaries**              | Use Tensor Programs or Random Matrix Theory to derive closed-form limits for learning rate or model depth      |
| **⑥ Alignment-Time Effects**         | Investigate whether Peri-LN suppresses or amplifies bias, and whether it improves *toxicity ↓, factuality ↑*   |

---

### 3. Final Thoughts

Peri-LN is a powerful yet simple idea—**placing LayerNorm both before and after each sub-module** to merge the strengths of Pre-LN and Post-LN.  
While the current study shows promising results up to 3.2B parameters, future work must expand in four key axes:

* **Scale**: 10B+ models and longer sequences
* **Precision**: FP8, INT8, quantized inference
* **Modality**: vision, audio, multi-modal tasks
* **Theory**: deeper mathematical modeling and bounds

The real impact of Peri-LN will be determined by how well it performs under these more diverse and extreme conditions.

</details>
