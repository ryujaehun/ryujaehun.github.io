<!doctype html><html lang=ko-kr data-theme=claude><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER | Jaehun's Blog</title><meta name=description content="ë…¼ë¬¸ ë§í¬
Q : ì´ ë…¼ë¬¸ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì½ê³  ë…¼ë¬¸ì˜ ê°•ì ê³¼ ë…ì°½ì ì¸ ì§€ì ì„ ì„¤ëª…í•´ì£¼ê³  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œ ì…ë ¥ì„ ë“¤ì–´ì„œ ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì¤˜ ì¶”ê°€ì ìœ¼ë¡œ ë…¼ë¬¸ì˜ í•œê³„ì ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜ âœ… ê²°ë¡  ìš”ì•½ ì´ ë…¼ë¬¸ì€ ì´ˆì¥ë¬¸(long-context) LLMì„ ì €ë ´í•œ í•˜..."><meta name=keywords content="ê°œë°œ,í”„ë¡œê·¸ë˜ë°,ì—ì„¸ì´"><meta name=author content><meta name=language content="ko"><meta name=robots content="index, follow"><link rel=canonical href=https://jaehun.me/ko/ko/posts/2025-03-24-paper-2408.16978/><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://jaehun.me/ko/ko/posts/2025-03-24-paper-2408.16978/"><meta property="og:site_name" content="Jaehun's Blog"><meta property="og:title" content="TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER"><meta property="og:description" content="ë…¼ë¬¸ ë§í¬
Q : ì´ ë…¼ë¬¸ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì½ê³  ë…¼ë¬¸ì˜ ê°•ì ê³¼ ë…ì°½ì ì¸ ì§€ì ì„ ì„¤ëª…í•´ì£¼ê³  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œ ì…ë ¥ì„ ë“¤ì–´ì„œ ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì¤˜ ì¶”ê°€ì ìœ¼ë¡œ ë…¼ë¬¸ì˜ í•œê³„ì ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜ âœ… ê²°ë¡  ìš”ì•½ ì´ ë…¼ë¬¸ì€ ì´ˆì¥ë¬¸(long-context) LLMì„ ì €ë ´í•œ í•˜ë“œì›¨ì–´(ì˜ˆ: 4 GPU) ìƒì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í›ˆë ¨í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” FPDT (Fully Pipelined Distributed Transformer) êµ¬ì¡°ë¥¼ ì œì•ˆí•¨.
ê¸°ì¡´ ëŒ€ë¹„ ìµœëŒ€ 16ë°° ë” ê¸´ ì‹œí€€ìŠ¤(ì˜ˆ: 2M tokens)ë¥¼ 55% ì´ìƒì˜ MFU(Model FLOPs Utilization) íš¨ìœ¨ë¡œ í›ˆë ¨ ê°€ëŠ¥í•¨."><meta property="og:locale" content="ko_kr"><meta property="og:type" content="article"><meta property="article:section" content="ko"><meta property="article:published_time" content="2025-03-24T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-24T00:00:00+00:00"><meta property="og:image" content="https://jaehun.me/images/og-default.avif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jaehun.me/images/og-default.avif"><meta name=twitter:title content="TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER"><meta name=twitter:description content="ë…¼ë¬¸ ë§í¬
Q : ì´ ë…¼ë¬¸ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì½ê³  ë…¼ë¬¸ì˜ ê°•ì ê³¼ ë…ì°½ì ì¸ ì§€ì ì„ ì„¤ëª…í•´ì£¼ê³  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œ ì…ë ¥ì„ ë“¤ì–´ì„œ ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì¤˜ ì¶”ê°€ì ìœ¼ë¡œ ë…¼ë¬¸ì˜ í•œê³„ì ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜ âœ… ê²°ë¡  ìš”ì•½ ì´ ë…¼ë¬¸ì€ ì´ˆì¥ë¬¸(long-context) LLMì„ ì €ë ´í•œ í•˜ë“œì›¨ì–´(ì˜ˆ: 4 GPU) ìƒì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í›ˆë ¨í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” FPDT (Fully Pipelined Distributed Transformer) êµ¬ì¡°ë¥¼ ì œì•ˆí•¨.
ê¸°ì¡´ ëŒ€ë¹„ ìµœëŒ€ 16ë°° ë” ê¸´ ì‹œí€€ìŠ¤(ì˜ˆ: 2M tokens)ë¥¼ 55% ì´ìƒì˜ MFU(Model FLOPs Utilization) íš¨ìœ¨ë¡œ í›ˆë ¨ ê°€ëŠ¥í•¨."><meta itemprop=name content="TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER"><meta itemprop=description content="ë…¼ë¬¸ ë§í¬
Q : ì´ ë…¼ë¬¸ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì½ê³  ë…¼ë¬¸ì˜ ê°•ì ê³¼ ë…ì°½ì ì¸ ì§€ì ì„ ì„¤ëª…í•´ì£¼ê³  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œ ì…ë ¥ì„ ë“¤ì–´ì„œ ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì¤˜ ì¶”ê°€ì ìœ¼ë¡œ ë…¼ë¬¸ì˜ í•œê³„ì ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜ âœ… ê²°ë¡  ìš”ì•½ ì´ ë…¼ë¬¸ì€ ì´ˆì¥ë¬¸(long-context) LLMì„ ì €ë ´í•œ í•˜ë“œì›¨ì–´(ì˜ˆ: 4 GPU) ìƒì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í›ˆë ¨í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” FPDT (Fully Pipelined Distributed Transformer) êµ¬ì¡°ë¥¼ ì œì•ˆí•¨.
ê¸°ì¡´ ëŒ€ë¹„ ìµœëŒ€ 16ë°° ë” ê¸´ ì‹œí€€ìŠ¤(ì˜ˆ: 2M tokens)ë¥¼ 55% ì´ìƒì˜ MFU(Model FLOPs Utilization) íš¨ìœ¨ë¡œ í›ˆë ¨ ê°€ëŠ¥í•¨."><meta itemprop=datePublished content="2025-03-24T00:00:00+00:00"><meta itemprop=dateModified content="2025-03-24T00:00:00+00:00"><meta itemprop=wordCount content="9400"><meta itemprop=image content="https://jaehun.me/images/og-default.avif"><meta itemprop=keywords content="Paper-Review,With-Gpt"><script>window.HUGO_SEARCH_CONFIG={searchIndexURL:'"/ko/index.json"'}</script><script>window.HUGO_GALLERY_CONFIG={justified_gallery:!1,lightbox:!1,justified:"{}",lightbox_options:"{}"}</script><link rel=stylesheet href=/css/compiled.min.9165cace5b80a5be5daad6ea96eb2abc20a18a3f41d7fed7f0335b689fdf7883.css integrity="sha256-kWXKzluApb5dqtbqlusqvCChij9B1/7X8DNbaJ/feIM=" crossorigin=anonymous><link rel=stylesheet href=/css/chroma.min.491df36221f739b5948a747a0351f100ee7ccaaf466d9f46288bf06de1d59123.css integrity="sha256-SR3zYiH3ObWUinR6A1HxAO58yq9GbZ9GKIvwbeHVkSM=" crossorigin=anonymous><script src=/js/main.ba969e49a7a874e6938fe689a7dcaa00cb64cb4d429c2cf98d09bde512a16c6d.js integrity="sha256-upaeSaeodOaTj+aJp9yqAMtky01CnCz5jQm95RKhbG0=" crossorigin=anonymous></script><script src=/js/gumshoe.polyfills.min.js></script><script src=/js/toc.70654aebf0b738a78ae2df95297cc10ebc6e590f3c942dd1325fa852f50038b2.js integrity="sha256-cGVK6/C3OKeK4t+VKXzBDrxuWQ88lC3RMl+oUvUAOLI=" crossorigin=anonymous defer></script><script src=/js/search.de3eba3540834efb8328121784bff4774e06362412ee41eee665f5b4f987f393.js integrity="sha256-3j66NUCDTvuDKBIXhL/0d04GNiQS7kHu5mX1tPmH85M=" crossorigin=anonymous defer></script><script src=/js/dock.e02f422517e001d9fb6bea1e9e8b0e89e9d2e486ad4641f275bb3e36ce2ae79f.js integrity="sha256-4C9CJRfgAdn7a+oenosOienS5IatRkHydbs+Ns4q558=" crossorigin=anonymous defer></script><script>(function(){const e=localStorage.getItem("theme")||"system",n=localStorage.getItem("colorScheme")||"claude";document.documentElement.setAttribute("data-theme",n);function t(){e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}t(),e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t)})()</script></head><body class="bg-background text-foreground min-h-screen antialiased"><div id=reading-progress-container class="reading-progress-container pointer-events-none fixed top-0 right-0 left-0 z-50 transition-opacity duration-300 ease-out" data-height=3 data-smooth-scroll=true data-hide-on-complete=false><div class="reading-progress-bg w-full"></div><div id=reading-progress-bar class="from-primary to-primary/80 reading-progress-bar
transition-all duration-150 ease-out
absolute top-0 left-0 w-0 bg-gradient-to-r"></div></div><script>(function(){"use strict";const t=document.getElementById("reading-progress-container"),o=document.getElementById("reading-progress-bar");if(!t||!o)return;const a={smoothScroll:t.dataset.smoothScroll==="true",hideOnComplete:t.dataset.hideOnComplete==="true"};let n=!0,l=null;function r(){const t=window.pageYOffset||document.documentElement.scrollTop,n=document.documentElement.scrollHeight,s=window.innerHeight,e=n-s;return e<=0?0:Math.min(Math.max(t/e*100,0),100)}function c(){const e=r();o.style.width=e+"%",a.hideOnComplete&&e>=99.5?n&&(t.style.opacity="0",n=!1):n||(t.style.opacity="1",n=!0)}let s=!1;function e(){s||(requestAnimationFrame(()=>{c(),s=!1}),s=!0)}function i(){window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||e()}),e(),window.addEventListener("beforeunload",()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})()</script><header class="sticky top-0 z-50 mx-auto max-w-4xl px-4 py-6"><div class="border-border bg-card/80 flex items-center rounded-xl border px-6 py-4 shadow-sm backdrop-blur-sm"><div class="hidden w-full items-center md:flex"><div class="flex items-center"><a href=/ko/ class="flex h-10 w-10 items-center justify-center overflow-hidden rounded-full transition-transform duration-200 hover:scale-105" aria-label="Jaehun's Blog"><img src=/images/logo.svg alt="Jaehun's Blog" class="h-full w-full object-cover"></a></div><nav class="mx-8 flex flex-1 items-center justify-center"><div class="flex items-center space-x-1"><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.posts"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
<span>ê²Œì‹œê¸€
</span></a><a href=/ko/categories/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.categories"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
<span>ì¹´í…Œê³ ë¦¬
</span></a><a href=/ko/tags/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.tags"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512.0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828.0l-7-7A1.994 1.994.0 013 12V7a4 4 0 014-4z"/></svg>
<span>íƒœê·¸
</span></a><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.archives"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
<span>ì•„ì¹´ì´ë¸Œ</span></a></div></nav><div class="flex items-center space-x-2"><div class=relative><button id=language-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=language aria-label="ì–¸ì–´ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì–¸ì–´ ë³€ê²½"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8 6 6m-7 0 6-6 2-3M2 5h12M7 2h1m14 20-5-10-5 10m2-4h6"/></svg></button><div id=language-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=language role=menu aria-labelledby=language-toggle><a href=/ko/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem aria-current=true><span class=font-medium>í•œêµ­ì–´</span></a><a href=/en/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem><span class=font-medium>English</span></a></div></div><div class=relative><button id=color-scheme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=color-scheme aria-label="í…Œë§ˆ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="í…Œë§ˆ ë³€ê²½"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z"/></svg></button><div id=color-scheme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=color-scheme><button data-color-scheme=claude class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme=default class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme=bumblebee class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme=emerald class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme=nord class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme=sunset class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme=abyss class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme=dracula class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme=amethyst class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme=slate class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme=twitter class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div></div><div class=relative><button id=theme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=theme aria-label="í…Œë§ˆ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 sun-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë¼ì´íŠ¸"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
<svg class="h-5 w-5 moon-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë‹¤í¬"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg>
<svg class="h-5 w-5 system-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì‹œìŠ¤í…œ"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg></button><div id=theme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=theme><button data-theme=light class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë¼ì´íŠ¸"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>ë¼ì´íŠ¸</span></button><button data-theme=dark class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë‹¤í¬"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg><span>ë‹¤í¬</span></button><button data-theme=system class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì‹œìŠ¤í…œ"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg><span>ì‹œìŠ¤í…œ</span></button></div></div></div></div><div class="flex w-full items-center justify-between md:hidden"><div class=relative><button id=mobile-menu-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:bg-accent hover:text-foreground flex h-10 w-10 items-center justify-center rounded-lg border transition-colors duration-200" data-dropdown-type=mobile-menu aria-label=ë©”ë‰´ aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë©”ë‰´"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=mobile-menu class="mobile-menu dropdown-menu border-border bg-popover/95 absolute top-12 left-0 z-[60] hidden w-80 max-w-[calc(100vw-2rem)] rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out md:hidden" data-dropdown-type=mobile-menu role=menu aria-labelledby=mobile-menu-toggle><nav class="flex flex-col"><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.posts"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
<span>ê²Œì‹œê¸€
</span></a><a href=/ko/categories/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.categories"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
<span>ì¹´í…Œê³ ë¦¬
</span></a><a href=/ko/tags/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.tags"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512.0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828.0l-7-7A1.994 1.994.0 013 12V7a4 4 0 014-4z"/></svg>
<span>íƒœê·¸
</span></a><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.archives"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
<span>ì•„ì¹´ì´ë¸Œ</span></a></nav></div></div><div class="flex items-center space-x-2"><div class=relative><button id=language-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=language aria-label="ì–¸ì–´ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì–¸ì–´ ë³€ê²½"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8 6 6m-7 0 6-6 2-3M2 5h12M7 2h1m14 20-5-10-5 10m2-4h6"/></svg></button><div id=language-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=language role=menu aria-labelledby=language-toggle><a href=/ko/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem aria-current=true><span class=font-medium>í•œêµ­ì–´</span></a><a href=/en/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem><span class=font-medium>English</span></a></div></div><div class=relative><button id=color-scheme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=color-scheme aria-label="í…Œë§ˆ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="í…Œë§ˆ ë³€ê²½"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z"/></svg></button><div id=color-scheme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=color-scheme><button data-color-scheme=claude class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme=default class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme=bumblebee class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme=emerald class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme=nord class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme=sunset class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme=abyss class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme=dracula class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme=amethyst class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme=slate class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme=twitter class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div></div><div class=relative><button id=theme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=theme aria-label="í…Œë§ˆ ë³€ê²½" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 sun-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë¼ì´íŠ¸"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
<svg class="h-5 w-5 moon-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë‹¤í¬"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg>
<svg class="h-5 w-5 system-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì‹œìŠ¤í…œ"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg></button><div id=theme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=theme><button data-theme=light class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë¼ì´íŠ¸"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>ë¼ì´íŠ¸</span></button><button data-theme=dark class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ë‹¤í¬"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg><span>ë‹¤í¬</span></button><button data-theme=system class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="ì‹œìŠ¤í…œ"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg><span>ì‹œìŠ¤í…œ</span></button></div></div></div></div></div></header><main class="mx-auto max-w-4xl px-4 py-6"><nav class="breadcrumb mb-4 md:mb-6 py-1" aria-label=ê²½ë¡œ><ol class="text-muted-foreground flex items-center space-x-1 md:space-x-2 text-sm overflow-x-auto whitespace-nowrap scrollbar-hide py-1"><li class=flex-shrink-0><a href=/ko/ class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02]"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="í™ˆ"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11 2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
<span class="max-w-[4rem] md:max-w-none truncate">í™ˆ</span></a></li><li class="flex items-center gap-1 md:gap-2 min-w-0"><span class="text-muted-foreground/50 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></span><div class="flex items-center gap-1 md:gap-2 min-w-0"><a href=/ko class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02] flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5A2 2 0 003 7z"/></svg>
<span class="max-w-[4rem] md:max-w-none truncate">Ko</span>
</a><span class="text-muted-foreground/50 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></span>
<span class="text-foreground flex items-center gap-0.5 md:gap-1 font-medium min-w-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
<span class="max-w-[8rem] md:max-w-[16rem] lg:max-w-none truncate">TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER</span></span></div></li></ol></nav><header class=mb-8><h1 class="text-foreground mb-4 text-3xl font-bold md:text-4xl">TRAINING ULTRA LONG CONTEXT LANGUAGE MODEL WITH FULLY PIPELINED DISTRIBUTED TRANSFORMER</h1></header><article class="prose prose-neutral dark:prose-invert max-w-none"><p><a href=https://arxiv.org/abs/2408.16978>ë…¼ë¬¸ ë§í¬</a></p><h1 id=q--ì´-ë…¼ë¬¸ì„-ì•„ì£¼-ìì„¸í•˜ê²Œ-ì½ê³ -ë…¼ë¬¸ì˜-ê°•ì ê³¼-ë…ì°½ì ì¸-ì§€ì ì„-ì„¤ëª…í•´ì£¼ê³ -í•µì‹¬-ì•Œê³ ë¦¬ì¦˜ì„-ì˜ˆì‹œ-ì…ë ¥ì„-ë“¤ì–´ì„œ-ì „ì²´ì ì¸-ê³¼ì •ì„-ì„¤ëª…í•´ì¤˜-ì¶”ê°€ì ìœ¼ë¡œ-ë…¼ë¬¸ì˜-í•œê³„ì ì—-ëŒ€í•´ì„œë„-ì•Œë ¤ì¤˜>Q : ì´ ë…¼ë¬¸ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì½ê³  ë…¼ë¬¸ì˜ ê°•ì ê³¼ ë…ì°½ì ì¸ ì§€ì ì„ ì„¤ëª…í•´ì£¼ê³  í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œ ì…ë ¥ì„ ë“¤ì–´ì„œ ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì¤˜ ì¶”ê°€ì ìœ¼ë¡œ ë…¼ë¬¸ì˜ í•œê³„ì ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜</h1><h3 id=-ê²°ë¡ -ìš”ì•½>âœ… ê²°ë¡  ìš”ì•½</h3><p>ì´ ë…¼ë¬¸ì€ <strong>ì´ˆì¥ë¬¸(long-context)</strong> LLMì„ <strong>ì €ë ´í•œ í•˜ë“œì›¨ì–´(ì˜ˆ: 4 GPU)</strong> ìƒì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í›ˆë ¨í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” <strong>FPDT (Fully Pipelined Distributed Transformer)</strong> êµ¬ì¡°ë¥¼ ì œì•ˆí•¨.<br>ê¸°ì¡´ ëŒ€ë¹„ <strong>ìµœëŒ€ 16ë°° ë” ê¸´ ì‹œí€€ìŠ¤</strong>(ì˜ˆ: 2M tokens)ë¥¼ <strong>55% ì´ìƒì˜ MFU(Model FLOPs Utilization)</strong> íš¨ìœ¨ë¡œ í›ˆë ¨ ê°€ëŠ¥í•¨.</p><hr><h2 id=-ë…¼ë¬¸ì˜-ê°•ì --ë…ì°½ì ì¸-ê¸°ì—¬>ğŸ” ë…¼ë¬¸ì˜ ê°•ì  & ë…ì°½ì ì¸ ê¸°ì—¬</h2><table><thead><tr><th>êµ¬ë¶„</th><th>ê¸°ì¡´ ê¸°ë²• í•œê³„</th><th>FPDTì˜ ë…ì°½ì„±</th></tr></thead><tbody><tr><td><strong>ìì› íš¨ìœ¨ì„±</strong></td><td>256K<del>512K sequence ê¸¸ì´ì— ìˆ˜ì‹­</del>ìˆ˜ë°± ê°œì˜ GPU í•„ìš”</td><td><strong>4 GPUë¡œ 8B ëª¨ë¸ 2M ê¸¸ì´ í•™ìŠµ</strong> ê°€ëŠ¥</td></tr><tr><td><strong>ë©”ëª¨ë¦¬ ìµœì í™”</strong></td><td>QKVÂ·AttentionÂ·FFN ì¤‘ê°„ ë²„í¼ë¡œ ì¸í•œ memory spike ì¡´ì¬</td><td><strong>Chunk ë‹¨ìœ„ ë¶„í•  + Double Buffering + Host Memory ì˜¤í”„ë¡œë“œ</strong></td></tr><tr><td><strong>íŒŒì´í”„ë¼ì¸ êµ¬ì¡°</strong></td><td>ê¸°ì¡´ì€ Attentionë§Œ ë³‘ë ¬í™”</td><td><strong>Attention + FFN ì „ì²´ ë¸”ë¡ì— íŒŒì´í”„ë¼ì´ë‹ ì ìš©</strong>, HtoD (Host-to-Device) Fetchë„ ê²¹ì¹˜ê²Œ ìŠ¤ì¼€ì¤„ë§</td></tr><tr><td><strong>ë²”ìš©ì„±</strong></td><td>íŠ¹ì • ëª¨ë¸ (Megatron-GPT, Ulysses ë“±)ì— ì¢…ì†</td><td><strong>GPT, LLaMA ë“± ë‹¤ì–‘í•œ Transformerì— ì ìš© ê°€ëŠ¥</strong>, DeepSpeed ZeRO/FSDPì™€ í˜¸í™˜</td></tr></tbody></table><hr><h2 id=-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜-êµ¬ì¡°-ìš”ì•½-fpdt>ğŸ”§ í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ êµ¬ì¡° ìš”ì•½ (FPDT)</h2><h3 id=1-ì…ë ¥-ì˜ˆì‹œ>1. ì…ë ¥ ì˜ˆì‹œ</h3><ul><li>ì…ë ¥ ì‹œí€€ìŠ¤: <strong>1.6M tokens</strong>, Batch size = 1</li><li>ëª¨ë¸: <strong>8B LLaMA</strong></li><li>í™˜ê²½: 4 x A100 80GB GPU</li></ul><hr><h3 id=2-ë‹¨ê³„ë³„-ì²˜ë¦¬-ê³¼ì •-ì˜ˆì‹œ>2. ë‹¨ê³„ë³„ ì²˜ë¦¬ ê³¼ì • ì˜ˆì‹œ</h3><h4 id=-ë‹¨ê³„-1-sequence-chunking>ğŸ“Œ ë‹¨ê³„ 1: Sequence Chunking</h4><ul><li>ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ ì˜ˆ: <code>chunk_size = 64K</code> ìœ¼ë¡œ <strong>25ê°œì˜ ì²­í¬</strong>ë¡œ ë‚˜ëˆ”</li></ul><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-0 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-0 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-0><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln>1</span><span class=cl><span class=n>Sequence</span> <span class=o>=</span> <span class=p>[</span><span class=n>T0</span><span class=p>,</span> <span class=n>T1</span><span class=p>,</span> <span class=o>...</span><span class=p>,</span> <span class=n>T24</span><span class=p>]</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-0",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><h4 id=-ë‹¨ê³„-2-qkv-projection--all-to-all>ğŸ“Œ ë‹¨ê³„ 2: QKV Projection + All-to-All</h4><p>ê° chunk <code>Ti</code>ì— ëŒ€í•´:</p><ul><li>Q/K/V Projection â†’ <code>qi</code>, <code>ki</code>, <code>vi</code> ìƒì„±</li><li><strong>AlltoAll í†µì‹ </strong>ìœ¼ë¡œ ê° GPUëŠ” ì „ì²´ ì‹œí€€ìŠ¤ì˜ ì¼ë¶€ headë¥¼ ê°–ê²Œ ë¨</li><li>ì´ ê³¼ì •ì€ chunk ë‹¨ìœ„ë¡œ ìˆœì°¨ ìˆ˜í–‰ë¨</li></ul><h4 id=-ë‹¨ê³„-3-ì˜¤í”„ë¡œë“œ-ì „ëµ-fetchingoffloading>ğŸ“Œ ë‹¨ê³„ 3: ì˜¤í”„ë¡œë“œ ì „ëµ (Fetching/Offloading)</h4><ul><li><code>ki</code>, <code>vi</code>ëŠ” <strong>host memoryë¡œ ì˜¤í”„ë¡œë“œ</strong></li><li>ë‹¤ìŒ chunkì˜ <code>qi+1</code> ì—°ì‚°ì„ ìœ„í•´ <strong>í•„ìš”í•œ <code>ki</code>, <code>vi</code>ë§Œ GPUë¡œ fetch</strong></li></ul><h4 id=-ë‹¨ê³„-4-online-attention-ìˆ˜í–‰>ğŸ“Œ ë‹¨ê³„ 4: Online Attention ìˆ˜í–‰</h4><ul><li>ì˜ˆ: <code>qÌ‚2</code>ë¥¼ ê³„ì‚°í•  ë•Œ, <code>kÌ‚0, vÌ‚0</code>, <code>kÌ‚1, vÌ‚1</code>, <code>kÌ‚2, vÌ‚2</code>ê°€ í•„ìš”</li><li>host memoryì—ì„œ í•´ë‹¹ <code>kÌ‚, vÌ‚</code>ë§Œ ê°€ì ¸ì™€ attention ìˆ˜í–‰</li></ul><h4 id=-ë‹¨ê³„-5-backward-with-double-buffer>ğŸ“Œ ë‹¨ê³„ 5: Backward with Double Buffer</h4><ul><li>Backward ì‹œì—ë„ ë™ì¼í•˜ê²Œ chunkë³„ <code>qÌ‚i, kÌ‚i, vÌ‚i</code>ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ hostâ†’GPU fetch</li><li><strong>Double buffer</strong> ì „ëµìœ¼ë¡œ prefetch + computeë¥¼ <strong>ë™ì‹œì— ì§„í–‰</strong></li></ul><h4 id=-ë‹¨ê³„-6-ffn-ë°-loss-ì²˜ë¦¬>ğŸ“Œ ë‹¨ê³„ 6: FFN ë° Loss ì²˜ë¦¬</h4><ul><li>FFNì€ chunkingë§Œ ì ìš© (offloadingì€ X)</li><li>LossëŠ” float32ë¡œ í° ë©”ëª¨ë¦¬ ì“°ëŠ”ë°, <strong>ë³„ë„ chunking ì²˜ë¦¬</strong></li></ul><hr><h2 id=-ì„±ëŠ¥-ë¹„êµ-ì‹¤í—˜-ê²°ê³¼>ğŸ“Š ì„±ëŠ¥ ë¹„êµ (ì‹¤í—˜ ê²°ê³¼)</h2><table><thead><tr><th>ëª¨ë¸ í¬ê¸°</th><th>ê¸°ì¡´ ìµœëŒ€ ì‹œí€€ìŠ¤ ê¸¸ì´ (Ulysses ê¸°ì¤€)</th><th>FPDT ìµœëŒ€ ê¸¸ì´</th><th>GPU ìˆ˜</th><th>MFU</th></tr></thead><tbody><tr><td>2.7B GPT</td><td>256K</td><td><strong>2M</strong></td><td>2</td><td>53%</td></tr><tr><td>8B LLaMA</td><td>512K</td><td><strong>2M</strong></td><td>4</td><td>47%</td></tr><tr><td>70B LLaMA</td><td>1M</td><td><strong>4M</strong></td><td>32</td><td>55%</td></tr></tbody></table><hr><h2 id=-í•œê³„ì >âš ï¸ í•œê³„ì </h2><table><thead><tr><th>í•œê³„</th><th>ì„¤ëª…</th></tr></thead><tbody><tr><td><strong>PCIe ëŒ€ì—­í­ ë³‘ëª©</strong></td><td>Host-to-GPU ë©”ëª¨ë¦¬ fetchëŠ” NVLINKì— ë¹„í•´ ëŠë ¤ì„œ, chunk size ì„¤ì •ì´ ì¤‘ìš” (64Kë¡œ ìµœì í™”)</td></tr><tr><td><strong>FFN ë©”ëª¨ë¦¬ ìµœì í™” ë¯¸ì§€ì›</strong></td><td>FFNì€ offloading ë¶ˆê°€. chunk ìˆ˜ë¥¼ ëŠ˜ë ¤ë„ computation latencyê°€ memory fetchë¥¼ ê°€ë¦¬ì§€ ëª»í•¨</td></tr><tr><td><strong>PyTorch Gradient Reduce ë¬¸ì œ</strong></td><td>ZeRO-3 ì‚¬ìš© ì‹œ gradient reduce ê³¼ì •ì—ì„œ PyTorchê°€ memory spikeë¥¼ ì¼ìœ¼ì¼œ ë³‘ëª© ê°€ëŠ¥ì„± ìˆìŒ</td></tr><tr><td><strong>ë³µì¡í•œ íŒŒì´í”„ë¼ì¸ êµ¬ì¡°</strong></td><td>Double buffer + chunk fetch + async compute ê°„ ìŠ¤ì¼€ì¤„ë§ì´ ë³µì¡í•´ ì‹¤ êµ¬í˜„ ë‚œì´ë„ ë†’ìŒ</td></tr></tbody></table><hr><h2 id=-ê²°ë¡ >ğŸ§  ê²°ë¡ </h2><p>FPDTëŠ” ì´ˆì¥ë¬¸ ì‹œí€€ìŠ¤ë¥¼ í•™ìŠµ ê°€ëŠ¥í•œ <strong>í˜ì‹ ì ì¸ ì‹œìŠ¤í…œ ìµœì í™” ê¸°ë²•</strong>ìœ¼ë¡œ, <strong>ë©”ëª¨ë¦¬ íš¨ìœ¨</strong>, <strong>í•˜ë“œì›¨ì–´ í™œìš©ë„</strong>, <strong>ë²”ìš©ì„±</strong>ì—ì„œ í° ê°•ì ì„ ì§€ë‹˜. íŠ¹íˆ ì—°êµ¬ìë‚˜ ì¤‘ì†Œê¸°ì—… ê°™ì´ <strong>ë¦¬ì†ŒìŠ¤ ì œì•½ì´ ìˆëŠ” í™˜ê²½ì—ì„œë„ ëŒ€ê·œëª¨ LLMì„ í•™ìŠµí•  ìˆ˜ ìˆëŠ” ì‹¤ìš©ì  ê°€ëŠ¥ì„±</strong>ì„ ì œì‹œí–ˆë‹¤ëŠ” ì ì—ì„œ ë§¤ìš° ê°€ì¹˜ ìˆìŒ.</p><h1 id=q--pytorch-ì½”ë“œ-ìˆ˜ì¤€ì˜-ì˜ì‚¬-ì½”ë“œë¡œ-êµ¬í˜„-ì˜ˆì‹œë¥¼-ì œê³µí•´ì¤˜>Q : PyTorch ì½”ë“œ ìˆ˜ì¤€ì˜ ì˜ì‚¬ ì½”ë“œë¡œ êµ¬í˜„ ì˜ˆì‹œë¥¼ ì œê³µí•´ì¤˜</h1><p>ì¢‹ì•„ìš”. ì•„ë˜ëŠ” ë…¼ë¬¸ì—ì„œ ì œì•ˆí•œ <strong>FPDT(Fully Pipelined Distributed Transformer)</strong> êµ¬ì¡°ì˜ í•µì‹¬ ìš”ì†Œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í•œ <strong>PyTorch ì˜ì‚¬ ì½”ë“œ</strong>ì…ë‹ˆë‹¤. íŠ¹íˆ, ë‹¤ìŒì„ ë°˜ì˜í•©ë‹ˆë‹¤:</p><ol><li><strong>ì‹œí€€ìŠ¤ ì²­í¬ ë¶„í•  (chunking)</strong></li><li><strong>QKV Projection í›„ All-to-All í†µì‹ </strong></li><li><strong>Host Memory ì˜¤í”„ë¡œë“œ ë° Prefetching</strong></li><li><strong>Online Attention ì²˜ë¦¬</strong></li><li><strong>Double Buffering</strong></li></ol><hr><h3 id=-ê°œë…ì -ì „ì œ>ğŸ§  ê°œë…ì  ì „ì œ</h3><ul><li>ì´ ì‹œí€€ìŠ¤ ê¸¸ì´: <code>seq_len = 2_000_000</code></li><li>ì²­í¬ ë‹¨ìœ„: <code>chunk_size = 64_000</code></li><li>GPU ìˆ˜: <code>num_gpus = 4</code></li><li>ê° GPUëŠ” chunk ì¼ë¶€ë¥¼ ì²˜ë¦¬í•˜ë©°, ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ attentionì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ <code>AlltoAll</code>ì„ ì‚¬ìš©</li><li><code>host_memory</code>ëŠ” CPUì— ìœ„ì¹˜í•œ <code>torch.Tensor</code> dictionaryë¡œ ëª¨ì‚¬</li></ul><hr><h3 id=-í•µì‹¬-êµ¬ì¡°-pytorch-ìŠ¤íƒ€ì¼-ì˜ì‚¬-ì½”ë“œ>ğŸ§¾ í•µì‹¬ êµ¬ì¡°: PyTorch ìŠ¤íƒ€ì¼ ì˜ì‚¬ ì½”ë“œ</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-1 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-1 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>class</span> <span class=nc>FPDTBlock</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hidden_dim</span><span class=p>,</span> <span class=n>num_heads</span><span class=p>,</span> <span class=n>chunk_size</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>qkv_proj</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=n>hidden_dim</span><span class=p>,</span> <span class=n>hidden_dim</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>out_proj</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=n>hidden_dim</span><span class=p>,</span> <span class=n>hidden_dim</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>attn</span> <span class=o>=</span> <span class=n>ScaledDotProductAttention</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>chunk_size</span> <span class=o>=</span> <span class=n>chunk_size</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>hidden_dim</span> <span class=o>=</span> <span class=n>hidden_dim</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_heads</span> <span class=o>=</span> <span class=n>num_heads</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_seq</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>):</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=c1># input_seq: [B, S, D]</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=n>B</span><span class=p>,</span> <span class=n>S</span><span class=p>,</span> <span class=n>D</span> <span class=o>=</span> <span class=n>input_seq</span><span class=o>.</span><span class=n>shape</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=n>num_chunks</span> <span class=o>=</span> <span class=n>S</span> <span class=o>//</span> <span class=bp>self</span><span class=o>.</span><span class=n>chunk_size</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=n>outputs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=c1># Step 1: Chunking</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=n>chunks</span> <span class=o>=</span> <span class=n>input_seq</span><span class=o>.</span><span class=n>chunk</span><span class=p>(</span><span class=n>num_chunks</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># [B, chunk_size, D]</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=c1># Host memory offloading êµ¬ì¡°</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=n>host_kv_cache</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># host memory simulation (CPU)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>chunks</span><span class=p>):</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>            <span class=c1># Step 2: QKV Projection</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>            <span class=n>qkv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>qkv_proj</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>  <span class=c1># [B, chunk_size, 3 * D]</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>            <span class=n>q</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=o>=</span> <span class=n>qkv</span><span class=o>.</span><span class=n>chunk</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>dim</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=c1># Step 3: AlltoAll simulation (head-wise split across GPUs)</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>            <span class=n>q</span> <span class=o>=</span> <span class=n>q</span><span class=o>.</span><span class=n>cuda</span><span class=p>()</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>            <span class=n>k</span> <span class=o>=</span> <span class=n>k</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span>  <span class=c1># Offload to host</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=n>v</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>            <span class=n>host_kv_cache</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>  <span class=c1># store to &#34;host&#34;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>                <span class=c1># No past context needed</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>                <span class=n>attn_out</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>attn</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=n>k</span><span class=o>.</span><span class=n>cuda</span><span class=p>(),</span> <span class=n>v</span><span class=o>.</span><span class=n>cuda</span><span class=p>())</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>                <span class=c1># Step 4: Fetch previous k, v from host memory</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>                <span class=n>all_k</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>                <span class=n>all_v</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>                <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>  <span class=c1># causal mask: qáµ¢ attends to kâ‚€..káµ¢</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>                    <span class=n>k_j</span><span class=p>,</span> <span class=n>v_j</span> <span class=o>=</span> <span class=n>host_kv_cache</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>                    <span class=n>all_k</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>k_j</span><span class=o>.</span><span class=n>cuda</span><span class=p>(</span><span class=n>non_blocking</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>                    <span class=n>all_v</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>v_j</span><span class=o>.</span><span class=n>cuda</span><span class=p>(</span><span class=n>non_blocking</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>
</span></span><span class=line><span class=ln>46</span><span class=cl>                <span class=n>k_full</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>(</span><span class=n>all_k</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>                <span class=n>v_full</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>(</span><span class=n>all_v</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>                <span class=n>attn_out</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>attn</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=n>k_full</span><span class=p>,</span> <span class=n>v_full</span><span class=p>)</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl>            <span class=c1># Step 5: Output projection</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>            <span class=n>output</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>out_proj</span><span class=p>(</span><span class=n>attn_out</span><span class=p>)</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>            <span class=n>outputs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>
</span></span><span class=line><span class=ln>54</span><span class=cl>        <span class=k>return</span> <span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># [B, S, D]</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>
</span></span><span class=line><span class=ln>56</span><span class=cl>
</span></span><span class=line><span class=ln>57</span><span class=cl><span class=k>class</span> <span class=nc>ScaledDotProductAttention</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>mask</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>        <span class=c1># q, k, v: [B, T, D]</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>        <span class=n>d_k</span> <span class=o>=</span> <span class=n>q</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>        <span class=n>scores</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>matmul</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=n>k</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>))</span> <span class=o>/</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>d_k</span><span class=p>)</span>  <span class=c1># [B, T_q, T_k]</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>        <span class=k>if</span> <span class=n>mask</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>            <span class=n>scores</span> <span class=o>=</span> <span class=n>scores</span><span class=o>.</span><span class=n>masked_fill</span><span class=p>(</span><span class=n>mask</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mf>1e9</span><span class=p>)</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>        <span class=n>attn_weights</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>softmax</span><span class=p>(</span><span class=n>scores</span><span class=p>,</span> <span class=n>dim</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>        <span class=k>return</span> <span class=n>torch</span><span class=o>.</span><span class=n>matmul</span><span class=p>(</span><span class=n>attn_weights</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>  <span class=c1># [B, T_q, D]</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-1",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h3 id=-double-buffering-ë…¼ë¦¬-ìš”ì•½>ğŸ¯ Double Buffering ë…¼ë¦¬ ìš”ì•½</h3><p>ì‹¤ì œ CUDA êµ¬í˜„ì—ì„œëŠ”:</p><ul><li><code>qÌ‚i, kÌ‚i, vÌ‚i</code>ë¥¼ prefetchí•˜ëŠ” <strong>Stream A</strong></li><li>í˜„ì¬ chunkì˜ attentionì„ ìˆ˜í–‰í•˜ëŠ” <strong>Stream B</strong></li><li>ì´ì „ chunk ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•˜ëŠ” <strong>Stream C</strong></li></ul><p>ì´ë ‡ê²Œ ìµœì†Œ <strong>3ê°œì˜ CUDA stream</strong>ì„ ëŒë¦¬ë©° chunk ê°„ ì˜¤ë²„ë©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. PyTorchì—ì„œëŠ” <code>torch.cuda.Stream</code>ì„ ì‚¬ìš©í•´ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ êµ¬í˜„ ê°€ëŠ¥í•˜ì§€ë§Œ, ìœ„ ì˜ì‚¬ì½”ë“œì—ì„œëŠ” ê°œë…ë§Œ ì „ë‹¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p><hr><h3 id=-ì°¸ê³ -êµ¬í˜„-ë¼ì´ë¸ŒëŸ¬ë¦¬>ğŸ”© ì°¸ê³  êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬</h3><p>ë…¼ë¬¸ êµ¬í˜„ì€ DeepSpeed Ulyssesë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, GitHub ì£¼ì†Œë„ ëª…ì‹œë¨:
ğŸ‘‰ <a href=https://github.com/microsoft/DeepSpeed/pull/6462>https://github.com/microsoft/DeepSpeed/pull/6462</a></p><h1 id=q--ë…¼ë¬¸ì˜-í•µì‹¬ì•Œê³ ë¦¬ì¦˜ì„-ì˜ˆì‹œë¥¼-ë“¤ì–´-ì•„ì£¼-ìì„¸í•˜ê²Œ-ì„¤ëª…í•´ì£¼ê³ -ì •ë¦¬í•´-ì¤˜>Q : ë…¼ë¬¸ì˜ í•µì‹¬ì•Œê³ ë¦¬ì¦˜ì„ ì˜ˆì‹œë¥¼ ë“¤ì–´ ì•„ì£¼ ìì„¸í•˜ê²Œ ì„¤ëª…í•´ì£¼ê³  ì •ë¦¬í•´ ì¤˜</h1><p>ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œëŠ” ë…¼ë¬¸ <em>&ldquo;Training Ultra Long Context Language Model with Fully Pipelined Distributed Transformer (FPDT)&rdquo;</em> ì˜ <strong>í•µì‹¬ ì•Œê³ ë¦¬ì¦˜</strong>ì„ ì•„ì£¼ ìì„¸í•˜ê²Œ ì„¤ëª…í•˜ê³ , ì‹¤ì œ ì‹œí€€ìŠ¤ ì˜ˆì‹œë¥¼ ë“¤ì–´ ì „ ê³¼ì •ì„ êµ¬ì¡°í™”í•´ì„œ ì •ë¦¬í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p><hr><h2 id=-í•µì‹¬-ê°œë…-ìš”ì•½>âœ… í•µì‹¬ ê°œë… ìš”ì•½</h2><p><strong>FPDT(Fully Pipelined Distributed Transformer)</strong> ëŠ” ë‹¤ìŒ ì„¸ ê°€ì§€ ê¸°ìˆ ì„ ì¡°í•©í•˜ì—¬ <strong>ìˆ˜ë°±ë§Œ í† í°ì˜ ì´ˆì¥ë¬¸ ì‹œí€€ìŠ¤ë¥¼ ì ì€ GPU ìˆ˜ë¡œ í•™ìŠµ ê°€ëŠ¥</strong>í•˜ê²Œ í•©ë‹ˆë‹¤:</p><ol><li><strong>ì‹œí€€ìŠ¤ ì²­í¬ ë¶„í•  (Chunking)</strong></li><li><strong>ë©”ëª¨ë¦¬ ì˜¤í”„ë¡œë“œ + Prefetching (Hostâ†”GPU)</strong></li><li><strong>Attention ì—°ì‚°ê³¼ ì˜¤í”„ë¡œë“œ ë³‘ë ¬ ìˆ˜í–‰ (Double Buffering)</strong></li></ol><p>ì´ êµ¬ì¡°ë¥¼ í†µí•´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ì„ í˜•ìœ¼ë¡œ ì¤„ì´ê³ , GPU í™œìš©ë„(MFU)ë¥¼ 55% ì´ìƒ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><hr><h2 id=-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜-ì˜ˆì‹œë¡œ-ìì„¸íˆ-ì„¤ëª…>ğŸ” í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ ì˜ˆì‹œë¡œ ìì„¸íˆ ì„¤ëª…</h2><h3 id=-ì˜ˆì‹œ-ìƒí™©>ğŸŒŸ ì˜ˆì‹œ ìƒí™©</h3><table><thead><tr><th>í•­ëª©</th><th>ê°’</th></tr></thead><tbody><tr><td>ëª¨ë¸</td><td>LLaMA 8B</td></tr><tr><td>GPU ìˆ˜</td><td>4ê°œ (A100 80GB)</td></tr><tr><td>ì‹œí€€ìŠ¤ ê¸¸ì´</td><td><code>S = 1,024,000</code> (100ë§Œ í† í°)</td></tr><tr><td>ì²­í¬ í¬ê¸°</td><td><code>chunk_size = 256,000</code> â†’ ì´ 4ê°œ ì²­í¬</td></tr><tr><td>ë°°ì¹˜ í¬ê¸°</td><td>1</td></tr><tr><td>í† í°</td><td><code>[xâ‚, xâ‚‚, ..., xâ‚â‚€â‚‚â‚„â‚€â‚€â‚€]</code></td></tr></tbody></table><hr><h3 id=-step-by-step-íë¦„-forward-ê¸°ì¤€>âš™ï¸ Step-by-Step íë¦„ (Forward ê¸°ì¤€)</h3><hr><h4 id=-step-1-ì‹œí€€ìŠ¤-ì²­í¬-ë¶„í• -chunking>ğŸ§© Step 1. ì‹œí€€ìŠ¤ ì²­í¬ ë¶„í•  (Chunking)</h4><p>ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ 4ê°œì˜ ì²­í¬ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.</p><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-2 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-2 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln>1</span><span class=cl><span class=n>chunks</span> <span class=o>=</span> <span class=p>[</span><span class=n>Tâ‚€</span><span class=p>:</span> <span class=n>xâ‚</span><span class=o>~</span><span class=n>xâ‚‚â‚…â‚†â‚€â‚€â‚€</span><span class=p>,</span> <span class=n>Tâ‚</span><span class=p>:</span> <span class=n>xâ‚‚â‚…â‚†â‚€â‚€â‚</span><span class=o>~</span><span class=n>xâ‚…â‚â‚‚â‚€â‚€â‚€</span><span class=p>,</span> <span class=o>...</span><span class=p>,</span> <span class=n>Tâ‚ƒ</span><span class=p>:</span> <span class=n>xâ‚‡â‚†â‚ˆâ‚€â‚€â‚</span><span class=o>~</span><span class=n>xâ‚â‚€â‚‚â‚„â‚€â‚€â‚€</span><span class=p>]</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-2",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h4 id=-step-2-ê°-ì²­í¬ì—-ëŒ€í•´-qkv-í”„ë¡œì ì…˜-ìˆ˜í–‰>ğŸ¯ Step 2. ê° ì²­í¬ì— ëŒ€í•´ QKV í”„ë¡œì ì…˜ ìˆ˜í–‰</h4><p>ì˜ˆ: Tâ‚€ (256K tokens)ì— ëŒ€í•´</p><ul><li><code>qâ‚€</code>, <code>kâ‚€</code>, <code>vâ‚€</code> = Linear(Tâ‚€)</li></ul><hr><h4 id=-step-3-all-to-all-í†µì‹ -ìˆ˜í–‰>ğŸ”„ Step 3. All-to-All í†µì‹  ìˆ˜í–‰</h4><ul><li>Q: ë¡œì»¬ ì‹œí€€ìŠ¤ë¥¼ ì „ë¶€ ê°–ê³ , headë¥¼ ë‚˜ëˆ„ì–´ ì²˜ë¦¬ â†’ <strong>qÌ‚â‚€</strong></li><li>K/V: headëŠ” ëª¨ë‘ ë³´ìœ í•˜ê³ , ì‹œí€€ìŠ¤ë¥¼ ë‚˜ëˆ„ì–´ ë°›ìŒ â†’ <strong>kÌ‚â‚€, vÌ‚â‚€</strong></li></ul><p><strong>ê²°ê³¼</strong>: ê° GPUëŠ” ë™ì¼í•œ ì‹œí€€ìŠ¤ë¥¼ ë³´ì§€ë§Œ ë‹¤ë¥¸ headë¥¼ ê°€ì§</p><hr><h4 id=-step-4-host-memoryì—-k-v-ì˜¤í”„ë¡œë“œ>ğŸ’¾ Step 4. Host Memoryì— kÌ‚, vÌ‚ ì˜¤í”„ë¡œë“œ</h4><ul><li><code>kÌ‚â‚€</code>, <code>vÌ‚â‚€</code> â†’ Hostë¡œ ì´ë™ (CPU RAM)</li><li><code>qÌ‚â‚€</code>ë§Œ GPUì— ë‚¨ì•„ <strong>Attention ìˆ˜í–‰</strong></li></ul><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>âœ… ì´ë•ŒëŠ” ê³¼ê±°ê°€ ì—†ìœ¼ë¯€ë¡œ <code>qÌ‚â‚€</code> â†’ <code>kÌ‚â‚€</code>, <code>vÌ‚â‚€</code> ë§Œìœ¼ë¡œ attention ê³„ì‚°</p></div></blockquote><hr><h4 id=-step-5-ë‹¤ìŒ-ì²­í¬-tì—-ëŒ€í•´-ë°˜ë³µ>ğŸ” Step 5. ë‹¤ìŒ ì²­í¬ Tâ‚ì— ëŒ€í•´ ë°˜ë³µ</h4><ul><li><code>qâ‚</code>, <code>kâ‚</code>, <code>vâ‚</code> â†’ Linear â†’ AlltoAll â†’ <code>qÌ‚â‚</code>, <code>kÌ‚â‚</code>, <code>vÌ‚â‚</code></li><li>Hostì—ì„œ <code>kÌ‚â‚€</code>, <code>vÌ‚â‚€</code> ê°€ì ¸ì˜¤ê¸° â†’ GPUì— ì˜¬ë¦¼</li><li><code>qÌ‚â‚</code>ì€ <code>[kÌ‚â‚€, kÌ‚â‚]</code>, <code>[vÌ‚â‚€, vÌ‚â‚]</code> ì— ëŒ€í•´ attention ìˆ˜í–‰</li></ul><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ğŸ¯ <strong>Online Attention</strong>: ê³¼ê±° ì²­í¬ë¥¼ í•œ ê°œì”© GPUì— ì˜¬ë¦¬ë©° ìˆœì°¨ì ìœ¼ë¡œ attention ê³„ì‚°</p></div></blockquote><hr><h4 id=-step-6-ì´-ê³¼ì •ì„-ëª¨ë“ -ì²­í¬ì—-ëŒ€í•´-ë°˜ë³µ>ğŸ”ƒ Step 6. ì´ ê³¼ì •ì„ ëª¨ë“  ì²­í¬ì— ëŒ€í•´ ë°˜ë³µ</h4><p>ì˜ˆ: Tâ‚ƒ ì²˜ë¦¬ ì‹œì—ëŠ” <code>kÌ‚â‚€ ~ kÌ‚â‚ƒ</code>, <code>vÌ‚â‚€ ~ vÌ‚â‚ƒ</code>ë¥¼ ìˆœì„œëŒ€ë¡œ prefetchí•˜ë©° attention ìˆ˜í–‰</p><hr><h3 id=-backward-pass-double-buffering>ğŸ”„ Backward Pass: Double Buffering</h3><p>Backwardì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ <strong>nested loop</strong> êµ¬ì¡°ë¥¼ ê°€ì§</p><ul><li><strong>Outer Loop</strong>: <code>kÌ‚i, vÌ‚i</code> (ê³¼ê±° ì²­í¬)</li><li><strong>Inner Loop</strong>: <code>qÌ‚j</code> (í˜„ì¬ ì²­í¬)</li></ul><h4 id=ì˜ˆ-4ê°œ-ì²­í¬ì¼-ë•Œ-backward-íë¦„>ì˜ˆ: 4ê°œ ì²­í¬ì¼ ë•Œ backward íë¦„</h4><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-3 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-3 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>for i in [0, 1, 2, 3]:  # over kÌ‚i, vÌ‚i
</span></span><span class=line><span class=ln>2</span><span class=cl>    fetch kÌ‚i, vÌ‚i from host to GPU
</span></span><span class=line><span class=ln>3</span><span class=cl>    for j in [i, ..., 3]:  # qÌ‚jê°€ í˜„ì¬ì™€ ì´í›„ ì²­í¬
</span></span><span class=line><span class=ln>4</span><span class=cl>        fetch qÌ‚j from host
</span></span><span class=line><span class=ln>5</span><span class=cl>        compute attention gradient(qÌ‚j, kÌ‚i, vÌ‚i)
</span></span><span class=line><span class=ln>6</span><span class=cl>        accumulate dqÌ‚j, dkÌ‚i, dvÌ‚i</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-3",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><ul><li>ì£¼ì˜: causal attention ì„±ì§ˆ ìƒ, <code>qÌ‚j</code>ëŠ” <code>kÌ‚i</code>ë§Œ attend ê°€ëŠ¥ if <code>i &lt;= j</code></li><li>ì´í›„ <code>AlltoAll</code>ë¡œ ì›ë˜ GPUì— gradë¥¼ ë³µì›í•˜ê³  <code>dq, dk, dv â†’ dInput</code> ê³„ì‚°</li></ul><hr><h3 id=-ë©”ëª¨ë¦¬-ìµœì í™”-êµ¬ì¡°-ìš”ì•½>ğŸ“¦ ë©”ëª¨ë¦¬ ìµœì í™” êµ¬ì¡° ìš”ì•½</h3><table><thead><tr><th>ì „ëµ</th><th>ì„¤ëª…</th></tr></thead><tbody><tr><td><strong>Chunking</strong></td><td>memory peakë¥¼ <code>1/u</code>ë¡œ ê°ì†Œ (u: chunk ìˆ˜)</td></tr><tr><td><strong>Offloading</strong></td><td>ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” k/vë¥¼ Host(CPU)ë¡œ ì´ë™</td></tr><tr><td><strong>Prefetching</strong></td><td>ë‹¤ìŒ chunkì˜ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ GPUë¡œ ì˜¬ë¦¼</td></tr><tr><td><strong>Double Buffering</strong></td><td>ì—°ì‚°ê³¼ ë©”ëª¨ë¦¬ I/Oë¥¼ ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬</td></tr><tr><td><strong>Stream 3ê°œ ì‚¬ìš©</strong></td><td>ì—°ì‚°, fetch, free ê°ê° ì „ìš© stream</td></tr></tbody></table><hr><h2 id=-ì‹œê°ì -ìš”ì•½>ğŸ“Š ì‹œê°ì  ìš”ì•½</h2><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-4 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-4 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>Chunk Tâ‚€ â”€â–º [Qâ‚€, Kâ‚€, Vâ‚€] â”€â–º [AlltoAll] â”€â–º [Attention(qÌ‚â‚€, kÌ‚â‚€,vÌ‚â‚€)]
</span></span><span class=line><span class=ln>2</span><span class=cl>                      â””â”€â”€ host â† kÌ‚â‚€, vÌ‚â‚€
</span></span><span class=line><span class=ln>3</span><span class=cl>Chunk Tâ‚ â”€â–º [Qâ‚, Kâ‚, Vâ‚] â”€â–º [AlltoAll]
</span></span><span class=line><span class=ln>4</span><span class=cl>  fetch from host: [kÌ‚â‚€, vÌ‚â‚€]
</span></span><span class=line><span class=ln>5</span><span class=cl>                      â””â”€â”€ Attention(qÌ‚â‚, [kÌ‚â‚€,kÌ‚â‚], [vÌ‚â‚€,vÌ‚â‚])
</span></span><span class=line><span class=ln>6</span><span class=cl>...</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-4",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h2 id=-ì •ë¦¬>âœ… ì •ë¦¬</h2><table><thead><tr><th>ìš”ì†Œ</th><th>ì—­í• </th><th>ì´ì </th></tr></thead><tbody><tr><td><strong>Chunking</strong></td><td>ì‹œí€€ìŠ¤ë¥¼ ë‚˜ëˆ  ì—°ì‚° ë° ë©”ëª¨ë¦¬ ìµœì í™”</td><td>O(1/u) ë©”ëª¨ë¦¬ ê°ì†Œ</td></tr><tr><td><strong>AlltoAll</strong></td><td>head-wise ë³‘ë ¬ attention</td><td>GPU ë¶„ì‚° ìµœì í™”</td></tr><tr><td><strong>Offloading</strong></td><td>k/vë¥¼ CPU RAMìœ¼ë¡œ ì´ë™</td><td>HBM ì‚¬ìš©ëŸ‰ ì ˆê°</td></tr><tr><td><strong>Prefetch + Double Buffering</strong></td><td>I/Oì™€ ì—°ì‚° ë™ì‹œ ì§„í–‰</td><td>GPU ë¹„íš¨ìœ¨ ë°©ì§€, MFU ì¦ê°€</td></tr><tr><td><strong>Online Attention</strong></td><td>ì´ì „ ì²­í¬ ì¬í™œìš©</td><td>ê¸´ ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬ ê°€ëŠ¥</td></tr></tbody></table><h1 id=q--ì´-ë…¼ë¬¸ì—ì„œ-ì œì‹œí•œ-ê²°ê³¼ë¥¼-ìì„¸í•˜ê²Œ-ë³´ê³ -ë‹¤ë¥¸-ë°©ë²•ë¡ ì—-ë¹„í•˜ì—¬-íŠ¹ì¶œë‚œ-ì ê³¼-ë…¼ë¬¸ì—ì„œ-ì œê¸°í•˜ëŠ”-ì–´ë– í•œ-ë°©ë²•ì´-ì´ëŸ¬í•œ-ê²°ê³¼ë¥¼-ë„ì¶œí•˜ê²Œ-ë˜ì—ˆëŠ”ì§€-ë…¼ë¬¸ì—ì„œ-ì œì‹œí•˜ëŠ”-ì´ìœ ì™€-ë„ˆì˜-ìƒê°ì„-ì•Œë ¤ì¤˜>Q : ì´ ë…¼ë¬¸ì—ì„œ ì œì‹œí•œ ê²°ê³¼ë¥¼ ìì„¸í•˜ê²Œ ë³´ê³  ë‹¤ë¥¸ ë°©ë²•ë¡ ì— ë¹„í•˜ì—¬ íŠ¹ì¶œë‚œ ì ê³¼ ë…¼ë¬¸ì—ì„œ ì œê¸°í•˜ëŠ” ì–´ë– í•œ ë°©ë²•ì´ ì´ëŸ¬í•œ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ê²Œ ë˜ì—ˆëŠ”ì§€ ë…¼ë¬¸ì—ì„œ ì œì‹œí•˜ëŠ” ì´ìœ ì™€ ë„ˆì˜ ìƒê°ì„ ì•Œë ¤ì¤˜</h1><p>ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ë…¼ë¬¸ <em>Training Ultra Long Context Language Model with Fully Pipelined Distributed Transformer</em> ì—ì„œ ì œì‹œí•œ ì‹¤í—˜ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, <strong>(1) ê¸°ì¡´ ë°©ë²•ê³¼ì˜ ì„±ëŠ¥ ë¹„êµ</strong>, <strong>(2) íŠ¹ì¶œë‚œ ì </strong>, <strong>(3) ì›ì¸ì„ ë§Œë“œëŠ” í•µì‹¬ ê¸°ìˆ  ìš”ì†Œ</strong>, ê·¸ë¦¬ê³  <strong>(4) ë…¼ë¬¸ ì£¼ì¥ì— ëŒ€í•œ í‰ê°€ ë° ë‚´ ìƒê°</strong>ì„ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</p><hr><h2 id=-1-ì‹¤í—˜-ê²°ê³¼-ìš”ì•½-ì„±ëŠ¥-ë¹„êµ>âœ… 1. ì‹¤í—˜ ê²°ê³¼ ìš”ì•½: ì„±ëŠ¥ ë¹„êµ</h2><h3 id=-ëª¨ë¸ë³„-ìµœëŒ€-ì‹œí€€ìŠ¤-ê¸¸ì´-ë°-gpu-ì‚¬ìš©ëŸ‰-ë¹„êµ-table--figure-11-ê¸°ë°˜>ğŸ“Š ëª¨ë¸ë³„ ìµœëŒ€ ì‹œí€€ìŠ¤ ê¸¸ì´ ë° GPU ì‚¬ìš©ëŸ‰ ë¹„êµ (Table + Figure 11 ê¸°ë°˜)</h3><table><thead><tr><th>Model</th><th>GPU ìˆ˜</th><th>Megatron-SP Max Seq</th><th>Ulysses Max Seq</th><th><strong>FPDT Max Seq</strong></th><th>MFU (FPDT)</th></tr></thead><tbody><tr><td>GPT 2.7B</td><td>2</td><td>256K</td><td>256K</td><td><strong>2M (8Ã—)</strong></td><td><strong>53.1%</strong></td></tr><tr><td>GPT 6.7B</td><td>4</td><td>128K</td><td>256K</td><td><strong>2M (16Ã—)</strong></td><td><strong>46.2%</strong></td></tr><tr><td>LLaMA 8B</td><td>4</td><td>128K</td><td>512K</td><td><strong>2M (4Ã—)</strong></td><td><strong>47.2%</strong></td></tr><tr><td>GPT 13B</td><td>8</td><td>256K</td><td>512K</td><td><strong>2M (4Ã—)</strong></td><td><strong>42.9%</strong></td></tr><tr><td>GPT 30B</td><td>16</td><td>-</td><td>1M</td><td><strong>2M (2Ã—)</strong></td><td><strong>41.4%</strong></td></tr><tr><td>LLaMA 70B</td><td>32</td><td>-</td><td>1M</td><td><strong>4M (4Ã—)</strong></td><td><strong>55.7%</strong></td></tr></tbody></table><ul><li>ê¸°ì¡´ Megatron-SPì™€ Ulysses ëŒ€ë¹„ <strong>ìµœëŒ€ 16ë°°</strong> ë” ê¸´ ì‹œí€€ìŠ¤ë¥¼ ì²˜ë¦¬ ê°€ëŠ¥</li><li>GPU í™œìš©ë„ (MFU)ë„ <strong>50% ì´ìƒ ìœ ì§€</strong>, íŠ¹íˆ LLaMA 70B ëª¨ë¸ì—ì„œëŠ” <strong>ìµœê³  55.7%</strong></li></ul><hr><h2 id=-2-íŠ¹ì¶œë‚œ-ì -ê¸°ì¡´-ë°©ë²•ê³¼ì˜-ê²°ì •ì -ì°¨ë³„ì„±>ğŸŒŸ 2. íŠ¹ì¶œë‚œ ì  (ê¸°ì¡´ ë°©ë²•ê³¼ì˜ ê²°ì •ì  ì°¨ë³„ì„±)</h2><table><thead><tr><th>í•­ëª©</th><th>ê¸°ì¡´ Megatron-SP / Ulysses</th><th><strong>FPDTì˜ ì°¨ë³„ì </strong></th></tr></thead><tbody><tr><td>ì‹œí€€ìŠ¤ ì²˜ë¦¬ ëŠ¥ë ¥</td><td>ìˆ˜ì‹­ë§Œ (256K ~ 512K)</td><td><strong>ìˆ˜ë°±ë§Œ (ìµœëŒ€ 4M)</strong></td></tr><tr><td>GPU ì‚¬ìš©ëŸ‰</td><td>ë™ì¼ ì‹œí€€ìŠ¤ì— ìˆ˜ì‹­~ìˆ˜ë°± GPU í•„ìš”</td><td><strong>ë‹¨ 4~32 GPUë¡œ ë‹¬ì„±</strong></td></tr><tr><td>ë©”ëª¨ë¦¬ ë³‘ëª© í•´ì†Œ</td><td>ë¶€ë¶„ì  (Activation Checkpoint ë“±)</td><td><strong>ì „ì²´ Transformer block ìˆ˜ì¤€ ìµœì í™”</strong></td></tr><tr><td>ì—°ì‚°/í†µì‹  íŒŒì´í”„ë¼ì´ë‹</td><td>ì—†ìŒ ë˜ëŠ” ì œí•œì </td><td><strong>ì „ ì—°ì‚° ë‹¨ê³„ì— Double Buffer ì ìš©</strong></td></tr><tr><td>í˜¸í™˜ì„±</td><td>íŠ¹ì • í”„ë ˆì„ì›Œí¬ ì¢…ì†</td><td><strong>DeepSpeed ZeRO, FSDP ë“±ê³¼ í˜¸í™˜</strong></td></tr></tbody></table><p>â†’ ê²°ë¡ ì ìœ¼ë¡œ, **â€œê°™ì€ í•˜ë“œì›¨ì–´ì—ì„œ í›¨ì”¬ ë” ê¸´ ì‹œí€€ìŠ¤ë¥¼ í•™ìŠµâ€**í•  ìˆ˜ ìˆê²Œ ë§Œë“  ê²ƒì´ ê°€ì¥ í° ê¸°ì—¬</p><hr><h2 id=-3-ì´ëŸ¬í•œ-ê²°ê³¼ë¥¼-ë§Œë“ -í•µì‹¬-ê¸°ìˆ -ìš”ì†Œ-ë…¼ë¬¸-ì„¤ëª…-ê¸°ë°˜>ğŸ§  3. ì´ëŸ¬í•œ ê²°ê³¼ë¥¼ ë§Œë“  í•µì‹¬ ê¸°ìˆ  ìš”ì†Œ (ë…¼ë¬¸ ì„¤ëª… ê¸°ë°˜)</h2><table><thead><tr><th>ê¸°ìˆ  ìš”ì†Œ</th><th>ë…¼ë¬¸ì—ì„œì˜ ì„¤ëª…</th><th>ê²°ê³¼ì— ë¯¸ì¹œ ì˜í–¥</th></tr></thead><tbody><tr><td><strong>ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬ (Chunking)</strong></td><td>ì‹œí€€ìŠ¤ë¥¼ ì²­í¬ë¡œ ë‚˜ëˆ„ì–´ QKVÂ·AttentionÂ·FFN ì—°ì‚°ì„ ë¶„ì‚° ì²˜ë¦¬</td><td>GPU memory peak ì¤„ì„ (ìµœëŒ€ 1/u ê°ì†Œ)</td></tr><tr><td><strong>Host memory offloading</strong></td><td>K/Vë¥¼ GPUì—ì„œ CPUë¡œ ì˜®ê²¨ HBM ì‚¬ìš© ê°ì†Œ</td><td>ê¸°ì¡´ GPU ë©”ëª¨ë¦¬ë¡œëŠ” ë¶ˆê°€ëŠ¥í•œ sequence ì²˜ë¦¬ ê°€ëŠ¥</td></tr><tr><td><strong>Online Attention</strong></td><td>í˜„ì¬ ì²­í¬ì˜ Qê°€ ê³¼ê±° ì²­í¬ì˜ K/Vë¥¼ ì°¸ì¡°</td><td>ì´ˆì¥ë¬¸ ì‹œí€€ìŠ¤ë¥¼ forward/backward ëª¨ë‘ ì²˜ë¦¬</td></tr><tr><td><strong>Double Buffering + CUDA Streams</strong></td><td>Fetch/Compute/Free ë³‘ë ¬í™” (ìµœëŒ€ 3ê°œ stream)</td><td>PCIe ë³‘ëª©ì„ ê°€ë¦¬ê³  GPU ì—°ì‚° ìœ íœ´ ì‹œê°„ ìµœì†Œí™”</td></tr><tr><td><strong>AlltoAll ë¦¬ë””ìì¸</strong></td><td>ê¸°ì¡´ Ulyssesë³´ë‹¤ ê°€ë³ê³  head-wise êµí™˜</td><td>í†µì‹ ëŸ‰ ìµœì í™” + NVLink ë°¸ëŸ°ì‹±</td></tr></tbody></table><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ë…¼ë¬¸ì—ì„œëŠ” íŠ¹íˆ <strong>hostâ†”GPU ì˜¤í”„ë¡œë“œë¥¼ ì˜ ë³‘ë ¬í™”í•œ ê²ƒ</strong>ì´ MFU ìƒìŠ¹ì˜ í•µì‹¬ì´ë¼ê³  ì„¤ëª…</p></div></blockquote><hr><h2 id=-4-ë…¼ë¬¸-ì£¼ì¥ì˜-í‰ê°€--ë‚´-ìƒê°>ğŸ’¡ 4. ë…¼ë¬¸ ì£¼ì¥ì˜ í‰ê°€ + ë‚´ ìƒê°</h2><h3 id=-ë…¼ë¬¸-ì£¼ì¥-ì •ë¦¬>ğŸ§¾ ë…¼ë¬¸ ì£¼ì¥ ì •ë¦¬</h3><ul><li>ê¸°ì¡´ì—ëŠ” ê¸´ ì»¨í…ìŠ¤íŠ¸ LLM í•™ìŠµì— <strong>ìˆ˜ì‹­~ìˆ˜ë°± GPU</strong>ê°€ í•„ìš”</li><li>FPDTëŠ” <strong>host memoryì™€ì˜ pipeline ì²˜ë¦¬</strong>ë¡œ <strong>4~32 GPUë§Œìœ¼ë¡œ ìµœëŒ€ 4M ì‹œí€€ìŠ¤ í•™ìŠµ ê°€ëŠ¥</strong></li><li>ë©”ëª¨ë¦¬ ìŠ¤íŒŒì´í¬ ì—†ì´ GPU í™œìš©ë„ë„ <strong>50% ì´ìƒ ìœ ì§€</strong></li><li>LLaMA, GPT ë“± ë‹¤ì–‘í•œ ëª¨ë¸ì— ë²”ìš© ì ìš© ê°€ëŠ¥</li></ul><h3 id=-ë‚´-ìƒê°-í‰ê°€>âœ… ë‚´ ìƒê° (í‰ê°€)</h3><ul><li>ë…¼ë¬¸ì€ ë‹¨ìˆœíˆ &ldquo;ë” ê¸¸ê²Œ&rdquo; í•™ìŠµí•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, <strong>ê·¹ë‹¨ì ìœ¼ë¡œ ìì› íš¨ìœ¨ì ì¸ êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤Œ</strong></li><li>íŠ¹íˆ <strong>4 GPUë¡œ 2M í† í°</strong>ì„ í•™ìŠµí•  ìˆ˜ ìˆê²Œ í•œ ê±´ ìƒë‹¹íˆ ì¸ìƒì  (ê¸°ì¡´ 64 GPU ì´ìƒ í•„ìš”í–ˆë˜ ì‘ì—…)</li><li>ì‹œí€€ìŠ¤ë¥¼ ìª¼ê°œê³ , ìºì‹œí•˜ê³ , ê°€ì ¸ì˜¤ê³ , ë‹¤ì‹œ ì“°ëŠ” ë“± ì‹œìŠ¤í…œ ìˆ˜ì¤€ ì„¤ê³„ê°€ í›Œë¥­í•¨</li><li>ë‹¤ë§Œ, <strong>FFNì´ë‚˜ Softmax ë¶€ë¶„ì€ ì—¬ì „íˆ ë©”ëª¨ë¦¬ ë³‘ëª©</strong>ì´ ì¡´ì¬í•˜ë¯€ë¡œ ì™„ì „í•œ ì†”ë£¨ì…˜ì€ ì•„ë‹˜</li><li>ì‹¤ì œ PyTorch + CUDA í™˜ê²½ì—ì„œ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” <strong>ë³µì¡í•œ low-level êµ¬í˜„ì´ í•„ìš”</strong>í•˜ë‹¤ëŠ” ì ì€ í˜„ì‹¤ì  í—ˆë“¤</li></ul><hr><h2 id=-ìš”ì•½-ì •ë¦¬>âœ… ìš”ì•½ ì •ë¦¬</h2><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>FPDTëŠ” ê¸°ì¡´ ë°©ì‹ ëŒ€ë¹„ <strong>ìµœëŒ€ 16ë°° ë” ê¸´ ì‹œí€€ìŠ¤</strong>, <strong>ìµœëŒ€ 87.5% ë” ì ì€ GPU ìì›</strong>, <strong>55% ì´ìƒ MFU</strong>ë¥¼ ë‹¬ì„±í•œ ì‹œìŠ¤í…œ ìµœì í™” ê¸°ë²•ìœ¼ë¡œ, ì´ëŠ” <code>chunking</code>, <code>offloading</code>, <code>double buffering</code>, <code>online attention</code> ë“±ì˜ ì²´ê³„ì ì¸ ì„¤ê³„ë¥¼ í†µí•´ ê°€ëŠ¥í–ˆë‹¤. ì‹œìŠ¤í…œ ìˆ˜ì¤€ì—ì„œ ë©”ëª¨ë¦¬/í†µì‹ /ì—°ì‚°ì„ ì •ë°€í•˜ê²Œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•œ ì ì´ í•µì‹¬ ê²½ìŸë ¥ì´ë‹¤.</p></div></blockquote><h1 id=q--ì´-ë…¼ë¬¸ì˜-í•œê³„ë¥¼-ê·¹ë³µí•˜ê¸°-ìœ„í•œ-ë°©ë²•ìœ¼ë¡œ-ì–´ë–¤-ì—°êµ¬íë¦„ì´-ìˆëŠ”ì§€-ì •ë¦¬í•´ì„œ-ìì„¸í•˜ê²Œ-ì„¤ëª…í•´-ì¤˜>Q : ì´ ë…¼ë¬¸ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ ì–´ë–¤ ì—°êµ¬íë¦„ì´ ìˆëŠ”ì§€ ì •ë¦¬í•´ì„œ ìì„¸í•˜ê²Œ ì„¤ëª…í•´ ì¤˜</h1><p>ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤. ì´ ë…¼ë¬¸ì—ì„œ ì œì•ˆí•œ <strong>FPDT(Fully Pipelined Distributed Transformer)</strong> ëŠ” ì´ˆì¥ë¬¸(long-context) LLM í•™ìŠµì„ ê°€ëŠ¥í•˜ê²Œ í•œ ì‹œìŠ¤í…œ ìµœì í™” ë°©ì‹ì´ì§€ë§Œ, ì—¬ì „íˆ ëª‡ ê°€ì§€ <strong>í•œê³„ì </strong>ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì•„ë˜ì—ì„œëŠ” í•´ë‹¹ í•œê³„ë¥¼ ë¨¼ì € ì •ë¦¬í•˜ê³ , <strong>ê·¸ í•œê³„ë¥¼ ë³´ì™„í•˜ê±°ë‚˜ ê·¹ë³µí•˜ê¸° ìœ„í•œ ìµœê·¼ ì—°êµ¬ íë¦„</strong>ì„ ê´€ë ¨ ë…¼ë¬¸ ê¸°ë°˜ìœ¼ë¡œ ìƒì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p><hr><h2 id=-1-ì´-ë…¼ë¬¸ì˜-í•µì‹¬-í•œê³„>âœ… 1. ì´ ë…¼ë¬¸ì˜ í•µì‹¬ í•œê³„</h2><table><thead><tr><th>í•œê³„ êµ¬ë¶„</th><th>êµ¬ì²´ì  ì„¤ëª…</th></tr></thead><tbody><tr><td><strong>1. FFN ë©”ëª¨ë¦¬ ìµœì í™” ë¯¸í¡</strong></td><td>FFN ì—°ì‚°ì€ token-wise ì—°ì‚°ì´ë¼ offloadingì´ ë¶ˆê°€ëŠ¥í•˜ê³ , chunking ì™¸ ë©”ëª¨ë¦¬ ì´ë“ì´ ì—†ìŒ.</td></tr><tr><td><strong>2. Gradient AllReduce ë³‘ëª©</strong></td><td>PyTorch ZeRO-3ì™€ í•¨ê»˜ ì“¸ ê²½ìš°, gradient reduction ì‹œ GPU memory spike ë°œìƒ ê°€ëŠ¥</td></tr><tr><td><strong>3. PCIe ë³‘ëª©</strong></td><td>Hostâ†”GPU ê°„ ë°ì´í„° ì´ë™ì€ ì—¬ì „íˆ PCIeë¡œ ì œí•œë˜ì–´ bottleneck ë°œìƒ ê°€ëŠ¥</td></tr><tr><td><strong>4. êµ¬í˜„ ë³µì¡ë„</strong></td><td>Double buffer, prefetch, multi-stream ë“± êµ¬í˜„ ë‚œì´ë„ê°€ ë†’ê³ , ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ì ‘ê·¼ì„±ì´ ë‚®ìŒ</td></tr><tr><td><strong>5. ë¹„íš¨ìœ¨ì ì¸ Vocabulary Projection</strong></td><td>CrossEntropy Loss ì§ì „ì˜ logits projection ë‹¨ê³„ì—ì„œ float32 ì‚¬ìš© ë° vocab sizeë¡œ ì¸í•´ ë©”ëª¨ë¦¬ ê¸‰ì¦</td></tr></tbody></table><hr><h2 id=-2-ì´-í•œê³„ë¥¼-ë³´ì™„í•˜ëŠ”-ìµœê·¼-ì—°êµ¬-íë¦„>ğŸ” 2. ì´ í•œê³„ë¥¼ ë³´ì™„í•˜ëŠ” ìµœê·¼ ì—°êµ¬ íë¦„</h2><hr><h3 id=-1-ffn-ë©”ëª¨ë¦¬-ìµœì í™”--mst-mini-sequence-transformer>ğŸ“Œ [1] FFN ë©”ëª¨ë¦¬ ìµœì í™” â†’ <strong>MsT (Mini-sequence Transformer)</strong></h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p><strong>Luo et al., 2024. arXiv:2407.15892</strong></p></div></blockquote><h4 id=í•µì‹¬-ì•„ì´ë””ì–´>í•µì‹¬ ì•„ì´ë””ì–´</h4><ul><li>FFNì€ token-wise ì—°ì‚°ìœ¼ë¡œ offloadingì´ ì–´ë µê¸° ë•Œë¬¸ì—, <strong>MLP ì—°ì‚° ìì²´ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ë¶„í• </strong>í•˜ê³  ê° chunkë§Œ ë©”ëª¨ë¦¬ì— ì˜¬ë ¤ ê³„ì‚° â†’ memory pressure ê°ì†Œ</li></ul><h4 id=í•œê³„>í•œê³„</h4><ul><li>FFNë§Œ ë‹¤ë£¨ë©° attention ë©”ëª¨ë¦¬ ë¬¸ì œëŠ” ì—¬ì „íˆ ì¡´ì¬</li><li>ì—°ì‚° granularityê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ throughput ì €í•˜ ê°€ëŠ¥ì„±</li></ul><h4 id=ë…¼ë¬¸ê³¼ì˜-ê´€ê³„>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</h4><ul><li>FPDTëŠ” attention ìµœì í™” ì¤‘ì‹¬ â†’ <strong>MsTì™€ ê²°í•© ê°€ëŠ¥</strong></li></ul><hr><h3 id=-2-gradient-ë©”ëª¨ë¦¬-spike-í•´ì†Œ--gradient-checkpoint-fusion--async-reduce>ğŸ“Œ [2] Gradient ë©”ëª¨ë¦¬ spike í•´ì†Œ â†’ <strong>Gradient Checkpoint Fusion / Async Reduce</strong></h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ê´€ë ¨ ì—°êµ¬: ZeRO-Infinity (Rajbhandari et al.), PyTorch FSDP ê°œì„ ì•ˆ</p></div></blockquote><h4 id=í•´ê²°-ë°©ì‹>í•´ê²° ë°©ì‹</h4><ul><li><strong>Gradient AllReduceë¥¼ chunk ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì ì§„ì ìœ¼ë¡œ ìˆ˜í–‰</strong></li><li><strong>CUDA Streamì„ ë¶„ë¦¬í•˜ì—¬ Computeì™€ Reduceë¥¼ ë³‘ë ¬í™”</strong></li><li>ì¼ë¶€ëŠ” <strong>offloadëœ gradientë¥¼ CPUì—ì„œ AllReduce</strong> í›„ ë‹¤ì‹œ GPUë¡œ ë³µì›</li></ul><h4 id=ë…¼ë¬¸ê³¼ì˜-ê´€ê³„-1>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</h4><ul><li>FPDTëŠ” forward/backward activationë§Œ ìµœì í™” â†’ gradient stageëŠ” ë¯¸ë¹„</li><li>í–¥í›„ ZeROì™€ ë” ì •ë°€í•œ í†µí•©ì´ í•„ìš”</li></ul><hr><h3 id=-3-pcie-ë³‘ëª©--unified-memory--nvswitch--direct-storage-ê¸°ë°˜-ì—°êµ¬>ğŸ“Œ [3] PCIe ë³‘ëª© â†’ <strong>Unified Memory / NVSwitch / Direct Storage ê¸°ë°˜ ì—°êµ¬</strong></h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p><strong>NVIDIA Hopper + H100 ê¸°ë°˜</strong>, ê´€ë ¨ ë…¼ë¬¸: RingAttention (Liu et al., 2023), Infini-Attention</p></div></blockquote><h4 id=í•´ê²°-ë°©ì‹-1>í•´ê²° ë°©ì‹</h4><ul><li><strong>NVSwitch or NVLink direct storage</strong> ì´ìš© ì‹œ host memory access latency ê°ì†Œ</li><li><strong>Host memory prefetch ìš°ì„ ìˆœìœ„ ì¡°ì ˆ</strong> í˜¹ì€ <strong>GPU DirectStorage</strong>ë¥¼ í†µí•´ I/O latency ì¤„ì´ê¸°</li></ul><h4 id=ë…¼ë¬¸ê³¼ì˜-ê´€ê³„-2>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</h4><ul><li>FPDTëŠ” ì—¬ì „íˆ PCIe 4.0 ê¸°ë°˜ì—ì„œ ì‹¤í—˜ë¨ â†’ H100/NVSwitch í™˜ê²½ì—ì„œëŠ” ë” í° íš¨ìœ¨ ê°€ëŠ¥</li></ul><hr><h3 id=-4-vocab-projection-ë¬¸ì œ--int8fp8-softmax-lowrank-projection>ğŸ“Œ [4] Vocab Projection ë¬¸ì œ â†’ <strong>Int8/FP8 Softmax, LowRank Projection</strong></h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ê´€ë ¨: OpenLLM-INT8, LLM.int8(), LoRA-PROJ, Blockwise Softmax</p></div></blockquote><h4 id=í•´ê²°-ë°©ì‹-2>í•´ê²° ë°©ì‹</h4><ul><li><strong>Float32 â†’ Float16 or Int8</strong> ë¡œ logits ê³„ì‚°</li><li><strong>Vocab Projectionì„ Low-Rankë¡œ ì••ì¶•</strong>í•˜ê±°ë‚˜, Softmaxë¥¼ block-wiseë¡œ ë¶„ì‚° ì²˜ë¦¬</li></ul><h4 id=fpdtì™€ì˜-ì—°ê³„-ê°€ëŠ¥ì„±>FPDTì™€ì˜ ì—°ê³„ ê°€ëŠ¥ì„±</h4><ul><li>ìµœì¢… ì¶œë ¥ë‹¨ì—ì„œë„ ë©”ëª¨ë¦¬ ìµœì í™”ë¥¼ í•´ì•¼ ì§„ì •í•œ &ldquo;end-to-end long-context training&rdquo; ì™„ì„± ê°€ëŠ¥</li></ul><hr><h3 id=-5-ë”-ì‰¬ìš´-êµ¬í˜„ì„-ìœ„í•œ-ì—°êµ¬--modular-frameworks-colossal-ai-megatron-lm-deepspeed>ğŸ“Œ [5] ë” ì‰¬ìš´ êµ¬í˜„ì„ ìœ„í•œ ì—°êµ¬ â†’ <strong>Modular Frameworks: Colossal-AI, Megatron-LM, DeepSpeed</strong></h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ë‹¤ì–‘í•œ LLM ì‹œìŠ¤í…œ í”„ë ˆì„ì›Œí¬ê°€ <strong>ìë™ offloading / chunking / scheduling</strong>ì„ ì§€ì›í•˜ë„ë¡ í™•ì¥ ì¤‘</p></div></blockquote><h4 id=ì˜ˆì‹œ>ì˜ˆì‹œ</h4><ul><li>Colossal-AIì˜ Gemini Memory Manager</li><li>DeepSpeedì˜ Ulysses ìë™í™” API (ì œì•ˆ ë…¼ë¬¸ê³¼ ë™ì¼ íŒ€)</li></ul><h4 id=ëª©ì >ëª©ì </h4><ul><li>FPDTì™€ ê°™ì€ ê¸°ë²•ì„ <strong>ì‚¬ìš©ìê°€ ì‰½ê²Œ êµ¬ì„±</strong>í•  ìˆ˜ ìˆë„ë¡ ì¶”ìƒí™”</li></ul><hr><h2 id=-3-ìš”ì•½-ì •ë¦¬>âœ… 3. ìš”ì•½ ì •ë¦¬</h2><table><thead><tr><th>FPDT í•œê³„</th><th>ë³´ì™„ ì—°êµ¬ íë¦„</th><th>ê´€ë ¨ ê¸°ìˆ </th></tr></thead><tbody><tr><td>FFN ë©”ëª¨ë¦¬ ìµœì í™” ë¶€ì¬</td><td>MsT</td><td>FFN ì²­í¬ ë¶„í• </td></tr><tr><td>Gradient spike</td><td>Gradient fusion, async reduce</td><td>ZeRO-Infinity, FSDP</td></tr><tr><td>PCIe ë³‘ëª©</td><td>NVLink, GPU DirectStorage</td><td>Hopper/NVSwitch ì•„í‚¤í…ì²˜</td></tr><tr><td>Vocab projection</td><td>Int8/LowRank Softmax</td><td>LLM.int8(), LoRA-Proj</td></tr><tr><td>êµ¬í˜„ ë‚œì´ë„</td><td>ìë™í™” í”„ë ˆì„ì›Œí¬</td><td>ColossalAI, DeepSpeed API</td></tr></tbody></table><hr><h2 id=-ì •ë¦¬-ì•ìœ¼ë¡œì˜-ì—°êµ¬-ë°©í–¥ì„±>ğŸ§  ì •ë¦¬: ì•ìœ¼ë¡œì˜ ì—°êµ¬ ë°©í–¥ì„±</h2><ul><li>FPDTëŠ” <strong>attention ê²½ë¡œì˜ ìµœì í™”ì—ëŠ” ê±°ì˜ ì™„ì„±í˜•ì— ê°€ê¹Œì›€</strong></li><li>í•˜ì§€ë§Œ ì „ì²´ ëª¨ë¸ì´ bottleneck ì—†ì´ í•™ìŠµë˜ê¸° ìœ„í•´ì„ :<ul><li>FFN, Loss, Optimizer, AllReduce ë‹¨ê³„ë„ ê°™ì€ ìˆ˜ì¤€ìœ¼ë¡œ ìµœì í™” í•„ìš”</li><li>Hardware-aware tuning (ì˜ˆ: NUMA ìµœì í™”, CUDA Stream ë°°ì¹˜ ë“±)</li><li>ML ì—”ì§€ë‹ˆì–´ê°€ ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ <strong>ì¶”ìƒí™”ëœ API ì œê³µ</strong></li></ul></li></ul><hr><p>í•„ìš”í•˜ì‹œë©´ ìœ„ ì—°êµ¬ íë¦„ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ <strong>FPDT ê¸°ë°˜ í–¥ìƒí˜• ì•„í‚¤í…ì²˜ ì„¤ê³„ë„</strong>ë‚˜, ë…¼ë¬¸ ë¹„êµí‘œë„ ì •ë¦¬í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”.</p><h1 id=q--fpdtì—ì„œ-ì œì•ˆí•œ-sequence-chunkingê³¼-offloading-ë°©ì‹ì´-ê¸°ì¡´-megatron-spë‚˜-ulyssesì˜-ë³‘ë ¬í™”-ì „ëµê³¼-ì–´ë–¤-êµ¬ì¡°ì -ì°¨ì´ë¥¼-ê°€ì§€ë©°-ì´-ì°¨ì´ê°€-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰ê³¼-mfuì—-ì–´ë–¤-ì˜í–¥ì„-ì£¼ëŠ”ê°€>Q : FPDTì—ì„œ ì œì•ˆí•œ sequence chunkingê³¼ offloading ë°©ì‹ì´ ê¸°ì¡´ Megatron-SPë‚˜ Ulyssesì˜ ë³‘ë ¬í™” ì „ëµê³¼ ì–´ë–¤ êµ¬ì¡°ì  ì°¨ì´ë¥¼ ê°€ì§€ë©°, ì´ ì°¨ì´ê°€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ MFUì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ëŠ”ê°€?</h1><p>ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤. ì´ ì§ˆë¬¸ì€ FPDTì˜ í•µì‹¬ ì„¤ê³„ ì² í•™ê³¼ ê¸°ì¡´ ê¸°ìˆ (Megatron-SP, Ulysses)ê³¼ì˜ <strong>êµ¬ì¡°ì  ì°¨ì´</strong>ë¥¼ íŒŒì•…í•˜ëŠ” ë° ì•„ì£¼ ì¤‘ìš”í•©ë‹ˆë‹¤. ì•„ë˜ì—ì„œ <strong>ë¹„êµí‘œ</strong>, <strong>í•µì‹¬ ì°¨ì´</strong>, ê·¸ë¦¬ê³  <strong>ë©”ëª¨ë¦¬/ì„±ëŠ¥ ì¸¡ë©´ì˜ íš¨ê³¼</strong>ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì„¤ëª…ë“œë¦´ê²Œìš”.</p><hr><h2 id=-1-êµ¬ì¡°ì -ì°¨ì´-ìš”ì•½>âœ… 1. êµ¬ì¡°ì  ì°¨ì´ ìš”ì•½</h2><table><thead><tr><th>í•­ëª©</th><th>Megatron-SP</th><th>DeepSpeed Ulysses</th><th><strong>FPDT (ì œì•ˆ ê¸°ë²•)</strong></th></tr></thead><tbody><tr><td>ì‹œí€€ìŠ¤ ë³‘ë ¬í™” ë°©ì‹</td><td>Sequence + Tensor ë³‘ë ¬í™”</td><td>Head-wise AlltoAll (1-step)</td><td><strong>Chunked sequence + AlltoAll + Offloading</strong></td></tr><tr><td>Attention ì²˜ë¦¬ ë°©ì‹</td><td>QKV ì „ì²´ ìœ ì§€</td><td>qëŠ” local, k/vëŠ” head-wise ë¶„ì‚°</td><td><strong>qëŠ” GPUì— ìœ ì§€, k/vëŠ” hostë¡œ offload í›„ í•„ìš” ì‹œ fetch</strong></td></tr><tr><td>ë©”ëª¨ë¦¬ ìµœì í™” ë°©ì‹</td><td>Activation checkpointë§Œ ì‚¬ìš©</td><td>AlltoAllë¡œ ë¶„ì‚° ë©”ëª¨ë¦¬ ì‚¬ìš©</td><td><strong>Activation + Offload + Prefetch + Chunking + Double Buffering</strong></td></tr><tr><td>ë³‘ë ¬ì„± ë‹¨ìœ„</td><td>Head x Layer x Device</td><td>Sequence x Head</td><td><strong>Sequence chunk x Head x Stream</strong></td></tr><tr><td>Forward/Backward ì„¤ê³„</td><td>ì „ ì‹œí€€ìŠ¤ ë‹¨ì¼ ì—°ì‚°</td><td>Ulysses attentionë§Œ ìµœì í™”</td><td><strong>Transformer block ì „ì²´ë¥¼ chunk ë‹¨ìœ„ë¡œ íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬</strong></td></tr></tbody></table><hr><h2 id=-2-í•µì‹¬-êµ¬ì¡°ì -ì°¨ì´ì -3ê°€ì§€>âœ… 2. í•µì‹¬ êµ¬ì¡°ì  ì°¨ì´ì  3ê°€ì§€</h2><h3 id=-sequence-chunking>â‘  Sequence Chunking</h3><ul><li>FPDTëŠ” ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ <code>u</code>ê°œì˜ <strong>ì²­í¬ë¡œ ë¶„í• </strong><br>â†’ ê° chunkë§ˆë‹¤ Q/K/V ê³„ì‚°, attention ìˆ˜í–‰</li></ul><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ê¸°ì¡´ ë°©ë²•ì€ ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬ â†’ <strong>Activation memory O(N)</strong><br>FPDTëŠ” ê° chunkë§Œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¼ â†’ <strong>O(N/u)ìœ¼ë¡œ ê°ì†Œ</strong></p></div></blockquote><hr><h3 id=-offloading-kv--host-memory>â‘¡ Offloading (k/v â†’ Host memory)</h3><ul><li><strong>kÌ‚i, vÌ‚iëŠ” ê³„ì‚° í›„ host memory(CPU RAM)ë¡œ ì´ë™</strong></li><li>ì´í›„ attention ì‹œ ë‹¤ì‹œ GPUë¡œ prefetch</li></ul><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ê¸°ì¡´ì€ k/vë¥¼ ì „ë¶€ GPUì— ìœ ì§€<br>FPDTëŠ” <strong>GPUì—ëŠ” që§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ë©”ëª¨ë¦¬ ëŒ€ì²´ ì €ì¥</strong></p></div></blockquote><hr><h3 id=-double-buffering>â‘¢ Double Buffering</h3><ul><li>GPU ì—°ì‚°ê³¼ hostâ†”device í†µì‹ ì„ ë³‘ë ¬í™”
â†’ CUDA Stream 3ê°œ: <code>compute</code>, <code>fetch</code>, <code>free</code></li></ul><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>ê¸°ì¡´ì€ ë™ê¸°ì‹ ì²˜ë¦¬ë¡œ GPU idle time ë°œìƒ<br>FPDTëŠ” ì—°ì‚°ê³¼ í†µì‹ ì„ <strong>fully overlap</strong>í•˜ì—¬ MFU ìƒìŠ¹</p></div></blockquote><hr><h2 id=-3-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰-ë°-mfu-ì¸¡ë©´-íš¨ê³¼>âœ… 3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë° MFU ì¸¡ë©´ íš¨ê³¼</h2><h3 id=-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰>â–¶ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</h3><table><thead><tr><th>ëª¨ë¸</th><th>Ulysses ë©”ëª¨ë¦¬</th><th>FPDT ë©”ëª¨ë¦¬ (chunk=2)</th></tr></thead><tbody><tr><td>2.7B</td><td>~27GB</td><td><strong>18GB (33% ê°ì†Œ)</strong></td></tr><tr><td>6.7B</td><td>~61GB</td><td><strong>~45GB (26% ê°ì†Œ)</strong></td></tr></tbody></table><ul><li>ë…¼ë¬¸ Figure 12 ì°¸ì¡°</li><li>Chunk ìˆ˜ë¥¼ ëŠ˜ë¦´ìˆ˜ë¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ ì„ í˜•ì ìœ¼ë¡œ ê°ì†Œ</li></ul><hr><h3 id=-mfu-model-flops-utilization>â–¶ MFU (Model FLOPs Utilization)</h3><table><thead><tr><th>ëª¨ë¸</th><th>ë°©ë²•</th><th>MFU (%)</th></tr></thead><tbody><tr><td>8B LLaMA</td><td>ZeRO3 + Ulysses</td><td>46.8%</td></tr><tr><td>8B LLaMA</td><td>ZeRO3 + FPDT</td><td><strong>55.7%</strong></td></tr></tbody></table><ul><li>ì˜¤í”„ë¡œë“œë¡œ ì¸í•œ fetch latencyë¥¼ ì—°ì‚°ê³¼ ê²¹ì¹¨ìœ¼ë¡œì¨ <strong>GPU idle time ìµœì†Œí™”</strong></li><li>íŠ¹íˆ attentionì˜ O(NÂ²) ì—°ì‚°ì´ fetch latencyë¥¼ ì™„ì „íˆ ê°€ë¦¼</li></ul><hr><h2 id=-ì •ë¦¬-ì§ˆë¬¸ì—-ëŒ€í•œ-ë‹µë³€>ğŸ” ì •ë¦¬: ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€</h2><p><strong>FPDTëŠ” ê¸°ì¡´ Megatron-SPë‚˜ Ulyssesë³´ë‹¤ ì‹œí€€ìŠ¤ë¥¼ chunk ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê³ , k/vë¥¼ host memoryì— ì˜¤í”„ë¡œë“œí•˜ë©°, attention ë° FFN ì—°ì‚°ê¹Œì§€ íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ í¬ê²Œ ì¤„ì´ë©´ì„œë„ GPU í™œìš©ë„(MFU)ë¥¼ ê·¹ëŒ€í™”í•˜ëŠ” êµ¬ì¡°ì  ì°¨ë³„ì„±ì„ ê°€ì§„ë‹¤.</strong> ì´ëŸ¬í•œ êµ¬ì¡°ëŠ” íŠ¹íˆ ê¸´ ì‹œí€€ìŠ¤(1M<del>4M í† í°) í•™ìŠµ ì‹œ ê¸°ì¡´ ëŒ€ë¹„ **ìµœëŒ€ 16ë°° ê¸´ ì‹œí€€ìŠ¤ë¥¼ 4</del>32 GPUë¡œ í•™ìŠµ ê°€ëŠ¥í•˜ê²Œ ë§Œë“  ì£¼ëœ ì›ì¸**ì´ë‹¤.</p><h1 id=q--forwardì™€-backward-passì—ì„œ-ê°ê°-attention-ê³„ì‚°ì—-í•„ìš”í•œ-k-vë¥¼-ì–´ë–»ê²Œ-ê´€ë¦¬í•˜ë©°-double-bufferingì´-ì‹¤ì œ-ì–´ë–¤-ë°©ì‹ìœ¼ë¡œ-ì—°ì‚°ê³¼-ioë¥¼-ê²¹ì³-ì²˜ë¦¬í•˜ëŠ”ê°€>Q : Forwardì™€ Backward passì—ì„œ ê°ê° attention ê³„ì‚°ì— í•„ìš”í•œ k, vë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ë©°, Double Bufferingì´ ì‹¤ì œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì—°ì‚°ê³¼ I/Oë¥¼ ê²¹ì³ ì²˜ë¦¬í•˜ëŠ”ê°€?</h1><p>ì¢‹ìŠµë‹ˆë‹¤. ì´ ì§ˆë¬¸ì€ FPDTì˜ <strong>íš¨ìœ¨ì„± í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜</strong>ì¸ <code>k, v ê´€ë¦¬ ì „ëµ</code>ê³¼ <code>Double Buffering</code>ì— ëŒ€í•œ ì´í•´ë¥¼ ë¬»ëŠ” ê²ƒìœ¼ë¡œ, ë…¼ë¬¸ì˜ ê¸°ìˆ ì  ì„±ê³¼ë¥¼ ì¢Œìš°í•˜ëŠ” í•µì‹¬ì…ë‹ˆë‹¤. ì•„ë˜ì—ì„œëŠ” <strong>(1) forward ë‹¨ê³„ì—ì„œ k/v ê´€ë¦¬</strong>, <strong>(2) backward ë‹¨ê³„ì—ì„œì˜ Double Buffering ë™ì‘</strong>, ê·¸ë¦¬ê³  <strong>(3) ì „ì²´ íë¦„ì˜ ë³‘ë ¬ì„± ì„¤ê³„</strong>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ìì„¸íˆ ì„¤ëª…ë“œë¦´ê²Œìš”.</p><hr><h2 id=-1-forward-passì—ì„œ-k-v-ê´€ë¦¬-ë°©ì‹>âœ… 1. Forward Passì—ì„œ k, v ê´€ë¦¬ ë°©ì‹</h2><h3 id=-ëª©ì -gpu-ë©”ëª¨ë¦¬-ì ˆì•½>ğŸ¯ ëª©ì : GPU ë©”ëª¨ë¦¬ ì ˆì•½</h3><p>â†’ ê¸´ ì‹œí€€ìŠ¤ ì „ì²´ì˜ <code>k</code>, <code>v</code>ë¥¼ GPUì— ì˜¬ë¦´ ê²½ìš°, <strong>O(NÂ²) ë©”ëª¨ë¦¬ í­ì¦</strong><br>â†’ FPDTëŠ” ì´ë¥¼ <strong>host(CPU memory)ì— ì˜¤í”„ë¡œë“œ</strong>í•˜ì—¬ í•´ê²°</p><h3 id=-êµ¬ì¡°-íë¦„>ğŸŒ êµ¬ì¡° íë¦„</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-5 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-5 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-5><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln>1</span><span class=cl>1. ì‹œí€€ìŠ¤ chunk Táµ¢ â†’ Linear â†’ qáµ¢, káµ¢, váµ¢
</span></span><span class=line><span class=ln>2</span><span class=cl>2. AlltoAll ìˆ˜í–‰ â†’ qÌ‚áµ¢, kÌ‚áµ¢, vÌ‚áµ¢ ìƒì„± (head-wise ë¶„ì‚°ëœ ë²„ì „)
</span></span><span class=line><span class=ln>3</span><span class=cl>3. kÌ‚áµ¢, vÌ‚áµ¢ëŠ” **host memoryë¡œ ì˜¤í”„ë¡œë“œ**
</span></span><span class=line><span class=ln>4</span><span class=cl>4. attention ìˆ˜í–‰ ì‹œ, ê³¼ê±° chunkì˜ kÌ‚â±¼, vÌ‚â±¼ë¥¼ hostì—ì„œ fetch
</span></span><span class=line><span class=ln>5</span><span class=cl>5. qÌ‚áµ¢ì™€ fetchëœ kÌ‚â±¼, vÌ‚â±¼ë¥¼ ì‚¬ìš©í•´ attention ìˆ˜í–‰</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-5",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><h3 id=-í•µì‹¬-í¬ì¸íŠ¸>âœ… í•µì‹¬ í¬ì¸íŠ¸</h3><ul><li><code>qÌ‚áµ¢</code>ë§Œ GPUì— ë‚¨ê³ , <code>kÌ‚, vÌ‚</code>ëŠ” <strong>host memoryì— ì €ì¥</strong></li><li>ìƒˆë¡œìš´ chunkì˜ attentionì„ ê³„ì‚°í•  ë•Œë§Œ í•„ìš”í•œ ë§Œí¼ GPUì— ì˜¬ë¦¼</li></ul><p>â†’ <strong>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ chunk ìˆ˜(<code>u</code>)ì— ë”°ë¼ 1/u ìˆ˜ì¤€ìœ¼ë¡œ ë‚®ì¶¤</strong></p><hr><h2 id=-2-backward-passì—ì„œì˜-double-buffering>âœ… 2. Backward Passì—ì„œì˜ Double Buffering</h2><h3 id=-ë¬¸ì œ-ìƒí™©>ğŸ§  ë¬¸ì œ ìƒí™©</h3><ul><li>BackwardëŠ” forwardë³´ë‹¤ í›¨ì”¬ ë§ì€ intermediateë¥¼ í•„ìš”ë¡œ í•¨</li><li>íŠ¹íˆ attention gradientëŠ” <code>qÌ‚áµ¢</code>, <code>kÌ‚â±¼</code>, <code>vÌ‚â±¼</code>ë¥¼ ëª¨ë‘ ë™ì‹œì— ì°¸ì¡°í•¨</li><li>GPU memoryì™€ PCIe ëŒ€ì—­í­ ê°„ mismatchë¡œ <strong>ì„±ëŠ¥ ë³‘ëª© ë°œìƒ ê°€ëŠ¥</strong></li></ul><h3 id=-fpdt-í•´ê²°-ì „ëµ-double-buffering>ğŸ§© FPDT í•´ê²° ì „ëµ: <strong>Double Buffering</strong></h3><table><thead><tr><th>í•­ëª©</th><th>ê¸°ëŠ¥</th></tr></thead><tbody><tr><td>Buffer A</td><td>í˜„ì¬ chunkì˜ ì—°ì‚° ìˆ˜í–‰ìš©</td></tr><tr><td>Buffer B</td><td>ë‹¤ìŒ chunkì˜ kÌ‚â±¼, vÌ‚â±¼ prefetch ìš©</td></tr><tr><td>Stream 1</td><td>Attention gradient ì—°ì‚°</td></tr><tr><td>Stream 2</td><td>Hostâ†’GPU prefetch (HtoD)</td></tr><tr><td>Stream 3</td><td>ë¶ˆí•„ìš”í•´ì§„ buffer í•´ì œ (memory reuse)</td></tr></tbody></table><hr><h3 id=-ì‹¤ì œ-ì—°ì‚°-êµ¬ì¡°-ì˜ˆì‹œ-t--t-ì´-4ê°œ-chunk>ğŸ” ì‹¤ì œ ì—°ì‚° êµ¬ì¡°: ì˜ˆì‹œ (<code>Tâ‚€ ~ Tâ‚ƒ</code>, ì´ 4ê°œ chunk)</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-6 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=ì ‘ê¸° aria-label=ì ‘ê¸°>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">ì ‘ê¸°</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-6 title=ë³µì‚¬ aria-label=ë³µì‚¬>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">ë³µì‚¬</span></button></div></div><div class="code-block-content relative" id=code-6><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln> 1</span><span class=cl>Outer loop over kÌ‚â±¼, vÌ‚â±¼:
</span></span><span class=line><span class=ln> 2</span><span class=cl>    fetch(kÌ‚â±¼, vÌ‚â±¼) â†’ GPU (stream 2)
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    Inner loop over qÌ‚áµ¢ where i â‰¥ j:
</span></span><span class=line><span class=ln> 5</span><span class=cl>        fetch(qÌ‚áµ¢) â†’ GPU (stream 2)
</span></span><span class=line><span class=ln> 6</span><span class=cl>        compute grad(qÌ‚áµ¢, kÌ‚â±¼, vÌ‚â±¼) (stream 1)
</span></span><span class=line><span class=ln> 7</span><span class=cl>        accumulate grad_qÌ‚áµ¢, grad_kÌ‚â±¼, grad_vÌ‚â±¼
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        free old qÌ‚ (stream 3)
</span></span><span class=line><span class=ln>10</span><span class=cl>    end
</span></span><span class=line><span class=ln>11</span><span class=cl>end</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">í´ë¦­í•˜ì—¬ ë” ë³´ê¸°</div></div></div></div><script>(function(){const s="code-6",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="ë³µì‚¬ë¨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="ë³µì‚¬"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("å¤åˆ¶å¤±è´¥:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="ì„ íƒë¨"),setTimeout(()=>{t&&(t.textContent="ë³µì‚¬"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="í¼ì¹˜ê¸°"),t.title="í¼ì¹˜ê¸°"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="ì ‘ê¸°"),t.title="ì ‘ê¸°"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>âœ… <strong>attention backwardì˜ ì—°ì‚° latency</strong>ê°€ ì¶©ë¶„íˆ í¬ê¸° ë•Œë¬¸ì—,<br><strong>HtoD prefetch latencyë¥¼ computeë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìˆ¨ê¹€</strong><br>â†’ GPU ì—°ì‚° idle time ìµœì†Œí™”</p></div></blockquote><hr><h2 id=-3-ì—°ì‚°ê³¼-io-ë³‘ë ¬í™”-íš¨ê³¼-ìš”ì•½>âœ… 3. ì—°ì‚°ê³¼ I/O ë³‘ë ¬í™” íš¨ê³¼ ìš”ì•½</h2><table><thead><tr><th>ë³‘ë ¬ ì²˜ë¦¬ ìš”ì†Œ</th><th>íš¨ê³¼</th></tr></thead><tbody><tr><td>Compute vs. Prefetch</td><td>PCIe bandwidth ë³‘ëª© íšŒí”¼ (ì—°ì‚°ìœ¼ë¡œ ê°€ë¦¼)</td></tr><tr><td>Forward Pass</td><td>k/v ì˜¤í”„ë¡œë“œë¡œ GPU ë©”ëª¨ë¦¬ ì‚¬ìš© ìµœì†Œí™”</td></tr><tr><td>Backward Pass</td><td>Buffer ì´ì¤‘í™”ë¡œ ì—°ì‚°ê³¼ fetchë¥¼ ì™„ì „ ë¶„ë¦¬</td></tr><tr><td>AlltoAll ë¶„ì‚° í†µì‹ </td><td>ê° GPUê°€ ë¶„ì‚°ëœ headë§Œ ì²˜ë¦¬ â†’ HBM peak ê°ì†Œ</td></tr><tr><td>Stream 3ê°œ ë¶„ë¦¬</td><td>compute / I/O / free ë™ì‹œ ì²˜ë¦¬ â†’ ë†’ì€ MFU í™•ë³´</td></tr></tbody></table><hr><h2 id=-ì‹¤ì¸¡-ê²°ê³¼-ê¸°ë°˜-íš¨ê³¼>ğŸ“Š ì‹¤ì¸¡ ê²°ê³¼ ê¸°ë°˜ íš¨ê³¼</h2><ul><li><strong>FPDT + Double Buffering</strong>ì„ ì ìš©í•œ ê²½ìš°:<ul><li>LLaMA 8B, 4 GPU ê¸°ì¤€ MFU: <strong>55.7%</strong></li><li>ê¸°ì¡´ Ulysses ëŒ€ë¹„ <strong>~9%p ìƒìŠ¹</strong></li><li>GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€ chunk ìˆ˜ ì¦ê°€ì— ë”°ë¼ ì„ í˜• ê°ì†Œ</li></ul></li></ul><hr><h2 id=-ì •ë¦¬-ì§ˆë¬¸ì—-ëŒ€í•œ-ì§ì ‘-ë‹µë³€>ğŸ” ì •ë¦¬: ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ ë‹µë³€</h2><p><strong>FPDTì—ì„œëŠ” forward ì‹œ k, vë¥¼ chunk ë‹¨ìœ„ë¡œ ê³„ì‚° í›„ host memoryë¡œ ì˜¤í”„ë¡œë“œí•˜ì—¬ GPU memoryë¥¼ ì ˆì•½í•˜ê³ , backwardì—ì„œëŠ” double bufferingì„ í†µí•´ ì´ì „ chunkì˜ kÌ‚, vÌ‚ë¥¼ fetchí•˜ë©´ì„œ ë™ì‹œì— í˜„ì¬ chunkì˜ gradientë¥¼ ê³„ì‚°í•˜ì—¬ ì—°ì‚°ê³¼ I/Oë¥¼ ë³‘ë ¬í™”í•œë‹¤. ì´ êµ¬ì¡°ëŠ” PCIe ë³‘ëª©ì„ íšŒí”¼í•˜ê³  GPU idle timeì„ ìµœì†Œí™”í•¨ìœ¼ë¡œì¨ ë†’ì€ MFUë¥¼ ìœ ì§€í•œë‹¤.</strong></p><hr><h1 id=q--fpdtê°€-í•´ê²°í•˜ì§€-ëª»í•œ-memory-spikeë‚˜-communication-ë³‘ëª©-ì§€ì ì€-ë¬´ì—‡ì´ë©°-ì´ë¥¼-í•´ê²°í•˜ê¸°-ìœ„í•´-ì–´ë–¤-í›„ì†-ê¸°ìˆ ì´ë‚˜-ë³‘ë ¬í™”-ì „ëµì´-ê²°í•©ë -ìˆ˜-ìˆëŠ”ê°€>Q : FPDTê°€ í•´ê²°í•˜ì§€ ëª»í•œ memory spikeë‚˜ communication ë³‘ëª© ì§€ì ì€ ë¬´ì—‡ì´ë©°, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì–´ë–¤ í›„ì† ê¸°ìˆ ì´ë‚˜ ë³‘ë ¬í™” ì „ëµì´ ê²°í•©ë  ìˆ˜ ìˆëŠ”ê°€?</h1><p>ì¢‹ìŠµë‹ˆë‹¤. ì´ ì§ˆë¬¸ì€ FPDTì˜ <strong>ì”ì—¬ ë³‘ëª©</strong>ì„ ì§šì–´ë³´ê³ , ì´í›„ ì–´ë–¤ <strong>í›„ì† ê¸°ìˆ /ë³‘ë ¬í™” ì „ëµ</strong>ìœ¼ë¡œ ì´ë¥¼ ê·¹ë³µí•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì°¾ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì•„ë˜ì— FPDTê°€ <strong>í•´ê²°í•˜ì§€ ëª»í•œ ë¬¸ì œ</strong>ë¥¼ ì •ë¦¬í•˜ê³ , ê° ë¬¸ì œì— ëŒ€í•´ <strong>êµ¬ì²´ì ì¸ ë³´ì™„ ê¸°ìˆ /ì—°êµ¬ íë¦„</strong>ì„ ì œì‹œí•©ë‹ˆë‹¤.</p><hr><h2 id=-1-fpdtê°€-í•´ê²°í•˜ì§€-ëª»í•œ-memory-spike-ë°-í†µì‹ -ë³‘ëª©>âœ… 1. FPDTê°€ í•´ê²°í•˜ì§€ ëª»í•œ memory spike ë° í†µì‹  ë³‘ëª©</h2><table><thead><tr><th>êµ¬ë¶„</th><th>ë¬¸ì œ ì§€ì </th><th>ì„¤ëª…</th></tr></thead><tbody><tr><td>â‘  FFN ë©”ëª¨ë¦¬ ìŠ¤íŒŒì´í¬</td><td>FFN ë ˆì´ì–´ëŠ” token-wise ì—°ì‚°ì´ë¼ offloading ë¶ˆê°€ â†’ activation bufferê°€ ë§ìŒ</td><td></td></tr><tr><td>â‘¡ Vocab projection spike</td><td>ë§ˆì§€ë§‰ Linear + Softmaxì—ì„œ vocab sizeê°€ í¬ë©´ ë©”ëª¨ë¦¬ ê¸‰ì¦ (íŠ¹íˆ float32 ì‚¬ìš©)</td><td></td></tr><tr><td>â‘¢ Gradient AllReduce memory peak</td><td>ZeRO-3ì™€ PyTorch FSDP ì‚¬ìš© ì‹œ gradient í•©ì‚° ê³¼ì •ì—ì„œ GPU ë©”ëª¨ë¦¬ ìˆœê°„ ì¦ê°€ ë°œìƒ</td><td></td></tr><tr><td>â‘£ Hostâ†”GPU ëŒ€ì—­í­ ë³‘ëª© (PCIe)</td><td>k/v fetchë¥¼ PCIeë¡œ í•˜ë©´ NVLink ëŒ€ë¹„ ì „ì†¡ ì†ë„ ëŠë ¤ì„œ compute latencyê°€ ì´ë¥¼ ê°€ë¦¬ì§€ ëª»í•  ìˆ˜ë„ ìˆìŒ</td><td></td></tr><tr><td>â‘¤ Chunk granularity tuningì˜ ì–´ë ¤ì›€</td><td>ë„ˆë¬´ ì‘ìœ¼ë©´ ì˜¤ë²„í—¤ë“œ, ë„ˆë¬´ í¬ë©´ memory overflow â†’ ìˆ˜ë™ íŠœë‹ í•„ìš”</td><td></td></tr></tbody></table><hr><h2 id=-2-ê°-ë¬¸ì œë³„-í›„ì†-ê¸°ìˆ -ë°-ë³‘ë ¬í™”-ì „ëµ>ğŸ” 2. ê° ë¬¸ì œë³„ í›„ì† ê¸°ìˆ  ë° ë³‘ë ¬í™” ì „ëµ</h2><hr><h3 id=-ë¬¸ì œ--ffn-ë©”ëª¨ë¦¬-ìŠ¤íŒŒì´í¬>ğŸš§ ë¬¸ì œ â‘  FFN ë©”ëª¨ë¦¬ ìŠ¤íŒŒì´í¬</h3><p><strong>í›„ì† ê¸°ìˆ </strong>: MsT (Mini-sequence Transformer, arXiv:2407.15892), Flash-FFN, Chunked FFN<br><strong>í•´ê²° ì•„ì´ë””ì–´</strong>:</p><ul><li>FFNë„ attentionì²˜ëŸ¼ <strong>ì²­í¬ ë‹¨ìœ„ë¡œ ë¶„í• </strong>í•´ì„œ ì²˜ë¦¬</li><li>MLP ì—°ì‚°ì„ pipeline ì²˜ë¦¬í•˜ì—¬ activation ë©”ëª¨ë¦¬ í”¼í¬ ê°ì†Œ</li></ul><p><strong>ê²°í•© ì œì•ˆ</strong>: FPDTì˜ attention chunkingê³¼ FFN chunkingì„ í†µí•©í•˜ì—¬ <strong>Transformer block ì „ì²´ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬</strong></p><hr><h3 id=-ë¬¸ì œ--vocab-projection-ìŠ¤íŒŒì´í¬>ğŸš§ ë¬¸ì œ â‘¡ Vocab Projection ìŠ¤íŒŒì´í¬</h3><p><strong>í›„ì† ê¸°ìˆ </strong>: Int8 Softmax (LLM.int8), Blockwise Softmax, LoRA-Proj<br><strong>í•´ê²° ì•„ì´ë””ì–´</strong>:</p><ul><li><strong>Float16/Int8 ê¸°ë°˜ softmax</strong>ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš© ê°ì†Œ</li><li>Vocab Projectionì„ **Low-rank ë¶„í•´ (LoRA)**ë¡œ ì²˜ë¦¬í•˜ì—¬ weight ìˆ˜ ì¤„ì´ê¸°</li><li>Softmaxë¥¼ <strong>block ë‹¨ìœ„ë¡œ ë‚˜ëˆ  ë¶„ì‚° ê³„ì‚°</strong></li></ul><p><strong>ê²°í•© ì œì•ˆ</strong>: FPDT ë§ˆì§€ë§‰ stage (loss ê³„ì‚° ì „)ì—ë„ chunking ì ìš© + mixed precision softmax ë„ì…</p><hr><h3 id=-ë¬¸ì œ--gradient-allreduce-memory-peak>ğŸš§ ë¬¸ì œ â‘¢ Gradient AllReduce memory peak</h3><p><strong>í›„ì† ê¸°ìˆ </strong>:</p><ul><li><strong>ZeRO-Infinity (DeepSpeed)</strong>: gradientë¥¼ offloadí•˜ê±°ë‚˜ ë‚˜ëˆ ì„œ ì²˜ë¦¬</li><li><strong>Async Gradient Reduce + Overlap</strong>: computeì™€ í†µì‹  ë™ì‹œ ì²˜ë¦¬</li><li><strong>Memory-aware AllReduce (PowerSGD, Chunked Reduce)</strong></li></ul><p><strong>ê²°í•© ì œì•ˆ</strong>:</p><ul><li>FPDTì— ZeRO-Infinityì˜ gradient offload ëª¨ë“ˆì„ ì¶”ê°€</li><li>Backward pass í›„ gradient syncë¥¼ chunk ë‹¨ìœ„ë¡œ ì²˜ë¦¬</li></ul><hr><h3 id=-ë¬¸ì œ--pcie-ë³‘ëª©>ğŸš§ ë¬¸ì œ â‘£ PCIe ë³‘ëª©</h3><p><strong>í›„ì† ê¸°ìˆ </strong>:</p><ul><li><strong>GPU DirectStorage / NVMeâ†”GPU ì „ì†¡</strong></li><li><strong>Unified Memory + Prefetch Hints (CUDA UM)</strong></li><li><strong>H100/Hopper + NVSwitch í™œìš©í•œ ëŒ€ì—­í­ í™•ì¥</strong></li></ul><p><strong>ê²°í•© ì œì•ˆ</strong>:</p><ul><li>k/v ì˜¤í”„ë¡œë“œë¥¼ ì¼ë°˜ host memoryê°€ ì•„ë‹ˆë¼ <strong>ì†ë„ ë¹ ë¥¸ ë¡œì»¬ SSDë‚˜ CPU DRAM poolë¡œ ë¶„ì‚°</strong></li><li>FPDTì— <strong>ë°ì´í„° ì „ì†¡ ìš°ì„ ìˆœìœ„ ì¡°ì ˆ ë° Prefetch Scheduler</strong> ì¶”ê°€</li></ul><hr><h3 id=-ë¬¸ì œ--chunk-size-tuning-ìë™í™”>ğŸš§ ë¬¸ì œ â‘¤ Chunk size tuning ìë™í™”</h3><p><strong>í›„ì† ê¸°ìˆ </strong>:</p><ul><li><strong>Auto-tuner ê¸°ë°˜ dynamic chunking</strong> (profiling ê¸°ë°˜)</li><li>RL ê¸°ë°˜ ì‹¤í–‰ ì‹œê°„ ìµœì í™” (ì˜ˆ: FlexFlow, LIFT)</li><li><strong>Memory peak estimator + adaptive scheduler</strong></li></ul><p><strong>ê²°í•© ì œì•ˆ</strong>:</p><ul><li>í•™ìŠµ ì´ˆê¸°ì— hardware spec + ëª¨ë¸ í¬ê¸° ê¸°ë°˜ìœ¼ë¡œ ìµœì  chunk size ìë™ íƒìƒ‰</li></ul><hr><h2 id=-ì •ë¦¬-fpdt-ë³´ì™„-ìš”ì•½í‘œ>ğŸ§  ì •ë¦¬: FPDT ë³´ì™„ ìš”ì•½í‘œ</h2><table><thead><tr><th>ë¬¸ì œ ì§€ì </th><th>ë³´ì™„ ê¸°ìˆ </th><th>í•µì‹¬ ì „ëµ</th></tr></thead><tbody><tr><td>FFN ë©”ëª¨ë¦¬ ìŠ¤íŒŒì´í¬</td><td>MsT, Chunked FFN</td><td>FFNë„ ì²­í¬ ì²˜ë¦¬</td></tr><tr><td>Vocab projection</td><td>Int8 Softmax, LoRA-Proj</td><td>Mixed precision + Block softmax</td></tr><tr><td>Gradient ë©”ëª¨ë¦¬ í­ë°œ</td><td>ZeRO-Infinity, Async Reduce</td><td>Gradient offload + Chunked AllReduce</td></tr><tr><td>PCIe ë³‘ëª©</td><td>DirectStorage, Unified Memory</td><td>GPUâ†”Host ìµœì í™” ì „ì†¡ ê²½ë¡œ</td></tr><tr><td>Chunk íŠœë‹ ì–´ë ¤ì›€</td><td>Auto-Tuning, RL ê¸°ë°˜ ìµœì í™”</td><td>Profile-based tuning scheduler</td></tr></tbody></table><hr><h2 id=-ê²°ë¡ -1>âœ¨ ê²°ë¡ </h2><p><strong>FPDTëŠ” attention ì¤‘ì‹¬ì˜ ë©”ëª¨ë¦¬ ìµœì í™”ì—ëŠ” ë§¤ìš° íš¨ê³¼ì </strong>ì´ì§€ë§Œ, Transformer ì „ì²´ í•™ìŠµ íŒŒì´í”„ë¼ì¸ ê´€ì ì—ì„œ ë³´ë©´ <strong>FFN, Vocab projection, Gradient sync, PCIe í†µì‹  ë³‘ëª© ë“±ì˜ ë³‘ë ¬í™”ê°€ ì—¬ì „íˆ ë¶€ì¡±</strong>í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì”ì—¬ ë³‘ëª©ì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” <strong>í›„ì† ê¸°ìˆ ë“¤ì„ ê²°í•©í•˜ì—¬ end-to-end long-context í•™ìŠµ ìµœì í™” ì‹œìŠ¤í…œ</strong>ì„ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ë‹¤ìŒ ë‹¨ê³„ì˜ ì—°êµ¬ ë°©í–¥ì…ë‹ˆë‹¤.</p></article></main><footer class="mx-auto max-w-4xl px-4 py-8"><div class="px-6 py-6"><nav class=mb-6><div class="flex flex-wrap items-center justify-center gap-1"><a href=/index.xml class="nav-link hover:text-primary hover:bg-primary/10 text-muted-foreground flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="RSS Feed"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18.0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"/></svg>
<span>RSS Feed</span></a></div></nav><div class="border-border mb-6 border-t"></div><div class="flex flex-col items-center justify-between gap-4 md:flex-row"><div class="text-muted-foreground text-sm"><p>&copy; 2025 Jaehun's Blog.
ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .</p></div><div class="flex items-center gap-3"><a href=https://github.com/ryujaehun target=_blank rel="noopener noreferrer" class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=GitHub aria-label=GitHub><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="GitHub"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8.0 00-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35.0-3.5.0.0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35.0 3.5A5.4 5.4.0 004 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></svg>
</a><a href=https://www.linkedin.com/in/jaehunryu/ target=_blank rel="noopener noreferrer" class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=Linkedin aria-label=Linkedin><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="Linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg>
</a><a href=mailto:jaehunryu@icloud.com class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=Email aria-label=Email><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="Email"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22.0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v10a2 2 0 002 2z"/></svg></a></div></div></div></footer><div id=dock class="pointer-events-none fixed bottom-4 left-1/2 z-[9999] w-fit -translate-x-1/2 translate-y-24 opacity-0 transition-all duration-300 ease-out sm:right-0 sm:left-0 sm:mx-auto sm:translate-x-0" role=toolbar aria-label="ë°”ë¡œê°€ê¸° ë„êµ¬ ëª¨ìŒ"><nav class="border-border bg-card/80 scrollbar-hide xs:px-3 xs:py-2 mx-auto flex max-w-[calc(100vw-2rem)] min-w-fit items-center justify-center overflow-x-auto rounded-2xl border px-4 py-3 shadow-lg backdrop-blur-sm sm:px-4 sm:py-3"><button id=dock-back class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title=ë’¤ë¡œ aria-label=ë’¤ë¡œ>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
<span class="hidden sm:inline">ë’¤ë¡œ</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-toc class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title=ëª©ì°¨ aria-label=ëª©ì°¨>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
<span class="hidden sm:inline">ëª©ì°¨</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-search class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-3 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-4 sm:py-2" title=ê²€ìƒ‰ aria-label=ê²€ìƒ‰>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
<span class="hidden md:inline">ê²€ìƒ‰</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-top class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title="ë§¨ ìœ„ë¡œ" aria-label="ë§¨ ìœ„ë¡œ">
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m18 15-6-6-6 6"/></svg>
<span class="hidden sm:inline">ë§¨ ìœ„ë¡œ</span></button></nav></div><div id=toc-overlay class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-all duration-300" role=dialog aria-modal=true aria-labelledby=toc-title></div><div id=toc-card class="pointer-events-none fixed inset-4 z-50 flex w-auto scale-95 items-center justify-center opacity-0 transition-all duration-300 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:block sm:w-full sm:max-w-md sm:-translate-x-1/2 sm:-translate-y-1/2" role=dialog aria-modal=true aria-labelledby=toc-title><div class="bg-card border-border w-full max-w-sm overflow-hidden rounded-xl border shadow-xl sm:max-w-md"><div class="border-border bg-muted/30 flex items-center justify-between border-b p-4"><div class="flex items-center gap-3"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg><h2 id=toc-title class="text-foreground text-lg font-semibold">ëª©ì°¨</h2></div><button id=toc-close class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 rounded-lg p-2 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none" title=ë‹«ê¸° aria-label=ë‹«ê¸°>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="max-h-96 overflow-y-auto p-4"><nav id=toc-nav class=toc-scrollbar aria-label="ê¸€ ëª©ì°¨"><div id=toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#-ê²°ë¡ -ìš”ì•½>âœ… ê²°ë¡  ìš”ì•½</a></li></ul></li><li><a href=#-ë…¼ë¬¸ì˜-ê°•ì --ë…ì°½ì ì¸-ê¸°ì—¬>ğŸ” ë…¼ë¬¸ì˜ ê°•ì  & ë…ì°½ì ì¸ ê¸°ì—¬</a></li><li><a href=#-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜-êµ¬ì¡°-ìš”ì•½-fpdt>ğŸ”§ í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ êµ¬ì¡° ìš”ì•½ (FPDT)</a><ul><li><a href=#1-ì…ë ¥-ì˜ˆì‹œ>1. ì…ë ¥ ì˜ˆì‹œ</a></li><li><a href=#2-ë‹¨ê³„ë³„-ì²˜ë¦¬-ê³¼ì •-ì˜ˆì‹œ>2. ë‹¨ê³„ë³„ ì²˜ë¦¬ ê³¼ì • ì˜ˆì‹œ</a><ul><li><a href=#-ë‹¨ê³„-1-sequence-chunking>ğŸ“Œ ë‹¨ê³„ 1: Sequence Chunking</a></li><li><a href=#-ë‹¨ê³„-2-qkv-projection--all-to-all>ğŸ“Œ ë‹¨ê³„ 2: QKV Projection + All-to-All</a></li><li><a href=#-ë‹¨ê³„-3-ì˜¤í”„ë¡œë“œ-ì „ëµ-fetchingoffloading>ğŸ“Œ ë‹¨ê³„ 3: ì˜¤í”„ë¡œë“œ ì „ëµ (Fetching/Offloading)</a></li><li><a href=#-ë‹¨ê³„-4-online-attention-ìˆ˜í–‰>ğŸ“Œ ë‹¨ê³„ 4: Online Attention ìˆ˜í–‰</a></li><li><a href=#-ë‹¨ê³„-5-backward-with-double-buffer>ğŸ“Œ ë‹¨ê³„ 5: Backward with Double Buffer</a></li><li><a href=#-ë‹¨ê³„-6-ffn-ë°-loss-ì²˜ë¦¬>ğŸ“Œ ë‹¨ê³„ 6: FFN ë° Loss ì²˜ë¦¬</a></li></ul></li></ul></li><li><a href=#-ì„±ëŠ¥-ë¹„êµ-ì‹¤í—˜-ê²°ê³¼>ğŸ“Š ì„±ëŠ¥ ë¹„êµ (ì‹¤í—˜ ê²°ê³¼)</a></li><li><a href=#-í•œê³„ì >âš ï¸ í•œê³„ì </a></li><li><a href=#-ê²°ë¡ >ğŸ§  ê²°ë¡ </a></li></ul><ul><li><ul><li><a href=#-ê°œë…ì -ì „ì œ>ğŸ§  ê°œë…ì  ì „ì œ</a></li><li><a href=#-í•µì‹¬-êµ¬ì¡°-pytorch-ìŠ¤íƒ€ì¼-ì˜ì‚¬-ì½”ë“œ>ğŸ§¾ í•µì‹¬ êµ¬ì¡°: PyTorch ìŠ¤íƒ€ì¼ ì˜ì‚¬ ì½”ë“œ</a></li><li><a href=#-double-buffering-ë…¼ë¦¬-ìš”ì•½>ğŸ¯ Double Buffering ë…¼ë¦¬ ìš”ì•½</a></li><li><a href=#-ì°¸ê³ -êµ¬í˜„-ë¼ì´ë¸ŒëŸ¬ë¦¬>ğŸ”© ì°¸ê³  êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬</a></li></ul></li></ul><ul><li><a href=#-í•µì‹¬-ê°œë…-ìš”ì•½>âœ… í•µì‹¬ ê°œë… ìš”ì•½</a></li><li><a href=#-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜-ì˜ˆì‹œë¡œ-ìì„¸íˆ-ì„¤ëª…>ğŸ” í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ ì˜ˆì‹œë¡œ ìì„¸íˆ ì„¤ëª…</a><ul><li><a href=#-ì˜ˆì‹œ-ìƒí™©>ğŸŒŸ ì˜ˆì‹œ ìƒí™©</a></li><li><a href=#-step-by-step-íë¦„-forward-ê¸°ì¤€>âš™ï¸ Step-by-Step íë¦„ (Forward ê¸°ì¤€)</a><ul><li><a href=#-step-1-ì‹œí€€ìŠ¤-ì²­í¬-ë¶„í• -chunking>ğŸ§© Step 1. ì‹œí€€ìŠ¤ ì²­í¬ ë¶„í•  (Chunking)</a></li><li><a href=#-step-2-ê°-ì²­í¬ì—-ëŒ€í•´-qkv-í”„ë¡œì ì…˜-ìˆ˜í–‰>ğŸ¯ Step 2. ê° ì²­í¬ì— ëŒ€í•´ QKV í”„ë¡œì ì…˜ ìˆ˜í–‰</a></li><li><a href=#-step-3-all-to-all-í†µì‹ -ìˆ˜í–‰>ğŸ”„ Step 3. All-to-All í†µì‹  ìˆ˜í–‰</a></li><li><a href=#-step-4-host-memoryì—-k-v-ì˜¤í”„ë¡œë“œ>ğŸ’¾ Step 4. Host Memoryì— kÌ‚, vÌ‚ ì˜¤í”„ë¡œë“œ</a></li><li><a href=#-step-5-ë‹¤ìŒ-ì²­í¬-tì—-ëŒ€í•´-ë°˜ë³µ>ğŸ” Step 5. ë‹¤ìŒ ì²­í¬ Tâ‚ì— ëŒ€í•´ ë°˜ë³µ</a></li><li><a href=#-step-6-ì´-ê³¼ì •ì„-ëª¨ë“ -ì²­í¬ì—-ëŒ€í•´-ë°˜ë³µ>ğŸ”ƒ Step 6. ì´ ê³¼ì •ì„ ëª¨ë“  ì²­í¬ì— ëŒ€í•´ ë°˜ë³µ</a></li></ul></li><li><a href=#-backward-pass-double-buffering>ğŸ”„ Backward Pass: Double Buffering</a><ul><li><a href=#ì˜ˆ-4ê°œ-ì²­í¬ì¼-ë•Œ-backward-íë¦„>ì˜ˆ: 4ê°œ ì²­í¬ì¼ ë•Œ backward íë¦„</a></li></ul></li><li><a href=#-ë©”ëª¨ë¦¬-ìµœì í™”-êµ¬ì¡°-ìš”ì•½>ğŸ“¦ ë©”ëª¨ë¦¬ ìµœì í™” êµ¬ì¡° ìš”ì•½</a></li></ul></li><li><a href=#-ì‹œê°ì -ìš”ì•½>ğŸ“Š ì‹œê°ì  ìš”ì•½</a></li><li><a href=#-ì •ë¦¬>âœ… ì •ë¦¬</a></li></ul><ul><li><a href=#-1-ì‹¤í—˜-ê²°ê³¼-ìš”ì•½-ì„±ëŠ¥-ë¹„êµ>âœ… 1. ì‹¤í—˜ ê²°ê³¼ ìš”ì•½: ì„±ëŠ¥ ë¹„êµ</a><ul><li><a href=#-ëª¨ë¸ë³„-ìµœëŒ€-ì‹œí€€ìŠ¤-ê¸¸ì´-ë°-gpu-ì‚¬ìš©ëŸ‰-ë¹„êµ-table--figure-11-ê¸°ë°˜>ğŸ“Š ëª¨ë¸ë³„ ìµœëŒ€ ì‹œí€€ìŠ¤ ê¸¸ì´ ë° GPU ì‚¬ìš©ëŸ‰ ë¹„êµ (Table + Figure 11 ê¸°ë°˜)</a></li></ul></li><li><a href=#-2-íŠ¹ì¶œë‚œ-ì -ê¸°ì¡´-ë°©ë²•ê³¼ì˜-ê²°ì •ì -ì°¨ë³„ì„±>ğŸŒŸ 2. íŠ¹ì¶œë‚œ ì  (ê¸°ì¡´ ë°©ë²•ê³¼ì˜ ê²°ì •ì  ì°¨ë³„ì„±)</a></li><li><a href=#-3-ì´ëŸ¬í•œ-ê²°ê³¼ë¥¼-ë§Œë“ -í•µì‹¬-ê¸°ìˆ -ìš”ì†Œ-ë…¼ë¬¸-ì„¤ëª…-ê¸°ë°˜>ğŸ§  3. ì´ëŸ¬í•œ ê²°ê³¼ë¥¼ ë§Œë“  í•µì‹¬ ê¸°ìˆ  ìš”ì†Œ (ë…¼ë¬¸ ì„¤ëª… ê¸°ë°˜)</a></li><li><a href=#-4-ë…¼ë¬¸-ì£¼ì¥ì˜-í‰ê°€--ë‚´-ìƒê°>ğŸ’¡ 4. ë…¼ë¬¸ ì£¼ì¥ì˜ í‰ê°€ + ë‚´ ìƒê°</a><ul><li><a href=#-ë…¼ë¬¸-ì£¼ì¥-ì •ë¦¬>ğŸ§¾ ë…¼ë¬¸ ì£¼ì¥ ì •ë¦¬</a></li><li><a href=#-ë‚´-ìƒê°-í‰ê°€>âœ… ë‚´ ìƒê° (í‰ê°€)</a></li></ul></li><li><a href=#-ìš”ì•½-ì •ë¦¬>âœ… ìš”ì•½ ì •ë¦¬</a></li></ul><ul><li><a href=#-1-ì´-ë…¼ë¬¸ì˜-í•µì‹¬-í•œê³„>âœ… 1. ì´ ë…¼ë¬¸ì˜ í•µì‹¬ í•œê³„</a></li><li><a href=#-2-ì´-í•œê³„ë¥¼-ë³´ì™„í•˜ëŠ”-ìµœê·¼-ì—°êµ¬-íë¦„>ğŸ” 2. ì´ í•œê³„ë¥¼ ë³´ì™„í•˜ëŠ” ìµœê·¼ ì—°êµ¬ íë¦„</a><ul><li><a href=#-1-ffn-ë©”ëª¨ë¦¬-ìµœì í™”--mst-mini-sequence-transformer>ğŸ“Œ [1] FFN ë©”ëª¨ë¦¬ ìµœì í™” â†’ <strong>MsT (Mini-sequence Transformer)</strong></a><ul><li><a href=#í•µì‹¬-ì•„ì´ë””ì–´>í•µì‹¬ ì•„ì´ë””ì–´</a></li><li><a href=#í•œê³„>í•œê³„</a></li><li><a href=#ë…¼ë¬¸ê³¼ì˜-ê´€ê³„>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</a></li></ul></li><li><a href=#-2-gradient-ë©”ëª¨ë¦¬-spike-í•´ì†Œ--gradient-checkpoint-fusion--async-reduce>ğŸ“Œ [2] Gradient ë©”ëª¨ë¦¬ spike í•´ì†Œ â†’ <strong>Gradient Checkpoint Fusion / Async Reduce</strong></a><ul><li><a href=#í•´ê²°-ë°©ì‹>í•´ê²° ë°©ì‹</a></li><li><a href=#ë…¼ë¬¸ê³¼ì˜-ê´€ê³„-1>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</a></li></ul></li><li><a href=#-3-pcie-ë³‘ëª©--unified-memory--nvswitch--direct-storage-ê¸°ë°˜-ì—°êµ¬>ğŸ“Œ [3] PCIe ë³‘ëª© â†’ <strong>Unified Memory / NVSwitch / Direct Storage ê¸°ë°˜ ì—°êµ¬</strong></a><ul><li><a href=#í•´ê²°-ë°©ì‹-1>í•´ê²° ë°©ì‹</a></li><li><a href=#ë…¼ë¬¸ê³¼ì˜-ê´€ê³„-2>ë…¼ë¬¸ê³¼ì˜ ê´€ê³„</a></li></ul></li><li><a href=#-4-vocab-projection-ë¬¸ì œ--int8fp8-softmax-lowrank-projection>ğŸ“Œ [4] Vocab Projection ë¬¸ì œ â†’ <strong>Int8/FP8 Softmax, LowRank Projection</strong></a><ul><li><a href=#í•´ê²°-ë°©ì‹-2>í•´ê²° ë°©ì‹</a></li><li><a href=#fpdtì™€ì˜-ì—°ê³„-ê°€ëŠ¥ì„±>FPDTì™€ì˜ ì—°ê³„ ê°€ëŠ¥ì„±</a></li></ul></li><li><a href=#-5-ë”-ì‰¬ìš´-êµ¬í˜„ì„-ìœ„í•œ-ì—°êµ¬--modular-frameworks-colossal-ai-megatron-lm-deepspeed>ğŸ“Œ [5] ë” ì‰¬ìš´ êµ¬í˜„ì„ ìœ„í•œ ì—°êµ¬ â†’ <strong>Modular Frameworks: Colossal-AI, Megatron-LM, DeepSpeed</strong></a><ul><li><a href=#ì˜ˆì‹œ>ì˜ˆì‹œ</a></li><li><a href=#ëª©ì >ëª©ì </a></li></ul></li></ul></li><li><a href=#-3-ìš”ì•½-ì •ë¦¬>âœ… 3. ìš”ì•½ ì •ë¦¬</a></li><li><a href=#-ì •ë¦¬-ì•ìœ¼ë¡œì˜-ì—°êµ¬-ë°©í–¥ì„±>ğŸ§  ì •ë¦¬: ì•ìœ¼ë¡œì˜ ì—°êµ¬ ë°©í–¥ì„±</a></li></ul><ul><li><a href=#-1-êµ¬ì¡°ì -ì°¨ì´-ìš”ì•½>âœ… 1. êµ¬ì¡°ì  ì°¨ì´ ìš”ì•½</a></li><li><a href=#-2-í•µì‹¬-êµ¬ì¡°ì -ì°¨ì´ì -3ê°€ì§€>âœ… 2. í•µì‹¬ êµ¬ì¡°ì  ì°¨ì´ì  3ê°€ì§€</a><ul><li><a href=#-sequence-chunking>â‘  Sequence Chunking</a></li><li><a href=#-offloading-kv--host-memory>â‘¡ Offloading (k/v â†’ Host memory)</a></li><li><a href=#-double-buffering>â‘¢ Double Buffering</a></li></ul></li><li><a href=#-3-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰-ë°-mfu-ì¸¡ë©´-íš¨ê³¼>âœ… 3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë° MFU ì¸¡ë©´ íš¨ê³¼</a><ul><li><a href=#-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰>â–¶ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</a></li><li><a href=#-mfu-model-flops-utilization>â–¶ MFU (Model FLOPs Utilization)</a></li></ul></li><li><a href=#-ì •ë¦¬-ì§ˆë¬¸ì—-ëŒ€í•œ-ë‹µë³€>ğŸ” ì •ë¦¬: ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€</a></li></ul><ul><li><a href=#-1-forward-passì—ì„œ-k-v-ê´€ë¦¬-ë°©ì‹>âœ… 1. Forward Passì—ì„œ k, v ê´€ë¦¬ ë°©ì‹</a><ul><li><a href=#-ëª©ì -gpu-ë©”ëª¨ë¦¬-ì ˆì•½>ğŸ¯ ëª©ì : GPU ë©”ëª¨ë¦¬ ì ˆì•½</a></li><li><a href=#-êµ¬ì¡°-íë¦„>ğŸŒ êµ¬ì¡° íë¦„</a></li><li><a href=#-í•µì‹¬-í¬ì¸íŠ¸>âœ… í•µì‹¬ í¬ì¸íŠ¸</a></li></ul></li><li><a href=#-2-backward-passì—ì„œì˜-double-buffering>âœ… 2. Backward Passì—ì„œì˜ Double Buffering</a><ul><li><a href=#-ë¬¸ì œ-ìƒí™©>ğŸ§  ë¬¸ì œ ìƒí™©</a></li><li><a href=#-fpdt-í•´ê²°-ì „ëµ-double-buffering>ğŸ§© FPDT í•´ê²° ì „ëµ: <strong>Double Buffering</strong></a></li><li><a href=#-ì‹¤ì œ-ì—°ì‚°-êµ¬ì¡°-ì˜ˆì‹œ-t--t-ì´-4ê°œ-chunk>ğŸ” ì‹¤ì œ ì—°ì‚° êµ¬ì¡°: ì˜ˆì‹œ (<code>Tâ‚€ ~ Tâ‚ƒ</code>, ì´ 4ê°œ chunk)</a></li></ul></li><li><a href=#-3-ì—°ì‚°ê³¼-io-ë³‘ë ¬í™”-íš¨ê³¼-ìš”ì•½>âœ… 3. ì—°ì‚°ê³¼ I/O ë³‘ë ¬í™” íš¨ê³¼ ìš”ì•½</a></li><li><a href=#-ì‹¤ì¸¡-ê²°ê³¼-ê¸°ë°˜-íš¨ê³¼>ğŸ“Š ì‹¤ì¸¡ ê²°ê³¼ ê¸°ë°˜ íš¨ê³¼</a></li><li><a href=#-ì •ë¦¬-ì§ˆë¬¸ì—-ëŒ€í•œ-ì§ì ‘-ë‹µë³€>ğŸ” ì •ë¦¬: ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ ë‹µë³€</a></li></ul><ul><li><a href=#-1-fpdtê°€-í•´ê²°í•˜ì§€-ëª»í•œ-memory-spike-ë°-í†µì‹ -ë³‘ëª©>âœ… 1. FPDTê°€ í•´ê²°í•˜ì§€ ëª»í•œ memory spike ë° í†µì‹  ë³‘ëª©</a></li><li><a href=#-2-ê°-ë¬¸ì œë³„-í›„ì†-ê¸°ìˆ -ë°-ë³‘ë ¬í™”-ì „ëµ>ğŸ” 2. ê° ë¬¸ì œë³„ í›„ì† ê¸°ìˆ  ë° ë³‘ë ¬í™” ì „ëµ</a><ul><li><a href=#-ë¬¸ì œ--ffn-ë©”ëª¨ë¦¬-ìŠ¤íŒŒì´í¬>ğŸš§ ë¬¸ì œ â‘  FFN ë©”ëª¨ë¦¬ ìŠ¤íŒŒì´í¬</a></li><li><a href=#-ë¬¸ì œ--vocab-projection-ìŠ¤íŒŒì´í¬>ğŸš§ ë¬¸ì œ â‘¡ Vocab Projection ìŠ¤íŒŒì´í¬</a></li><li><a href=#-ë¬¸ì œ--gradient-allreduce-memory-peak>ğŸš§ ë¬¸ì œ â‘¢ Gradient AllReduce memory peak</a></li><li><a href=#-ë¬¸ì œ--pcie-ë³‘ëª©>ğŸš§ ë¬¸ì œ â‘£ PCIe ë³‘ëª©</a></li><li><a href=#-ë¬¸ì œ--chunk-size-tuning-ìë™í™”>ğŸš§ ë¬¸ì œ â‘¤ Chunk size tuning ìë™í™”</a></li></ul></li><li><a href=#-ì •ë¦¬-fpdt-ë³´ì™„-ìš”ì•½í‘œ>ğŸ§  ì •ë¦¬: FPDT ë³´ì™„ ìš”ì•½í‘œ</a></li><li><a href=#-ê²°ë¡ -1>âœ¨ ê²°ë¡ </a></li></ul></nav></div></nav></div><div class="border-border bg-muted/20 border-t px-4 py-3"><div class="text-muted-foreground text-center text-xs"><span>ì œëª©ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤</span></div></div></div></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>function initKaTeX(){if(typeof renderMathInElement=="undefined"){setTimeout(initKaTeX,100);return}var e=[{display:!0,left:"$$",right:"$$"},{display:!1,left:"$",right:"$"}];renderMathInElement(document.body,{delimiters:e,throwOnError:!1,errorColor:"#cc0000",fleqn:!1,leqno:!1,trust:!1})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initKaTeX):initKaTeX()</script><div id=search-overlay class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 transition-opacity duration-300"></div><div id=search-modal class="bg-card border-border pointer-events-none fixed top-1/2 left-1/2 z-50 max-h-[80vh] w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 scale-95 transform overflow-hidden rounded-xl border opacity-0 shadow-xl transition-all duration-300"><div class="border-border flex items-center gap-3 border-b p-4"><div class="text-muted-foreground h-5 w-5 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg></div><div class="relative flex-1"><button id=search-clear class="text-muted-foreground hover:text-foreground hover:bg-muted/50 pointer-events-none absolute top-1/2 left-0 z-10 h-5 w-5 -translate-y-1/2 rounded opacity-0 transition-all duration-200" title=ì§€ìš°ê¸° aria-label=ì§€ìš°ê¸°>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg>
</button>
<input id=search-input type=text placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰..." class="text-foreground placeholder:text-muted-foreground w-full border-none bg-transparent pl-8 text-lg outline-none" autocomplete=off spellcheck=false></div><button id=search-close class="text-muted-foreground hover:text-foreground hover:bg-muted/50 flex h-6 w-6 items-center justify-center rounded-md p-0.5 transition-all duration-200" title=ë‹«ê¸° aria-label=ë‹«ê¸°>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div id=search-results class="max-h-96 overflow-y-auto"><div id=search-empty class="flex flex-col items-center justify-center py-12 text-center"><div class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg></div><h3 class="text-foreground mb-2 text-lg font-semibold">ê²€ìƒ‰ ì‹œì‘</h3><p class="text-muted-foreground text-sm">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p></div><div id=search-loading class="flex hidden items-center justify-center py-8"><div class="mr-3 h-6 w-6 animate-spin rounded-full border-2 border-current border-t-transparent"></div><span class=text-muted-foreground>ê²€ìƒ‰ ì¤‘...</span></div><div id=search-no-results class="flex hidden flex-col items-center justify-center py-12 text-center"><div class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/></svg></div><h3 class="text-foreground mb-2 text-lg font-semibold">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</h3><p class="text-muted-foreground text-sm">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p></div><div id=search-results-list class=hidden><div id=search-stats class="text-muted-foreground border-border border-b px-4 py-3 text-sm" data-template="%dê°œì˜ ê²°ê³¼ ì°¾ìŒ"></div><div id=search-items class="divide-border divide-y"></div></div></div><div class="border-border bg-muted/20 border-t px-4 py-3"><div class="text-muted-foreground flex items-center justify-between text-xs"><div class="flex items-center gap-2 md:gap-4"><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">â†‘â†“</kbd>
<span class="hidden sm:inline">ì´ë™</span></div><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">â†µ</kbd>
<span class="hidden sm:inline">ì„ íƒ</span></div><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">ESC</kbd>
<span class="hidden sm:inline">ë‹«ê¸°</span></div></div><div class="search-hint-desktop flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">âŒ˜K</kbd>
<span>ë‹¨ì¶•í‚¤</span></div></div></div></div></body></html>