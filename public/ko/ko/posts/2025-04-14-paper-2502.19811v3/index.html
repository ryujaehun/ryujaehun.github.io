<!doctype html><html lang=ko-kr data-theme=claude><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts | Jaehun's Blog</title><meta name=description content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문 **&ldquo;Comet: Fine-grained..."><meta name=keywords content="개발,프로그래밍,에세이"><meta name=author content><meta name=language content="ko"><meta name=robots content="index, follow"><link rel=canonical href=https://jaehun.me/ko/ko/posts/2025-04-14-paper-2502.19811v3/><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://jaehun.me/ko/ko/posts/2025-04-14-paper-2502.19811v3/"><meta property="og:site_name" content="Jaehun's Blog"><meta property="og:title" content="Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts"><meta property="og:description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문 **“Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts”**는 MoE 모델의 핵심 병목인 GPU 간 통신 지연을 fine-grained 수준에서 컴퓨팅과 통신을 정교하게 겹치도록 설계함으로써 실행 성능을 크게 개선한 ByteDance의 시스템 최적화 논문입니다."><meta property="og:locale" content="ko_kr"><meta property="og:type" content="article"><meta property="article:section" content="ko"><meta property="article:published_time" content="2025-04-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-14T00:00:00+00:00"><meta property="og:image" content="https://jaehun.me/images/og-default.avif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jaehun.me/images/og-default.avif"><meta name=twitter:title content="Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts"><meta name=twitter:description content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문 **“Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts”**는 MoE 모델의 핵심 병목인 GPU 간 통신 지연을 fine-grained 수준에서 컴퓨팅과 통신을 정교하게 겹치도록 설계함으로써 실행 성능을 크게 개선한 ByteDance의 시스템 최적화 논문입니다."><meta itemprop=name content="Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts"><meta itemprop=description content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문 **“Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts”**는 MoE 모델의 핵심 병목인 GPU 간 통신 지연을 fine-grained 수준에서 컴퓨팅과 통신을 정교하게 겹치도록 설계함으로써 실행 성능을 크게 개선한 ByteDance의 시스템 최적화 논문입니다."><meta itemprop=datePublished content="2025-04-14T00:00:00+00:00"><meta itemprop=dateModified content="2025-04-14T00:00:00+00:00"><meta itemprop=wordCount content="11126"><meta itemprop=image content="https://jaehun.me/images/og-default.avif"><meta itemprop=keywords content="Paper-Review,With-Gpt"><script>window.HUGO_SEARCH_CONFIG={searchIndexURL:'"/ko/index.json"'}</script><script>window.HUGO_GALLERY_CONFIG={justified_gallery:!1,lightbox:!1,justified:"{}",lightbox_options:"{}"}</script><link rel=stylesheet href=/css/compiled.min.9165cace5b80a5be5daad6ea96eb2abc20a18a3f41d7fed7f0335b689fdf7883.css integrity="sha256-kWXKzluApb5dqtbqlusqvCChij9B1/7X8DNbaJ/feIM=" crossorigin=anonymous><link rel=stylesheet href=/css/chroma.min.491df36221f739b5948a747a0351f100ee7ccaaf466d9f46288bf06de1d59123.css integrity="sha256-SR3zYiH3ObWUinR6A1HxAO58yq9GbZ9GKIvwbeHVkSM=" crossorigin=anonymous><script src=/js/main.ba969e49a7a874e6938fe689a7dcaa00cb64cb4d429c2cf98d09bde512a16c6d.js integrity="sha256-upaeSaeodOaTj+aJp9yqAMtky01CnCz5jQm95RKhbG0=" crossorigin=anonymous></script><script src=/js/gumshoe.polyfills.min.js></script><script src=/js/toc.70654aebf0b738a78ae2df95297cc10ebc6e590f3c942dd1325fa852f50038b2.js integrity="sha256-cGVK6/C3OKeK4t+VKXzBDrxuWQ88lC3RMl+oUvUAOLI=" crossorigin=anonymous defer></script><script src=/js/search.de3eba3540834efb8328121784bff4774e06362412ee41eee665f5b4f987f393.js integrity="sha256-3j66NUCDTvuDKBIXhL/0d04GNiQS7kHu5mX1tPmH85M=" crossorigin=anonymous defer></script><script src=/js/dock.e02f422517e001d9fb6bea1e9e8b0e89e9d2e486ad4641f275bb3e36ce2ae79f.js integrity="sha256-4C9CJRfgAdn7a+oenosOienS5IatRkHydbs+Ns4q558=" crossorigin=anonymous defer></script><script>(function(){const e=localStorage.getItem("theme")||"system",n=localStorage.getItem("colorScheme")||"claude";document.documentElement.setAttribute("data-theme",n);function t(){e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}t(),e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t)})()</script></head><body class="bg-background text-foreground min-h-screen antialiased"><div id=reading-progress-container class="reading-progress-container pointer-events-none fixed top-0 right-0 left-0 z-50 transition-opacity duration-300 ease-out" data-height=3 data-smooth-scroll=true data-hide-on-complete=false><div class="reading-progress-bg w-full"></div><div id=reading-progress-bar class="from-primary to-primary/80 reading-progress-bar
transition-all duration-150 ease-out
absolute top-0 left-0 w-0 bg-gradient-to-r"></div></div><script>(function(){"use strict";const t=document.getElementById("reading-progress-container"),o=document.getElementById("reading-progress-bar");if(!t||!o)return;const a={smoothScroll:t.dataset.smoothScroll==="true",hideOnComplete:t.dataset.hideOnComplete==="true"};let n=!0,l=null;function r(){const t=window.pageYOffset||document.documentElement.scrollTop,n=document.documentElement.scrollHeight,s=window.innerHeight,e=n-s;return e<=0?0:Math.min(Math.max(t/e*100,0),100)}function c(){const e=r();o.style.width=e+"%",a.hideOnComplete&&e>=99.5?n&&(t.style.opacity="0",n=!1):n||(t.style.opacity="1",n=!0)}let s=!1;function e(){s||(requestAnimationFrame(()=>{c(),s=!1}),s=!0)}function i(){window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||e()}),e(),window.addEventListener("beforeunload",()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})()</script><header class="sticky top-0 z-50 mx-auto max-w-4xl px-4 py-6"><div class="border-border bg-card/80 flex items-center rounded-xl border px-6 py-4 shadow-sm backdrop-blur-sm"><div class="hidden w-full items-center md:flex"><div class="flex items-center"><a href=/ko/ class="flex h-10 w-10 items-center justify-center overflow-hidden rounded-full transition-transform duration-200 hover:scale-105" aria-label="Jaehun's Blog"><img src=/images/logo.svg alt="Jaehun's Blog" class="h-full w-full object-cover"></a></div><nav class="mx-8 flex flex-1 items-center justify-center"><div class="flex items-center space-x-1"><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.posts"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
<span>게시글
</span></a><a href=/ko/categories/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.categories"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
<span>카테고리
</span></a><a href=/ko/tags/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.tags"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512.0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828.0l-7-7A1.994 1.994.0 013 12V7a4 4 0 014-4z"/></svg>
<span>태그
</span></a><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.archives"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
<span>아카이브</span></a></div></nav><div class="flex items-center space-x-2"><div class=relative><button id=language-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=language aria-label="언어 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="언어 변경"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8 6 6m-7 0 6-6 2-3M2 5h12M7 2h1m14 20-5-10-5 10m2-4h6"/></svg></button><div id=language-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=language role=menu aria-labelledby=language-toggle><a href=/ko/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem aria-current=true><span class=font-medium>한국어</span></a><a href=/en/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem><span class=font-medium>English</span></a></div></div><div class=relative><button id=color-scheme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=color-scheme aria-label="테마 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="테마 변경"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z"/></svg></button><div id=color-scheme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=color-scheme><button data-color-scheme=claude class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme=default class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme=bumblebee class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme=emerald class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme=nord class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme=sunset class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme=abyss class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme=dracula class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme=amethyst class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme=slate class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme=twitter class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div></div><div class=relative><button id=theme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=theme aria-label="테마 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 sun-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="라이트"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
<svg class="h-5 w-5 moon-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="다크"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg>
<svg class="h-5 w-5 system-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="시스템"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg></button><div id=theme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=theme><button data-theme=light class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="라이트"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>라이트</span></button><button data-theme=dark class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="다크"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg><span>다크</span></button><button data-theme=system class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="시스템"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg><span>시스템</span></button></div></div></div></div><div class="flex w-full items-center justify-between md:hidden"><div class=relative><button id=mobile-menu-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:bg-accent hover:text-foreground flex h-10 w-10 items-center justify-center rounded-lg border transition-colors duration-200" data-dropdown-type=mobile-menu aria-label=메뉴 aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="메뉴"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=mobile-menu class="mobile-menu dropdown-menu border-border bg-popover/95 absolute top-12 left-0 z-[60] hidden w-80 max-w-[calc(100vw-2rem)] rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out md:hidden" data-dropdown-type=mobile-menu role=menu aria-labelledby=mobile-menu-toggle><nav class="flex flex-col"><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.posts"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
<span>게시글
</span></a><a href=/ko/categories/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.categories"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
<span>카테고리
</span></a><a href=/ko/tags/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.tags"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512.0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828.0l-7-7A1.994 1.994.0 013 12V7a4 4 0 014-4z"/></svg>
<span>태그
</span></a><a href=/ko/ class="nav-link
text-muted-foreground hover:text-primary hover:bg-primary/10
focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none" role=menuitem><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="nav.archives"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
<span>아카이브</span></a></nav></div></div><div class="flex items-center space-x-2"><div class=relative><button id=language-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=language aria-label="언어 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="언어 변경"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8 6 6m-7 0 6-6 2-3M2 5h12M7 2h1m14 20-5-10-5 10m2-4h6"/></svg></button><div id=language-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=language role=menu aria-labelledby=language-toggle><a href=/ko/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem aria-current=true><span class=font-medium>한국어</span></a><a href=/en/ class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role=menuitem><span class=font-medium>English</span></a></div></div><div class=relative><button id=color-scheme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=color-scheme aria-label="테마 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="테마 변경"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z"/></svg></button><div id=color-scheme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=color-scheme><button data-color-scheme=claude class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme=default class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme=bumblebee class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme=emerald class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme=nord class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme=sunset class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme=abyss class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme=dracula class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme=amethyst class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme=slate class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme=twitter class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div></div><div class=relative><button id=theme-toggle class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95" data-dropdown-type=theme aria-label="테마 변경" aria-expanded=false aria-haspopup=true>
<svg class="h-5 w-5 sun-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="라이트"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
<svg class="h-5 w-5 moon-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="다크"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg>
<svg class="h-5 w-5 system-icon hidden relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="시스템"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg></button><div id=theme-dropdown class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out" data-dropdown-type=theme><button data-theme=light class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="라이트"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span>라이트</span></button><button data-theme=dark class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="다크"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg><span>다크</span></button><button data-theme=system class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
<svg class="h-5 w-5 mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="시스템"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17 9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5A2 2 0 003 5v10a2 2 0 002 2z"/></svg><span>시스템</span></button></div></div></div></div></div></header><main class="mx-auto max-w-4xl px-4 py-6"><nav class="breadcrumb mb-4 md:mb-6 py-1" aria-label=경로><ol class="text-muted-foreground flex items-center space-x-1 md:space-x-2 text-sm overflow-x-auto whitespace-nowrap scrollbar-hide py-1"><li class=flex-shrink-0><a href=/ko/ class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02]"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="홈"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11 2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
<span class="max-w-[4rem] md:max-w-none truncate">홈</span></a></li><li class="flex items-center gap-1 md:gap-2 min-w-0"><span class="text-muted-foreground/50 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></span><div class="flex items-center gap-1 md:gap-2 min-w-0"><a href=/ko class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02] flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5A2 2 0 003 7z"/></svg>
<span class="max-w-[4rem] md:max-w-none truncate">Ko</span>
</a><span class="text-muted-foreground/50 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></span>
<span class="text-foreground flex items-center gap-0.5 md:gap-1 font-medium min-w-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
<span class="max-w-[8rem] md:max-w-[16rem] lg:max-w-none truncate">Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts</span></span></div></li></ol></nav><header class=mb-8><h1 class="text-foreground mb-4 text-3xl font-bold md:text-4xl">Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts</h1></header><article class="prose prose-neutral dark:prose-invert max-w-none"><p><a href=https://arxiv.org/abs/2502.19811v3>논문 링크</a></p><h1 id=q--이-논문을-아주-자세하게-읽고-논문의-강점과-독창적인-지점을-설명해주고-핵심-알고리즘을-예시-입력을-들어서-전체적인-과정을-설명해줘-추가적으로-논문의-한계점에-대해서도-알려줘>Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘</h1><p>논문 **&ldquo;Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts&rdquo;**는 MoE 모델의 핵심 병목인 GPU 간 통신 지연을 <strong>fine-grained 수준에서 컴퓨팅과 통신을 정교하게 겹치도록 설계</strong>함으로써 실행 성능을 크게 개선한 ByteDance의 시스템 최적화 논문입니다.</p><hr><h2 id=-결론-요약>📌 결론 요약</h2><p><strong>Comet은 기존 MoE 시스템 대비 최대 1.96× 단일 레이어 속도 향상, 전체 모델 기준 평균 1.71× 속도 향상</strong>을 달성하였으며, ByteDance의 10,000+ GPU 클러스터에 상용 배포되어 수백만 GPU 시간 절감 효과를 보고함.</p><table><thead><tr><th>모델</th><th>비교 시스템</th><th>속도 향상 배율</th></tr></thead><tbody><tr><td>단일 MoE Layer</td><td>Megatron-Cutlass 외 3종</td><td><strong>1.28× ~ 2.37×</strong></td></tr><tr><td>End-to-End</td><td>Megatron-Cutlass / TE / FasterMoE / Tutel</td><td><strong>1.71× 평균 (최대 44.4%)</strong></td></tr></tbody></table><hr><h2 id=-핵심-기여-및-독창성>🧠 핵심 기여 및 독창성</h2><table><thead><tr><th>기여 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. Shared Tensor 기반의 Data Dependency 분석 및 재구성</strong></td><td>통신과 연산 간의 미세 단위 dependency를 추출하여 shared tensor를 M 또는 N 방향으로 나누고, computation tile 단위로 reschedule</td></tr><tr><td><strong>2. Adaptive Thread Block Assignment</strong></td><td>GPU Thread Block을 통신/연산으로 분리한 후, workload에 따라 비율을 동적으로 조절하여 latency concealment 극대화</td></tr><tr><td><strong>3. Fused Kernel을 통한 intra-kernel pipelining</strong></td><td>별도 kernel 호출 대신 하나의 kernel 내에서 통신과 연산을 thread block 수준에서 분리해 fine-grained overlapping 실현</td></tr><tr><td><strong>4. 실용성 높은 구현 및 실제 클러스터 적용</strong></td><td>NVSHMEM 기반 구현, Megatron-LM 통합, 다양한 병렬 전략(Tensor/Expert) 및 플랫폼(H800, L20) 대응</td></tr></tbody></table><hr><h2 id=-핵심-알고리즘-설명-예시-기반>🔍 핵심 알고리즘 설명 (예시 기반)</h2><h3 id=문제-상황>문제 상황:</h3><p>MoE의 Layer0에서는 각 token이 여러 expert로 분산되어 GPU 간 통신 필요 → GEMM 실행은 tile 단위 (예: 128×128), 하지만 통신은 token 단위 → <strong>granularity mismatch</strong> 발생</p><hr><h3 id=예시-입력>예시 입력:</h3><ul><li>총 토큰 수 ( M = 4096 ), 각 token은 ( N = 4096 ) 차원</li><li>top-k = 2 → token마다 2개의 expert로 라우팅됨</li><li>Expert 수 ( E = 8 ), GPU 수 = 8 (expert parallelism)</li></ul><hr><h3 id=comet-처리-흐름>Comet 처리 흐름:</h3><ol><li><p><strong>Shared Tensor Decompose</strong></p><ul><li>Layer0에서는 GEMM의 입력이므로 ( M ) 방향(토큰 단위)으로 tensor 분해</li><li>Layer1에서는 TopK reduce 결과를 보낼 때 ( N ) 방향(embedding 차원)으로 분해</li></ul></li><li><p><strong>Reschedule: 통신-연산 파이프라인 정렬</strong></p><ul><li>각 expert의 GEMM tile이 가능한 한 local token으로 시작되도록 token 정렬</li><li>Remote token은 비동기로 가져오면서 다른 tile 연산 진행</li></ul></li><li><p><strong>Adaptive Thread Block Assignment</strong></p><ul><li>GPU SM에 thread block 배정 시, 통신 전용 / 연산 전용 block 분리</li><li>Comet은 입력 길이, top-k, expert 수에 따라 최적 분할비 (e.g. 통신:연산 = 26:106)를 동적으로 선택</li></ul></li><li><p><strong>Fine-grained Fused Kernel 실행</strong></p><ul><li>통신 thread block은 async I/O (TMA 등)로 remote token 수신</li><li>연산 thread block은 GroupGEMM tile 실행</li><li>공유 메모리 경유로 통신-연산을 안전하게 동기화</li></ul></li></ol><hr><h2 id=-성능-분석-실험-결과>🧪 성능 분석 (실험 결과)</h2><table><thead><tr><th>실험 조건</th><th>Comet의 개선 효과</th></tr></thead><tbody><tr><td>Input Token 수 증가 (2048→32768)</td><td>1.28× ~ 2.37× layer 속도 개선</td></tr><tr><td>top-k 및 expert 수 증가</td><td>Tutel, FasterMoE 대비 1.16× ~ 1.83× 안정적 개선</td></tr><tr><td>GPU 간 대역폭 제약 (L20 클러스터)</td><td>1.19× ~ 1.46× 개선, Comet의 유연성 입증</td></tr><tr><td>Load imbalance 상황 (token 분포 std=0.05)</td><td>여전히 Comet이 최저 latency 유지</td></tr></tbody></table><hr><h2 id=-한계점-및-향후-방향>⚠️ 한계점 및 향후 방향</h2><table><thead><tr><th>한계</th><th>설명</th></tr></thead><tbody><tr><td><strong>NVSHMEM 의존성</strong></td><td>저수준 통신 라이브러리 사용 → 유지보수 및 호환성 문제 가능</td></tr><tr><td><strong>실행 전 profiling 필요</strong></td><td>각 모델 config마다 최적 thread block 비율을 profiling 해야 함</td></tr><tr><td><strong>아직은 MoE layer에 집중</strong></td><td>attention, embedding 등 다른 연산과 통합된 end-to-end 전체 최적화는 미진</td></tr></tbody></table><hr><h2 id=-요약>💡 요약</h2><p><strong>Comet은 기존 coarse-grained pipelining 방식의 한계를 극복하고, fine-grained 수준에서 연산과 통신을 정교하게 조율함으로써 MoE의 병목을 구조적으로 해결한 고성능 시스템입니다.</strong> 특히, CUDA 커널 레벨에서의 통합 스케줄링 및 동적 리소스 분배는 일반적인 kernel-level 병렬화에서 구현이 어려웠던 부분을 효과적으로 해결한 점에서 높은 독창성과 실용성을 지닙니다.</p><h1 id=q--논문의-핵심알고리즘을-예시를-들어-아주-자세하게-설명해주고-정리해-줘>Q : 논문의 핵심알고리즘을 예시를 들어 아주 자세하게 설명해주고 정리해 줘</h1><p>좋습니다. 논문 <em>Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts</em>의 핵심 알고리즘은 크게 두 가지입니다:</p><hr><h2 id=-핵심-알고리즘-구조-요약>🧩 핵심 알고리즘 구조 요약</h2><table><thead><tr><th>구성 요소</th><th>역할</th><th>핵심 아이디어</th></tr></thead><tbody><tr><td>① Shared Tensor 기반 Dependency Resolving</td><td>통신-연산 파이프라인 최적화</td><td>Tensor 분해 + 연산 재스케줄</td></tr><tr><td>② Adaptive Workload Assignment</td><td>GPU 자원 효율화</td><td>Thread block 비율을 동적으로 조정</td></tr></tbody></table><hr><p>이제 실제 예시를 기반으로 각 알고리즘이 어떻게 작동하는지 자세히 설명하겠습니다.</p><hr><h2 id=-예시-설정>🔎 예시 설정</h2><h3 id=모델-설정>모델 설정</h3><ul><li>Token 수 ( M = 4096 ), 임베딩 차원 ( N = 4096 )</li><li>Expert 수 ( E = 4 ), top-k = 2</li><li>Expert parallelism: 각 GPU는 1개의 expert를 가지고 있음 (GPU0 ~ GPU3)</li><li>GEMM tile 크기 = 128 × 128</li></ul><hr><h2 id=--shared-tensor-기반-dependency-resolving>🧠 ① Shared Tensor 기반 Dependency Resolving</h2><h3 id=-목적>💡 목적</h3><p>통신과 연산을 <strong>동시에 처리</strong>하기 위해, 연산에서 필요한 데이터가 준비되는 순간 바로 연산을 시작하게 만드는 것</p><hr><h3 id=-moe-layer0의-예>📌 MoE Layer0의 예</h3><h4 id=-step-1-shared-tensor-분해-decompose>✅ Step 1: Shared Tensor 분해 (Decompose)</h4><ul><li>각 token은 top-2 expert로 라우팅됨 → GPU 간 All-to-All 통신 필요</li><li>GEMM 연산은 보통 128개의 token 단위로 tile 연산</li><li>따라서, <strong>shared tensor를 M 방향(토큰 방향)</strong> 으로 분해<ul><li>예: tensor shape = (4096 × N), → 32개 블록 (4096/128 = 32)</li></ul></li></ul><h4 id=-step-2-재스케줄-reschedule>✅ Step 2: 재스케줄 (Reschedule)</h4><ul><li>각 expert는 local + remote token이 섞여 있음</li><li>먼저 <strong>local token만 포함된 tile부터 GEMM 실행 시작</strong><ul><li>예: GPU1의 Expert1은 local token 0~127을 먼저 처리</li></ul></li><li>그 사이 GPU1은 GPU0/GPU2로부터 필요한 remote token을 비동기로 수신</li></ul><p>➡️ 결과적으로 연산과 통신이 자연스럽게 겹침 (overlap)</p><hr><h3 id=-moe-layer1의-예>📌 MoE Layer1의 예</h3><h4 id=-step-1-shared-tensor-분해-decompose-1>✅ Step 1: Shared Tensor 분해 (Decompose)</h4><ul><li>GEMM 후 결과를 top-k reduce하여 통신함 → GEMM 결과는 (M×N)</li><li>Reduce는 token끼리 합치므로 M 방향으로 분해 ❌, 대신 <strong>N 방향 분해</strong> ✔️</li></ul><h4 id=-step-2-재스케줄>✅ Step 2: 재스케줄</h4><ul><li>GEMM 결과는 column-wise로 처리되며</li><li><strong>앞부분 N 차원의 column부터 먼저 계산하고 바로 reduce+send</strong><ul><li>예: column 0~127 완료 → 곧바로 All-to-All 시작</li></ul></li></ul><p>➡️ 연산 끝날 때까지 기다리지 않고, 앞부분부터 통신을 시작할 수 있게 됨</p><hr><h2 id=--adaptive-workload-assignment>🧠 ② Adaptive Workload Assignment</h2><h3 id=-목적-1>💡 목적</h3><p>연산 thread block과 통신 thread block의 <strong>수량 비율</strong>을 자동 조정하여 pipeline 효율 극대화</p><hr><h3 id=예시>예시</h3><ul><li>GPU에 132개의 SM이 있음 → 132개의 thread block 배치 가능</li><li>각 kernel 실행 시, <code>nc</code>개는 통신용 thread block, <code>np</code>개는 연산용 thread block 할당</li></ul><h4 id=문제-어떤-비율이-최적일까>문제: 어떤 비율이 최적일까?</h4><h4 id=해결>해결:</h4><ul><li>실행 전에 다양한 입력 길이와 모델 구성에 따라 profile 수행</li><li>예: ( M=16384, TP=8 )이면 → 최적 <code>nc=26</code>, <code>np=106</code></li><li>이 값을 metadata로 저장 → 런타임에 동적으로 최적 커널 선택</li></ul><p>➡️ workload마다 latency concealment 극대화 (예: 통신과 연산 latency 비슷하게 맞춤)</p><hr><h2 id=-전체-실행-흐름-요약>🎯 전체 실행 흐름 요약</h2><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-0 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-0 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-0><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln> 1</span><span class=cl>[Input Tokens] →
</span></span><span class=line><span class=ln> 2</span><span class=cl>① Shared Tensor 생성 →
</span></span><span class=line><span class=ln> 3</span><span class=cl>①-1 M/N 방향으로 분해 →
</span></span><span class=line><span class=ln> 4</span><span class=cl>①-2 Token 정렬 및 tile 단위 연산 재배열 →
</span></span><span class=line><span class=ln> 5</span><span class=cl>② Adaptive thread block 분배 (e.g., nc=26, np=106) →
</span></span><span class=line><span class=ln> 6</span><span class=cl>③ Fused kernel 내에서
</span></span><span class=line><span class=ln> 7</span><span class=cl>   ├─ 통신 block: remote token 비동기 수신
</span></span><span class=line><span class=ln> 8</span><span class=cl>   └─ 연산 block: local token부터 GEMM 시작 →
</span></span><span class=line><span class=ln> 9</span><span class=cl>④ 연산 결과는 곧바로 column-wise로 reduce+send →
</span></span><span class=line><span class=ln>10</span><span class=cl>[Output Token]</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-0",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h2 id=-시각화-요약>📌 시각화 요약</h2><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-1 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-1 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-1><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln> 1</span><span class=cl>  ┌────────────┐         ┌────────────┐
</span></span><span class=line><span class=ln> 2</span><span class=cl>  │ Remote I/O │◄───────▶│ Local GEMM │
</span></span><span class=line><span class=ln> 3</span><span class=cl>  └────────────┘         └────────────┘
</span></span><span class=line><span class=ln> 4</span><span class=cl>        ▲                      ▲
</span></span><span class=line><span class=ln> 5</span><span class=cl>        │ Shared Tensor (분해/재정렬)
</span></span><span class=line><span class=ln> 6</span><span class=cl>        ▼                      ▼
</span></span><span class=line><span class=ln> 7</span><span class=cl>  ┌─────────────────────────────────┐
</span></span><span class=line><span class=ln> 8</span><span class=cl>  │    Fine-grained Overlapping     │
</span></span><span class=line><span class=ln> 9</span><span class=cl>  └─────────────────────────────────┘
</span></span><span class=line><span class=ln>10</span><span class=cl>        ▲                      ▲
</span></span><span class=line><span class=ln>11</span><span class=cl>        │                      │
</span></span><span class=line><span class=ln>12</span><span class=cl>   [통신 Thread Block]    [연산 Thread Block]</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-1",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h2 id=-요약-정리>✅ 요약 정리</h2><table><thead><tr><th>알고리즘</th><th>설명</th><th>주요 효과</th></tr></thead><tbody><tr><td>Shared Tensor Dependency Resolving</td><td>통신과 연산 사이의 데이터 의존성 해소 위해 tensor를 분해 및 재스케줄</td><td>미세 단위 연산-통신 overlap 실현</td></tr><tr><td>Adaptive Workload Assignment</td><td>통신/연산 thread block의 수를 동적으로 할당</td><td>SM 활용도 극대화 + bubble 최소화</td></tr><tr><td>Fused Kernel 실행</td><td>하나의 kernel에서 통신과 연산을 분리된 thread block으로 동시에 실행</td><td>커널 호출 오버헤드 제거</td></tr></tbody></table><h1 id=q--이-논문에서-제시한-결과를-자세하게-보고-다른-방법론에-비하여-특출난-점과-논문에서-제기하는-어떠한-방법이-이러한-결과를-도출하게-되었는지-논문에서-제시하는-이유와-너의-생각을-알려줘>Q : 이 논문에서 제시한 결과를 자세하게 보고 다른 방법론에 비하여 특출난 점과 논문에서 제기하는 어떠한 방법이 이러한 결과를 도출하게 되었는지 논문에서 제시하는 이유와 너의 생각을 알려줘</h1><p>논문 **&ldquo;Comet: Fine-grained Computation-communication Overlapping for Mixture-of-Experts&rdquo;**는 기존 MoE 시스템들과 비교하여 <strong>성능 향상폭이 일관되고 크며</strong>, 그 원인을 <strong>아키텍처 차원의 정밀한 병렬성과 리소스 배분 전략</strong>에서 찾습니다. 아래에서는 Comet이 <strong>구체적으로 어떤 실험 조건에서 얼마나 뛰어난 성능을 보였는지</strong>, 그리고 <strong>어떤 메커니즘이 성능 향상을 유도했는지</strong>, 마지막으로 이에 대한 제 생각까지 종합적으로 정리하겠습니다.</p><hr><h2 id=-실험-결과-요약-수치로-보는-comet의-강점>✅ 실험 결과 요약: 수치로 보는 Comet의 강점</h2><h3 id=1--end-to-end-모델-성능-비교>1. 📈 End-to-End 모델 성능 비교</h3><table><thead><tr><th>모델</th><th>비교 대상</th><th>Comet 성능 향상</th></tr></thead><tbody><tr><td>Mixtral-8x7B, Qwen2-MoE, Phi-3.5-MoE</td><td>Megatron-Cutlass</td><td><strong>34.1% 감소</strong></td></tr><tr><td></td><td>Megatron-TE</td><td><strong>42.6% 감소</strong></td></tr><tr><td></td><td>FasterMoE</td><td><strong>44.4% 감소</strong></td></tr><tr><td></td><td>Tutel</td><td><strong>31.8% 감소</strong></td></tr></tbody></table><h3 id=2--단일-moe-layer-성능>2. 🔍 단일 MoE Layer 성능</h3><table><thead><tr><th>Input Token 수</th><th>Comet vs. Baseline</th><th>향상 폭</th></tr></thead><tbody><tr><td>M = 2048~32768</td><td>Megatron-TE 외 3종</td><td><strong>1.28× ~ 2.37×</strong></td></tr></tbody></table><h3 id=3--통신-overlap-효과>3. 🎯 통신 Overlap 효과</h3><table><thead><tr><th>시스템</th><th>통신 latency 은닉률</th></tr></thead><tbody><tr><td><strong>Comet</strong></td><td><strong>86.5%</strong></td></tr><tr><td>Tutel</td><td>68.6%</td></tr><tr><td>FasterMoE</td><td>29.2%</td></tr><tr><td>Megatron 계열</td><td>0% (overlap 없음)</td></tr></tbody></table><hr><h2 id=-comet이-특출났던-이유-논문에서-제시한-주장>🔍 Comet이 특출났던 이유 (논문에서 제시한 주장)</h2><h3 id=-1-fine-grained-수준에서의-연산통신-병렬화>🎯 1. Fine-grained 수준에서의 연산/통신 병렬화</h3><ul><li>기존 방법(FasterMoE, Tutel)은 kernel-level 수준에서 coarse하게 겹치거나 수동 pipelining만 제공</li><li>→ Comet은 shared tensor를 token 단위로 분해 후, tile granularity로 연산 재스케줄</li><li>✅ 효과: <strong>전례 없는 수준의 latency hiding</strong></li></ul><h3 id=-2-fused-kernel-내-thread-block-specialization>🎯 2. Fused kernel 내 thread block specialization</h3><ul><li>통신과 연산을 동일 kernel 내 thread block으로 완전히 분리하여 SM 간 리소스 충돌 방지</li><li>✅ 효과: <strong>CUDA kernel 호출 오버헤드 제거 + 동시 실행 보장</strong></li></ul><h3 id=-3-adaptive-workload-assignment>🎯 3. Adaptive workload assignment</h3><ul><li>입력 길이, expert 수, top-k 등 다양한 상황에 따라 thread block 비율 동적으로 조정</li><li>✅ 효과: <strong>다양한 config에서 consistently 우수한 성능</strong></li></ul><h3 id=-4-host-scheduling-제거>🎯 4. Host scheduling 제거</h3><ul><li>FasterMoE, Tutel은 전문가마다 kernel을 생성해야 해서 작은 expert 수에서는 오버헤드 심각</li><li>Comet은 fused kernel 내부에서 자체 스케줄링 수행</li><li>✅ 효과: <strong>작은 입력에서도 성능 저하 없음</strong></li></ul><hr><h2 id=-내-생각-comet이-왜-차별적인가>🧠 내 생각: Comet이 왜 차별적인가?</h2><table><thead><tr><th>관점</th><th>기존 방식</th><th>Comet</th></tr></thead><tbody><tr><td>병렬 granularity</td><td>전문가별/배치별</td><td><strong>tile/token 단위 (fine-grained)</strong></td></tr><tr><td>통신 연산 통합</td><td>별도 kernel</td><td><strong>fused kernel 내부 병렬 thread block</strong></td></tr><tr><td>runtime adaptiveness</td><td>없음 또는 고정</td><td><strong>동적 thread block 조절</strong></td></tr><tr><td>실질적 latency 은닉</td><td>미흡</td><td><strong>86% 이상 은닉</strong></td></tr></tbody></table><h3 id=-핵심-통찰>📌 핵심 통찰:</h3><p>기존 시스템들이 단순히 통신 시점을 당기거나 연산을 block-wise로 나누는 수준에 그쳤다면, <strong>Comet은 CUDA kernel 설계 차원에서 문제를 다시 정의함으로써 병목을 해결</strong>함. 이는 단순한 기법의 조합이 아니라, **“연산 단위와 통신 단위 간 granularity mismatch를 해결하는 구조적 접근”**으로 볼 수 있음.</p><hr><h2 id=-향후-확장-가능성>💬 향후 확장 가능성</h2><p>논문에서 언급된 것처럼, 이 구조는 TVM이나 Triton 같은 컴파일러 백엔드로 확장 가능하며, 실제 <strong>&ldquo;token dispatch-aware kernel fusion&rdquo;</strong> 같은 개념을 도입하면 더 일반적인 sparse 모델(예: sparse MLP, Switch Transformer 등)에도 적용 가능함.</p><hr><h2 id=-요약-정리-1>✅ 요약 정리</h2><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>성능</td><td>최대 2.37× 속도 향상, 통신 latency 86.5% 은닉</td></tr><tr><td>구조적 차별점</td><td>shared tensor 재구성 + fused kernel 병렬화</td></tr><tr><td>핵심 메커니즘</td><td>fine-grained dependency resolving + adaptive thread block assignment</td></tr><tr><td>내 견해</td><td>단순한 pipelining이 아닌, GPU 커널 스케줄링의 구조적 최적화</td></tr></tbody></table><h1 id=q-이-논문에서-제시된-방법을-수도-코드로-설명을-해주었으면해-구체적인-주석이-추가가-되면-좋을것-같아>Q :이 논문에서 제시된 방법을 수도 코드로 설명을 해주었으면해 구체적인 주석이 추가가 되면 좋을것 같아</h1><p>아래는 <strong>Comet 논문</strong>의 핵심 알고리즘을 반영한 **수도 코드 (pseudocode)**입니다. 구조적으로는 두 핵심 구성인:</p><ol><li><strong>Shared Tensor 기반 Dependency Resolving (분해 및 재스케줄링)</strong></li><li><strong>Adaptive Workload Assignment (thread block 비율 조정)</strong></li></ol><p>을 중심으로 구성했으며, GPU의 SM 단위 실행을 추상화하여 <code>launch_kernel()</code>로 표현하고 CUDA 스타일의 thread block 역할도 구체적으로 주석으로 설명합니다.</p><hr><h3 id=-1-주요-데이터-구조-정의>📦 1. 주요 데이터 구조 정의</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-2 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-2 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln>1</span><span class=cl><span class=c1># SharedTensor: 통신-연산 사이의 공유 버퍼</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=k>class</span> <span class=nc>SharedTensor</span><span class=p>:</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>):</span>  <span class=c1># shape = (M, N)</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>zeros</span><span class=p>(</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>()</span>  <span class=c1># fine-grained access 관리용</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-2",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h3 id=-2-dependency-resolving-shared-tensor-분해--재스케줄>🔄 2. Dependency Resolving: shared tensor 분해 + 재스케줄</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-3 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-3 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>def</span> <span class=nf>decompose_and_reschedule</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>layer_type</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s2>    shared_tensor: 통신과 연산 사이의 버퍼
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s2>    layer_type: &#34;layer0&#34; or &#34;layer1&#34; (통신-연산 or 연산-통신)
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=k>if</span> <span class=n>layer_type</span> <span class=o>==</span> <span class=s2>&#34;layer0&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=c1># Layer0: GEMM이 consumer → token dimension(M)을 따라 분해</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=n>chunks</span> <span class=o>=</span> <span class=n>split_tensor</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=n>chunk_size</span><span class=o>=</span><span class=mi>128</span><span class=p>)</span>  <span class=c1># GEMM tile 기준</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=c1># local 우선 실행을 위한 토큰 정렬 (source GPU 기준)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=n>sorted_chunks</span> <span class=o>=</span> <span class=n>sort_by_source_rank</span><span class=p>(</span><span class=n>chunks</span><span class=p>)</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=k>return</span> <span class=n>sorted_chunks</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>elif</span> <span class=n>layer_type</span> <span class=o>==</span> <span class=s2>&#34;layer1&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=c1># Layer1: Top-K Reduce가 consumer → embedding dimension(N) 따라 분해</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=n>chunks</span> <span class=o>=</span> <span class=n>split_tensor</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=s1>&#39;N&#39;</span><span class=p>,</span> <span class=n>chunk_size</span><span class=o>=</span><span class=mi>128</span><span class=p>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=k>return</span> <span class=n>chunks</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-3",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h3 id=-3-adaptive-thread-block-assignment>⚙️ 3. Adaptive Thread Block Assignment</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-4 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-4 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>def</span> <span class=nf>select_optimal_thread_block_config</span><span class=p>(</span><span class=n>M</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>topk</span><span class=p>,</span> <span class=n>TP</span><span class=p>,</span> <span class=n>EP</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s2>    입력 크기 및 모델 설정에 따라 최적의 thread block 비율 선택
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=p>(</span><span class=n>M</span><span class=p>,</span> <span class=n>topk</span><span class=p>,</span> <span class=n>TP</span><span class=p>,</span> <span class=n>EP</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>PROFILED_CONFIG</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=k>return</span> <span class=n>PROFILED_CONFIG</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>  <span class=c1># 사전 프로파일링된 메타데이터</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=c1># 기본 fallback</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=n>total_blocks</span> <span class=o>=</span> <span class=mi>132</span>  <span class=c1># Hopper 기준</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=n>nc</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=mf>0.2</span> <span class=o>*</span> <span class=n>total_blocks</span><span class=p>)</span>  <span class=c1># 통신용</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=n>np</span> <span class=o>=</span> <span class=n>total_blocks</span> <span class=o>-</span> <span class=n>nc</span>       <span class=c1># 연산용</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=k>return</span> <span class=n>nc</span><span class=p>,</span> <span class=n>np</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-4",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h3 id=-4-fused-kernel-실행-커널-내부-동작-추상화>🚀 4. Fused Kernel 실행 (커널 내부 동작 추상화)</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-5 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-5 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-5><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>def</span> <span class=nf>launch_comet_fused_kernel</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>layer_type</span><span class=p>,</span> <span class=n>nc</span><span class=p>,</span> <span class=n>np</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s2>    하나의 CUDA 커널 내부에서 통신 thread block과 연산 thread block을 동시에 실행
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=c1># 각 thread block은 아래와 같은 동작을 함</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>parallel_for</span> <span class=n>block_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nc</span> <span class=o>+</span> <span class=n>np</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=k>if</span> <span class=n>block_id</span> <span class=o>&lt;</span> <span class=n>nc</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>            <span class=c1># 🔴 통신용 thread block</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=n>all_required_chunks_ready</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>):</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=n>remote_fetch_next_token</span><span class=p>()</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                <span class=n>write_to_shared_tensor</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=c1># 🔵 연산용 thread block (GEMM or Reduce)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=n>chunks</span> <span class=o>=</span> <span class=n>get_ready_chunks</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>block_id</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=k>for</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=n>chunks</span><span class=p>:</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                <span class=k>if</span> <span class=n>layer_type</span> <span class=o>==</span> <span class=s2>&#34;layer0&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=n>group_gemm</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=n>topk_reduce_and_scatter</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                <span class=n>write_output</span><span class=p>(</span><span class=n>result</span><span class=p>)</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-5",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h3 id=-전체-실행-흐름-정리>🧠 전체 실행 흐름 정리</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PYTHON</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-6 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-6 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-6><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>def</span> <span class=nf>run_comet_pipeline</span><span class=p>(</span><span class=n>M</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>topk</span><span class=p>,</span> <span class=n>TP</span><span class=p>,</span> <span class=n>EP</span><span class=p>,</span> <span class=n>layer_type</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1># Step 1: Shared tensor 준비</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=n>shared_tensor</span> <span class=o>=</span> <span class=n>SharedTensor</span><span class=p>((</span><span class=n>M</span> <span class=o>*</span> <span class=n>topk</span><span class=p>,</span> <span class=n>N</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=c1># Step 2: Shared tensor 분해 및 재정렬</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>chunks</span> <span class=o>=</span> <span class=n>decompose_and_reschedule</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>layer_type</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=c1># Step 3: 최적 thread block 수 계산</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>nc</span><span class=p>,</span> <span class=n>np</span> <span class=o>=</span> <span class=n>select_optimal_thread_block_config</span><span class=p>(</span><span class=n>M</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>topk</span><span class=p>,</span> <span class=n>TP</span><span class=p>,</span> <span class=n>EP</span><span class=p>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=c1># Step 4: 커널 실행 (통신/연산 병렬 수행)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=n>launch_comet_fused_kernel</span><span class=p>(</span><span class=n>shared_tensor</span><span class=p>,</span> <span class=n>layer_type</span><span class=p>,</span> <span class=n>nc</span><span class=p>,</span> <span class=n>np</span><span class=p>)</span></span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-6",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><hr><h2 id=-주석-요약-포인트>✅ 주석 요약 포인트</h2><ul><li><code>decompose_and_reschedule()</code>는 통신과 연산 사이의 granularity mismatch를 해소</li><li><code>select_optimal_thread_block_config()</code>는 workload 맞춤형 thread block 비율 제공</li><li><code>launch_comet_fused_kernel()</code>은 하나의 fused kernel에서 <strong>thread block 단위로 역할 분리</strong><ul><li><code>block_id &lt; nc</code>: 통신 전용 thread block (NVSHMEM 기반 I/O)</li><li><code>block_id >= nc</code>: 연산 전용 thread block (CUTLASS 기반 GEMM, Top-K Reduce 등)</li></ul></li></ul><hr><p>이 구조는 <strong>CUDA GPU programming abstraction</strong>과 <strong>논문 설계 흐름</strong>을 정확히 대응시키며, 향후 Triton이나 TVM으로 구현 시에도 그대로 맵핑 가능한 수준으로 설계되었습니다.</p><h1 id=q--이-논문의-입력데이터와-추론-과정에-대해서-예시를-들어-아주-자세하게-설명해-주겠니-추가적으로-모델아키텍처의-구성-및-모델을-구성하는-연산과-메모리-요구량-컴퓨팅-요구량-대해서도-설명해줘>Q : 이 논문의 입력데이터와 추론 과정에 대해서 예시를 들어 아주 자세하게 설명해 주겠니? 추가적으로 모델아키텍처의 구성 및 모델을 구성하는 연산과 메모리 요구량 컴퓨팅 요구량 대해서도 설명해줘</h1><p>좋습니다. 이 논문인 <strong>Comet</strong>은 Mixture-of-Experts (MoE) 기반 대형 모델에서의 <strong>추론(inference)</strong> 또는 <strong>학습 과정에서 발생하는 GPU 간 통신 병목을 해소</strong>하기 위한 시스템적 최적화를 다룹니다. 질문하신 내용을 기준으로 다음과 같이 설명하겠습니다:</p><hr><h2 id=1--예시-기반-입력-데이터와-추론-과정>1. 📥 예시 기반 입력 데이터와 추론 과정</h2><h3 id=-예시-mixtral-8x7b-모델-기준-논문-실험-대상>📌 예시: Mixtral-8x7B 모델 기준 (논문 실험 대상)</h3><table><thead><tr><th>항목</th><th>값</th></tr></thead><tbody><tr><td>Input token 수 ( M )</td><td>8192</td></tr><tr><td>Embedding dimension ( N )</td><td>4096</td></tr><tr><td>Hidden size ( K )</td><td>14336</td></tr><tr><td>Expert 수 ( E )</td><td>8</td></tr><tr><td>Top-k routing</td><td>2 (각 token은 2개의 expert에 전달)</td></tr></tbody></table><hr><h3 id=-추론-전처리-및-라우팅-token-routing>🔁 추론 전처리 및 라우팅 (Token Routing)</h3><ol><li><strong>Input</strong>: 8192 tokens → [8192, 4096] 크기의 입력 텐서</li><li><strong>Gating</strong>:<ul><li>각 token은 top-2 expert로 라우팅됨 → 총 16384개 token이 expert에 전달됨</li><li>실제 routing은 gate 네트워크(작은 MLP)가 softmax 후 top-2 선택</li></ul></li><li><strong>All-to-All 통신</strong>:<ul><li>Expert는 여러 GPU에 분산되어 있음 → 각 GPU는 자신에게 라우팅된 token만 받음</li></ul></li></ol><hr><h3 id=-expert-computation-moe-layer-0>🧠 Expert Computation (MoE Layer 0)</h3><p>각 expert는 일반적인 FFN 구조:</p><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">TEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-7 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-7 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-7><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln>1</span><span class=cl>GEMM1: [token, 4096] × [4096, 14336] → [token, 14336]
</span></span><span class=line><span class=ln>2</span><span class=cl>Activation: GELU or ReLU
</span></span><span class=line><span class=ln>3</span><span class=cl>GEMM2: [token, 14336] × [14336, 4096] → [token, 4096]</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-7",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><ul><li><code>token</code>은 GPU별로 분산됨 (e.g., GPU0은 3000개, GPU1은 1500개 등)</li><li>이 연산은 모든 expert에 대해 병렬적으로 수행됨 (Grouped GEMM)</li></ul><hr><h3 id=-결과-병합-moe-layer-1>📤 결과 병합 (MoE Layer 1)</h3><ul><li>각 expert의 출력은 다시 All-to-All로 전송되어 원래 token 위치로 결합됨</li><li>Top-k reduction 수행:<ul><li>각 token의 두 expert 출력 → gating score 기반 weighted sum</li><li>최종 output shape: [8192, 4096]</li></ul></li></ul><hr><h2 id=2--모델-아키텍처-구성-comet-관점>2. 🏗️ 모델 아키텍처 구성 (Comet 관점)</h2><h3 id=전체-구조-1-transformer-block-기준>전체 구조 (1 Transformer block 기준)</h3><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">TEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-8 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-8 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-8><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln> 1</span><span class=cl>Input Embedding
</span></span><span class=line><span class=ln> 2</span><span class=cl>   ↓
</span></span><span class=line><span class=ln> 3</span><span class=cl>Multi-Head Self Attention
</span></span><span class=line><span class=ln> 4</span><span class=cl>   ↓
</span></span><span class=line><span class=ln> 5</span><span class=cl>LayerNorm
</span></span><span class=line><span class=ln> 6</span><span class=cl>   ↓
</span></span><span class=line><span class=ln> 7</span><span class=cl>MoE Layer
</span></span><span class=line><span class=ln> 8</span><span class=cl>  ├─ Dispatch (token → expert)
</span></span><span class=line><span class=ln> 9</span><span class=cl>  ├─ Expert FFNs (GEMM1 + Activation + GEMM2)
</span></span><span class=line><span class=ln>10</span><span class=cl>  └─ Combine (Top-k reduction)
</span></span><span class=line><span class=ln>11</span><span class=cl>   ↓
</span></span><span class=line><span class=ln>12</span><span class=cl>LayerNorm
</span></span><span class=line><span class=ln>13</span><span class=cl>   ↓
</span></span><span class=line><span class=ln>14</span><span class=cl>Output</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-8",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>이 중 Comet은 <strong>MoE Layer에만 집중</strong>하여 통신-연산 병렬화를 수행합니다.</p></div></blockquote><hr><h2 id=3--연산량computational-cost-분석>3. 📊 연산량(Computational Cost) 분석</h2><h3 id=-moe-layer-기준-한-expert의-ffn>✅ MoE Layer 기준: 한 expert의 FFN</h3><table><thead><tr><th>연산</th><th>형태</th><th>FLOPs 계산</th></tr></thead><tbody><tr><td>GEMM1</td><td>[T, 4096] × [4096, 14336]</td><td>( 2 \times T \times 4096 \times 14336 )</td></tr><tr><td>GELU</td><td>[T, 14336]</td><td>약 ( 10 \times T \times 14336 )</td></tr><tr><td>GEMM2</td><td>[T, 14336] × [14336, 4096]</td><td>( 2 \times T \times 14336 \times 4096 )</td></tr><tr><td><strong>합계</strong></td><td></td><td>약 ( 2 \times T \times 4096 \times 14336 \times 2 ) FLOPs</td></tr></tbody></table><ul><li>( T ): 해당 expert에 라우팅된 token 수</li><li>예: GPU당 평균 T = 2048이면, 약 480 GFLOPs per expert</li></ul><hr><h2 id=4--메모리-요구량>4. 🧠 메모리 요구량</h2><h3 id=shared-tensor-크기>Shared Tensor 크기</h3><blockquote class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1"><div class="prose prose-sm max-w-none"><p>shared tensor는 GEMM 입력/출력 및 통신을 위한 버퍼입니다.</p></div></blockquote><ul><li>MoE Layer0: ( M \times \text{topk} \times N )<ul><li>예: ( 8192 \times 2 \times 4096 \times 2 ) Bytes (BF16) ≈ <strong>128MB</strong></li></ul></li><li>MoE Layer1: GEMM 출력 후 reduce 대상 → 동일 크기</li></ul><p><strong>→ 총 약 256MB의 버퍼 필요</strong>, 이는 <strong>NVSHMEM을 통해 모든 GPU에서 공유됨</strong></p><hr><h2 id=5--comet에서의-최적화-요소-반영>5. 🧩 Comet에서의 최적화 요소 반영</h2><table><thead><tr><th>처리 단계</th><th>Comet에서의 최적화 방법</th><th>효과</th></tr></thead><tbody><tr><td>Dispatch</td><td>Shared Tensor 기반 M 방향 분해 + 토큰 재배치</td><td>통신 시작과 연산 병렬화 가능</td></tr><tr><td>GEMM 실행</td><td>GroupGEMM → tile 우선순위 재스케줄</td><td>local token tile 우선 실행으로 overlap 증가</td></tr><tr><td>Combine</td><td>N 방향 분해 → column-wise GEMM 처리</td><td>연산 일부 끝나자마자 통신 가능</td></tr><tr><td>통신 & 연산</td><td>통신/연산 thread block 분리 (fused kernel)</td><td>CUDA scheduling 오버헤드 제거</td></tr></tbody></table><hr><h2 id=-정리-요약>✅ 정리 요약</h2><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>입력 데이터</td><td>[8192, 4096] token embedding</td></tr><tr><td>라우팅 방식</td><td>top-2 expert routing (gate 기반)</td></tr><tr><td>주요 연산</td><td>GEMM1 + Activation + GEMM2 + Top-k Combine</td></tr><tr><td>FLOPs</td><td>약 2.4 TFLOPs (모든 expert 처리 시)</td></tr><tr><td>메모리 요구량</td><td>Shared Tensor 256MB (BF16 기준)</td></tr><tr><td>Comet 효과</td><td>통신-연산 fine-grained overlap + 커널 내 스케줄링으로 1.7×~2× 속도 향상</td></tr></tbody></table><h1 id=q--이-논문의-한계를-극복하기-위한-방법으로-어떤-연구흐름이-있는지-정리해서-자세하게-설명해-줘>Q : 이 논문의 한계를 극복하기 위한 방법으로 어떤 연구흐름이 있는지 정리해서 자세하게 설명해 줘</h1><p>좋습니다. 이 논문 <strong>Comet</strong>은 Mixture-of-Experts(MoE) 구조에서 <strong>fine-grained 수준의 통신-연산 overlap</strong>을 구현하여 기존 방법의 coarse-grained pipelining 한계를 극복했습니다. 하지만, 여전히 몇 가지 <strong>구조적, 시스템적 한계</strong>가 존재하며, 이러한 한계를 극복하려는 연구들은 다양한 방향으로 발전하고 있습니다.</p><hr><h2 id=-comet의-주요-한계-요약>✅ Comet의 주요 한계 요약</h2><table><thead><tr><th>범주</th><th>한계점</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 통신 라이브러리 종속성</strong></td><td>NVSHMEM</td><td>낮은 수준의 GPU 직접통신 API로, 플랫폼 독립성/유지보수 어려움</td></tr><tr><td><strong>2. 컴파일러 최적화 부재</strong></td><td>수작업 커널 튜닝</td><td>컴파일러 기반의 자동화된 tile 분해/스케줄링이 없음</td></tr><tr><td><strong>3. attention 등 타 연산과의 통합 부재</strong></td><td>범용성 제한</td><td>MoE 연산 외의 dense block에 대한 latency overlap은 고려되지 않음</td></tr><tr><td><strong>4. 실행 전 profiling 필요</strong></td><td>static optimal block config</td><td>입력/하드웨어가 달라지면 profiling 재필요 → 실시간 적응 어려움</td></tr></tbody></table><hr><h2 id=-한계-극복을-위한-연구-흐름별-정리>🔍 한계 극복을 위한 연구 흐름별 정리</h2><h3 id=-1-컴파일러-기반-자동화-tvm-triton-unity>🧠 [1] 컴파일러 기반 자동화: TVM, Triton, Unity</h3><table><thead><tr><th>접근법</th><th>설명</th></tr></thead><tbody><tr><td><strong>Triton-based Fused MoE Kernels</strong></td><td>연산자 fusion + 메모리 관리 자동화</td></tr><tr><td><strong>TVM</strong></td><td>dependency-aware scheduling + cost model 기반 autotuning</td></tr><tr><td><strong>Unity</strong> (Meta, 2024)</td><td>모델 표현-컴파일-스케줄링 전체 자동화 파이프라인 구축</td></tr></tbody></table><p><strong>핵심 기여</strong>:<br>Comet의 shared tensor 분석 및 reschedule 과정을 <strong>자동으로 추론 및 커널 생성</strong><br>→ 사람이 hand-tune한 커널보다 더 효율적인 layout & schedule을 제안 가능</p><p>🔗 대표 연구:</p><ul><li><strong>Unity: AI compiler for unified model optimization</strong> (Meta, 2024)</li><li><strong>TrMoE: Triton-based sparse expert execution</strong> (ICLR 2025 under review)</li></ul><hr><h3 id=-2-네트워크토폴로지-최적화-hierarchical-all-to-all--topology-aware-scheduling>🌐 [2] 네트워크/토폴로지 최적화: Hierarchical All-to-All & Topology-aware Scheduling</h3><table><thead><tr><th>접근법</th><th>설명</th></tr></thead><tbody><tr><td><strong>2D Hierarchical All-to-All</strong></td><td>intra-node / inter-node 분리 후 효율적 통신</td></tr><tr><td><strong>Topology-aware token dispatch</strong></td><td>bandwidth에 따라 routing 최적화 (Hotspot 방지)</td></tr></tbody></table><p><strong>핵심 기여</strong>:<br>NVSHMEM을 사용하는 fine-grained 통신의 한계를 <strong>통신 스케줄링 계층에서 완화</strong><br>→ 더 큰 클러스터에 적응 가능</p><p>🔗 대표 연구:</p><ul><li><strong>Tutel (2023)</strong> – Hierarchical All2All + adaptive MoE</li><li><strong>HetuMoE (2022)</strong> – 트래픽을 균형있게 분산시켜 통신 병목 완화</li></ul><hr><h3 id=-3-onlineruntime-재구성-dynamic-expert-scheduling--adaptive-routing>🔄 [3] Online/Runtime 재구성: Dynamic Expert Scheduling & Adaptive Routing</h3><table><thead><tr><th>접근법</th><th>설명</th></tr></thead><tbody><tr><td><strong>Dynamic Expert Pruning / Dropout</strong></td><td>실행 시점에 부하 기반으로 expert 활성화</td></tr><tr><td><strong>Expert Affinity Routing</strong></td><td>통신량 최소화 방향으로 routing 동적 조절</td></tr><tr><td><strong>Latency-aware Kernel Dispatcher</strong></td><td>입력 token 수에 따라 fused kernel 동적 선택</td></tr></tbody></table><p><strong>핵심 기여</strong>:<br>Comet의 static profiling 의존성을 해결하고 <strong>실시간 workload에 적응</strong><br>→ workload imbalance나 token skew에도 강건</p><p>🔗 대표 연구:</p><ul><li><strong>Gating Dropout (ICML 2022)</strong> – MoE 통신량 감소</li><li><strong>SparTA (Sparse Transformer Autotuner)</strong> – online tile tuning</li></ul><hr><h3 id=-4-다른-연산자와의-통합-attention-moe-fusion-cross-block-scheduling>🔀 [4] 다른 연산자와의 통합: Attention-MoE Fusion, Cross-block Scheduling</h3><table><thead><tr><th>접근법</th><th>설명</th></tr></thead><tbody><tr><td><strong>Fused Attention + MoE Block</strong></td><td>연속된 attention → MoE block을 fused kernel로 실행</td></tr><tr><td><strong>Pipeline-aware compiler</strong></td><td>연산자 간 dep graph를 global scheduling</td></tr></tbody></table><p><strong>핵심 기여</strong>:<br>현재 MoE layer만 target으로 하는 Comet을 <strong>모델 전체 수준으로 확장</strong></p><p>🔗 대표 연구:</p><ul><li><strong>PipeMoE (INFOCOM 2023)</strong> – MoE operator 간 full-path pipeline 구성</li><li><strong>Flux (ByteDance, 2024)</strong> – MoE 외 연산까지 fused kernel 구성</li></ul><hr><h2 id=-비교-요약-테이블-연구-흐름별-특징>📌 비교 요약 테이블: 연구 흐름별 특징</h2><table><thead><tr><th>연구 흐름</th><th>해결 대상</th><th>대표 기술</th><th>기대 효과</th></tr></thead><tbody><tr><td>Compiler 기반 자동화</td><td>수작업 커널 최적화</td><td>Triton, TVM, Unity</td><td>구조적 재현성과 확장성</td></tr><tr><td>통신 최적화</td><td>통신량/latency</td><td>Hierarchical All2All</td><td>더 큰 클러스터 대응</td></tr><tr><td>Runtime 적응</td><td>Static tuning</td><td>Gating Dropout, SparTA</td><td>입력 변화에 유연</td></tr><tr><td>전체 모델 통합</td><td>연산자 간 경계</td><td>PipeMoE, Flux</td><td>모델 수준 latency 최적화</td></tr></tbody></table><hr><h2 id=-정리>✅ 정리</h2><ul><li><strong>Comet</strong>은 MoE 구조 내 통신-연산 병목을 <strong>fine-grained pipelining + fused kernel</strong> 방식으로 해결한 최첨단 시스템이지만, <strong>컴파일러 지원 부재, 통신 추상화 제한, 전체 모델 통합 부족</strong> 등의 구조적 한계가 있습니다.</li><li>이를 극복하기 위한 연구는 아래와 같은 흐름으로 확장 중입니다:<ol><li><strong>컴파일러 기반 자동화 (Triton/TVM/Unity)</strong></li><li><strong>네트워크 aware 통신 최적화 (Tutel, HetuMoE)</strong></li><li><strong>동적 실행 적응 (SparTA, Gating Dropout)</strong></li><li><strong>모델 전체 연산 통합 (PipeMoE, Flux)</strong></li></ol></li></ul><p>각 흐름은 <strong>Comet의 장점을 유지하면서도 확장성과 실시간성, 범용성 측면에서 더 큰 발전 가능성</strong>을 열어주고 있습니다.</p><h1 id=q--comet이-기존-moe-시스템fastermoe-tutel-등-대비-fine-grained-overlapping을-실현하기-위해-어떤-granularity-level-최적화를-적용했으며-이로-인해-어떠한-구조적-trade-off가-발생하는가>Q : Comet이 기존 MoE 시스템(FasterMoE, Tutel 등) 대비 fine-grained overlapping을 실현하기 위해 어떤 granularity-level 최적화를 적용했으며, 이로 인해 어떠한 구조적 trade-off가 발생하는가?</h1><p>좋은 질문입니다. <strong>Comet이 기존 MoE 시스템(FasterMoE, Tutel 등)과 비교해 가장 근본적으로 차별화되는 점은 granularity 수준에서의 정교한 최적화</strong>입니다. 아래에서 구체적으로 어떤 수준에서 fine-grained overlapping을 적용했는지, 그리고 그에 따라 생기는 구조적 trade-off는 무엇인지 정리해드립니다.</p><hr><h2 id=-comet의-granularity-level-최적화>✅ Comet의 granularity-level 최적화</h2><h3 id=1-기존-시스템의-한계-coarse-grained-overlap>1. 기존 시스템의 한계 (Coarse-Grained Overlap)</h3><table><thead><tr><th>시스템</th><th>겹침 수준</th><th>단점</th></tr></thead><tbody><tr><td><strong>FasterMoE</strong></td><td>expert 단위 pipelining</td><td>작은 expert 처리 시 kernel launch 오버헤드 커짐</td></tr><tr><td><strong>Tutel</strong></td><td>token group 단위 pipelining</td><td>Heuristic scheduling → 실제 종속성 반영 어려움</td></tr></tbody></table><p>이들은 통신과 연산을 <strong>별도의 kernel로 나누어 coarse하게 병렬 실행</strong>하며,
kernel 간 오버헤드, 종속성 미스매치 등으로 <strong>latency hiding이 제한적</strong>임</p><hr><h3 id=2-comet의-fine-grained-overlapping-방식>2. Comet의 fine-grained overlapping 방식</h3><table><thead><tr><th>항목</th><th>Comet의 접근</th></tr></thead><tbody><tr><td><strong>Tensor 분해 단위</strong></td><td>token dimension(M), embedding dimension(N) 방향 분해</td></tr><tr><td><strong>Execution granularity</strong></td><td>GroupGEMM tile (e.g., 128×128) 수준에서 재스케줄링</td></tr><tr><td><strong>Kernel 실행 단위</strong></td><td>하나의 <strong>fused kernel 내부에서 통신/연산 thread block 분리</strong></td></tr><tr><td><strong>연산 순서</strong></td><td>token 소스 rank 기준 정렬 → <strong>local token tile 우선 실행</strong></td></tr></tbody></table><p>➡️ 이렇게 하여 통신이 완료된 일부 데이터가 <strong>즉시 연산에 들어갈 수 있는 path</strong> 확보</p><hr><h2 id=-구조적-trade-off>⚠️ 구조적 trade-off</h2><h3 id=1-커널-복잡도-증가-및-구현-부담>1. 커널 복잡도 증가 및 구현 부담</h3><ul><li>Fused kernel은 통신/연산 thread block 간의 <strong>동기화, shared memory 할당, warp 경쟁</strong> 등을 세밀하게 제어해야 함</li><li>→ 일반적인 CUTLASS GEMM이나 기존 NCCL 사용보다 <strong>low-level CUDA 설계 부담 증가</strong></li></ul><h3 id=2-하드웨어-종속성-증가>2. 하드웨어 종속성 증가</h3><ul><li>Hopper GPU에서는 TMA/Tensor Core 등을 효율적으로 활용하지만, **다른 GPU 아키텍처(Ampere, Volta)**에서는 이점이 제한될 수 있음</li><li>특히 NVSHMEM은 모든 클러스터 환경에서 지원되는 것이 아니므로 <strong>이식성 문제</strong> 발생</li></ul><h3 id=3-컴파일러-최적화와의-통합-어려움>3. 컴파일러 최적화와의 통합 어려움</h3><ul><li>shared tensor의 분해/재배치는 현재 수작업으로 최적화됨 → <strong>컴파일러가 인지하고 최적화하기 어려움</strong></li><li>TVM, Triton 등과 연동 시 <strong>의존성 추론이 까다로움</strong></li></ul><hr><h2 id=-요약-1>🔁 요약</h2><table><thead><tr><th>항목</th><th>기존 방법</th><th>Comet</th></tr></thead><tbody><tr><td>Overlap 단위</td><td>expert/kernel</td><td>token/tile</td></tr><tr><td>실행 방식</td><td>병렬 커널 실행</td><td>fused kernel 내부 thread block 병렬</td></tr><tr><td>장점</td><td>구현 단순, 일부 overlap</td><td><strong>정밀한 latency hiding (86% 은닉)</strong></td></tr><tr><td>단점</td><td>overlap 제한적</td><td><strong>설계 복잡성, 이식성, 컴파일러 통합성 문제</strong></td></tr></tbody></table><hr><p>결론적으로, Comet은 granularity를 token-level 및 tile-level로 끌어올린 덕분에 <strong>MoE의 통신 병목을 근본적으로 해소</strong>하지만, <strong>이와 맞물려 커널 설계 및 시스템 통합 측면에서 복잡성과 이식성에 대한 trade-off</strong>를 감수해야 하는 구조입니다. 이 점을 후속 연구에서는 <strong>컴파일러 통합이나 runtime adaptation 방식으로 해결하려는 흐름</strong>이 있습니다.</p><h1 id=q--shared-tensor-기반-dependency-resolving-과정에서-m과-n-방향-분해를-사용하는-기준은-무엇이며-이를-다른-연산자예-attention-layernorm에도-일반화하려면-어떤-제약이-발생하는가>Q : Shared Tensor 기반 dependency resolving 과정에서 M과 N 방향 분해를 사용하는 기준은 무엇이며, 이를 다른 연산자(예: Attention, LayerNorm)에도 일반화하려면 어떤 제약이 발생하는가?</h1><p>매우 중요한 질문입니다. <strong>Comet의 핵심 기술인 Shared Tensor 기반 dependency resolving</strong>은 **&ldquo;어떤 방향으로 tensor를 분해할 것인가?&rdquo;**에 따라 overlapping 성능이 크게 좌우되며, 이를 다른 연산자(예: Attention, LayerNorm 등)로 확장하려면 <strong>연산자의 입출력 형태 및 데이터 의존성 구조</strong>에 대한 깊은 이해가 필요합니다.</p><hr><h2 id=-1-comet에서-mn-방향-분해-기준>✅ 1. Comet에서 M/N 방향 분해 기준</h2><h3 id=shared-tensor의-역할>Shared Tensor의 역할</h3><ul><li><strong>통신과 연산 사이</strong>에서 데이터를 연결하는 <strong>producer-consumer buffer</strong></li><li>overlapping을 위해선 <strong>두 연산이 독립적으로 접근 가능한 방향</strong>으로 분해되어야 함</li></ul><hr><h3 id=moe-layer-0-all-to-all--gemm>MoE Layer 0 (All-to-All → GEMM)</h3><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Producer</td><td>통신 (All-to-All)</td></tr><tr><td>Consumer</td><td>GEMM1 (FFN의 첫 번째 연산)</td></tr><tr><td>Shared Tensor shape</td><td>((M \times \text{topk}, N))</td></tr><tr><td>분해 방향</td><td><strong>M 방향 (토큰 단위)</strong></td></tr></tbody></table><p><strong>이유</strong>:</p><ul><li>GEMM은 row-wise 병렬화 → 각 token은 독립적으로 계산 가능</li><li>따라서, <strong>M 차원을 따라 분해하면 consumer(GEMM)가 부분적으로 먼저 실행 가능</strong></li><li>이로 인해 통신된 일부 token만 도착해도 연산이 시작됨</li></ul><hr><h3 id=moe-layer-1-gemm2--combine>MoE Layer 1 (GEMM2 → Combine)</h3><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Producer</td><td>GEMM2 (FFN의 두 번째 연산)</td></tr><tr><td>Consumer</td><td>Top-k Combine + All-to-All</td></tr><tr><td>Shared Tensor shape</td><td>동일: ((M \times \text{topk}, N))</td></tr><tr><td>분해 방향</td><td><strong>N 방향 (임베딩 차원)</strong></td></tr></tbody></table><p><strong>이유</strong>:</p><ul><li>Top-k Combine은 token 단위로 <strong>M 방향 reduce</strong> 연산</li><li>이 경우 <strong>M 방향은 inter-dependent</strong> → 분해 불가</li><li>대신, <strong>N 차원은 token 내부 차원이므로 독립적</strong> → 연산 일부 완료 시 곧바로 통신 가능</li></ul><hr><h2 id=-2-일반화-시-기준>✅ 2. 일반화 시 기준</h2><p>다른 연산자에 이 방식을 적용하려면 <strong>다음 기준</strong>을 따져야 합니다:</p><table><thead><tr><th>판단 기준</th><th>의미</th><th>예시</th></tr></thead><tbody><tr><td><strong>연산자의 access pattern</strong></td><td>어떤 차원을 기준으로 병렬화하는가?</td><td>Attention → QK^T: head-wise, seq-wise</td></tr><tr><td><strong>의존성 방향</strong></td><td>어느 차원이 독립적이고, 어느 차원이 종속적인가?</td><td>LayerNorm → feature(N) 종속, token(M) 독립</td></tr><tr><td><strong>output consumption timing</strong></td><td>출력이 언제부터 다음 연산에 소비 가능한가?</td><td>Residual add: 전체 완료 필요 → overlap 어려움</td></tr></tbody></table><hr><h2 id=-3-연산자별-적용-가능성과-제약>✅ 3. 연산자별 적용 가능성과 제약</h2><h3 id=-self-attention-qkt-softmax-v-곱>🧠 Self-Attention (QK^T, softmax, V 곱)</h3><table><thead><tr><th>연산</th><th>가능 여부</th><th>제약</th></tr></thead><tbody><tr><td>QK^T (dot-product)</td><td>부분적으로 가능</td><td><code>seq_i</code>와 <code>seq_j</code> 간 의존성 존재 → <strong>M과 M의 상호참조</strong></td></tr><tr><td>softmax</td><td>❌</td><td>전체 query sequence 필요 → non-overlappable</td></tr><tr><td>V 곱</td><td>가능 (tile 단위)</td><td><code>softmax(QK)</code>가 완료되어야 시작 가능</td></tr></tbody></table><p>➡️ <strong>Attention은 token 간 의존성이 있어 M 분해가 어려우며, V 곱 단계만 일부 적용 가능</strong></p><hr><h3 id=-layernorm>🧪 LayerNorm</h3><table><thead><tr><th>연산</th><th>가능 여부</th><th>제약</th></tr></thead><tbody><tr><td>Mean, Var 계산</td><td>불가능 (전체 feature 필요)</td><td>N 차원 reduction 필요</td></tr><tr><td>정규화 계산</td><td>부분 적용 가능</td><td>N 방향 병렬 가능하나, <strong>의미 있는 overlapping은 어려움</strong></td></tr></tbody></table><p>➡️ LayerNorm은 output을 생성하기 위해 **전체 feature vector(N)**가 필요하기 때문에 overlapping 자체가 어려움</p><hr><h2 id=-요약-정리-2>✅ 요약 정리</h2><table><thead><tr><th>연산자</th><th>가능 분해 방향</th><th>가능한 overlapping 단계</th><th>제약 사항</th></tr></thead><tbody><tr><td>GEMM</td><td>M (row-wise)</td><td>Early computation by tile</td><td>없음</td></tr><tr><td>Combine (TopK)</td><td>N (column-wise)</td><td>Early reduce + send</td><td>M 종속성</td></tr><tr><td>Attention</td><td>일부 M, 일부 head</td><td>V 곱 정도</td><td>query-key 간 상호참조</td></tr><tr><td>LayerNorm</td><td>거의 불가</td><td>없음</td><td>feature 전체 필요</td></tr></tbody></table><hr><h2 id=-결론>📌 결론</h2><p>Comet의 M/N 방향 분해 기준은 다음과 같은 <strong>원칙적 판단</strong>에 기반합니다:</p><ol><li><strong>Consumer 연산자가 어떤 차원을 병렬화하는가?</strong></li><li><strong>Shared tensor 내에서 독립적으로 접근 가능한 차원이 존재하는가?</strong></li><li><strong>그 차원으로 tensor를 분해했을 때 결과가 일관성을 유지하는가?</strong></li></ol><p>이를 다른 연산자에 일반화하기 위해서는 <strong>연산자의 내부 데이터 의존성 모델링</strong>과 <strong>tile-level scheduler의 보편화</strong>가 필수이며, 이러한 generalization은 앞으로의 컴파일러 기반 접근(TVM, Unity 등)에서 중요한 방향이 될 것입니다.</p><h1 id=q--adaptive-thread-block-assignment에서-profiling-기반으로-최적-block-비율을-선택하는-방식이-comet의-실시간성이나-범용성에-미치는-영향을-줄이고자-할-때-어떠한-online-scheduling-기법이-보완적으로-적용될-수-있을까>Q : Adaptive thread block assignment에서 profiling 기반으로 최적 block 비율을 선택하는 방식이 Comet의 실시간성이나 범용성에 미치는 영향을 줄이고자 할 때, 어떠한 online scheduling 기법이 보완적으로 적용될 수 있을까?</h1><p>이 질문은 <strong>Comet의 Adaptive Thread Block Assignment</strong>의 핵심 한계를 지적하는 매우 예리한 질문입니다. Comet은 현재 **사전 profiling 기반(static metadata)**으로 최적 <code>nc:nc</code> (통신:연산 thread block 비율)를 선택하기 때문에, **실시간성(real-time adaptability)**과 <strong>범용성(generalizability)</strong> 측면에서 제약이 있습니다.</p><hr><h2 id=-문제-요약-왜-문제가-되는가>✅ 문제 요약: 왜 문제가 되는가?</h2><table><thead><tr><th>항목</th><th>문제점</th></tr></thead><tbody><tr><td><strong>실시간성 결여</strong></td><td>새로운 입력 크기(M), top-k, 하드웨어 환경 등 바뀔 때마다 profiling 재수행 필요</td></tr><tr><td><strong>범용성 부족</strong></td><td>다른 모델이나 dynamic routing 정책에 대해 성능 보장 어려움</td></tr><tr><td><strong>모델 일반화 한계</strong></td><td>Comet은 MoE의 FFN 구조에 최적화 → 다른 구조(예: depth-wise conv)에서 어려움</td></tr></tbody></table><hr><h2 id=-해결-방향-online-scheduling-기법-적용>✅ 해결 방향: Online Scheduling 기법 적용</h2><p>아래는 실시간 적응성을 높이기 위해 적용 가능한 <strong>Online Scheduling 기법 3가지</strong>와 그 특징입니다.</p><hr><h3 id=1--reinforcement-learning-기반-thread-block-튜너-runtime-auto-tuner>1. 🔁 Reinforcement Learning 기반 Thread Block 튜너 (Runtime Auto-Tuner)</h3><p>| 개념 | 환경 상태(state)를 입력으로 받고, thread block 비율을 action으로 선택 → reward는 latency |
| 입력 | 현재 입력 token 수(M), expert 수(E), top-k, device ID, previous latency |
| 방법 | Bandit / PPO / DQN 기반 정책 학습 (심지어 lightweight model도 가능) |
| 장점 | 실시간 적응 + 환경 변화에 강건 |
| 단점 | 초기 학습 비용, cold-start 문제</p><p><strong>예시</strong>:</p><ul><li>첫 번째 100 step 동안 탐색 (explore)</li><li>이후 빠르게 best config 선택</li><li>latency에 따라 reward 조정</li></ul><p>🔗 관련 사례:</p><ul><li><strong>AutoTVM (TVM)</strong>, <strong>SparTA (Sparse Transformer Auto-tuner)</strong></li></ul><hr><h3 id=2--lightweight-heuristic-rule--피드백-보정-latency-ratio-tuning>2. 📊 Lightweight Heuristic Rule + 피드백 보정 (Latency Ratio Tuning)</h3><p>| 개념 | 통신 연산 latency를 runtime에서 실측 → 일정 비율 차이만큼 thread block 수 재조정 |
| 수식 예시 |</p><div class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md"><div class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-2"><div class="text-muted-foreground flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4 4 4-4 4M6 16l-4-4 4-4"/></svg></div><span class="text-muted-foreground text-sm font-medium">PLAINTEXT</span></div><div class="flex items-center gap-2"><button class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-9 data-default-state=expanded data-collapsed=false data-auto-collapse-lines=30 data-auto-collapse-height=400 data-collapsed-height=120 title=접기 aria-label=접기>
<span class=collapse-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
</span><span class="collapse-text hidden sm:inline">접기</span>
</button>
<button class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none" data-code-id=code-9 title=복사 aria-label=복사>
<span class=copy-icon><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
</span><span class="copy-text hidden sm:inline">복사</span></button></div></div><div class="code-block-content relative" id=code-9><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>if latency_comm &gt; latency_comp:
</span></span><span class=line><span class=ln>2</span><span class=cl>    nc += Δ
</span></span><span class=line><span class=ln>3</span><span class=cl>    np -= Δ
</span></span><span class=line><span class=ln>4</span><span class=cl>else:
</span></span><span class=line><span class=ln>5</span><span class=cl>    np += Δ
</span></span><span class=line><span class=ln>6</span><span class=cl>    nc -= Δ</span></span></code></pre></div><div class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300"><div class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">클릭하여 더 보기</div></div></div></div><script>(function(){const s="code-9",n=document.querySelector('.copy-code-btn[data-code-id="'+s+'"]'),t=document.querySelector('.collapse-code-btn[data-code-id="'+s+'"]'),e=document.getElementById(s);if(!e)return;if(n){const s=n.querySelector(".copy-icon"),t=n.querySelector(".copy-text");n.addEventListener("click",async function(){try{let o="";const i=e.querySelector(".lntd:last-child code");if(i)o=i.textContent||i.innerText;else{const t=e.querySelector("code");if(t){const e=t.querySelector(".ln");if(e){const e=t.querySelectorAll(".cl");if(e.length>0)o=Array.from(e).map(e=>{const t=e.textContent||e.innerText;return t.replace(/\n+$/,"")}).join(`
`).replace(/\n+$/,"");else{const e=t.textContent||t.innerText;o=e.replace(/^\d+/gm,"").replace(/^\s+/gm,"")}}else o=t.textContent||t.innerText}else o=e.textContent||e.innerText}o=o.trim(),await navigator.clipboard.writeText(o),s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>`,t&&(t.textContent="복사됨"),n.classList.add("text-green-600"),setTimeout(()=>{s.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>`,t&&(t.textContent="복사"),n.classList.remove("text-green-600")},2e3)}catch(o){console.error("复制失败:",o);const s=document.createRange(),i=e.querySelector("code")||e;s.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),t&&(t.textContent="선택됨"),setTimeout(()=>{t&&(t.textContent="복사"),n.removeAllRanges()},2e3)}})}if(t){const d=t.querySelector(".collapse-icon"),c=t.querySelector(".collapse-text"),n=e.querySelector(".collapse-overlay");let s=e.querySelector("pre.chroma");s||(s=e.querySelector("pre"));const m=t.dataset.defaultState||"expanded",f=t.dataset.collapsed==="true",u=parseInt(t.dataset.autoCollapseLines)||30,h=parseInt(t.dataset.autoCollapseHeight)||400,p=parseInt(t.dataset.collapsedHeight)||120;let l=!1;function i(){const e=f||m==="collapsed"||a();e&&o(!0,!1)}function a(){if(s){const e=s.querySelectorAll(".line, .cl"),t=s.offsetHeight;return e.length>u||t>h}const t=e.offsetHeight;if(t>h)return!0;const n=e.textContent||e.innerText||"",o=n.split(`
`).length;return o>u}function o(s,o=!0){if(!n)return;l=s,s?(e.style.maxHeight=p+"px",e.style.overflow="hidden",n.style.opacity="1",n.style.pointerEvents="auto",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>`,c&&(c.textContent="펼치기"),t.title="펼치기"):(e.style.maxHeight="",e.style.overflow="",n.style.opacity="0",n.style.pointerEvents="none",d.innerHTML=`
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>`,c&&(c.textContent="접기"),t.title="접기"),o&&(e.style.transition="max-height 0.3s ease-out",setTimeout(()=>{e.style.transition=""},300))}function r(){o(!l,!0)}t.addEventListener("click",r),n&&n.addEventListener("click",()=>{l&&o(!1,!0)}),i()}})()</script><p>| 장점 | 매우 경량 + 빠른 적용 가능 |
| 단점 | feedback loop tuning이 안정적이지 않을 수 있음</p><p><strong>적용 방식</strong>:</p><ul><li>각 MoE layer 시작 시 latency 예측</li><li>커널 launch 직전 shared memory/warp 수 고려해 thread block 조정</li></ul><p>🔗 관련 사례:</p><ul><li>Flux (ByteDance internal)</li><li>Optimus-CC: Heuristic communication partitioning</li></ul><hr><h3 id=3--predictive-performance-modeling-dynamic-cost-model>3. 📈 Predictive Performance Modeling (Dynamic Cost Model)</h3><p>| 개념 | 학습된 모델을 통해 입력 파라미터 기반으로 block 비율 예측 |
| 학습 대상 | 입력 길이 M, expert 부하 분포 std, top-k, 하드웨어 정보 |
| 모델 종류 | Linear Regression / Gradient Boosted Trees / Lightweight NN |
| 장점 | 매우 빠르고 정확도 높음 (한 번만 학습하면 됨) |
| 단점 | 모델 구조 바뀔 경우 재학습 필요</p><p><strong>구현 방식</strong>:</p><ul><li>다양한 config에 대해 오프라인 latency log 수집</li><li>이후 실행 시, 해당 input에 맞는 <code>nc/np</code> 예측</li></ul><p>🔗 관련 사례:</p><ul><li>GShard / Unity compiler의 auto-partitioning cost model</li></ul><hr><h2 id=-요약-비교표>📌 요약 비교표</h2><table><thead><tr><th>방식</th><th>실시간성</th><th>정확도</th><th>구현 난이도</th><th>보완 가능성</th></tr></thead><tbody><tr><td>RL 기반 튜닝</td><td>★★★★☆</td><td>★★★★☆</td><td>★★★★☆</td><td>최고 수준 적응성</td></tr><tr><td>Heuristic + Feedback</td><td>★★★★★</td><td>★★☆☆☆</td><td>★★☆☆☆</td><td>빠른 적용, 간단</td></tr><tr><td>Predictive 모델링</td><td>★★★★☆</td><td>★★★★☆</td><td>★★★☆☆</td><td>적당한 트레이드오프</td></tr></tbody></table><hr><h2 id=-추천-hybrid-방식>✅ 추천: Hybrid 방식</h2><ul><li><strong>초기 실행에는 Predictive 모델 + Heuristic 보정</strong></li><li>이후 자주 쓰이는 config에는 RL 기반 튜너를 학습</li></ul><p>→ 초기 latency는 낮추고, 장기적으로 <strong>실행 환경 변화에 적응 가능</strong>한 구조 확보</p><hr><h2 id=-결론-1>✅ 결론</h2><p><strong>Comet의 static profiling 기반 thread block assignment는 고정된 config에서는 매우 강력하지만,</strong> 동적 환경/모델 구조/입력 변동에는 민감합니다. 이를 극복하기 위해서는:</p><ol><li>RL 기반 auto-tuner (강력하지만 복잡)</li><li>Heuristic feedback loop (간단하고 빠름)</li><li>Cost model 기반 prediction (성능 예측 정확)</li></ol><p>을 조합한 <strong>실시간 hybrid thread block scheduler</strong>가 가장 현실적이며 효과적인 대안입니다. 이러한 방식은 Comet을 더 넓은 범위의 모델과 상황에 적용 가능한 <strong>범용 MoE 시스템</strong>으로 확장하는 데 핵심 기여를 할 수 있습니다.</p></article></main><footer class="mx-auto max-w-4xl px-4 py-8"><div class="px-6 py-6"><nav class=mb-6><div class="flex flex-wrap items-center justify-center gap-1"><a href=/index.xml class="nav-link hover:text-primary hover:bg-primary/10 text-muted-foreground flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="RSS Feed"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18.0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"/></svg>
<span>RSS Feed</span></a></div></nav><div class="border-border mb-6 border-t"></div><div class="flex flex-col items-center justify-between gap-4 md:flex-row"><div class="text-muted-foreground text-sm"><p>&copy; 2025 Jaehun's Blog.
모든 권리 보유.</p></div><div class="flex items-center gap-3"><a href=https://github.com/ryujaehun target=_blank rel="noopener noreferrer" class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=GitHub aria-label=GitHub><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="GitHub"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8.0 00-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35.0-3.5.0.0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35.0 3.5A5.4 5.4.0 004 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></svg>
</a><a href=https://www.linkedin.com/in/jaehunryu/ target=_blank rel="noopener noreferrer" class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=Linkedin aria-label=Linkedin><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="Linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg>
</a><a href=mailto:jaehunryu@icloud.com class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none" title=Email aria-label=Email><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-label="Email"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22.0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v10a2 2 0 002 2z"/></svg></a></div></div></div></footer><div id=dock class="pointer-events-none fixed bottom-4 left-1/2 z-[9999] w-fit -translate-x-1/2 translate-y-24 opacity-0 transition-all duration-300 ease-out sm:right-0 sm:left-0 sm:mx-auto sm:translate-x-0" role=toolbar aria-label="바로가기 도구 모음"><nav class="border-border bg-card/80 scrollbar-hide xs:px-3 xs:py-2 mx-auto flex max-w-[calc(100vw-2rem)] min-w-fit items-center justify-center overflow-x-auto rounded-2xl border px-4 py-3 shadow-lg backdrop-blur-sm sm:px-4 sm:py-3"><button id=dock-back class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title=뒤로 aria-label=뒤로>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
<span class="hidden sm:inline">뒤로</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-toc class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title=목차 aria-label=목차>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
<span class="hidden sm:inline">목차</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-search class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-3 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-4 sm:py-2" title=검색 aria-label=검색>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
<span class="hidden md:inline">검색</span></button><div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div><button id=dock-top class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2" title="맨 위로" aria-label="맨 위로">
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="m18 15-6-6-6 6"/></svg>
<span class="hidden sm:inline">맨 위로</span></button></nav></div><div id=toc-overlay class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-all duration-300" role=dialog aria-modal=true aria-labelledby=toc-title></div><div id=toc-card class="pointer-events-none fixed inset-4 z-50 flex w-auto scale-95 items-center justify-center opacity-0 transition-all duration-300 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:block sm:w-full sm:max-w-md sm:-translate-x-1/2 sm:-translate-y-1/2" role=dialog aria-modal=true aria-labelledby=toc-title><div class="bg-card border-border w-full max-w-sm overflow-hidden rounded-xl border shadow-xl sm:max-w-md"><div class="border-border bg-muted/30 flex items-center justify-between border-b p-4"><div class="flex items-center gap-3"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg><h2 id=toc-title class="text-foreground text-lg font-semibold">목차</h2></div><button id=toc-close class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 rounded-lg p-2 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none" title=닫기 aria-label=닫기>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="max-h-96 overflow-y-auto p-4"><nav id=toc-nav class=toc-scrollbar aria-label="글 목차"><div id=toc-content><nav id=TableOfContents><ul><li><a href=#-결론-요약>📌 결론 요약</a></li><li><a href=#-핵심-기여-및-독창성>🧠 핵심 기여 및 독창성</a></li><li><a href=#-핵심-알고리즘-설명-예시-기반>🔍 핵심 알고리즘 설명 (예시 기반)</a><ul><li><a href=#문제-상황>문제 상황:</a></li><li><a href=#예시-입력>예시 입력:</a></li><li><a href=#comet-처리-흐름>Comet 처리 흐름:</a></li></ul></li><li><a href=#-성능-분석-실험-결과>🧪 성능 분석 (실험 결과)</a></li><li><a href=#-한계점-및-향후-방향>⚠️ 한계점 및 향후 방향</a></li><li><a href=#-요약>💡 요약</a></li></ul><ul><li><a href=#-핵심-알고리즘-구조-요약>🧩 핵심 알고리즘 구조 요약</a></li><li><a href=#-예시-설정>🔎 예시 설정</a><ul><li><a href=#모델-설정>모델 설정</a></li></ul></li><li><a href=#--shared-tensor-기반-dependency-resolving>🧠 ① Shared Tensor 기반 Dependency Resolving</a><ul><li><a href=#-목적>💡 목적</a></li><li><a href=#-moe-layer0의-예>📌 MoE Layer0의 예</a><ul><li><a href=#-step-1-shared-tensor-분해-decompose>✅ Step 1: Shared Tensor 분해 (Decompose)</a></li><li><a href=#-step-2-재스케줄-reschedule>✅ Step 2: 재스케줄 (Reschedule)</a></li></ul></li><li><a href=#-moe-layer1의-예>📌 MoE Layer1의 예</a><ul><li><a href=#-step-1-shared-tensor-분해-decompose-1>✅ Step 1: Shared Tensor 분해 (Decompose)</a></li><li><a href=#-step-2-재스케줄>✅ Step 2: 재스케줄</a></li></ul></li></ul></li><li><a href=#--adaptive-workload-assignment>🧠 ② Adaptive Workload Assignment</a><ul><li><a href=#-목적-1>💡 목적</a></li><li><a href=#예시>예시</a><ul><li><a href=#문제-어떤-비율이-최적일까>문제: 어떤 비율이 최적일까?</a></li><li><a href=#해결>해결:</a></li></ul></li></ul></li><li><a href=#-전체-실행-흐름-요약>🎯 전체 실행 흐름 요약</a></li><li><a href=#-시각화-요약>📌 시각화 요약</a></li><li><a href=#-요약-정리>✅ 요약 정리</a></li></ul><ul><li><a href=#-실험-결과-요약-수치로-보는-comet의-강점>✅ 실험 결과 요약: 수치로 보는 Comet의 강점</a><ul><li><a href=#1--end-to-end-모델-성능-비교>1. 📈 End-to-End 모델 성능 비교</a></li><li><a href=#2--단일-moe-layer-성능>2. 🔍 단일 MoE Layer 성능</a></li><li><a href=#3--통신-overlap-효과>3. 🎯 통신 Overlap 효과</a></li></ul></li><li><a href=#-comet이-특출났던-이유-논문에서-제시한-주장>🔍 Comet이 특출났던 이유 (논문에서 제시한 주장)</a><ul><li><a href=#-1-fine-grained-수준에서의-연산통신-병렬화>🎯 1. Fine-grained 수준에서의 연산/통신 병렬화</a></li><li><a href=#-2-fused-kernel-내-thread-block-specialization>🎯 2. Fused kernel 내 thread block specialization</a></li><li><a href=#-3-adaptive-workload-assignment>🎯 3. Adaptive workload assignment</a></li><li><a href=#-4-host-scheduling-제거>🎯 4. Host scheduling 제거</a></li></ul></li><li><a href=#-내-생각-comet이-왜-차별적인가>🧠 내 생각: Comet이 왜 차별적인가?</a><ul><li><a href=#-핵심-통찰>📌 핵심 통찰:</a></li></ul></li><li><a href=#-향후-확장-가능성>💬 향후 확장 가능성</a></li><li><a href=#-요약-정리-1>✅ 요약 정리</a></li></ul><ul><li><ul><li><a href=#-1-주요-데이터-구조-정의>📦 1. 주요 데이터 구조 정의</a></li><li><a href=#-2-dependency-resolving-shared-tensor-분해--재스케줄>🔄 2. Dependency Resolving: shared tensor 분해 + 재스케줄</a></li><li><a href=#-3-adaptive-thread-block-assignment>⚙️ 3. Adaptive Thread Block Assignment</a></li><li><a href=#-4-fused-kernel-실행-커널-내부-동작-추상화>🚀 4. Fused Kernel 실행 (커널 내부 동작 추상화)</a></li><li><a href=#-전체-실행-흐름-정리>🧠 전체 실행 흐름 정리</a></li></ul></li><li><a href=#-주석-요약-포인트>✅ 주석 요약 포인트</a></li></ul><ul><li><a href=#1--예시-기반-입력-데이터와-추론-과정>1. 📥 예시 기반 입력 데이터와 추론 과정</a><ul><li><a href=#-예시-mixtral-8x7b-모델-기준-논문-실험-대상>📌 예시: Mixtral-8x7B 모델 기준 (논문 실험 대상)</a></li><li><a href=#-추론-전처리-및-라우팅-token-routing>🔁 추론 전처리 및 라우팅 (Token Routing)</a></li><li><a href=#-expert-computation-moe-layer-0>🧠 Expert Computation (MoE Layer 0)</a></li><li><a href=#-결과-병합-moe-layer-1>📤 결과 병합 (MoE Layer 1)</a></li></ul></li><li><a href=#2--모델-아키텍처-구성-comet-관점>2. 🏗️ 모델 아키텍처 구성 (Comet 관점)</a><ul><li><a href=#전체-구조-1-transformer-block-기준>전체 구조 (1 Transformer block 기준)</a></li></ul></li><li><a href=#3--연산량computational-cost-분석>3. 📊 연산량(Computational Cost) 분석</a><ul><li><a href=#-moe-layer-기준-한-expert의-ffn>✅ MoE Layer 기준: 한 expert의 FFN</a></li></ul></li><li><a href=#4--메모리-요구량>4. 🧠 메모리 요구량</a><ul><li><a href=#shared-tensor-크기>Shared Tensor 크기</a></li></ul></li><li><a href=#5--comet에서의-최적화-요소-반영>5. 🧩 Comet에서의 최적화 요소 반영</a></li><li><a href=#-정리-요약>✅ 정리 요약</a></li></ul><ul><li><a href=#-comet의-주요-한계-요약>✅ Comet의 주요 한계 요약</a></li><li><a href=#-한계-극복을-위한-연구-흐름별-정리>🔍 한계 극복을 위한 연구 흐름별 정리</a><ul><li><a href=#-1-컴파일러-기반-자동화-tvm-triton-unity>🧠 [1] 컴파일러 기반 자동화: TVM, Triton, Unity</a></li><li><a href=#-2-네트워크토폴로지-최적화-hierarchical-all-to-all--topology-aware-scheduling>🌐 [2] 네트워크/토폴로지 최적화: Hierarchical All-to-All & Topology-aware Scheduling</a></li><li><a href=#-3-onlineruntime-재구성-dynamic-expert-scheduling--adaptive-routing>🔄 [3] Online/Runtime 재구성: Dynamic Expert Scheduling & Adaptive Routing</a></li><li><a href=#-4-다른-연산자와의-통합-attention-moe-fusion-cross-block-scheduling>🔀 [4] 다른 연산자와의 통합: Attention-MoE Fusion, Cross-block Scheduling</a></li></ul></li><li><a href=#-비교-요약-테이블-연구-흐름별-특징>📌 비교 요약 테이블: 연구 흐름별 특징</a></li><li><a href=#-정리>✅ 정리</a></li></ul><ul><li><a href=#-comet의-granularity-level-최적화>✅ Comet의 granularity-level 최적화</a><ul><li><a href=#1-기존-시스템의-한계-coarse-grained-overlap>1. 기존 시스템의 한계 (Coarse-Grained Overlap)</a></li><li><a href=#2-comet의-fine-grained-overlapping-방식>2. Comet의 fine-grained overlapping 방식</a></li></ul></li><li><a href=#-구조적-trade-off>⚠️ 구조적 trade-off</a><ul><li><a href=#1-커널-복잡도-증가-및-구현-부담>1. 커널 복잡도 증가 및 구현 부담</a></li><li><a href=#2-하드웨어-종속성-증가>2. 하드웨어 종속성 증가</a></li><li><a href=#3-컴파일러-최적화와의-통합-어려움>3. 컴파일러 최적화와의 통합 어려움</a></li></ul></li><li><a href=#-요약-1>🔁 요약</a></li></ul><ul><li><a href=#-1-comet에서-mn-방향-분해-기준>✅ 1. Comet에서 M/N 방향 분해 기준</a><ul><li><a href=#shared-tensor의-역할>Shared Tensor의 역할</a></li><li><a href=#moe-layer-0-all-to-all--gemm>MoE Layer 0 (All-to-All → GEMM)</a></li><li><a href=#moe-layer-1-gemm2--combine>MoE Layer 1 (GEMM2 → Combine)</a></li></ul></li><li><a href=#-2-일반화-시-기준>✅ 2. 일반화 시 기준</a></li><li><a href=#-3-연산자별-적용-가능성과-제약>✅ 3. 연산자별 적용 가능성과 제약</a><ul><li><a href=#-self-attention-qkt-softmax-v-곱>🧠 Self-Attention (QK^T, softmax, V 곱)</a></li><li><a href=#-layernorm>🧪 LayerNorm</a></li></ul></li><li><a href=#-요약-정리-2>✅ 요약 정리</a></li><li><a href=#-결론>📌 결론</a></li></ul><ul><li><a href=#-문제-요약-왜-문제가-되는가>✅ 문제 요약: 왜 문제가 되는가?</a></li><li><a href=#-해결-방향-online-scheduling-기법-적용>✅ 해결 방향: Online Scheduling 기법 적용</a><ul><li><a href=#1--reinforcement-learning-기반-thread-block-튜너-runtime-auto-tuner>1. 🔁 Reinforcement Learning 기반 Thread Block 튜너 (Runtime Auto-Tuner)</a></li><li><a href=#2--lightweight-heuristic-rule--피드백-보정-latency-ratio-tuning>2. 📊 Lightweight Heuristic Rule + 피드백 보정 (Latency Ratio Tuning)</a></li><li><a href=#3--predictive-performance-modeling-dynamic-cost-model>3. 📈 Predictive Performance Modeling (Dynamic Cost Model)</a></li></ul></li><li><a href=#-요약-비교표>📌 요약 비교표</a></li><li><a href=#-추천-hybrid-방식>✅ 추천: Hybrid 방식</a></li><li><a href=#-결론-1>✅ 결론</a></li></ul></nav></div></nav></div><div class="border-border bg-muted/20 border-t px-4 py-3"><div class="text-muted-foreground text-center text-xs"><span>제목을 클릭하면 해당 위치로 이동합니다</span></div></div></div></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>function initKaTeX(){if(typeof renderMathInElement=="undefined"){setTimeout(initKaTeX,100);return}var e=[{display:!0,left:"$$",right:"$$"},{display:!1,left:"$",right:"$"}];renderMathInElement(document.body,{delimiters:e,throwOnError:!1,errorColor:"#cc0000",fleqn:!1,leqno:!1,trust:!1})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initKaTeX):initKaTeX()</script><div id=search-overlay class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 transition-opacity duration-300"></div><div id=search-modal class="bg-card border-border pointer-events-none fixed top-1/2 left-1/2 z-50 max-h-[80vh] w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 scale-95 transform overflow-hidden rounded-xl border opacity-0 shadow-xl transition-all duration-300"><div class="border-border flex items-center gap-3 border-b p-4"><div class="text-muted-foreground h-5 w-5 flex-shrink-0"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg></div><div class="relative flex-1"><button id=search-clear class="text-muted-foreground hover:text-foreground hover:bg-muted/50 pointer-events-none absolute top-1/2 left-0 z-10 h-5 w-5 -translate-y-1/2 rounded opacity-0 transition-all duration-200" title=지우기 aria-label=지우기>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg>
</button>
<input id=search-input type=text placeholder="게시글 검색..." class="text-foreground placeholder:text-muted-foreground w-full border-none bg-transparent pl-8 text-lg outline-none" autocomplete=off spellcheck=false></div><button id=search-close class="text-muted-foreground hover:text-foreground hover:bg-muted/50 flex h-6 w-6 items-center justify-center rounded-md p-0.5 transition-all duration-200" title=닫기 aria-label=닫기>
<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div id=search-results class="max-h-96 overflow-y-auto"><div id=search-empty class="flex flex-col items-center justify-center py-12 text-center"><div class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg></div><h3 class="text-foreground mb-2 text-lg font-semibold">검색 시작</h3><p class="text-muted-foreground text-sm">검색어를 입력하세요</p></div><div id=search-loading class="flex hidden items-center justify-center py-8"><div class="mr-3 h-6 w-6 animate-spin rounded-full border-2 border-current border-t-transparent"></div><span class=text-muted-foreground>검색 중...</span></div><div id=search-no-results class="flex hidden flex-col items-center justify-center py-12 text-center"><div class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/></svg></div><h3 class="text-foreground mb-2 text-lg font-semibold">검색 결과 없음</h3><p class="text-muted-foreground text-sm">다른 검색어로 시도해보세요</p></div><div id=search-results-list class=hidden><div id=search-stats class="text-muted-foreground border-border border-b px-4 py-3 text-sm" data-template="%d개의 결과 찾음"></div><div id=search-items class="divide-border divide-y"></div></div></div><div class="border-border bg-muted/20 border-t px-4 py-3"><div class="text-muted-foreground flex items-center justify-between text-xs"><div class="flex items-center gap-2 md:gap-4"><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">↑↓</kbd>
<span class="hidden sm:inline">이동</span></div><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">↵</kbd>
<span class="hidden sm:inline">선택</span></div><div class="flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">ESC</kbd>
<span class="hidden sm:inline">닫기</span></div></div><div class="search-hint-desktop flex items-center gap-1"><kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs">⌘K</kbd>
<span>단축키</span></div></div></div></div></body></html>