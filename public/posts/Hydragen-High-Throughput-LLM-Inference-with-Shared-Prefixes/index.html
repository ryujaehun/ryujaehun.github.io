<!doctype html>
<html
  lang="ko-kr"
  data-theme="claude">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>Hydragen: High-Throughput LLM Inference with Shared Prefixes | Jaehun&#39;s Blog</title>

<meta name="description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문의 핵심 요약 이 논문은 Hydragen이라는 새로운 방법을 소개하여, ..." />
<meta name="keywords" content="개발, 컴파일러, 프로그래밍, 에세이" />
<meta name="author" content="" />
<meta name="language" content="ko-kr" />

<meta name="robots" content="index, follow" />
<link rel="canonical" href="http://192.168.1.11:1314/posts/Hydragen-High-Throughput-LLM-Inference-with-Shared-Prefixes/" />



  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />



<link rel="manifest" href="/site.webmanifest" />
<meta property="og:url" content="http://192.168.1.11:1314/posts/Hydragen-High-Throughput-LLM-Inference-with-Shared-Prefixes/">
  <meta property="og:site_name" content="Jaehun&#39;s Blog">
  <meta property="og:title" content="Hydragen: High-Throughput LLM Inference with Shared Prefixes">
  <meta property="og:description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문의 핵심 요약 이 논문은 Hydragen이라는 새로운 방법을 소개하여, 공통 프리픽스를 공유하는 텍스트 배치에 대한 대규모 언어 모델(LLM) 추론을 최적화합니다. 이 방법은 특히 프리픽스와 서픽스에 대한 어텐션 계산을 분리하고, 인터-시퀀스 배칭을 통해 하드웨어 효율성을 극대화하여 GPU 메모리 대역폭 병목현상을 줄입니다.">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-14T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-14T00:00:00+00:00">
    <meta property="og:image" content="http://192.168.1.11:1314/images/og-default.avif">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://192.168.1.11:1314/images/og-default.avif">
  <meta name="twitter:title" content="Hydragen: High-Throughput LLM Inference with Shared Prefixes">
  <meta name="twitter:description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문의 핵심 요약 이 논문은 Hydragen이라는 새로운 방법을 소개하여, 공통 프리픽스를 공유하는 텍스트 배치에 대한 대규모 언어 모델(LLM) 추론을 최적화합니다. 이 방법은 특히 프리픽스와 서픽스에 대한 어텐션 계산을 분리하고, 인터-시퀀스 배칭을 통해 하드웨어 효율성을 극대화하여 GPU 메모리 대역폭 병목현상을 줄입니다.">


  <meta itemprop="name" content="Hydragen: High-Throughput LLM Inference with Shared Prefixes">
  <meta itemprop="description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 논문의 핵심 요약 이 논문은 Hydragen이라는 새로운 방법을 소개하여, 공통 프리픽스를 공유하는 텍스트 배치에 대한 대규모 언어 모델(LLM) 추론을 최적화합니다. 이 방법은 특히 프리픽스와 서픽스에 대한 어텐션 계산을 분리하고, 인터-시퀀스 배칭을 통해 하드웨어 효율성을 극대화하여 GPU 메모리 대역폭 병목현상을 줄입니다.">
  <meta itemprop="datePublished" content="2024-12-14T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-12-14T00:00:00+00:00">
  <meta itemprop="wordCount" content="13001">
  <meta itemprop="image" content="http://192.168.1.11:1314/images/og-default.avif">
  <meta itemprop="keywords" content="Paper-Review,With-Gpt">







<script>
  window.HUGO_SEARCH_CONFIG = {
    searchIndexURL: "\"/index.json\""
  };
</script>


































<script>

  window.HUGO_GALLERY_CONFIG = {
    justified_gallery:  false ,
    lightbox:  false ,
    justified: "{}",
    lightbox_options: "{}"
  };
</script>




  
    <link rel="stylesheet" href="/css/compiled.css" />
  





  
    <link rel="stylesheet" href="/css/chroma.css" />
  












      <script src="/js/main.js"></script>



  <script src="/js/gumshoe.polyfills.min.js"></script>



        <script src="/js/toc.js" defer></script>



      <script src="/js/search.js" defer></script>



      <script src="/js/dock.js" defer></script>











  











    <script>
      
      (function() {
        const theme = localStorage.getItem('theme') || 'system';
        const colorScheme = localStorage.getItem('colorScheme') || 'claude';

        
        document.documentElement.setAttribute('data-theme', colorScheme);

        
        function applyTheme() {
          if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }

        applyTheme();

        
        if (theme === 'system') {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground min-h-screen antialiased">
    
    
  <div
    id="reading-progress-container"
    class="reading-progress-container pointer-events-none fixed top-0 right-0 left-0 z-50 transition-opacity duration-300 ease-out"
    data-height="3"
    data-smooth-scroll="true"
    data-hide-on-complete="false">
    
    <div class="reading-progress-bg w-full"></div>

    
    <div
      id="reading-progress-bar"
      class="from-primary to-primary/80 reading-progress-bar 
        transition-all duration-150 ease-out
       absolute top-0 left-0 w-0 bg-gradient-to-r"></div>
  </div>

  <script>
    (function () {
      "use strict";

      const progressContainer = document.getElementById(
        "reading-progress-container",
      );
      const progressBar = document.getElementById("reading-progress-bar");

      if (!progressContainer || !progressBar) return;

      
      const config = {
        smoothScroll: progressContainer.dataset.smoothScroll === "true",
        hideOnComplete: progressContainer.dataset.hideOnComplete === "true",
      };

      let isVisible = true;
      let gumshoeInstance = null;

      
      function calculateProgress() {
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;
        const documentHeight = document.documentElement.scrollHeight;
        const windowHeight = window.innerHeight;
        const scrollableHeight = documentHeight - windowHeight;

        if (scrollableHeight <= 0) return 0;

        return Math.min(Math.max((scrollTop / scrollableHeight) * 100, 0), 100);
      }

      
      function updateProgress() {
        const progress = calculateProgress();
        progressBar.style.width = progress + "%";

        
        if (config.hideOnComplete && progress >= 99.5) {
          if (isVisible) {
            progressContainer.style.opacity = "0";
            isVisible = false;
          }
        } else if (!isVisible) {
          progressContainer.style.opacity = "1";
          isVisible = true;
        }
      }

      
      let ticking = false;
      function requestTick() {
        if (!ticking) {
          requestAnimationFrame(() => {
            updateProgress();
            ticking = false;
          });
          ticking = true;
        }
      }

      
      function init() {
        
        window.addEventListener("scroll", requestTick, { passive: true });
        window.addEventListener("resize", requestTick, { passive: true });
        document.addEventListener("visibilitychange", () => {
          if (!document.hidden) requestTick();
        });

        
        requestTick();

        
        window.addEventListener("beforeunload", () => {
          window.removeEventListener("scroll", requestTick);
          window.removeEventListener("resize", requestTick);
        });
      }

      
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    })();
  </script>

    <header class="sticky top-0 z-50 mx-auto max-w-4xl px-4 py-6">
  <div
    class="border-border bg-card/80 flex items-center rounded-xl border px-6 py-4 shadow-sm backdrop-blur-sm">
    
    <div class="hidden w-full items-center md:flex">
      
      <div class="flex items-center">
        
          
          <a
            href="/"
            class="bg-primary text-primary-foreground hover:bg-primary/90 flex h-10 w-10 items-center justify-center rounded-full text-lg font-bold transition-transform duration-200 hover:scale-105"
            aria-label="Jaehun&#39;s Blog">
            J
          </a>
        
      </div>

      
      <nav class="mx-8 flex flex-1 items-center justify-center">
        <div class="flex items-center space-x-1">
          
          
            
            
            
              
                
              
            
            
            <a
              href="/posts/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.posts">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
              
              <span
                >
                  게시글
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/categories/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.categories">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />

</svg>
              
              <span
                >
                  카테고리
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/tags/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.tags">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />

</svg>
              
              <span
                >
                  태그
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/archives/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.archives">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />

</svg>
              
              <span
                >
                  아카이브
                </span
              >
            </a>
          
        </div>
      </nav>

      
      <div class="flex items-center space-x-2">
        
        
<div class="relative">
  <button id="language-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="language"
    aria-label="언어 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="언어 변경">
	<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8l6 6m-7 0l6-6l2-3M2 5h12M7 2h1m14 20l-5-10l-5 10m2-4h6" />
</svg></button>

  
  <div id="language-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="language"
    role="menu"
    aria-labelledby="language-toggle"><a href="/ko/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem" aria-current="true"><span class="font-medium">한국어</span></a><a href="/en/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem"><span class="font-medium">English</span></a></div>
</div>

        
        
<div class="relative">
  <button id="color-scheme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="color-scheme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="테마 변경">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z" />

</svg></button>

  
  <div id="color-scheme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="color-scheme"><button data-color-scheme="claude" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme="default" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme="bumblebee" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme="emerald" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme="nord" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme="sunset" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme="abyss" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme="dracula" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme="amethyst" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme="slate" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme="twitter" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div>
</div>

        
        
<div class="relative">
  <button id="theme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="theme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
      
  <svg class="h-5 w-5 sun-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg>
      
      
  <svg class="h-5 w-5 moon-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg>
      
      
  <svg class="h-5 w-5 system-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg></button>

  
  <div id="theme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="theme"><button data-theme="light" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg><span>라이트</span></button><button data-theme="dark" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg><span>다크</span></button><button data-theme="system" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg><span>시스템</span></button></div>
</div>
      </div>
    </div>

    
    <div class="flex w-full items-center justify-between md:hidden">
      
      
<div class="relative">
  <button
    id="mobile-menu-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:bg-accent hover:text-foreground flex h-10 w-10 items-center justify-center rounded-lg border transition-colors duration-200"
    data-dropdown-type="mobile-menu"
    aria-label="메뉴"
    aria-expanded="false"
    aria-haspopup="true">
    
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="메뉴">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />

</svg>
  </button>

  
  <div
    id="mobile-menu"
    class="mobile-menu dropdown-menu border-border bg-popover/95 absolute top-12 left-0 z-[60] hidden w-80 max-w-[calc(100vw-2rem)] rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out md:hidden"
    data-dropdown-type="mobile-menu"
    role="menu"
    aria-labelledby="mobile-menu-toggle">
    <nav class="flex flex-col">
      
      
        
        
        
          
            
          
        
        
        <a
          href="/posts/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.posts">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
          
          <span
            >
              게시글
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/categories/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.categories">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />

</svg>
          
          <span
            >
              카테고리
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/tags/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.tags">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />

</svg>
          
          <span
            >
              태그
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/archives/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.archives">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />

</svg>
          
          <span
            >
              아카이브
            </span
          >
        </a>
      
    </nav>
  </div>
</div>


      
      <div class="flex items-center space-x-2">
        
        
<div class="relative">
  <button id="language-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="language"
    aria-label="언어 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="언어 변경">
	<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8l6 6m-7 0l6-6l2-3M2 5h12M7 2h1m14 20l-5-10l-5 10m2-4h6" />
</svg></button>

  
  <div id="language-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="language"
    role="menu"
    aria-labelledby="language-toggle"><a href="/ko/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem" aria-current="true"><span class="font-medium">한국어</span></a><a href="/en/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem"><span class="font-medium">English</span></a></div>
</div>

        
        
<div class="relative">
  <button id="color-scheme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="color-scheme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="테마 변경">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z" />

</svg></button>

  
  <div id="color-scheme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="color-scheme"><button data-color-scheme="claude" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme="default" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme="bumblebee" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme="emerald" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme="nord" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme="sunset" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme="abyss" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme="dracula" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme="amethyst" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme="slate" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme="twitter" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div>
</div>

        
        
<div class="relative">
  <button id="theme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="theme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
      
  <svg class="h-5 w-5 sun-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg>
      
      
  <svg class="h-5 w-5 moon-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg>
      
      
  <svg class="h-5 w-5 system-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg></button>

  
  <div id="theme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="theme"><button data-theme="light" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg><span>라이트</span></button><button data-theme="dark" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg><span>다크</span></button><button data-theme="system" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg><span>시스템</span></button></div>
</div>
      </div>
    </div>
  </div>
</header>


    <main class="mx-auto max-w-4xl px-4 py-6">
      
  
  <nav
  class="breadcrumb mb-4 md:mb-6 py-1"
  aria-label="경로">
  <ol class="text-muted-foreground flex items-center space-x-1 md:space-x-2 text-sm overflow-x-auto whitespace-nowrap scrollbar-hide py-1">
    
    <li class="flex-shrink-0">
      <a
        href="/"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02]">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="홈">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />

</svg>
        <span class="max-w-[4rem] md:max-w-none truncate">홈</span>
      </a>
    </li>

    
    
      <li class="flex items-center gap-1 md:gap-2 min-w-0">
        <span class="text-muted-foreground/50 flex-shrink-0"
          >
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg>
        </span>

        
          
          <div class="flex items-center gap-1 md:gap-2 min-w-0">
            
              
              <a
                href="/posts"
                class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02] flex-shrink-0">
                
                  
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
                  <span class="max-w-[3rem] md:max-w-none truncate">게시글</span>
                
              </a>
              <span class="text-muted-foreground/50 flex-shrink-0"
                >
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg></span
              >
            
            
            <span class="text-foreground flex items-center gap-0.5 md:gap-1 font-medium min-w-0">
              
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
</svg>
              <span class="max-w-[8rem] md:max-w-[16rem] lg:max-w-none truncate">Hydragen: High-Throughput LLM Inference with Shared Prefixes</span>
            </span>
          </div>
        
      </li>
    

  </ol>
</nav>



  


  
  <header class="mb-8">
    


<div class="post-meta">
  
  <h1 class="text-foreground mb-6 text-3xl leading-tight font-bold md:text-4xl">
    Hydragen: High-Throughput LLM Inference with Shared Prefixes
  </h1>

  
  


  
  <div class="bg-card border-border flex flex-col gap-4 rounded-xl border p-6">
    
    <div
      class="text-muted-foreground flex flex-wrap items-center gap-4 text-sm">
      
      <div class="flex items-center gap-2">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="작성일"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
        <time datetime="2024-12-14">
          2024년 12월 14일
        </time>
      </div>

      
      


      
      
        <div class="flex items-center gap-2">
          
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="읽는 시간"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
          <span
            >26 분</span
          >
        </div>
      


      
      
        <div class="flex items-center gap-2">
          
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="단어 수"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
</svg>
          <span>13001 단어</span>
        </div>
      

    </div>

    
    
      <div class="flex flex-wrap items-center gap-4">
        
        
          <div class="flex items-center gap-2">
            
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="카테고리"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
</svg>
            <span class="text-muted-foreground mr-2 text-sm"
              >카테고리:</span
            >
            <div class="flex flex-wrap gap-2">
              
                <a
                  href="/categories/paper-review/"
                  class="bg-primary/10 text-primary hover:bg-primary/20 focus:ring-primary/20 inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 hover:shadow-md focus:ring-2 focus:outline-none">
                  paper-review
                </a>
              
                <a
                  href="/categories/with-gpt/"
                  class="bg-primary/10 text-primary hover:bg-primary/20 focus:ring-primary/20 inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 hover:shadow-md focus:ring-2 focus:outline-none">
                  with-gpt
                </a>
              
            </div>
          </div>
        


        
        

      </div>
    


    
    

  </div>
</div>

  </header>

  
  <article class="prose prose-neutral dark:prose-invert mb-12 max-w-none">
    <p><a href="https://arxiv.org/abs/2402.05099">논문 링크</a></p>
<h1 id="q--이-논문을-아주-자세하게-읽고-논문의-강점과-독창적인-지점을-설명해주고-핵심-알고리즘을-예시-입력을-들어서-전체적인-과정을-설명해줘-추가적으로-논문의-한계점에-대해서도-알려줘">Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘</h1>
<h3 id="논문의-핵심-요약"><strong>논문의 핵심 요약</strong></h3>
<p>이 논문은 <strong>Hydragen</strong>이라는 새로운 방법을 소개하여, 공통 프리픽스를 공유하는 텍스트 배치에 대한 대규모 언어 모델(LLM) 추론을 최적화합니다. 이 방법은 특히 <strong>프리픽스와 서픽스에 대한 어텐션 계산을 분리</strong>하고, <strong>인터-시퀀스 배칭</strong>을 통해 하드웨어 효율성을 극대화하여 GPU 메모리 대역폭 병목현상을 줄입니다.</p>
<ul>
<li><strong>핵심 성능 결과</strong>:
<ul>
<li>CodeLlama-13b에서 <strong>최대 32배의 추론 속도 증가</strong>를 달성.</li>
<li>프리픽스 길이가 16K 토큰으로 증가하더라도 처리 속도 감소가 <strong>15% 미만</strong>에 그침.</li>
<li>기존 방법(vLLM) 대비 긴 컨텍스트 처리에서 최대 <strong>90% 이상의 처리 효율 향상</strong>.</li>
<li>경쟁적 프로그래밍 문제(APPS)에서 평가 시간 <strong>55% 감소</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="강점"><strong>강점</strong></h3>
<ol>
<li>
<p><strong>하드웨어 친화적 접근</strong>:</p>
<ul>
<li>Hydragen은 현대 GPU의 텐서 코어를 활용하여 매트릭스-매트릭스 곱셈을 대체해 기존의 매트릭스-벡터 곱셈보다 훨씬 더 높은 연산 효율성을 제공합니다.</li>
<li><strong>배칭 최적화</strong>를 통해 메모리 읽기 횟수를 대폭 줄이고, GPU 메모리 대역폭 병목을 완화했습니다.</li>
</ul>
</li>
<li>
<p><strong>공통 프리픽스 구조에 대한 최적화</strong>:</p>
<ul>
<li>다수의 문장이 공통 프리픽스를 공유하는 실질적인 LLM 사용 사례(챗봇, 경쟁적 프로그래밍 등)에 특화된 설계.</li>
<li>긴 프리픽스에서 기존의 PagedAttention 대비 압도적인 성능 향상.</li>
</ul>
</li>
<li>
<p><strong>일반화 가능성</strong>:</p>
<ul>
<li>간단한 프리픽스-서픽스 분할뿐만 아니라 <strong>트리 기반 프롬프트 공유 패턴</strong>까지 지원, 다양한 LLM 응용 사례에 적합.</li>
</ul>
</li>
<li>
<p><strong>효율적인 구현</strong>:</p>
<ul>
<li>PyTorch를 기반으로 구현되어 별도의 복잡한 CUDA 커널 없이도 손쉽게 적용 가능.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="독창성"><strong>독창성</strong></h3>
<p>Hydragen은 다음 두 가지 주요 아이디어로 기존 방법론과 차별화됩니다:</p>
<ol>
<li>
<p><strong>Attention Decomposition</strong>:</p>
<ul>
<li>어텐션 계산을 프리픽스와 서픽스로 나눠 각각 독립적으로 처리 후 결합. 이를 통해 프리픽스 키/값 중복 읽기를 방지하고 계산 효율성을 극대화.</li>
<li>이를 위해 소프트맥스의 지수 합 로그(log-sum-exp)를 이용해 프리픽스와 서픽스 어텐션을 정확히 재구성.</li>
</ul>
</li>
<li>
<p><strong>Inter-Sequence Batching</strong>:</p>
<ul>
<li>공통 프리픽스에 대해 시퀀스 간 쿼리를 배칭해 하나의 대규모 매트릭스-매트릭스 연산으로 통합, 연산 밀도를 높이고 텐서 코어 활용.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="핵심-알고리즘-예시"><strong>핵심 알고리즘 예시</strong></h3>
<h4 id="1-문제-정의"><strong>1. 문제 정의</strong></h4>
<p>주어진 입력:</p>
<ul>
<li>프리픽스 키(<code>K1</code>), 값(<code>V1</code>)과 각 시퀀스별 서픽스 키(<code>K2</code>), 값(<code>V2</code>).</li>
<li>쿼리(<code>Q</code>).</li>
</ul>
<p>목표:
전체 어텐션 결과 ( O = \text{SDP}(Q, K, V) )를 정확히 계산.</p>
<h4 id="2-단계별-과정"><strong>2. 단계별 과정</strong></h4>
<ol>
<li>
<p><strong>프리픽스와 서픽스 분리 계산</strong>:</p>
<ul>
<li>프리픽스: ( O_{\text{prefix}} = \text{SDP}(Q, K1, V1) ).</li>
<li>서픽스: ( O_{\text{suffix}} = \text{SDP}(Q, K2, V2) ).</li>
</ul>
</li>
<li>
<p><strong>소프트맥스 재조합</strong>:
프리픽스와 서픽스의 지수 합 로그(LSE)를 사용해 결과를 결합:
[
O = \frac{O_{\text{prefix}} e^{\text{LSE}(Q, K1)} + O_{\text{suffix}} e^{\text{LSE}(Q, K2)}}{e^{\text{LSE}(Q, K1)} + e^{\text{LSE}(Q, K2)}}
]</p>
</li>
<li>
<p><strong>인터-시퀀스 배칭</strong>:</p>
<ul>
<li>프리픽스에 대해 배칭된 쿼리로 단일 매트릭스-매트릭스 곱셈 수행.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="한계점"><strong>한계점</strong></h3>
<ol>
<li>
<p><strong>서픽스 최적화 부재</strong>:</p>
<ul>
<li>서픽스에 대한 어텐션은 기존 FlashAttention 방식을 따르며 최적화되지 않음.</li>
<li>긴 서픽스의 경우 성능 저하 가능.</li>
</ul>
</li>
<li>
<p><strong>제약된 사용 사례</strong>:</p>
<ul>
<li>공통 프리픽스를 공유하지 않는 일반적인 배치에는 효과 제한.</li>
</ul>
</li>
<li>
<p><strong>초기 사용자 지정 요구</strong>:</p>
<ul>
<li>입력 데이터에서 공유 패턴을 명시적으로 정의해야 하며, 자동화된 프리픽스 공유 탐지 기능 부재.</li>
</ul>
</li>
<li>
<p><strong>하드웨어 의존성</strong>:</p>
<ul>
<li>텐서 코어 활용에 의존하므로 GPU 외의 하드웨어에서는 이점 감소 가능.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론"><strong>결론</strong></h3>
<p>Hydragen은 긴 프리픽스와 대규모 배치 환경에서 대규모 언어 모델 추론 성능을 획기적으로 개선합니다. <strong>현대 GPU 하드웨어에 최적화</strong>된 설계로 주목받을 만하며, 특히 긴 문맥 처리와 경쟁적 프로그래밍 문제 해결에 탁월한 성능을 발휘합니다. 하지만 서픽스 최적화 부재와 초기 설정 요구 사항은 추가 연구가 필요한 부분으로 보입니다.</p>
<h1 id="q--논문의-핵심알고리즘을-예시를-들어-아주-자세하게-설명해주고-정리해-줘">Q : 논문의 핵심알고리즘을 예시를 들어 아주 자세하게 설명해주고 정리해 줘</h1>
<p>논문에서 제안한 <strong>Hydragen 알고리즘</strong>은 공통 프리픽스를 갖는 배치에서 어텐션 계산을 최적화하기 위해 고안되었습니다. 아래에서는 알고리즘을 구체적인 예시와 함께 자세히 설명하고 핵심 내용을 정리합니다.</p>
<hr>
<h3 id="hydragen-알고리즘의-핵심"><strong>Hydragen 알고리즘의 핵심</strong></h3>
<ol>
<li>
<p><strong>Attention Decomposition</strong>:</p>
<ul>
<li>어텐션 계산을 **공통 프리픽스(prefix)**와 **고유 서픽스(suffix)**로 나눠 처리합니다.</li>
<li>공통 프리픽스는 여러 시퀀스에서 동일하므로 이를 합산 처리(Inter-Sequence Batching)하여 GPU 메모리 읽기를 줄이고 연산 효율을 높입니다.</li>
</ul>
</li>
<li>
<p><strong>Inter-Sequence Batching</strong>:</p>
<ul>
<li>프리픽스에 대해 여러 시퀀스의 쿼리 벡터를 하나로 묶어 <strong>매트릭스-매트릭스 곱셈</strong>을 수행.</li>
<li>서픽스는 독립적으로 처리되며 <strong>매트릭스-벡터 곱셈</strong> 방식으로 계산됩니다.</li>
</ul>
</li>
<li>
<p><strong>Softmax 재조합</strong>:</p>
<ul>
<li>프리픽스와 서픽스 어텐션 결과를 소프트맥스의 재조합 규칙(log-sum-exp)을 통해 결합하여 전체 어텐션 결과를 복원합니다.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="예시를-통한-설명"><strong>예시를 통한 설명</strong></h3>
<h4 id="1-문제-설정"><strong>1. 문제 설정</strong></h4>
<ul>
<li>
<p>배치(batch)에는 3개의 문장이 포함되어 있습니다:</p>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-0"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-0"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-0">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">문장1: &#34;The quick brown fox [runs fast].&#34;
</span></span><span class="line"><span class="ln">2</span><span class="cl">문장2: &#34;The quick brown fox [jumps high].&#34;
</span></span><span class="line"><span class="ln">3</span><span class="cl">문장3: &#34;The quick brown fox [eats food].&#34;</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-0';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<p>여기서 <code>[runs fast]</code>, <code>[jumps high]</code>, <code>[eats food]</code>는 각 문장의 **고유 서픽스(suffix)**이며, &ldquo;The quick brown fox&quot;는 모든 문장에서 공유하는 **공통 프리픽스(prefix)**입니다.</p>
</li>
<li>
<p>입력 행렬 정의:</p>
<ul>
<li><strong>쿼리 행렬 ( Q )</strong>: 각 시퀀스의 토큰 쿼리 행렬.</li>
<li><strong>키 행렬 ( K )</strong>:
<ul>
<li>프리픽스 키: ( K_{\text{prefix}} ).</li>
<li>서픽스 키: ( K_{\text{suffix}} ).</li>
</ul>
</li>
<li><strong>값 행렬 ( V )</strong>:
<ul>
<li>프리픽스 값: ( V_{\text{prefix}} ).</li>
<li>서픽스 값: ( V_{\text{suffix}} ).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-단계별-계산"><strong>2. 단계별 계산</strong></h4>
<h5 id="1-프리픽스-어텐션-계산"><strong>(1) 프리픽스 어텐션 계산</strong></h5>
<ul>
<li>( Q_{\text{prefix}} )는 3개의 문장의 프리픽스에 해당하는 쿼리입니다.</li>
<li>프리픽스에 대한 어텐션은 모든 문장에서 동일한 ( K_{\text{prefix}} )와 ( V_{\text{prefix}} )를 사용하여 계산됩니다.</li>
<li>계산 방식:
[
O_{\text{prefix}} = \text{SDP}(Q_{\text{prefix}}, K_{\text{prefix}}, V_{\text{prefix}})
]</li>
<li>여기서 SDP는 Scaled Dot-Product Attention:
[
\text{SDP}(Q, K, V) = \text{softmax} \left( \frac{Q K^T}{\sqrt{d}} \right) V
]</li>
</ul>
<h5 id="2-인터-시퀀스-배칭"><strong>(2) 인터-시퀀스 배칭</strong></h5>
<ul>
<li>3개의 문장에 대해 동일한 ( K_{\text{prefix}} )와 ( V_{\text{prefix}} )가 사용되므로, ( Q_{\text{prefix}} )를 <strong>합산 배칭</strong>하여 하나의 큰 매트릭스로 처리:
[
Q_{\text{batched}} = [Q_{\text{prefix,1}}, Q_{\text{prefix,2}}, Q_{\text{prefix,3}}]^T
]</li>
<li>이를 통해 독립적인 3개의 매트릭스-벡터 곱셈 대신 단일 매트릭스-매트릭스 곱셈으로 효율성을 높임:
[
O_{\text{prefix}} = \text{SDP}(Q_{\text{batched}}, K_{\text{prefix}}, V_{\text{prefix}})
]</li>
</ul>
<h5 id="3-서픽스-어텐션-계산"><strong>(3) 서픽스 어텐션 계산</strong></h5>
<ul>
<li>각 문장의 서픽스는 서로 다르므로 독립적으로 계산:
[
O_{\text{suffix,1}} = \text{SDP}(Q_{\text{suffix,1}}, K_{\text{suffix,1}}, V_{\text{suffix,1}})
]
[
O_{\text{suffix,2}} = \text{SDP}(Q_{\text{suffix,2}}, K_{\text{suffix,2}}, V_{\text{suffix,2}})
]
[
O_{\text{suffix,3}} = \text{SDP}(Q_{\text{suffix,3}}, K_{\text{suffix,3}}, V_{\text{suffix,3}})
]</li>
</ul>
<h5 id="4-소프트맥스-결과-재조합"><strong>(4) 소프트맥스 결과 재조합</strong></h5>
<ul>
<li>프리픽스와 서픽스 결과를 소프트맥스 재조합(log-sum-exp) 방식으로 합산:
[
O = \frac{
O_{\text{prefix}} \cdot e^{\text{LSE}(Q_{\text{prefix}}, K_{\text{prefix}})} +
O_{\text{suffix}} \cdot e^{\text{LSE}(Q_{\text{suffix}}, K_{\text{suffix}})}
}{
e^{\text{LSE}(Q_{\text{prefix}}, K_{\text{prefix}})} +
e^{\text{LSE}(Q_{\text{suffix}}, K_{\text{suffix}})}
}
]</li>
<li>여기서 (\text{LSE})는 Log-Sum-Exp로 소프트맥스의 분모를 계산하는 데 사용.</li>
</ul>
<hr>
<h3 id="정리"><strong>정리</strong></h3>
<table>
  <thead>
      <tr>
          <th>단계</th>
          <th>설명</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>프리픽스 계산</strong></td>
          <td>공통 프리픽스에 대해 단일 배칭 계산으로 효율화.</td>
      </tr>
      <tr>
          <td><strong>서픽스 계산</strong></td>
          <td>독립적으로 처리. 프리픽스 최적화만큼 효율적이지는 않음.</td>
      </tr>
      <tr>
          <td><strong>결과 결합</strong></td>
          <td>프리픽스와 서픽스의 결과를 log-sum-exp 기반으로 결합하여 전체 어텐션 결과를 복원.</td>
      </tr>
      <tr>
          <td><strong>효율성 요약</strong></td>
          <td>매트릭스-매트릭스 곱셈(프리픽스)과 매트릭스-벡터 곱셈(서픽스)을 혼합, GPU 하드웨어 성능 극대화.</td>
      </tr>
  </tbody>
</table>
<p>Hydragen은 공통된 프리픽스를 최적화하여 <strong>GPU 메모리 대역폭 병목을 완화</strong>하고, 긴 프리픽스를 처리할 때도 성능 저하를 최소화합니다. 그러나 서픽스 최적화가 제한적이므로 긴 서픽스를 포함한 시나리오에서는 추가적인 개선 여지가 있습니다.</p>
<h1 id="q--이-논문에서-제시한-결과를-자세하게-보고-다른-방법론에-비하여-특출난-점과-논문에서-제기하는-어떠한-방법이-이러한-결과를-도출하게-되었는지-논문에서-제시하는-이유와-너의-생각을-알려줘">Q : 이 논문에서 제시한 결과를 자세하게 보고 다른 방법론에 비하여 특출난 점과 논문에서 제기하는 어떠한 방법이 이러한 결과를 도출하게 되었는지 논문에서 제시하는 이유와 너의 생각을 알려줘</h1>
<h3 id="논문에서-제시한-결과와-다른-방법론과의-비교"><strong>논문에서 제시한 결과와 다른 방법론과의 비교</strong></h3>
<h4 id="핵심-성능-결과"><strong>핵심 성능 결과</strong></h4>
<ol>
<li>
<p><strong>Hydragen의 주요 결과</strong>:</p>
<ul>
<li><strong>CodeLlama-13b</strong> 모델 기준:
<ul>
<li>기존 방법(vLLM) 대비 최대 <strong>32배 속도 향상</strong>.</li>
<li>프리픽스 길이가 16K 토큰으로 증가해도 처리 속도 감소가 <strong>15% 미만</strong>에 그침(vLLM은 90% 이상 감소).</li>
</ul>
</li>
<li>경쟁적 프로그래밍 문제(APPS)에서 평가 시간 <strong>55% 감소</strong>.</li>
<li>긴 문서를 처리하는 질문 응답 작업에서, <strong>256개의 질문을 처리하는 데 소요된 시간이 FlashAttention으로 64개의 질문을 처리하는 시간보다 짧음</strong>.</li>
</ul>
</li>
<li>
<p><strong>다른 방법론 대비 비교 결과</strong>:</p>
<ul>
<li><strong>FlashAttention</strong>:
<ul>
<li>프리픽스를 배치 수준에서 최적화하지 못하며, 프리픽스와 서픽스에 대한 독립적인 매트릭스-벡터 곱셈을 수행. 결과적으로 GPU 메모리 대역폭 병목이 발생.</li>
<li>Hydragen은 <strong>매트릭스-매트릭스 곱셈</strong>으로 이를 대체, GPU 텐서 코어를 활용해 성능을 크게 향상.</li>
</ul>
</li>
<li><strong>vLLM (PagedAttention)</strong>:
<ul>
<li>vLLM은 프리픽스 중복 저장을 제거하고 메모리 최적화는 이루어지지만, <strong>프리픽스 중복 읽기</strong> 문제를 해결하지 못함.</li>
<li>프리픽스가 길어질수록 메모리 읽기 비용이 급증하며, Hydragen은 이를 해결하여 긴 프리픽스에서도 높은 처리량을 유지.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="결과-비교표"><strong>결과 비교표</strong></h4>
<table>
  <thead>
      <tr>
          <th>방법론</th>
          <th>속도 향상 (Hydragen 대비)</th>
          <th>긴 프리픽스(16K)에서의 성능 감소</th>
          <th>특징</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Hydragen</strong></td>
          <td>-</td>
          <td><strong>15% 미만</strong></td>
          <td>프리픽스와 서픽스를 분리, 프리픽스는 배치로 처리.</td>
      </tr>
      <tr>
          <td><strong>vLLM (PagedAttention)</strong></td>
          <td><strong>최대 32배 느림</strong></td>
          <td><strong>90% 이상 감소</strong></td>
          <td>메모리 최적화만 수행, 중복 읽기 해결 못함.</td>
      </tr>
      <tr>
          <td><strong>FlashAttention</strong></td>
          <td>최대 <strong>16배 느림</strong></td>
          <td>메모리 초과로 실패</td>
          <td>매트릭스-벡터 곱셈 중심, 중복 문제 해결 못함.</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="특출난-점"><strong>특출난 점</strong></h3>
<p>Hydragen의 독창적인 점은 <strong>프리픽스 최적화를 하드웨어 친화적인 방식으로 수행</strong>하여 다른 방법론 대비 크게 개선된 성능을 제공한다는 것입니다.</p>
<ol>
<li>
<p><strong>긴 프리픽스에 대한 견고한 성능</strong>:</p>
<ul>
<li>기존 방법론은 긴 프리픽스에서 처리량이 급감하는 반면, Hydragen은 처리량 감소를 최소화합니다. 이는 프리픽스 키-값 재사용과 텐서 코어 최적화를 결합한 접근 덕분입니다.</li>
</ul>
</li>
<li>
<p><strong>트리 기반 구조 지원</strong>:</p>
<ul>
<li>단순히 프리픽스-서픽스 구조뿐만 아니라, 트리 구조로 이루어진 공유 패턴까지 최적화할 수 있는 일반화된 방법론을 제시.</li>
</ul>
</li>
<li>
<p><strong>GPU 메모리 활용 극대화</strong>:</p>
<ul>
<li>매트릭스-매트릭스 곱셈으로 연산 밀도를 높여 텐서 코어를 최대한 활용함으로써 현대 GPU의 장점을 극대화.</li>
</ul>
</li>
<li>
<p><strong>프리픽스-서픽스 분리</strong>:</p>
<ul>
<li>프리픽스와 서픽스를 분리하여 각각 독립적으로 계산한 뒤, <strong>log-sum-exp</strong> 방식으로 결과를 재조합하는 정확한 어텐션 계산 방법.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="이러한-결과를-도출한-핵심-요인"><strong>이러한 결과를 도출한 핵심 요인</strong></h3>
<h4 id="논문에서-제시하는-주요-이유">논문에서 제시하는 주요 이유:</h4>
<ol>
<li>
<p><strong>프리픽스와 서픽스 어텐션 분리</strong>:</p>
<ul>
<li>공통 프리픽스에 대해 각 시퀀스가 동일한 키와 값을 갖는다는 점을 활용.</li>
<li>이를 단일 연산으로 통합(인터-시퀀스 배칭)하여 메모리 읽기 비용을 크게 절감.</li>
</ul>
</li>
<li>
<p><strong>GPU 텐서 코어 활용</strong>:</p>
<ul>
<li>매트릭스-매트릭스 곱셈을 통해 텐서 코어의 높은 연산 능력을 활용, 매트릭스-벡터 곱셈 대비 연산 효율성을 크게 증가.</li>
<li>텐서 코어는 GPU 연산량의 <strong>10배 이상</strong> 성능을 제공.</li>
</ul>
</li>
<li>
<p><strong>소프트맥스 재조합</strong>:</p>
<ul>
<li>분리된 어텐션 계산 결과를 <strong>log-sum-exp</strong>로 정확히 합산하여 전체 어텐션을 복원.</li>
</ul>
</li>
<li>
<p><strong>효율적인 구현</strong>:</p>
<ul>
<li>PyTorch와 기존의 FlashAttention, Triton 커널을 활용하여 간결하면서도 하드웨어 친화적으로 구현.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="내-생각-이-방법의-장점과-제약"><strong>내 생각: 이 방법의 장점과 제약</strong></h3>
<ol>
<li>
<p><strong>장점</strong>:</p>
<ul>
<li><strong>실제 활용 가능성</strong>이 높다:
<ul>
<li>챗봇이나 코드 생성 등 공통 프리픽스를 갖는 실질적인 사용 사례에서 성능 개선 가능.</li>
</ul>
</li>
<li><strong>긴 문맥 처리의 실용적 개선</strong>:
<ul>
<li>긴 컨텍스트를 처리해야 하는 최신 LLM 응용 분야(예: 질문 응답, 요약)에서 뛰어난 성능 제공.</li>
</ul>
</li>
<li><strong>GPU 자원의 최적 활용</strong>:
<ul>
<li>기존 방법론이 메모리 대역폭 병목에 걸리는 문제를 해결하여 최신 GPU에서 더욱 두드러지는 이점을 가짐.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>제약</strong>:</p>
<ul>
<li><strong>서픽스 최적화 부족</strong>:
<ul>
<li>서픽스는 기존의 FlashAttention을 그대로 사용하므로, 서픽스 길이가 매우 길 경우 성능이 저하될 수 있음.</li>
</ul>
</li>
<li><strong>범용성 제한</strong>:
<ul>
<li>공통 프리픽스가 없는 일반적인 텍스트 배치에서는 이점을 제공하지 못함.</li>
</ul>
</li>
<li><strong>동적 공유 탐지 미지원</strong>:
<ul>
<li>현재는 사용자가 수동으로 입력 데이터에서 공유 패턴을 지정해야 하며, 프리픽스 탐지가 자동화되지 않음.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>추가 개선 제안</strong>:</p>
<ul>
<li><strong>서픽스 최적화</strong>:
<ul>
<li>서픽스 길이가 긴 경우에도 효율성을 높이는 방법을 추가적으로 탐구.</li>
</ul>
</li>
<li><strong>자동화된 공유 탐지</strong>:
<ul>
<li>입력 데이터에서 프리픽스를 자동으로 감지하는 시스템 개발.</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론-1"><strong>결론</strong></h3>
<p>Hydragen은 현대 GPU의 텐서 코어를 활용하여 긴 프리픽스를 공유하는 시퀀스에서 어텐션의 병목을 획기적으로 해결하는 방법입니다. 특히 <strong>긴 문맥 처리</strong>와 <strong>대규모 배치 환경</strong>에서 압도적인 성능을 보이며, 이를 가능하게 한 프리픽스-서픽스 분리와 배칭 최적화 기법이 독창적입니다.</p>
<p>다만, 서픽스 최적화와 범용성에서 한계가 있으며, 이를 해결한다면 더욱 넓은 응용 범위를 가진 방법론으로 발전할 수 있습니다.</p>
<h1 id="q-vllm과-비교를-했을때-장점과-단점을-시나리오-별로-입력-과정을-예시를-통하여-아주-자세하게-설명해-줘">Q: vllm과 비교를 했을때 장점과 단점을 시나리오 별로 입력 과정을 예시를 통하여 아주 자세하게 설명해 줘</h1>
<p>Hydragen과 vLLM의 <strong>장단점을 시나리오 별로 비교</strong>하기 위해 입력 과정을 상세히 분석하고, 각각의 방식이 어떻게 처리되는지 예시를 통해 설명하겠습니다. 비교는 공통 프리픽스를 포함한 시나리오와 포함하지 않은 시나리오로 나누어 진행합니다.</p>
<hr>
<h3 id="시나리오-1-공통-프리픽스를-포함한-배치-입력"><strong>시나리오 1: 공통 프리픽스를 포함한 배치 입력</strong></h3>
<h4 id="예시"><strong>예시</strong>:</h4>
<ul>
<li>입력: 3개의 문장 배치
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-1"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-1"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-1">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">문장 1: &#34;The quick brown fox [jumps over the lazy dog].&#34;
</span></span><span class="line"><span class="ln">2</span><span class="cl">문장 2: &#34;The quick brown fox [runs swiftly].&#34;
</span></span><span class="line"><span class="ln">3</span><span class="cl">문장 3: &#34;The quick brown fox [chased the rabbit].&#34;</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-1';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<ul>
<li>공통 프리픽스: &ldquo;The quick brown fox&rdquo;.</li>
<li>고유 서픽스: 각 문장의 대괄호 안 부분.</li>
</ul>
</li>
</ul>
<h4 id="vllm-처리-과정"><strong>vLLM 처리 과정</strong></h4>
<ol>
<li>
<p><strong>프리픽스 중복 제거</strong>:</p>
<ul>
<li>프리픽스 키-값(<code>K/V</code>) 캐시는 모든 시퀀스에 대해 단일 사본으로 저장하여 GPU 메모리 사용량을 감소시킴.</li>
<li>중복 키-값 데이터의 메모리 낭비는 방지하지만, 어텐션 계산 시 동일한 프리픽스 데이터를 반복적으로 읽어야 함.</li>
</ul>
</li>
<li>
<p><strong>어텐션 계산</strong>:</p>
<ul>
<li>각 시퀀스에 대해 독립적으로 어텐션 계산 수행:
[
O_1 = \text{SDP}(Q_1, [K_{\text{prefix}}||K_{\text{suffix},1}], [V_{\text{prefix}}||V_{\text{suffix},1}])
]
[
O_2 = \text{SDP}(Q_2, [K_{\text{prefix}}||K_{\text{suffix},2}], [V_{\text{prefix}}||V_{\text{suffix},2}])
]
[
O_3 = \text{SDP}(Q_3, [K_{\text{prefix}}||K_{\text{suffix},3}], [V_{\text{prefix}}||V_{\text{suffix},3}])
]</li>
<li>이 과정에서 각 시퀀스가 동일한 프리픽스 키와 값을 읽으므로 <strong>메모리 대역폭 병목</strong> 발생.</li>
</ul>
</li>
<li>
<p><strong>결과</strong>:</p>
<ul>
<li>메모리 최적화로 인해 GPU 메모리 초과 문제는 방지되지만, <strong>반복적인 프리픽스 읽기로 인해 처리 속도가 느려짐</strong>.</li>
</ul>
</li>
</ol>
<h4 id="hydragen-처리-과정"><strong>Hydragen 처리 과정</strong></h4>
<ol>
<li>
<p><strong>프리픽스 최적화</strong>:</p>
<ul>
<li>프리픽스 키-값을 단일 연산으로 배치 처리(인터-시퀀스 배칭):
[
Q_{\text{batched}} = [Q_1^{\text{prefix}}, Q_2^{\text{prefix}}, Q_3^{\text{prefix}}]^T
]
[
O_{\text{prefix}} = \text{SDP}(Q_{\text{batched}}, K_{\text{prefix}}, V_{\text{prefix}})
]</li>
<li>매트릭스-매트릭스 곱셈을 사용하여 텐서 코어를 활용, <strong>GPU 메모리 읽기 비용 감소 및 처리 속도 향상</strong>.</li>
</ul>
</li>
<li>
<p><strong>서픽스 계산</strong>:</p>
<ul>
<li>각 시퀀스의 서픽스를 독립적으로 처리:
[
O_{\text{suffix},1} = \text{SDP}(Q_1^{\text{suffix}}, K_{\text{suffix},1}, V_{\text{suffix},1})
]
[
O_{\text{suffix},2} = \text{SDP}(Q_2^{\text{suffix}}, K_{\text{suffix},2}, V_{\text{suffix},2})
]
[
O_{\text{suffix},3} = \text{SDP}(Q_3^{\text{suffix}}, K_{\text{suffix},3}, V_{\text{suffix},3})
]</li>
</ul>
</li>
<li>
<p><strong>결과 결합</strong>:</p>
<ul>
<li>프리픽스와 서픽스 결과를 log-sum-exp 방식으로 결합:
[
O_i = \frac{
O_{\text{prefix},i} \cdot e^{\text{LSE}(Q_i, K_{\text{prefix}})} +
O_{\text{suffix},i} \cdot e^{\text{LSE}(Q_i, K_{\text{suffix}})}
}{
e^{\text{LSE}(Q_i, K_{\text{prefix}})} +
e^{\text{LSE}(Q_i, K_{\text{suffix}})}
}
]</li>
</ul>
</li>
<li>
<p><strong>결과</strong>:</p>
<ul>
<li>프리픽스 중복 읽기를 방지하고 배칭 최적화를 통해 vLLM 대비 <strong>최대 32배 속도 향상</strong>.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="시나리오-2-공통-프리픽스가-없는-독립적인-배치"><strong>시나리오 2: 공통 프리픽스가 없는 독립적인 배치</strong></h3>
<h4 id="예시-1"><strong>예시</strong>:</h4>
<ul>
<li>입력: 3개의 독립된 문장 배치
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-2"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-2"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-2">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">문장 1: &#34;The cat is playing.&#34;
</span></span><span class="line"><span class="ln">2</span><span class="cl">문장 2: &#34;A bird is flying.&#34;
</span></span><span class="line"><span class="ln">3</span><span class="cl">문장 3: &#34;The dog is barking.&#34;</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-2';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
</li>
</ul>
<h4 id="vllm-처리-과정-1"><strong>vLLM 처리 과정</strong></h4>
<ol>
<li>
<p><strong>프리픽스 중복 제거</strong>:</p>
<ul>
<li>이 시나리오에서는 공통 프리픽스가 없으므로 vLLM의 프리픽스 최적화 기능이 적용되지 않음.</li>
</ul>
</li>
<li>
<p><strong>어텐션 계산</strong>:</p>
<ul>
<li>각 문장의 어텐션 계산은 독립적으로 수행:
[
O_1 = \text{SDP}(Q_1, K_1, V_1)
]
[
O_2 = \text{SDP}(Q_2, K_2, V_2)
]
[
O_3 = \text{SDP}(Q_3, K_3, V_3)
]</li>
</ul>
</li>
<li>
<p><strong>결과</strong>:</p>
<ul>
<li>공통 프리픽스가 없으므로 일반적인 어텐션 연산과 동일한 방식으로 작동.</li>
</ul>
</li>
</ol>
<h4 id="hydragen-처리-과정-1"><strong>Hydragen 처리 과정</strong></h4>
<ol>
<li>
<p><strong>프리픽스 최적화 비적용</strong>:</p>
<ul>
<li>Hydragen은 공통 프리픽스를 활용한 최적화가 없으므로 프리픽스 최적화 기능이 적용되지 않음.</li>
<li>기존의 FlashAttention과 동일하게 작동.</li>
</ul>
</li>
<li>
<p><strong>결과</strong>:</p>
<ul>
<li>이 시나리오에서는 Hydragen과 vLLM 모두 특별한 성능상의 차이가 없음.</li>
<li>Hydragen의 주요 이점은 공통 프리픽스가 존재하는 배치에 국한됨.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="비교-결과"><strong>비교 결과</strong></h3>
<table>
  <thead>
      <tr>
          <th><strong>특징</strong></th>
          <th><strong>vLLM</strong></th>
          <th><strong>Hydragen</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>프리픽스 최적화</strong></td>
          <td>프리픽스 중복 저장 제거.</td>
          <td>프리픽스 중복 읽기와 저장 모두 제거.</td>
      </tr>
      <tr>
          <td><strong>프리픽스 어텐션 계산</strong></td>
          <td>독립적인 매트릭스-벡터 곱셈 수행.</td>
          <td>인터-시퀀스 배칭으로 매트릭스-매트릭스 곱셈 수행.</td>
      </tr>
      <tr>
          <td><strong>긴 프리픽스 처리</strong></td>
          <td>프리픽스가 길어지면 처리량 급감(90% 이상).</td>
          <td>처리량 감소가 15% 미만으로 제한됨.</td>
      </tr>
      <tr>
          <td><strong>서픽스 처리</strong></td>
          <td>기존 FlashAttention 방식.</td>
          <td>기존 FlashAttention 방식.</td>
      </tr>
      <tr>
          <td><strong>공통 프리픽스 없는 배치</strong></td>
          <td>일반적인 어텐션 연산과 동일.</td>
          <td>FlashAttention과 동일.</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="장점"><strong>장점</strong></h3>
<ol>
<li>
<p><strong>Hydragen의 장점</strong>:</p>
<ul>
<li>공통 프리픽스가 긴 배치에서 <strong>최대 32배의 성능 향상</strong>.</li>
<li>텐서 코어 활용으로 <strong>GPU 자원 최적화</strong>.</li>
<li>긴 프리픽스를 포함한 시나리오에서 <strong>압도적인 효율성</strong> 제공.</li>
</ul>
</li>
<li>
<p><strong>vLLM의 장점</strong>:</p>
<ul>
<li>프리픽스 최적화가 단순하며 구현이 간단.</li>
<li><strong>프리픽스 공유 탐지가 자동화</strong>되어 있어 사용 편의성이 높음.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="단점"><strong>단점</strong></h3>
<ol>
<li>
<p><strong>Hydragen의 단점</strong>:</p>
<ul>
<li><strong>공통 프리픽스 없는 시나리오</strong>에서 이점 없음.</li>
<li>사용자가 입력 데이터를 명시적으로 분석해 <strong>프리픽스 구조를 정의해야 함</strong>.</li>
<li>서픽스 최적화 부재.</li>
</ul>
</li>
<li>
<p><strong>vLLM의 단점</strong>:</p>
<ul>
<li>프리픽스 최적화가 메모리 중복 제거에 국한되며, <strong>중복 읽기 문제를 해결하지 못함</strong>.</li>
<li>긴 프리픽스에서 처리 속도가 급감.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론-2"><strong>결론</strong></h3>
<p>Hydragen은 <strong>공통 프리픽스를 포함한 시나리오</strong>에서 vLLM을 크게 능가하며, 특히 긴 문맥이나 대규모 배치에서 효율성이 극대화됩니다. 그러나 공통 프리픽스가 없는 일반적인 배치에서는 vLLM과 큰 차이가 없으며, 사용 편의성 측면에서 Hydragen은 개선의 여지가 있습니다. vLLM은 자동화된 프리픽스 탐지를 제공하여 보다 간단하게 적용할 수 있지만, 긴 프리픽스와 대규모 배치에 적합하지 않습니다.</p>
<h1 id="q--음-그렇다면-이건-공통된-prefix-lazy하게-분석하여-배치로-처리하여-suffix와-log-sum-exp로-결합하여-prefix가-공통된-경우가-빈번할시에-vllm보다-compute-utilization을-향상시킨다고-생각하면-될까">Q : 음 그렇다면 이건 공통된 prefix lazy하게 분석하여 배치로 처리하여 suffix와 log-sum-exp로 결합하여 prefix가 공통된 경우가 빈번할시에 vllm보다 compute utilization을 향상시킨다고 생각하면 될까?</h1>
<p><strong>네, 정확히 이해하셨습니다.</strong> Hydragen은 <strong>공통된 프리픽스(prefix)를 효율적으로 처리</strong>함으로써, 공통 프리픽스가 빈번히 나타나는 시나리오에서 <strong>vLLM보다 Compute Utilization(계산 자원 활용률)을 대폭 향상</strong>시킵니다. 이를 좀 더 구체적으로 설명하겠습니다.</p>
<hr>
<h3 id="hydragen의-주요-접근-방식"><strong>Hydragen의 주요 접근 방식</strong></h3>
<ol>
<li>
<p><strong>공통 프리픽스를 Lazy하게 분석</strong>:</p>
<ul>
<li>입력 데이터에서 공통된 프리픽스와 고유한 서픽스를 분리합니다.</li>
<li>공통된 프리픽스를 단일 키-값 매트릭스로 처리하여 배치 효율을 극대화합니다.</li>
<li>이는 기존 vLLM의 프리픽스 저장 최적화와 달리, <strong>계산 단계에서 중복 읽기를 제거</strong>하는 데 초점이 맞춰져 있습니다.</li>
</ul>
</li>
<li>
<p><strong>배치 처리로 텐서 코어 활용 극대화</strong>:</p>
<ul>
<li>공통 프리픽스를 여러 시퀀스에 대해 <strong>단일 매트릭스-매트릭스 연산</strong>으로 처리합니다.</li>
<li>이는 기존 vLLM이 각 시퀀스별 매트릭스-벡터 곱셈을 수행하는 방식보다 <strong>훨씬 더 높은 GPU Compute Utilization</strong>을 제공합니다.</li>
</ul>
</li>
<li>
<p><strong>프리픽스와 서픽스의 결합</strong>:</p>
<ul>
<li><strong>log-sum-exp</strong> 방식을 사용해 프리픽스와 서픽스의 어텐션 결과를 정확히 결합.</li>
<li>이 과정에서 기존의 어텐션 정밀도를 유지하면서도 성능 최적화를 달성합니다.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="vllm-대비-compute-utilization의-향상"><strong>vLLM 대비 Compute Utilization의 향상</strong></h3>
<h4 id="1-vllm의-한계">1. <strong>vLLM의 한계</strong>:</h4>
<ul>
<li>프리픽스의 키-값 캐시를 저장하여 GPU 메모리를 절약하지만, 어텐션 계산에서 동일한 프리픽스를 각 시퀀스별로 반복적으로 읽습니다.</li>
<li>이로 인해 GPU 메모리 대역폭이 병목현상이 되고, 긴 프리픽스에서는 처리 속도가 급격히 감소합니다.</li>
</ul>
<h4 id="2-hydragen의-개선">2. <strong>Hydragen의 개선</strong>:</h4>
<ul>
<li>공통된 프리픽스를 단일 연산으로 처리하여 반복적인 읽기를 제거하고, 텐서 코어를 활용해 **계산 집중도(Arithmetic Intensity)**를 증가시킵니다.</li>
<li>긴 프리픽스에서도 성능 감소가 적고, 배치 크기가 클수록 성능 향상이 극대화됩니다.</li>
</ul>
<hr>
<h3 id="결론-3"><strong>결론</strong></h3>
<ul>
<li><strong>맞습니다</strong>. Hydragen은 공통 프리픽스를 분석하고 이를 배치로 처리하며, 고유 서픽스와 결합하는 최적화 기법을 통해 <strong>vLLM 대비 Compute Utilization을 대폭 향상</strong>시킵니다.</li>
<li>특히 <strong>공통 프리픽스가 빈번하게 나타나는 시나리오</strong>에서, Hydragen은 <strong>vLLM보다 훨씬 효율적으로 계산 리소스를 활용</strong>합니다.</li>
<li>반면, 공통 프리픽스가 없는 경우에는 Hydragen이 FlashAttention과 동일하게 동작하므로 이점이 없습니다. 따라서 공통 프리픽스의 빈도가 높은 환경에서 더욱 효과적입니다.</li>
</ul>
<h1 id="q--이-논문에서-제시된-방법을-실제로-사용하려면-기존-방법에서-어떠한-구현이-추가적으로-필요하고-이러한-구현에-소모되는-공수-및-연산에-필요한-컴퓨팅-자원의-크기에-대해서-계산해줄-수-있겠니">Q : 이 논문에서 제시된 방법을 실제로 사용하려면 기존 방법에서 어떠한 구현이 추가적으로 필요하고 이러한 구현에 소모되는 공수 및 연산에 필요한 컴퓨팅 자원의 크기에 대해서 계산해줄 수 있겠니?</h1>
<h3 id="hydragen-구현-시-기존-방법에서-추가적으로-필요한-구현-요소"><strong>Hydragen 구현 시 기존 방법에서 추가적으로 필요한 구현 요소</strong></h3>
<p>Hydragen을 실제로 적용하려면 <strong>기존 LLM 추론 파이프라인</strong>에 몇 가지 주요 구현 변경 및 추가 작업이 필요합니다. 이를 기반으로 구현의 복잡도와 추가적인 컴퓨팅 자원 요구 사항을 분석하겠습니다.</p>
<hr>
<h3 id="추가적으로-필요한-구현"><strong>추가적으로 필요한 구현</strong></h3>
<ol>
<li>
<p><strong>공통 프리픽스와 고유 서픽스의 자동 분리</strong>:</p>
<ul>
<li><strong>기능</strong>: 입력 배치에서 각 시퀀스 간 공통 프리픽스를 탐지하고 이를 분리하는 전처리 로직 추가.</li>
<li><strong>구현 고려사항</strong>:
<ul>
<li>공통 프리픽스를 분석하고, 이를 추출하는 알고리즘이 필요.</li>
<li>최적화를 위해 긴 배치의 모든 시퀀스를 비교해야 하므로 추가 연산이 발생.</li>
</ul>
</li>
<li><strong>복잡도</strong>:
<ul>
<li>최악의 경우 (O(B \times N^2)), (B)는 배치 크기, (N)은 시퀀스 길이. (일반적인 경우 (O(B \times N))로 줄일 수 있음.)</li>
<li>연산 비용은 텍스트 토큰 비교(간단한 문자열 해싱)로 해결 가능하므로 메모리 및 연산 부담은 적음.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>프리픽스 키-값 캐시 생성 및 공유 처리</strong>:</p>
<ul>
<li><strong>기능</strong>: 공통 프리픽스 키-값((K_{\text{prefix}}, V_{\text{prefix}}))을 캐싱하고 이를 단일 연산으로 처리.</li>
<li><strong>구현 고려사항</strong>:
<ul>
<li>기존 vLLM에서 프리픽스를 개별적으로 계산하던 방식을 <strong>인터-시퀀스 배칭</strong>으로 변경.</li>
<li>키-값 캐시를 생성 및 관리하는 로직 추가 필요.</li>
</ul>
</li>
<li><strong>복잡도</strong>:
<ul>
<li>캐시 생성은 한 번 수행되며, 크기는 (O(N_{\text{prefix}} \times d)), (d)는 임베딩 차원.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>프리픽스와 서픽스 어텐션 결과 결합</strong>:</p>
<ul>
<li><strong>기능</strong>: 프리픽스와 서픽스 어텐션 결과를 log-sum-exp 방식으로 결합하여 최종 어텐션 값을 계산.</li>
<li><strong>구현 고려사항</strong>:
<ul>
<li>추가로 (e^{\text{LSE}}) 계산과 재조합 연산을 수행.</li>
<li>이를 위해 기존 어텐션 연산 이후 추가적인 (O(B \times d)) 연산 필요.</li>
</ul>
</li>
<li><strong>복잡도</strong>:
<ul>
<li>추가 계산은 배치 크기와 임베딩 차원에 비례하므로 상대적으로 경미.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>인터-시퀀스 배칭</strong>:</p>
<ul>
<li><strong>기능</strong>: 공통 프리픽스에 대해 배치된 쿼리((Q_{\text{batched}}))를 입력으로 하는 매트릭스-매트릭스 연산.</li>
<li><strong>구현 고려사항</strong>:
<ul>
<li>기존 매트릭스-벡터 곱셈을 매트릭스-매트릭스 곱셈으로 변경.</li>
<li>GPU 텐서 코어 사용 최적화.</li>
</ul>
</li>
<li><strong>복잡도</strong>:
<ul>
<li>계산량은 동일하지만 메모리 접근 비용이 줄어들어 효율이 증가.</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="소요-공수-분석"><strong>소요 공수 분석</strong></h3>
<p>Hydragen은 기존의 FlashAttention이나 vLLM과 같은 최적화된 LLM 추론 프레임워크 위에 구현 가능하며, 다음과 같은 추가 개발 노력이 필요합니다:</p>
<ol>
<li>
<p><strong>프리픽스 분리 알고리즘 개발</strong>: 2~4주</p>
<ul>
<li>배치 입력에서 공통 프리픽스를 탐지하고 이를 효율적으로 분리하는 로직 구현.</li>
<li>문자열 비교 및 해싱을 기반으로, Python 또는 C++ 레벨에서 구현 가능.</li>
</ul>
</li>
<li>
<p><strong>인터-시퀀스 배칭 설계 및 통합</strong>: 4~6주</p>
<ul>
<li>PyTorch 또는 TensorFlow 기반의 배치 어텐션 연산 구현.</li>
<li>텐서 코어를 활용하기 위해 매트릭스-매트릭스 곱셈에 적합한 데이터 구조 설계.</li>
</ul>
</li>
<li>
<p><strong>log-sum-exp 결합 로직 추가</strong>: 1~2주</p>
<ul>
<li>프리픽스와 서픽스 어텐션 결과를 결합하는 추가 계산 모듈 구현.</li>
<li>기존 PyTorch API에서 지원하므로 간단히 통합 가능.</li>
</ul>
</li>
<li>
<p><strong>성능 최적화 및 테스트</strong>: 4~6주</p>
<ul>
<li>다양한 배치 크기와 프리픽스 길이에 대해 성능 최적화 및 벤치마크 수행.</li>
<li>GPU 활용률 분석 및 병목 현상 해결.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="추가-컴퓨팅-자원의-요구"><strong>추가 컴퓨팅 자원의 요구</strong></h3>
<p>Hydragen의 주요 장점은 <strong>계산 비용의 재배치</strong>를 통해 GPU 자원 활용률을 높인다는 점입니다. 추가 컴퓨팅 자원 요구 사항은 다음과 같습니다:</p>
<ol>
<li>
<p><strong>메모리 요구</strong>:</p>
<ul>
<li>(O(N_{\text{prefix}} \times d)) 크기의 추가 키-값 캐시 저장 필요.</li>
<li>일반적으로, 서픽스의 키-값 캐시와 비교해 <strong>메모리 사용량 증가가 미미</strong>.</li>
</ul>
</li>
<li>
<p><strong>연산량</strong>:</p>
<ul>
<li>프리픽스 어텐션을 매트릭스-매트릭스 곱셈으로 처리하므로 <strong>계산량은 기존 방식과 동일</strong>.</li>
<li>서픽스 결과와의 결합에 (O(B \times d)) 추가 연산이 발생하나 이는 GPU에서 병렬 처리 가능.</li>
</ul>
</li>
<li>
<p><strong>I/O 비용 감소</strong>:</p>
<ul>
<li>기존 방식에서 프리픽스 데이터를 각 시퀀스별로 반복적으로 읽던 것을 단일 읽기로 통합.</li>
<li><strong>메모리 대역폭 병목 완화로 처리량(Throughput)이 대폭 향상</strong>.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="예상-성능-개선"><strong>예상 성능 개선</strong></h3>
<ol>
<li>
<p><strong>GPU 활용률</strong>:</p>
<ul>
<li>텐서 코어를 사용하는 매트릭스-매트릭스 연산으로 전환하므로, GPU Compute Utilization이 <strong>10배 이상</strong> 향상 가능.</li>
</ul>
</li>
<li>
<p><strong>처리량(Throughput)</strong>:</p>
<ul>
<li>공통 프리픽스 길이가 길수록 I/O 병목이 크게 줄어들어, 기존 vLLM 대비 <strong>최대 32배 속도 개선</strong> 가능.</li>
</ul>
</li>
<li>
<p><strong>추론 비용 절감</strong>:</p>
<ul>
<li>긴 프리픽스를 처리하는 대규모 배치에서는 GPU 메모리 사용량과 대역폭 요구가 감소하여, 동일한 하드웨어로 <strong>더 많은 배치 처리</strong> 가능.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론-4"><strong>결론</strong></h3>
<ul>
<li><strong>필요한 구현</strong>: 공통 프리픽스 분리, 인터-시퀀스 배칭, log-sum-exp 결합 등 기존 어텐션 계산에 몇 가지 모듈이 추가됩니다.</li>
<li><strong>소요 공수</strong>: 구현부터 최적화까지 약 <strong>10~16주</strong>.</li>
<li><strong>추가 자원 요구</strong>: 메모리 사용량은 크게 증가하지 않으며, 연산량은 기존과 유사하지만 GPU 텐서 코어 활용률이 극대화되어 성능이 향상됩니다.</li>
</ul>
<p>따라서 Hydragen의 구현은 공통 프리픽스가 빈번히 발생하는 시나리오에서 대규모 배치 추론을 크게 개선할 수 있는 투자 가치가 있습니다.</p>
<h1 id="q--이-논문의-입력데이터와-추론-과정에-대해서-예시를-들어-아주-자세하게-설명해-주겠니-추가적으로-모델아키텍처의-구성-및-모델을-구성하는-연산과-메모리-요구량-컴퓨팅-요구량-대해서도-설명해줘">Q : 이 논문의 입력데이터와 추론 과정에 대해서 예시를 들어 아주 자세하게 설명해 주겠니? 추가적으로 모델아키텍처의 구성 및 모델을 구성하는 연산과 메모리 요구량 컴퓨팅 요구량 대해서도 설명해줘</h1>
<h3 id="논문의-입력-데이터와-추론-과정"><strong>논문의 입력 데이터와 추론 과정</strong></h3>
<h4 id="1-입력-데이터"><strong>1. 입력 데이터</strong></h4>
<ul>
<li><strong>특징</strong>: 논문은 공통 프리픽스를 갖는 배치 입력을 가정합니다.
<ul>
<li><strong>공통 프리픽스</strong>: 여러 시퀀스에서 동일한 부분. 예: 챗봇의 시스템 프롬프트, few-shot 학습의 컨텍스트.</li>
<li><strong>고유 서픽스</strong>: 각 시퀀스마다 다른 부분. 예: 사용자가 입력한 질문이나 문장.</li>
</ul>
</li>
</ul>
<h4 id="입력-데이터-예시"><strong>입력 데이터 예시</strong>:</h4>
<ul>
<li>배치 크기 ((B)): 3</li>
<li>시퀀스 길이 ((N_{\text{seq}})): 최대 20</li>
<li>임베딩 차원 ((d)): 8</li>
<li>입력 데이터:
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-3"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-3"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-3">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">문장 1: &#34;The quick brown fox [jumps over the lazy dog].&#34;
</span></span><span class="line"><span class="ln">2</span><span class="cl">문장 2: &#34;The quick brown fox [runs swiftly].&#34;
</span></span><span class="line"><span class="ln">3</span><span class="cl">문장 3: &#34;The quick brown fox [chased the rabbit].&#34;</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-3';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<ul>
<li>공통 프리픽스: <code>&quot;The quick brown fox&quot;</code>.</li>
<li>고유 서픽스:
<ul>
<li>문장 1: <code>[jumps over the lazy dog].</code></li>
<li>문장 2: <code>[runs swiftly].</code></li>
<li>문장 3: <code>[chased the rabbit].</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="입력-데이터의-처리-방식"><strong>입력 데이터의 처리 방식</strong>:</h4>
<ol>
<li>
<p><strong>토크나이제이션</strong>:</p>
<ul>
<li>문장을 토큰 단위로 분리하고 각 토큰을 고유 ID로 매핑.</li>
<li>예를 들어:
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-4"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-4"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-4">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">&#34;The quick brown fox&#34;: [101, 102, 103, 104]
</span></span><span class="line"><span class="ln">2</span><span class="cl">&#34;[jumps over the lazy dog]&#34;: [201, 202, 203, 204, 205]</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-4';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
</li>
</ul>
</li>
<li>
<p><strong>임베딩</strong>:</p>
<ul>
<li>각 토큰 ID를 임베딩 벡터로 변환:
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-5"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-5"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-5">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">&#34;The quick brown fox&#34;: [[0.1, 0.2, ...], [0.3, 0.4, ...], ...]</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-5';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
</li>
</ul>
</li>
<li>
<p><strong>키(Key), 값(Value), 쿼리(Query) 생성</strong>:</p>
<ul>
<li>입력 시퀀스는 모델의 임베딩 층을 통해 키, 값, 쿼리 행렬 (K, V, Q)로 변환.
<ul>
<li>(K_{\text{prefix}}, V_{\text{prefix}}): 공통 프리픽스의 키와 값.</li>
<li>(K_{\text{suffix}}, V_{\text{suffix}}): 고유 서픽스의 키와 값.</li>
<li>(Q): 전체 시퀀스의 쿼리 행렬.</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h4 id="2-추론-과정"><strong>2. 추론 과정</strong></h4>
<p>Hydragen은 프리픽스와 서픽스를 분리하여 어텐션을 최적화합니다. 다음은 단계별 추론 과정입니다.</p>
<h5 id="단계-1-프리픽스-어텐션"><strong>단계 1: 프리픽스 어텐션</strong></h5>
<ol>
<li>
<p>공통 프리픽스에 대한 어텐션 계산:
[
O_{\text{prefix}} = \text{SDP}(Q_{\text{batched}}, K_{\text{prefix}}, V_{\text{prefix}})
]</p>
<ul>
<li><strong>SDP</strong>(Scaled Dot-Product Attention):
[
\text{SDP}(Q, K, V) = \text{softmax} \left( \frac{Q K^T}{\sqrt{d}} \right) V
]</li>
<li>이때 (Q_{\text{batched}})는 여러 시퀀스의 프리픽스 쿼리를 배치로 묶은 행렬.</li>
</ul>
</li>
<li>
<p>결과:</p>
<ul>
<li>공통 프리픽스에 대해 단일 연산으로 처리, 메모리 대역폭 병목 완화.</li>
</ul>
</li>
</ol>
<h5 id="단계-2-서픽스-어텐션"><strong>단계 2: 서픽스 어텐션</strong></h5>
<ol>
<li>각 서픽스에 대해 독립적으로 어텐션 계산:
[
O_{\text{suffix},i} = \text{SDP}(Q_{\text{suffix},i}, K_{\text{suffix},i}, V_{\text{suffix},i})
]
<ul>
<li>각 시퀀스의 고유 서픽스에 대해 독립적인 계산 수행.</li>
</ul>
</li>
</ol>
<h5 id="단계-3-프리픽스와-서픽스-결과-결합"><strong>단계 3: 프리픽스와 서픽스 결과 결합</strong></h5>
<ol>
<li><strong>log-sum-exp 재조합</strong>:
<ul>
<li>프리픽스와 서픽스의 어텐션 결과를 결합:
[
O_i = \frac{
O_{\text{prefix},i} \cdot e^{\text{LSE}(Q_i, K_{\text{prefix}})} +
O_{\text{suffix},i} \cdot e^{\text{LSE}(Q_i, K_{\text{suffix}})}
}{
e^{\text{LSE}(Q_i, K_{\text{prefix}})} +
e^{\text{LSE}(Q_i, K_{\text{suffix}})}
}
]</li>
</ul>
</li>
</ol>
<h5 id="결과"><strong>결과</strong>:</h5>
<ul>
<li>최종 출력 (O = [O_1, O_2, O_3]).</li>
<li>각 시퀀스의 완전한 어텐션 결과가 도출됨.</li>
</ul>
<hr>
<h3 id="모델-아키텍처"><strong>모델 아키텍처</strong></h3>
<p>Hydragen은 Transformer 기반 모델에 최적화된 접근법을 사용합니다.</p>
<h4 id="transformer-아키텍처-구성-요소"><strong>Transformer 아키텍처 구성 요소</strong></h4>
<ol>
<li>
<p><strong>임베딩 층</strong>:</p>
<ul>
<li>입력 토큰을 임베딩 벡터로 변환.</li>
<li>(O(V \times d)): (V)는 어휘 크기, (d)는 임베딩 차원.</li>
</ul>
</li>
<li>
<p><strong>어텐션 층 (Multi-Head Attention)</strong>:</p>
<ul>
<li>Scaled Dot-Product Attention을 (H)개의 헤드에 대해 수행.</li>
<li>계산 비용:
<ul>
<li>쿼리-키 매트릭스 곱셈: (O(B \times N \times d^2)).</li>
<li>소프트맥스: (O(B \times N^2)).</li>
<li>값 매트릭스 곱셈: (O(B \times N \times d^2)).</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>피드포워드 네트워크 (FFN)</strong>:</p>
<ul>
<li>각 토큰 임베딩에 독립적으로 적용.</li>
<li>계산 비용: (O(B \times N \times d^2)).</li>
</ul>
</li>
</ol>
<hr>
<h3 id="연산-및-메모리-요구량"><strong>연산 및 메모리 요구량</strong></h3>
<h4 id="1-연산-요구량"><strong>1. 연산 요구량</strong></h4>
<ul>
<li>
<p><strong>Hydragen 추가 연산</strong>:</p>
<ol>
<li>공통 프리픽스 처리:
<ul>
<li>매트릭스-매트릭스 곱셈: (O(B \times N_{\text{prefix}} \times d^2)).</li>
</ul>
</li>
<li>서픽스 처리:
<ul>
<li>매트릭스-벡터 곱셈: (O(B \times N_{\text{suffix}} \times d^2)).</li>
</ul>
</li>
<li>log-sum-exp 결합:
<ul>
<li>추가 연산: (O(B \times d)).</li>
</ul>
</li>
</ol>
</li>
<li>
<p><strong>총 연산량</strong> (기존 대비):</p>
<ul>
<li>기존 방식(vLLM): 모든 시퀀스에 대해 독립적인 매트릭스-벡터 연산.</li>
<li>Hydragen: 프리픽스에 대해 매트릭스-매트릭스 연산으로 병렬화하여, 전체 배치 크기 (B)에 대해 효율성 증가.</li>
</ul>
</li>
</ul>
<h4 id="2-메모리-요구량"><strong>2. 메모리 요구량</strong></h4>
<ul>
<li><strong>키-값 캐시 크기</strong>:
<ul>
<li>기존 방식:
<ul>
<li>(O(B \times N_{\text{prefix}} \times d)) (중복 키-값 저장 포함).</li>
</ul>
</li>
<li>Hydragen 방식:
<ul>
<li>(O(N_{\text{prefix}} \times d) + O(B \times N_{\text{suffix}} \times d)).</li>
<li>중복 저장 제거로 메모리 요구량 감소.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="컴퓨팅-자원-요구량"><strong>컴퓨팅 자원 요구량</strong></h3>
<ol>
<li>
<p><strong>GPU 메모리</strong>:</p>
<ul>
<li>Hydragen은 공통 프리픽스 키-값 캐시를 단일 사본으로 관리하므로, 메모리 사용량이 감소.</li>
<li>(N_{\text{prefix}})가 클수록 메모리 이점이 커짐.</li>
</ul>
</li>
<li>
<p><strong>GPU 연산 효율</strong>:</p>
<ul>
<li>Hydragen은 매트릭스-매트릭스 곱셈으로 텐서 코어 활용을 극대화.</li>
<li>기존 방식 대비 GPU Compute Utilization이 <strong>10배 이상</strong> 향상 가능.</li>
</ul>
</li>
<li>
<p><strong>추가적인 CPU 자원</strong>:</p>
<ul>
<li>프리픽스와 서픽스 분리를 위한 사전 분석 작업이 추가되지만, 이는 GPU 연산 병목에 비해 미미한 부담.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론-5"><strong>결론</strong></h3>
<ul>
<li><strong>Hydragen의 추론 과정</strong>은 입력 데이터를 프리픽스와 서픽스로 분리하고, 이를 효율적으로 처리하는 방식으로 기존 방식 대비 메모리와 연산 효율성을 크게 향상합니다.</li>
<li><strong>모델 아키텍처의 요구</strong>:
<ul>
<li>추가적인 메모리 사용량은 거의 없으며, 연산 최적화로 인해 동일한 하드웨어로 더 큰 배치를 처리할 수 있습니다.</li>
</ul>
</li>
<li><strong>컴퓨팅 자원 요구</strong>:
<ul>
<li>GPU 텐서 코어 활용으로 기존 방식보다 더 높은 효율성을 제공합니다.</li>
</ul>
</li>
</ul>
<h1 id="q--이-논문의-한계를-극복하기-위한-방법으로-어떤-연구흐름이-있는지-정리해서-자세하게-설명해-줘">Q : 이 논문의 한계를 극복하기 위한 방법으로 어떤 연구흐름이 있는지 정리해서 자세하게 설명해 줘</h1>
<h3 id="이-논문의-한계와-이를-극복하기-위한-연구-흐름"><strong>이 논문의 한계와 이를 극복하기 위한 연구 흐름</strong></h3>
<p>Hydragen은 공통 프리픽스가 있는 배치에서 효율성을 극대화하지만, 다음과 같은 몇 가지 한계점이 존재합니다. 이를 극복하기 위해 현재 또는 앞으로의 연구에서 활용할 수 있는 접근법을 자세히 정리합니다.</p>
<hr>
<h3 id="1-공통-프리픽스가-없는-경우-성능-저하"><strong>1. 공통 프리픽스가 없는 경우 성능 저하</strong></h3>
<h4 id="한계-설명"><strong>한계 설명</strong>:</h4>
<ul>
<li>Hydragen은 공통 프리픽스를 전제로 최적화되어, <strong>공통 프리픽스가 없는 배치</strong>에서는 기존 FlashAttention 또는 vLLM과 동일하게 동작하며 추가적인 이점을 제공하지 못함.</li>
</ul>
<h4 id="극복-방향"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>프리픽스 탐지 자동화</strong>:</p>
<ul>
<li>공통 프리픽스가 없는 경우에도 <strong>부분적인 프리픽스 공유 탐지</strong>를 통해 최적화를 수행.</li>
<li>예: 긴 시퀀스에서 자연스럽게 등장하는 공통적인 하위 패턴(단어, 문구 등)을 탐지.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li><strong>Dynamic Prompt Sharing</strong>: 동적으로 입력 데이터에서 공유 가능한 프리픽스나 서픽스를 탐지하고 이를 병렬 처리. RadixAttention(SGLang)처럼 요청 데이터를 트리 형태로 분리하여 공통 서브트리를 최적화 가능.</li>
<li><strong>압축 기반 시퀀스 정렬</strong>: 데이터 압축 알고리즘(LZ77 등)을 응용해 시퀀스 간 공유되는 패턴을 효율적으로 탐지.</li>
</ul>
</li>
<li>
<p><strong>어텐션 연산 일반화</strong>:</p>
<ul>
<li>공통 프리픽스가 없는 경우에도 배치 수준에서 <strong>쿼리와 키의 통합 처리를 위한 구조</strong>를 설계.</li>
<li>예: <strong>Grouped Query Attention(GQA)</strong> 또는 <strong>Grouped Key-Value Caching</strong>을 사용하여 어텐션 계산에서 연산 공유 가능성을 극대화.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-서픽스-최적화의-부재"><strong>2. 서픽스 최적화의 부재</strong></h3>
<h4 id="한계-설명-1"><strong>한계 설명</strong>:</h4>
<ul>
<li>서픽스 계산은 기존 FlashAttention 방식에 의존하여 최적화되지 않음.</li>
<li>긴 서픽스가 있는 경우 성능이 저하될 가능성이 존재.</li>
</ul>
<h4 id="극복-방향-1"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>서픽스 내 병렬화 최적화</strong>:</p>
<ul>
<li>서픽스의 키-값 매트릭스도 쿼리와 동일하게 병렬화하여 텐서 코어 활용 극대화.</li>
<li>블록 단위 연산으로 메모리 접근 패턴 최적화.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li><strong>Block Attention</strong>:
<ul>
<li>FlashAttention-2처럼 서픽스를 고정 길이 블록으로 분할해 메모리 접근을 효율적으로 재구성.</li>
<li>블록별 병렬 계산으로 성능 향상.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>다중 쿼리 어텐션(Multi-Query Attention, MQA)</strong>:</p>
<ul>
<li>서픽스 키와 값을 여러 쿼리가 공유하도록 설계, 키-값 매트릭스 크기를 줄이고 계산량 감소.</li>
<li>효율적인 서픽스 키-값 관리로 긴 서픽스에서도 성능 저하를 최소화.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="3-동적-배치-처리-미지원"><strong>3. 동적 배치 처리 미지원</strong></h3>
<h4 id="한계-설명-2"><strong>한계 설명</strong>:</h4>
<ul>
<li>Hydragen은 고정된 배치에서 공통 프리픽스를 처리하도록 설계되어, <strong>다양한 요청이 실시간으로 들어오는 환경</strong>에서는 성능 저하.</li>
</ul>
<h4 id="극복-방향-2"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>동적 배치 생성</strong>:</p>
<ul>
<li>실시간 요청을 분석해 유사한 프리픽스를 공유하는 시퀀스를 자동으로 묶는 방식.</li>
<li>예: 다중 사용자의 실시간 요청에서 동일한 시스템 프롬프트를 공유하는 요청을 그룹화.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li><strong>Request Scheduling</strong>:
<ul>
<li>동적 배치 스케줄링 알고리즘을 통해 유사한 프리픽스를 갖는 요청을 클러스터링.</li>
<li>예: ORCA 또는 RadixAttention에서 사용된 <strong>동적 서브트리 공유 탐지</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>모델 프롬프트 관리 최적화</strong>:</p>
<ul>
<li>실시간 요청에서 프롬프트 공유를 효율적으로 감지하고 스케줄링.</li>
<li>모델 수준에서 요청의 우선순위를 조정해 프리픽스를 재활용.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="4-매우-긴-컨텍스트에서-메모리-사용-증가"><strong>4. 매우 긴 컨텍스트에서 메모리 사용 증가</strong></h3>
<h4 id="한계-설명-3"><strong>한계 설명</strong>:</h4>
<ul>
<li>공통 프리픽스가 매우 긴 경우((N_{\text{prefix}} &gt; 16K)) Hydragen의 키-값 캐시 크기가 메모리를 과도하게 점유할 수 있음.</li>
<li>특히, 서픽스가 긴 경우 추가적으로 메모리 사용이 증가.</li>
</ul>
<h4 id="극복-방향-3"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>키-값 캐시 압축</strong>:</p>
<ul>
<li>키-값 캐시를 저장하기 전에 압축하거나, 중요하지 않은 정보를 제거하여 메모리 사용을 줄임.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li>
<p><strong>Sparse Attention</strong>:</p>
<ul>
<li>효율적인 압축 전략을 도입해 중요한 어텐션 패턴만 유지.</li>
<li>예: BigBird 또는 Longformer의 sparse attention 구조 활용.</li>
</ul>
</li>
<li>
<p><strong>Memory Mapping Optimization</strong>:</p>
<ul>
<li>GPU 메모리와 CPU 메모리 간의 데이터 이동 최적화(vLLM에서 도입).</li>
<li>긴 컨텍스트를 다룰 때 키-값 데이터를 GPU에서 부분적으로 로드.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>기하급수적 캐시 감소(Exponential Cache Reduction)</strong>:</p>
<ul>
<li>프리픽스 길이에 따라 점진적으로 캐시의 해상도를 줄이는 방식.</li>
<li>최근 연구에서는 길이가 긴 컨텍스트에 대해 <strong>멀티-헤드 어텐션의 집중도를 동적으로 조정</strong>하여 메모리 사용을 줄임.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="5-긴-프리픽스와-긴-서픽스-간의-균형-문제"><strong>5. 긴 프리픽스와 긴 서픽스 간의 균형 문제</strong></h3>
<h4 id="한계-설명-4"><strong>한계 설명</strong>:</h4>
<ul>
<li>긴 프리픽스는 효율적으로 처리되지만, 긴 서픽스가 뒤따르는 경우 프리픽스 처리의 이점이 상쇄될 수 있음.</li>
</ul>
<h4 id="극복-방향-4"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>트리 기반 계층적 공유</strong>:</p>
<ul>
<li>긴 프리픽스와 긴 서픽스를 계층적으로 분리하여 병렬화.</li>
<li>예: APPS 문제에서 두 단계의 공유 구조를 효율적으로 처리했던 방식.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li><strong>Hierarchical Prompt Sharing</strong>:
<ul>
<li>트리 구조에서 중복되는 키-값을 재사용하며, 각 레벨에서 배치를 효율적으로 병렬 처리.</li>
<li>예: Tree of Thoughts 또는 RadixAttention.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Suffix-aware Prefix Optimization</strong>:</p>
<ul>
<li>서픽스 길이에 따라 프리픽스 계산을 동적으로 조정.</li>
<li>예: 프리픽스 처리의 비중을 줄이고 서픽스 계산을 최적화.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="6-구현-및-유지보수-복잡성"><strong>6. 구현 및 유지보수 복잡성</strong></h3>
<h4 id="한계-설명-5"><strong>한계 설명</strong>:</h4>
<ul>
<li>Hydragen은 PyTorch 또는 TensorFlow 기반의 기존 모델에 비해 구현 복잡도가 증가하며, 다양한 시나리오에서 이를 유지보수하기 어렵다.</li>
</ul>
<h4 id="극복-방향-5"><strong>극복 방향</strong>:</h4>
<ol>
<li>
<p><strong>자동화된 구현 툴체인 제공</strong>:</p>
<ul>
<li>Hydragen과 같은 최적화 기술을 PyTorch, Hugging Face 등 주요 프레임워크에 플러그인 형태로 통합.</li>
<li>사용자 정의 없이 쉽게 적용 가능하도록 지원.</li>
</ul>
<p><strong>연구 흐름</strong>:</p>
<ul>
<li><strong>Compiler-level Optimization</strong>:
<ul>
<li>Hydra 같은 추론 최적화 프레임워크와 연동해 CUDA 커널을 자동으로 생성 및 최적화.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Cross-hardware Compatibility</strong>:</p>
<ul>
<li>Hydragen의 최적화를 GPU뿐만 아니라 TPU, CPU 등 다양한 하드웨어에 맞춰 일반화.</li>
<li>예: ONNX 또는 TVM과 같은 범용 모델 컴파일러와의 통합.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="결론-6"><strong>결론</strong></h3>
<p>Hydragen은 공통 프리픽스가 있는 배치에 매우 효율적이지만, 서픽스 최적화, 공통 프리픽스 없는 데이터 처리, 그리고 긴 시퀀스 문제에서 한계를 보입니다. 이를 극복하기 위해 <strong>동적 공유 탐지</strong>, <strong>서픽스 최적화</strong>, <strong>캐시 압축</strong>, 그리고 <strong>실시간 배치 스케줄링</strong>과 같은 접근법이 연구되고 있으며, RadixAttention, Sparse Attention, Hierarchical Prompt Sharing 등이 중요한 연구 흐름으로 주목받고 있습니다.</p>
<p>이러한 방향으로 발전하면 Hydragen의 한계가 보완되고 더 많은 시나리오에서 높은 성능을 제공할 수 있을 것입니다.</p>

  </article>

  
  
  <div class="post-license bg-muted/30 border-border mb-8 rounded-xl border p-6">
    <div class="flex items-start gap-4">
      <div
        class="bg-primary/10 flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이선스"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
</svg>
      </div>

      <div class="flex-1">
        <h3 class="text-foreground mb-2 text-lg font-semibold">
          라이선스
        </h3>

        <div class="text-muted-foreground space-y-2 text-sm">
          
          <p>
            <strong>저작자:</strong>
            류재훈
          </p>
          

          <p>
            <strong>링크:</strong>
            <a
              href="http://192.168.1.11:1314/posts/Hydragen-High-Throughput-LLM-Inference-with-Shared-Prefixes/"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              http://192.168.1.11:1314/posts/Hydragen-High-Throughput-LLM-Inference-with-Shared-Prefixes/
            </a>
          </p>

          <p>
            <strong>라이선스:</strong>
            <a
              href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              CC BY-NC-SA 4.0
            </a>
          </p>

          <p class="text-xs">
            이 저작물은 크리에이티브 커먼즈 저작자표시-비영리-동일조건변경허락 4.0 국제 라이선스에 따라 이용할 수 있습니다. 출처를 표시하고, 비영리 목적으로만 사용하며, 동일한 라이선스를 유지해야 합니다.
          </p>
        </div>
      </div>
    </div>
  </div>


  
  





  <nav
    class="post-navigation mb-12"
    aria-label="게시글 네비게이션">
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
      
      <div class="nav-item">
        
          <a
            href="/posts/QUICK-Quantization-aware-Interleaving-and-Conflict-free-Kernel-for-efficient-LLM-inference/"
            class="group bg-card border-border hover:bg-primary/5 hover:border-primary/20 focus:ring-primary/20 flex min-h-[140px] flex-col justify-between rounded-xl border p-6 transition-all duration-300 ease-out hover:-translate-y-1 hover:scale-[1.02] hover:shadow-lg focus:ring-2 focus:outline-none">
            <div>
              <div class="mb-3 flex items-center gap-3">
                
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
</svg>
                <span class="text-muted-foreground text-sm font-medium">
                  이전
                </span>
              </div>

              <h3
                class="text-foreground group-hover:text-primary mb-3 line-clamp-2 text-lg leading-tight font-semibold transition-colors duration-200">
                QUICK: Quantization-aware Interleaving and Conflict-free Kernel for efficient LLM inference
              </h3>
            </div>

            <div
              class="text-muted-foreground mt-auto flex items-center gap-2 text-xs">
              
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
              <time datetime="2024-12-14">
                12月14日
              </time>
            </div>
          </a>
        
      </div>

      
      <div class="nav-item">
        
          <a
            href="/posts/Get-More-with-LESS-Synthesizing-Recurrence-with-KV-Cache-Compression-for-Efficient-LLM-Inferenc/"
            class="group bg-card border-border hover:bg-primary/5 hover:border-primary/20 focus:ring-primary/20 flex min-h-[140px] flex-col justify-between rounded-xl border p-6 transition-all duration-300 ease-out hover:-translate-y-1 hover:scale-[1.02] hover:shadow-lg focus:ring-2 focus:outline-none">
            <div>
              <div class="mb-3 flex items-center justify-end gap-3">
                <span class="text-muted-foreground text-sm font-medium">
                  다음
                </span>
                
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg>
              </div>

              <h3
                class="text-foreground group-hover:text-primary mb-3 line-clamp-2 text-right text-lg leading-tight font-semibold transition-colors duration-200">
                Get More with LESS: Synthesizing Recurrence with KV Cache Compression for Efficient LLM Inferenc
              </h3>
            </div>

            <div
              class="text-muted-foreground mt-auto flex items-center justify-end gap-2 text-xs">
              <time datetime="2024-12-14">
                12月14日
              </time>
              
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
            </div>
          </a>
        
      </div>
    </div>
  </nav>




  
  










  
  


    </main>

    <footer class="mx-auto max-w-4xl px-4 py-8">
  <div class="px-6 py-6">
    
    
      <nav class="mb-6">
        <div class="flex flex-wrap items-center justify-center gap-1">
          
            
            
            
            <a
              href="/index.xml"
              
              class="nav-link hover:text-primary hover:bg-primary/10 text-muted-foreground flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="RSS Feed">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z" />

</svg>
              
              <span
                >
                  RSS Feed
                </span
              >
            </a>
          
        </div>
      </nav>
    


    
    
      <div class="border-border mb-6 border-t"></div>
    


    
    <div class="flex flex-col items-center justify-between gap-4 md:flex-row">
      
      <div class="text-muted-foreground text-sm">
        <p>
          &copy; 2025 Jaehun&#39;s Blog.
          모든 권리 보유.
        </p>
      </div>

      
      
        <div class="flex items-center gap-3">
          
            <a
              href="https://github.com/ryujaehun"
              
                target="_blank" rel="noopener noreferrer"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="GitHub"
              aria-label="GitHub">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="GitHub"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></svg>
              
            </a>
          
            <a
              href="https://www.linkedin.com/in/jaehunryu/"
              
                target="_blank" rel="noopener noreferrer"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="Linkedin"
              aria-label="Linkedin">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="Linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2a2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg>
              
            </a>
          
            <a
              href="mailto:jaehunryu@icloud.com"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="Email"
              aria-label="Email">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="Email">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg>
              
            </a>
          
        </div>
      

    </div>
  </div>
</footer>


    
    



<div
  id="dock"
  class="pointer-events-none fixed bottom-4 left-1/2 z-[9999] w-fit -translate-x-1/2 translate-y-24 opacity-0 transition-all duration-300 ease-out sm:right-0 sm:left-0 sm:mx-auto sm:translate-x-0"
  role="toolbar"
  aria-label="바로가기 도구 모음">
  <nav
    class="border-border bg-card/80 scrollbar-hide xs:px-3 xs:py-2 mx-auto flex max-w-[calc(100vw-2rem)] min-w-fit items-center justify-center overflow-x-auto rounded-2xl border px-4 py-3 shadow-lg backdrop-blur-sm sm:px-4 sm:py-3">
    
    
      <button
        id="dock-back"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
        title="뒤로"
        aria-label="뒤로">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path d="m12 19-7-7 7-7"/>
  <path d="M19 12H5"/>

</svg>
        <span class="hidden sm:inline"
          >뒤로</span
        >
      </button>

      
      <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>
    


    
    
      <button
        id="dock-toc"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
        title="목차"
        aria-label="목차">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <line x1="8" x2="21" y1="6" y2="6"/>
  <line x1="8" x2="21" y1="12" y2="12"/>
  <line x1="8" x2="21" y1="18" y2="18"/>
  <line x1="3" x2="3.01" y1="6" y2="6"/>
  <line x1="3" x2="3.01" y1="12" y2="12"/>
  <line x1="3" x2="3.01" y1="18" y2="18"/>

</svg>
        <span class="hidden sm:inline"
          >목차</span
        >
      </button>

      
      <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>
    


    
    <button
      id="dock-search"
      class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-3 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-4 sm:py-2"
      title="검색"
      aria-label="검색">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
      <span class="hidden md:inline"
        >검색</span
      >
    </button>

    
    <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>

    
    
    


    
    <button
      id="dock-top"
      class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
      title="맨 위로"
      aria-label="맨 위로">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path d="m18 15-6-6-6 6"/>

</svg>
      <span class="hidden sm:inline"
        >맨 위로</span
      >
    </button>
  </nav>
</div>


    
      



<div
  id="toc-overlay"
  class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-all duration-300"
  role="dialog"
  aria-modal="true"
  aria-labelledby="toc-title"></div>


<div
  id="toc-card"
  class="pointer-events-none fixed inset-4 z-50 flex w-auto scale-95 items-center justify-center opacity-0 transition-all duration-300 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:block sm:w-full sm:max-w-md sm:-translate-x-1/2 sm:-translate-y-1/2"
  role="dialog"
  aria-modal="true"
  aria-labelledby="toc-title">
  <div
    class="bg-card border-border w-full max-w-sm overflow-hidden rounded-xl border shadow-xl sm:max-w-md">
    
    <div
      class="border-border bg-muted/30 flex items-center justify-between border-b p-4">
      <div class="flex items-center gap-3">
        
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <line x1="8" x2="21" y1="6" y2="6"/>
  <line x1="8" x2="21" y1="12" y2="12"/>
  <line x1="8" x2="21" y1="18" y2="18"/>
  <line x1="3" x2="3.01" y1="6" y2="6"/>
  <line x1="3" x2="3.01" y1="12" y2="12"/>
  <line x1="3" x2="3.01" y1="18" y2="18"/>

</svg>
        <h2 id="toc-title" class="text-foreground text-lg font-semibold">
          목차
        </h2>
      </div>

      
      <button
        id="toc-close"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 rounded-lg p-2 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"
        title="닫기"
        aria-label="닫기">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
      </button>
    </div>

    
    <div class="max-h-96 overflow-y-auto p-4">
      <nav
        id="toc-nav"
        class="toc-scrollbar"
        aria-label="글 목차">
          
          <div id="toc-content">
            <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#논문의-핵심-요약"><strong>논문의 핵심 요약</strong></a></li>
        <li><a href="#강점"><strong>강점</strong></a></li>
        <li><a href="#독창성"><strong>독창성</strong></a></li>
        <li><a href="#핵심-알고리즘-예시"><strong>핵심 알고리즘 예시</strong></a>
          <ul>
            <li><a href="#1-문제-정의"><strong>1. 문제 정의</strong></a></li>
            <li><a href="#2-단계별-과정"><strong>2. 단계별 과정</strong></a></li>
          </ul>
        </li>
        <li><a href="#한계점"><strong>한계점</strong></a></li>
        <li><a href="#결론"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#hydragen-알고리즘의-핵심"><strong>Hydragen 알고리즘의 핵심</strong></a></li>
        <li><a href="#예시를-통한-설명"><strong>예시를 통한 설명</strong></a>
          <ul>
            <li><a href="#1-문제-설정"><strong>1. 문제 설정</strong></a></li>
            <li><a href="#2-단계별-계산"><strong>2. 단계별 계산</strong></a></li>
          </ul>
        </li>
        <li><a href="#정리"><strong>정리</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#논문에서-제시한-결과와-다른-방법론과의-비교"><strong>논문에서 제시한 결과와 다른 방법론과의 비교</strong></a>
          <ul>
            <li><a href="#핵심-성능-결과"><strong>핵심 성능 결과</strong></a></li>
            <li><a href="#결과-비교표"><strong>결과 비교표</strong></a></li>
          </ul>
        </li>
        <li><a href="#특출난-점"><strong>특출난 점</strong></a></li>
        <li><a href="#이러한-결과를-도출한-핵심-요인"><strong>이러한 결과를 도출한 핵심 요인</strong></a>
          <ul>
            <li><a href="#논문에서-제시하는-주요-이유">논문에서 제시하는 주요 이유:</a></li>
          </ul>
        </li>
        <li><a href="#내-생각-이-방법의-장점과-제약"><strong>내 생각: 이 방법의 장점과 제약</strong></a></li>
        <li><a href="#결론-1"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#시나리오-1-공통-프리픽스를-포함한-배치-입력"><strong>시나리오 1: 공통 프리픽스를 포함한 배치 입력</strong></a>
          <ul>
            <li><a href="#예시"><strong>예시</strong>:</a></li>
            <li><a href="#vllm-처리-과정"><strong>vLLM 처리 과정</strong></a></li>
            <li><a href="#hydragen-처리-과정"><strong>Hydragen 처리 과정</strong></a></li>
          </ul>
        </li>
        <li><a href="#시나리오-2-공통-프리픽스가-없는-독립적인-배치"><strong>시나리오 2: 공통 프리픽스가 없는 독립적인 배치</strong></a>
          <ul>
            <li><a href="#예시-1"><strong>예시</strong>:</a></li>
            <li><a href="#vllm-처리-과정-1"><strong>vLLM 처리 과정</strong></a></li>
            <li><a href="#hydragen-처리-과정-1"><strong>Hydragen 처리 과정</strong></a></li>
          </ul>
        </li>
        <li><a href="#비교-결과"><strong>비교 결과</strong></a></li>
        <li><a href="#장점"><strong>장점</strong></a></li>
        <li><a href="#단점"><strong>단점</strong></a></li>
        <li><a href="#결론-2"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#hydragen의-주요-접근-방식"><strong>Hydragen의 주요 접근 방식</strong></a></li>
        <li><a href="#vllm-대비-compute-utilization의-향상"><strong>vLLM 대비 Compute Utilization의 향상</strong></a>
          <ul>
            <li><a href="#1-vllm의-한계">1. <strong>vLLM의 한계</strong>:</a></li>
            <li><a href="#2-hydragen의-개선">2. <strong>Hydragen의 개선</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#결론-3"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#hydragen-구현-시-기존-방법에서-추가적으로-필요한-구현-요소"><strong>Hydragen 구현 시 기존 방법에서 추가적으로 필요한 구현 요소</strong></a></li>
        <li><a href="#추가적으로-필요한-구현"><strong>추가적으로 필요한 구현</strong></a></li>
        <li><a href="#소요-공수-분석"><strong>소요 공수 분석</strong></a></li>
        <li><a href="#추가-컴퓨팅-자원의-요구"><strong>추가 컴퓨팅 자원의 요구</strong></a></li>
        <li><a href="#예상-성능-개선"><strong>예상 성능 개선</strong></a></li>
        <li><a href="#결론-4"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#논문의-입력-데이터와-추론-과정"><strong>논문의 입력 데이터와 추론 과정</strong></a>
          <ul>
            <li><a href="#1-입력-데이터"><strong>1. 입력 데이터</strong></a></li>
            <li><a href="#입력-데이터-예시"><strong>입력 데이터 예시</strong>:</a></li>
            <li><a href="#입력-데이터의-처리-방식"><strong>입력 데이터의 처리 방식</strong>:</a></li>
            <li><a href="#2-추론-과정"><strong>2. 추론 과정</strong></a></li>
          </ul>
        </li>
        <li><a href="#모델-아키텍처"><strong>모델 아키텍처</strong></a>
          <ul>
            <li><a href="#transformer-아키텍처-구성-요소"><strong>Transformer 아키텍처 구성 요소</strong></a></li>
          </ul>
        </li>
        <li><a href="#연산-및-메모리-요구량"><strong>연산 및 메모리 요구량</strong></a>
          <ul>
            <li><a href="#1-연산-요구량"><strong>1. 연산 요구량</strong></a></li>
            <li><a href="#2-메모리-요구량"><strong>2. 메모리 요구량</strong></a></li>
          </ul>
        </li>
        <li><a href="#컴퓨팅-자원-요구량"><strong>컴퓨팅 자원 요구량</strong></a></li>
        <li><a href="#결론-5"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#이-논문의-한계와-이를-극복하기-위한-연구-흐름"><strong>이 논문의 한계와 이를 극복하기 위한 연구 흐름</strong></a></li>
        <li><a href="#1-공통-프리픽스가-없는-경우-성능-저하"><strong>1. 공통 프리픽스가 없는 경우 성능 저하</strong></a>
          <ul>
            <li><a href="#한계-설명"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#2-서픽스-최적화의-부재"><strong>2. 서픽스 최적화의 부재</strong></a>
          <ul>
            <li><a href="#한계-설명-1"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향-1"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#3-동적-배치-처리-미지원"><strong>3. 동적 배치 처리 미지원</strong></a>
          <ul>
            <li><a href="#한계-설명-2"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향-2"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#4-매우-긴-컨텍스트에서-메모리-사용-증가"><strong>4. 매우 긴 컨텍스트에서 메모리 사용 증가</strong></a>
          <ul>
            <li><a href="#한계-설명-3"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향-3"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#5-긴-프리픽스와-긴-서픽스-간의-균형-문제"><strong>5. 긴 프리픽스와 긴 서픽스 간의 균형 문제</strong></a>
          <ul>
            <li><a href="#한계-설명-4"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향-4"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#6-구현-및-유지보수-복잡성"><strong>6. 구현 및 유지보수 복잡성</strong></a>
          <ul>
            <li><a href="#한계-설명-5"><strong>한계 설명</strong>:</a></li>
            <li><a href="#극복-방향-5"><strong>극복 방향</strong>:</a></li>
          </ul>
        </li>
        <li><a href="#결론-6"><strong>결론</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </nav>
    </div>

    
    <div class="border-border bg-muted/20 border-t px-4 py-3">
      <div class="text-muted-foreground text-center text-xs">
        <span>제목을 클릭하면 해당 위치로 이동합니다</span>
      </div>
    </div>
  </div>
</div>

    


  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
    integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP"
    crossorigin="anonymous" />
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
    integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"
    crossorigin="anonymous"></script>
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
    integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh"
    crossorigin="anonymous"></script>

<script>
    
    function initKaTeX() {
        if (typeof renderMathInElement === 'undefined') {
            setTimeout(initKaTeX, 100);
            return;
        }

        var delimiters = [{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"}];

        renderMathInElement(document.body, {
            delimiters: delimiters,
            throwOnError: false,
            errorColor: '#cc0000',
            fleqn: false,
            leqno: false,
            trust: false
        });
    }

    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initKaTeX);
    } else {
        initKaTeX();
    }
</script>
    



    
    
<div
  id="search-overlay"
  class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 transition-opacity duration-300"></div>


<div
  id="search-modal"
  class="bg-card border-border pointer-events-none fixed top-1/2 left-1/2 z-50 max-h-[80vh] w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 scale-95 transform overflow-hidden rounded-xl border opacity-0 shadow-xl transition-all duration-300">
  
  <div class="border-border flex items-center gap-3 border-b p-4">
    
    <div class="text-muted-foreground h-5 w-5 flex-shrink-0">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
    </div>

    
    <div class="relative flex-1">
      
      <button
        id="search-clear"
        class="text-muted-foreground hover:text-foreground hover:bg-muted/50 pointer-events-none absolute top-1/2 left-0 z-10 h-5 w-5 -translate-y-1/2 rounded opacity-0 transition-all duration-200"
        title="지우기"
        aria-label="지우기">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
      </button>

      
      <input
        id="search-input"
        type="text"
        placeholder="게시글 검색..."
        class="text-foreground placeholder:text-muted-foreground w-full border-none bg-transparent pl-8 text-lg outline-none"
        autocomplete="off"
        spellcheck="false" />
    </div>

    
    <button
      id="search-close"
      class="text-muted-foreground hover:text-foreground hover:bg-muted/50 flex h-6 w-6 items-center justify-center rounded-md p-0.5 transition-all duration-200"
      title="닫기"
      aria-label="닫기">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
    </button>
  </div>

  
  <div id="search-results" class="max-h-96 overflow-y-auto">
    
    <div
      id="search-empty"
      class="flex flex-col items-center justify-center py-12 text-center">
      <div
        class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
      </div>
      <h3 class="text-foreground mb-2 text-lg font-semibold">
        검색 시작
      </h3>
      <p class="text-muted-foreground text-sm">
        검색어를 입력하세요
      </p>
    </div>

    
    <div
      id="search-loading"
      class="flex hidden items-center justify-center py-8">
      <div
        class="mr-3 h-6 w-6 animate-spin rounded-full border-2 border-current border-t-transparent"></div>
      <span class="text-muted-foreground"
        >검색 중...</span
      >
    </div>

    
    <div
      id="search-no-results"
      class="flex hidden flex-col items-center justify-center py-12 text-center">
      <div
        class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
</svg>
      </div>
      <h3 class="text-foreground mb-2 text-lg font-semibold">
        검색 결과 없음
      </h3>
      <p class="text-muted-foreground text-sm">
        다른 검색어로 시도해보세요
      </p>
    </div>

    
    <div id="search-results-list" class="hidden">
      
      <div
        id="search-stats"
        class="text-muted-foreground border-border border-b px-4 py-3 text-sm"
        data-template="%d개의 결과 찾음">
      </div>

      
      <div id="search-items" class="divide-border divide-y">
        
      </div>
    </div>
  </div>

  
  <div class="border-border bg-muted/20 border-t px-4 py-3">
    <div
      class="text-muted-foreground flex items-center justify-between text-xs">
      <div class="flex items-center gap-2 md:gap-4">
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >↑↓</kbd
          >
          <span class="hidden sm:inline"
            >이동</span
          >
        </div>
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >↵</kbd
          >
          <span class="hidden sm:inline"
            >선택</span
          >
        </div>
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >ESC</kbd
          >
          <span class="hidden sm:inline"
            >닫기</span
          >
        </div>
      </div>
      <div class="search-hint-desktop flex items-center gap-1">
        <kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
          >⌘K</kbd
        >
        <span>단축키</span>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
