<!doctype html>
<html
  lang="ko-kr"
  data-theme="claude">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>MoEUT: Mixture-of-Experts Universal Transformers | Jaehun&#39;s Blog</title>

<meta name="description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 ✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘) MoEUT..." />
<meta name="keywords" content="개발, 컴파일러, 프로그래밍, 에세이" />
<meta name="author" content="" />
<meta name="language" content="ko-kr" />

<meta name="robots" content="index, follow" />
<link rel="canonical" href="http://192.168.1.11:1314/posts/MoEUT-Mixture-of-Experts-Universal-Transformers/" />



  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />



<link rel="manifest" href="/site.webmanifest" />
<meta property="og:url" content="http://192.168.1.11:1314/posts/MoEUT-Mixture-of-Experts-Universal-Transformers/">
  <meta property="og:site_name" content="Jaehun&#39;s Blog">
  <meta property="og:title" content="MoEUT: Mixture-of-Experts Universal Transformers">
  <meta property="og:description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 ✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘) MoEUT는 Universal Transformer(UT)의 구조적 강점(레이어 파라미터 공유 기반의 recurrence)을 유지하면서도 기존 한계였던 parameter-compute ratio 문제를 해결한 구조다. 핵심은 다음 세 가지다:">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-13T00:00:00+00:00">
    <meta property="og:image" content="http://192.168.1.11:1314/images/og-default.avif">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://192.168.1.11:1314/images/og-default.avif">
  <meta name="twitter:title" content="MoEUT: Mixture-of-Experts Universal Transformers">
  <meta name="twitter:description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 ✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘) MoEUT는 Universal Transformer(UT)의 구조적 강점(레이어 파라미터 공유 기반의 recurrence)을 유지하면서도 기존 한계였던 parameter-compute ratio 문제를 해결한 구조다. 핵심은 다음 세 가지다:">


  <meta itemprop="name" content="MoEUT: Mixture-of-Experts Universal Transformers">
  <meta itemprop="description" content="논문 링크
Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘 ✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘) MoEUT는 Universal Transformer(UT)의 구조적 강점(레이어 파라미터 공유 기반의 recurrence)을 유지하면서도 기존 한계였던 parameter-compute ratio 문제를 해결한 구조다. 핵심은 다음 세 가지다:">
  <meta itemprop="datePublished" content="2025-04-13T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-04-13T00:00:00+00:00">
  <meta itemprop="wordCount" content="11281">
  <meta itemprop="image" content="http://192.168.1.11:1314/images/og-default.avif">
  <meta itemprop="keywords" content="Paper-Review,With-Gpt">







<script>
  window.HUGO_SEARCH_CONFIG = {
    searchIndexURL: "\"/index.json\""
  };
</script>


































<script>

  window.HUGO_GALLERY_CONFIG = {
    justified_gallery:  false ,
    lightbox:  false ,
    justified: "{}",
    lightbox_options: "{}"
  };
</script>




  
    <link rel="stylesheet" href="/css/compiled.css" />
  





  
    <link rel="stylesheet" href="/css/chroma.css" />
  












      <script src="/js/main.js"></script>



  <script src="/js/gumshoe.polyfills.min.js"></script>



        <script src="/js/toc.js" defer></script>



      <script src="/js/search.js" defer></script>



      <script src="/js/dock.js" defer></script>











  











    <script>
      
      (function() {
        const theme = localStorage.getItem('theme') || 'system';
        const colorScheme = localStorage.getItem('colorScheme') || 'claude';

        
        document.documentElement.setAttribute('data-theme', colorScheme);

        
        function applyTheme() {
          if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }

        applyTheme();

        
        if (theme === 'system') {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground min-h-screen antialiased">
    
    
  <div
    id="reading-progress-container"
    class="reading-progress-container pointer-events-none fixed top-0 right-0 left-0 z-50 transition-opacity duration-300 ease-out"
    data-height="3"
    data-smooth-scroll="true"
    data-hide-on-complete="false">
    
    <div class="reading-progress-bg w-full"></div>

    
    <div
      id="reading-progress-bar"
      class="from-primary to-primary/80 reading-progress-bar 
        transition-all duration-150 ease-out
       absolute top-0 left-0 w-0 bg-gradient-to-r"></div>
  </div>

  <script>
    (function () {
      "use strict";

      const progressContainer = document.getElementById(
        "reading-progress-container",
      );
      const progressBar = document.getElementById("reading-progress-bar");

      if (!progressContainer || !progressBar) return;

      
      const config = {
        smoothScroll: progressContainer.dataset.smoothScroll === "true",
        hideOnComplete: progressContainer.dataset.hideOnComplete === "true",
      };

      let isVisible = true;
      let gumshoeInstance = null;

      
      function calculateProgress() {
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;
        const documentHeight = document.documentElement.scrollHeight;
        const windowHeight = window.innerHeight;
        const scrollableHeight = documentHeight - windowHeight;

        if (scrollableHeight <= 0) return 0;

        return Math.min(Math.max((scrollTop / scrollableHeight) * 100, 0), 100);
      }

      
      function updateProgress() {
        const progress = calculateProgress();
        progressBar.style.width = progress + "%";

        
        if (config.hideOnComplete && progress >= 99.5) {
          if (isVisible) {
            progressContainer.style.opacity = "0";
            isVisible = false;
          }
        } else if (!isVisible) {
          progressContainer.style.opacity = "1";
          isVisible = true;
        }
      }

      
      let ticking = false;
      function requestTick() {
        if (!ticking) {
          requestAnimationFrame(() => {
            updateProgress();
            ticking = false;
          });
          ticking = true;
        }
      }

      
      function init() {
        
        window.addEventListener("scroll", requestTick, { passive: true });
        window.addEventListener("resize", requestTick, { passive: true });
        document.addEventListener("visibilitychange", () => {
          if (!document.hidden) requestTick();
        });

        
        requestTick();

        
        window.addEventListener("beforeunload", () => {
          window.removeEventListener("scroll", requestTick);
          window.removeEventListener("resize", requestTick);
        });
      }

      
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    })();
  </script>

    <header class="sticky top-0 z-50 mx-auto max-w-4xl px-4 py-6">
  <div
    class="border-border bg-card/80 flex items-center rounded-xl border px-6 py-4 shadow-sm backdrop-blur-sm">
    
    <div class="hidden w-full items-center md:flex">
      
      <div class="flex items-center">
        
          
          <a
            href="/"
            class="bg-primary text-primary-foreground hover:bg-primary/90 flex h-10 w-10 items-center justify-center rounded-full text-lg font-bold transition-transform duration-200 hover:scale-105"
            aria-label="Jaehun&#39;s Blog">
            J
          </a>
        
      </div>

      
      <nav class="mx-8 flex flex-1 items-center justify-center">
        <div class="flex items-center space-x-1">
          
          
            
            
            
              
                
              
            
            
            <a
              href="/posts/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.posts">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
              
              <span
                >
                  게시글
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/categories/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.categories">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />

</svg>
              
              <span
                >
                  카테고리
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/tags/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.tags">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />

</svg>
              
              <span
                >
                  태그
                </span
              >
            </a>
          
            
            
            
              
                
              
            
            
            <a
              href="/archives/"
              class="nav-link 
                text-muted-foreground hover:text-primary hover:bg-primary/10
               focus:ring-primary/20 relative flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.archives">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />

</svg>
              
              <span
                >
                  아카이브
                </span
              >
            </a>
          
        </div>
      </nav>

      
      <div class="flex items-center space-x-2">
        
        
<div class="relative">
  <button id="language-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="language"
    aria-label="언어 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="언어 변경">
	<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8l6 6m-7 0l6-6l2-3M2 5h12M7 2h1m14 20l-5-10l-5 10m2-4h6" />
</svg></button>

  
  <div id="language-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="language"
    role="menu"
    aria-labelledby="language-toggle"><a href="/ko/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem" aria-current="true"><span class="font-medium">한국어</span></a><a href="/en/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem"><span class="font-medium">English</span></a></div>
</div>

        
        
<div class="relative">
  <button id="color-scheme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="color-scheme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="테마 변경">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z" />

</svg></button>

  
  <div id="color-scheme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="color-scheme"><button data-color-scheme="claude" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme="default" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme="bumblebee" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme="emerald" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme="nord" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme="sunset" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme="abyss" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme="dracula" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme="amethyst" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme="slate" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme="twitter" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div>
</div>

        
        
<div class="relative">
  <button id="theme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="theme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
      
  <svg class="h-5 w-5 sun-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg>
      
      
  <svg class="h-5 w-5 moon-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg>
      
      
  <svg class="h-5 w-5 system-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg></button>

  
  <div id="theme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="theme"><button data-theme="light" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg><span>라이트</span></button><button data-theme="dark" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg><span>다크</span></button><button data-theme="system" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg><span>시스템</span></button></div>
</div>
      </div>
    </div>

    
    <div class="flex w-full items-center justify-between md:hidden">
      
      
<div class="relative">
  <button
    id="mobile-menu-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:bg-accent hover:text-foreground flex h-10 w-10 items-center justify-center rounded-lg border transition-colors duration-200"
    data-dropdown-type="mobile-menu"
    aria-label="메뉴"
    aria-expanded="false"
    aria-haspopup="true">
    
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="메뉴">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />

</svg>
  </button>

  
  <div
    id="mobile-menu"
    class="mobile-menu dropdown-menu border-border bg-popover/95 absolute top-12 left-0 z-[60] hidden w-80 max-w-[calc(100vw-2rem)] rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out md:hidden"
    data-dropdown-type="mobile-menu"
    role="menu"
    aria-labelledby="mobile-menu-toggle">
    <nav class="flex flex-col">
      
      
        
        
        
          
            
          
        
        
        <a
          href="/posts/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.posts">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
          
          <span
            >
              게시글
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/categories/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.categories">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />

</svg>
          
          <span
            >
              카테고리
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/tags/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.tags">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />

</svg>
          
          <span
            >
              태그
            </span
          >
        </a>
      
        
        
        
          
            
          
        
        
        <a
          href="/archives/"
          class="nav-link 
            text-muted-foreground hover:text-primary hover:bg-primary/10
           focus:ring-primary/20 relative flex items-center gap-3 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200 ease-out hover:translate-x-1 focus:ring-2 focus:outline-none"
          role="menuitem"
          >
          
            
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="nav.archives">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />

</svg>
          
          <span
            >
              아카이브
            </span
          >
        </a>
      
    </nav>
  </div>
</div>


      
      <div class="flex items-center space-x-2">
        
        
<div class="relative">
  <button id="language-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="language"
    aria-label="언어 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="언어 변경">
	<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 8l6 6m-7 0l6-6l2-3M2 5h12M7 2h1m14 20l-5-10l-5 10m2-4h6" />
</svg></button>

  
  <div id="language-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="language"
    role="menu"
    aria-labelledby="language-toggle"><a href="/ko/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem" aria-current="true"><span class="font-medium">한국어</span></a><a href="/en/" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none" role="menuitem"><span class="font-medium">English</span></a></div>
</div>

        
        
<div class="relative">
  <button id="color-scheme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="color-scheme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
  <svg class="h-5 w-5 relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="테마 변경">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v6a2 2 0 002 2h4a2 2 0 002-2V5z" />

</svg></button>

  
  <div id="color-scheme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-44 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="color-scheme"><button data-color-scheme="claude" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Default</span></button><button data-color-scheme="default" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>White</span></button><button data-color-scheme="bumblebee" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Bumblebee</span></button><button data-color-scheme="emerald" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Emerald</span></button><button data-color-scheme="nord" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Nord</span></button><button data-color-scheme="sunset" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Sunset</span></button><button data-color-scheme="abyss" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Abyss</span></button><button data-color-scheme="dracula" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Dracula</span></button><button data-color-scheme="amethyst" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Amethyst</span></button><button data-color-scheme="slate" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Slate</span></button><button data-color-scheme="twitter" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none"><span>Twitter</span></button></div>
</div>

        
        
<div class="relative">
  <button id="theme-toggle"
    class="dropdown-toggle border-border bg-background text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex h-10 w-10 items-center justify-center rounded-lg border transition-all duration-300 ease-out hover:scale-105 focus:ring-2 focus:outline-none active:scale-95"
    data-dropdown-type="theme"
    aria-label="테마 변경"
    aria-expanded="false"
    aria-haspopup="true">
      
      
  <svg class="h-5 w-5 sun-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg>
      
      
  <svg class="h-5 w-5 moon-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg>
      
      
  <svg class="h-5 w-5 system-icon hidden relative z-10"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg></button>

  
  <div id="theme-dropdown"
    class="dropdown-menu border-border bg-popover/95 absolute top-12 right-0 z-[60] hidden w-40 rounded-lg border p-1 shadow-lg backdrop-blur-sm transition-all duration-200 ease-out"
    data-dropdown-type="theme"><button data-theme="light" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이트">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />

</svg><span>라이트</span></button><button data-theme="dark" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="다크">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />

</svg><span>다크</span></button><button data-theme="system" class="text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground flex w-full items-center rounded-md px-4 py-2 text-sm transition-all duration-200 ease-out focus:outline-none">
  <svg class="h-5 w-5 mr-3 h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="시스템">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg><span>시스템</span></button></div>
</div>
      </div>
    </div>
  </div>
</header>


    <main class="mx-auto max-w-4xl px-4 py-6">
      
  
  <nav
  class="breadcrumb mb-4 md:mb-6 py-1"
  aria-label="경로">
  <ol class="text-muted-foreground flex items-center space-x-1 md:space-x-2 text-sm overflow-x-auto whitespace-nowrap scrollbar-hide py-1">
    
    <li class="flex-shrink-0">
      <a
        href="/"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02]">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="홈">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />

</svg>
        <span class="max-w-[4rem] md:max-w-none truncate">홈</span>
      </a>
    </li>

    
    
      <li class="flex items-center gap-1 md:gap-2 min-w-0">
        <span class="text-muted-foreground/50 flex-shrink-0"
          >
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg>
        </span>

        
          
          <div class="flex items-center gap-1 md:gap-2 min-w-0">
            
              
              <a
                href="/posts"
                class="text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-0.5 md:gap-1 rounded-lg px-1 md:px-3 py-0.5 md:py-1.5 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-[1.02] flex-shrink-0">
                
                  
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />

</svg>
                  <span class="max-w-[3rem] md:max-w-none truncate">게시글</span>
                
              </a>
              <span class="text-muted-foreground/50 flex-shrink-0"
                >
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg></span
              >
            
            
            <span class="text-foreground flex items-center gap-0.5 md:gap-1 font-medium min-w-0">
              
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
</svg>
              <span class="max-w-[8rem] md:max-w-[16rem] lg:max-w-none truncate">MoEUT: Mixture-of-Experts Universal Transformers</span>
            </span>
          </div>
        
      </li>
    

  </ol>
</nav>



  


  
  <header class="mb-8">
    


<div class="post-meta">
  
  <h1 class="text-foreground mb-6 text-3xl leading-tight font-bold md:text-4xl">
    MoEUT: Mixture-of-Experts Universal Transformers
  </h1>

  
  


  
  <div class="bg-card border-border flex flex-col gap-4 rounded-xl border p-6">
    
    <div
      class="text-muted-foreground flex flex-wrap items-center gap-4 text-sm">
      
      <div class="flex items-center gap-2">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="작성일"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
        <time datetime="2025-04-13">
          2025년 04월 13일
        </time>
      </div>

      
      


      
      
        <div class="flex items-center gap-2">
          
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="읽는 시간"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
          <span
            >23 분</span
          >
        </div>
      


      
      
        <div class="flex items-center gap-2">
          
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="단어 수"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
</svg>
          <span>11281 단어</span>
        </div>
      

    </div>

    
    
      <div class="flex flex-wrap items-center gap-4">
        
        
          <div class="flex items-center gap-2">
            
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="카테고리"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
</svg>
            <span class="text-muted-foreground mr-2 text-sm"
              >카테고리:</span
            >
            <div class="flex flex-wrap gap-2">
              
                <a
                  href="/categories/paper-review/"
                  class="bg-primary/10 text-primary hover:bg-primary/20 focus:ring-primary/20 inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 hover:shadow-md focus:ring-2 focus:outline-none">
                  paper-review
                </a>
              
                <a
                  href="/categories/with-gpt/"
                  class="bg-primary/10 text-primary hover:bg-primary/20 focus:ring-primary/20 inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 hover:shadow-md focus:ring-2 focus:outline-none">
                  with-gpt
                </a>
              
            </div>
          </div>
        


        
        

      </div>
    


    
    

  </div>
</div>

  </header>

  
  <article class="prose prose-neutral dark:prose-invert mb-12 max-w-none">
    <p><a href="https://arxiv.org/abs/2405.16039v2">논문 링크</a></p>
<h1 id="q--이-논문을-아주-자세하게-읽고-논문의-강점과-독창적인-지점을-설명해주고-핵심-알고리즘을-예시-입력을-들어서-전체적인-과정을-설명해줘-추가적으로-논문의-한계점에-대해서도-알려줘">Q : 이 논문을 아주 자세하게 읽고 논문의 강점과 독창적인 지점을 설명해주고 핵심 알고리즘을 예시 입력을 들어서 전체적인 과정을 설명해줘 추가적으로 논문의 한계점에 대해서도 알려줘</h1>
<h3 id="-결론-요약-핵심-강점-독창성-핵심-메커니즘">✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘)</h3>
<p><strong>MoEUT</strong>는 Universal Transformer(UT)의 구조적 강점(레이어 파라미터 공유 기반의 recurrence)을 유지하면서도 기존 한계였던 <strong>parameter-compute ratio 문제</strong>를 해결한 구조다. 핵심은 다음 세 가지다:</p>
<ol>
<li>**Mixture-of-Experts (MoE)**를 Feedforward와 Attention 양쪽에 사용해 <strong>파라미터 수는 늘리고 연산량은 줄이는 sparse 계산</strong> 가능.</li>
<li><strong>Layer Grouping</strong>으로 단일 shared-layer가 가진 expressive power 부족을 해결.</li>
<li><strong>Peri-layernorm</strong>으로 gradient flow와 residual scaling 문제를 동시에 해결.</li>
</ol>
<p><strong>⇒ 결과적으로</strong>, 같은 파라미터 수나 MACs 기준에서 MoEUT는 기존 Transformer를 소폭 상회하며, 특히 compute efficiency 측면에서 우수함을 보인다.</p>
<hr>
<h3 id="-핵심-구성-요소와-알고리즘-설명-예시-포함">🔍 핵심 구성 요소와 알고리즘 설명 (예시 포함)</h3>
<h4 id="1-σ-moe-기반-feedforward-block">1. σ-MoE 기반 Feedforward Block</h4>
<ul>
<li>각 layer는 NE개의 <strong>작은 expert</strong> (dexpert=128)를 가지며, top-K (K ≈ dmodel/dexpert) expert를 선택해 계산.</li>
</ul>
<p><strong>입력 예시:</strong></p>
<ul>
<li><code>xt</code> ∈ ℝ^dmodel (토큰 t의 embedding)</li>
<li>Expert 선택:<br>
[
s_t = σ(x_t W_S) \in ℝ^{NE}
]
상위 K개의 expert ID 선택:<br>
[
E(x_t) = \text{TopK}(s_t, K)
]</li>
<li>Output 계산:<br>
[
y_t = \sum_{e \in E(x_t)} s_t[e] \cdot \text{ReLU}(x_t W_1^e) W_2^e
]</li>
</ul>
<p>→ Expert selection에 entropy-based regularization 추가:
[
L = \sum_{e=1}^{NE} p[e] \log p[e], \quad p = \frac{1}{T} \sum_{t=1}^{T} \text{softmax}(x_t W_S)
]</p>
<h4 id="2-moe-self-attention-switchhead">2. MoE Self-Attention (SwitchHead)</h4>
<ul>
<li>각 head의 Value, Output projection이 MoE 구조.</li>
<li>Query, Key는 dense하게 계산하며 Value, Output은 MoE expert 중 선택하여 계산.</li>
</ul>
<p>예시: Head h, 토큰 t에 대해</p>
<ul>
<li>Expert score:
[
s_{V,t}^h = σ(x_t W_{SV}^h)
]</li>
<li>선택된 expert로 value projection:
[
v_t^h = \sum_{e \in E^h_V(x_t)} s^h_{V,t}[e] \cdot x_t W_V^{h,e}
]</li>
<li>Attention 계산 후 output projection도 유사하게 MoE 처리.</li>
</ul>
<h4 id="3-layer-grouping">3. Layer Grouping</h4>
<ul>
<li>G개의 non-shared 레이어를 하나의 group으로 묶고, 그 group을 반복하여 recurrence.</li>
<li>예시: G=2일 때 전체 depth가 18이면 9번 A-B 레이어를 반복 → ABABABAB&hellip;</li>
</ul>
<p>이 방식은 아래와 같은 <strong>복합 연산을 레이어 간 분할하여 수행하는 inductive bias</strong>를 제공:</p>
<ul>
<li>A → sub-operation 1</li>
<li>B → sub-operation 2</li>
<li>A-B → 전체 연산 완성</li>
</ul>
<h4 id="4-peri-layernorm">4. Peri-layernorm</h4>
<ul>
<li>일반적인 pre/post-layernorm과 달리 <strong>sigmoid, softmax 앞에서만 layernorm 적용</strong>.</li>
<li>Attention의 Query/Key, MoE gating score 계산에만 적용.</li>
<li>Residual path에는 적용하지 않아 gradient flow, residual scale 문제 동시 해결.</li>
</ul>
<hr>
<h3 id="-성능-비교-요약">📊 성능 비교 요약</h3>
<table>
  <thead>
      <tr>
          <th>모델 유형</th>
          <th>파라미터 수</th>
          <th>Perplexity (C4)</th>
          <th>Training MACs 기준 효율성</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Baseline Transformer</td>
          <td>244M</td>
          <td>13.40</td>
          <td>기준점</td>
      </tr>
      <tr>
          <td>σ-MoE (non-shared)</td>
          <td>244M</td>
          <td>13.70</td>
          <td>낮음</td>
      </tr>
      <tr>
          <td><strong>MoEUT (shared)</strong></td>
          <td>243M</td>
          <td><strong>13.24</strong></td>
          <td><strong>가장 효율적</strong></td>
      </tr>
  </tbody>
</table>
<p><em>Peri-layernorm</em>, <em>G=2 Grouping</em>, <em>σ-MoE+SwitchHead</em>가 조합될 때 성능이 가장 좋음.</p>
<hr>
<h3 id="-논문의-강점-및-독창적-기여">🌟 논문의 강점 및 독창적 기여</h3>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>기여 요약</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Compute 효율성</td>
          <td>동일 compute (MACs) 대비 perplexity 개선</td>
      </tr>
      <tr>
          <td>모델 구조</td>
          <td>UT와 MoE의 장점 결합한 최초의 구조</td>
      </tr>
      <tr>
          <td>학습 안정성</td>
          <td>MoE gating에 entropy 기반 regularization 도입</td>
      </tr>
      <tr>
          <td>Layer Grouping</td>
          <td>MoEUT의 expressive power를 구조적으로 확장</td>
      </tr>
      <tr>
          <td>Peri-layernorm</td>
          <td>기존 pre/post-layernorm의 문제점을 모두 해결한 새로운 방식</td>
      </tr>
      <tr>
          <td>분석</td>
          <td>Expert 사용 diversity, token-context 특이성까지 체계적 분석</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-한계점-및-개선-여지">⚠️ 한계점 및 개선 여지</h3>
<table>
  <thead>
      <tr>
          <th>한계</th>
          <th>설명</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Triton 기반 MoE 커널</td>
          <td>현재는 비효율적 구현으로 인해 baseline보다 학습 속도 느림 (1.7x)</td>
      </tr>
      <tr>
          <td>ACT 미적용</td>
          <td>Adaptive Computation Time은 본 논문에서 제외됨 (UT의 주요 기법 중 하나인데 병합되지 않음)</td>
      </tr>
      <tr>
          <td>스케일 제한</td>
          <td>최대 1B 파라미터 수준 실험에 한정 (GPT-4, Claude 3 같은 scale로는 미검증)</td>
      </tr>
      <tr>
          <td>Downstream 성능</td>
          <td>대부분 marginal improvement 수준 (zero-shot에서 아주 큰 차이는 아님)</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-결론">✅ 결론</h3>
<p>MoEUT는 Universal Transformer가 갖는 layer recurrence 기반의 generalization 능력을 유지하면서, compute/resource 효율성 문제를 MoE로 해결한 <strong>가장 실용적인 UT 변형 아키텍처</strong>다. 특히 <strong>fine-grained expert 구성</strong>, <strong>레이어 그룹 반복 설계</strong>, <strong>peri-layernorm 도입</strong>은 모두 UT의 한계를 극복하는 데 필수적이며, 이 논문은 그 모든 요소를 결합해 실질적으로 baseline을 능가하는 결과를 최초로 제시했다는 점에서 높은 가치를 가진다.</p>
<h1 id="q--논문의-핵심알고리즘을-예시를-들어-아주-자세하게-설명해주고-정리해-줘">Q : 논문의 핵심알고리즘을 예시를 들어 아주 자세하게 설명해주고 정리해 줘</h1>
<p>좋습니다. 아래는 <strong>MoEUT (Mixture-of-Experts Universal Transformer)</strong> 논문의 <strong>핵심 알고리즘</strong>을 수식 기반으로 정리하고, <strong>예시 입력을 통해 step-by-step으로 작동 과정을 설명</strong>한 내용입니다.</p>
<hr>
<h2 id="-핵심-알고리즘-구성-요약-요소별-구조와-연결관계">✅ 핵심 알고리즘 구성 요약 (요소별 구조와 연결관계)</h2>
<table>
  <thead>
      <tr>
          <th>컴포넌트</th>
          <th>방식</th>
          <th>특징</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>σ-MoE FFN</strong></td>
          <td>top-K soft routing</td>
          <td>fine-grained expert selection</td>
      </tr>
      <tr>
          <td><strong>MoE Self-Attention</strong></td>
          <td>SwitchHead 구조</td>
          <td>head-wise expert mixture</td>
      </tr>
      <tr>
          <td><strong>Layer Grouping</strong></td>
          <td>반복 구조 A-B-A-B</td>
          <td>sub-operation 분할 유도</td>
      </tr>
      <tr>
          <td><strong>Peri-LayerNorm</strong></td>
          <td>활성화 이전에만 적용</td>
          <td>signal scaling 문제 해결</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-예시-기반-설명-σ-moe--moe-self-attention-경로">🧪 예시 기반 설명 (σ-MoE + MoE Self-Attention 경로)</h2>
<h3 id="가정">가정</h3>
<ul>
<li>모델 파라미터:
<ul>
<li>( d_{\text{model}} = 4 ), ( d_{\text{expert}} = 2 ), expert 수 ( N_E = 3 ), top-K = 2</li>
</ul>
</li>
<li>입력 토큰: ( x_t = [0.1, -0.5, 0.3, 0.9] )</li>
</ul>
<hr>
<h3 id="-step-1-σ-moe-feedforward">🔹 Step 1: σ-MoE Feedforward</h3>
<h4 id="1-1-expert-선택">1-1. Expert 선택</h4>
<p>[
s_t = \sigma(x_t W_S)
\quad \text{(sigmoid gating)}
]</p>
<p>가정:<br>
[
W_S =
\begin{bmatrix}
0.2 &amp; -0.3 &amp; 0.5 \
-0.1 &amp; 0.4 &amp; 0.2 \
0.6 &amp; -0.2 &amp; 0.1 \
-0.4 &amp; 0.3 &amp; -0.1
\end{bmatrix}
\Rightarrow
x_t W_S = [0.5, -0.2, 0.3]
\Rightarrow
s_t = \sigma([0.5, -0.2, 0.3]) \approx [0.62, 0.45, 0.57]
]</p>
<p>→ top-2 expert: <strong>1번, 3번 expert 선택</strong></p>
<h4 id="1-2-선택된-expert-처리">1-2. 선택된 expert 처리</h4>
<p>각 expert는 두 weight:</p>
<ul>
<li>( W_1^e \in \mathbb{R}^{4\times2} ), ( W_2^e \in \mathbb{R}^{2\times4} )</li>
</ul>
<p>가정:</p>
<ul>
<li>( \text{ReLU}(x_t W_1^e) W_2^e ) 결과는 다음과 같음:
<ul>
<li>Expert 1: ( v_1 = [0.1, 0.2, 0.0, 0.1] )</li>
<li>Expert 3: ( v_3 = [0.05, 0.1, 0.2, 0.0] )</li>
</ul>
</li>
</ul>
<p>최종 output:
[
y_t = 0.62 \cdot v_1 + 0.57 \cdot v_3
= [0.62(0.1)+0.57(0.05), \dots]
\Rightarrow
y_t ≈ [0.1035, 0.197, 0.114, 0.062]
]</p>
<hr>
<h3 id="-step-2-moe-self-attention-switchhead">🔹 Step 2: MoE Self-Attention (SwitchHead)</h3>
<p>가정: 2-head attention, head dimension ( d_{\text{head}} = 2 )</p>
<h4 id="2-1-querykey-계산-dense">2-1. Query/Key 계산 (dense)</h4>
<p>[
Q_t^h = x_t W_Q^h,\quad K_t^h = x_t W_K^h
]</p>
<p>→ dot-product attention weight 계산은 일반 attention과 동일</p>
<h4 id="2-2-valueoutput에-moe-적용">2-2. Value/Output에 MoE 적용</h4>
<p>각 head마다 expert routing:</p>
<ul>
<li>expert score:<br>
[
s_V^h = \sigma(x_t W_{SV}^h)
\Rightarrow \text{top-2 expert 선택}
]</li>
<li>예: expert 1, 2 선택</li>
<li>값:
<ul>
<li>( V^h = \sum_{e \in \text{top-2}} s[e] \cdot x_t W_V^{h,e} )</li>
</ul>
</li>
<li>attention 결과 ( a_t^h = \text{Attention}(Q, K, V) )</li>
<li>output: ( y_t = \sum_h a_t^h W_O^{h,e} )</li>
</ul>
<hr>
<h3 id="-step-3-residual--peri-layernorm">🔹 Step 3: Residual + Peri-layernorm</h3>
<ul>
<li><strong>Peri-layernorm 적용 위치:</strong>
<ul>
<li>Attention: Q, K projection 전에만</li>
<li>FFN: gating (σ-MoE) 전에만</li>
</ul>
</li>
</ul>
<p>→ Main data path (FFN, V-proj 등)에는 layernorm 없음
→ gradient flow는 잘 유지하면서 residual scaling 문제 회피</p>
<hr>
<h2 id="-요약-전체-연산-흐름">🧠 요약: 전체 연산 흐름</h2>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PLAINTEXT
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-0"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-0"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-0">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="ln">1</span><span class="cl">x_t 
</span></span><span class="line"><span class="ln">2</span><span class="cl"> ↓
</span></span><span class="line"><span class="ln">3</span><span class="cl">[Layer Group]
</span></span><span class="line"><span class="ln">4</span><span class="cl">   ├─ σ-MoE FFN → sparse expert 선택 및 계산
</span></span><span class="line"><span class="ln">5</span><span class="cl">   └─ MoE Attention → head-wise expert mixture
</span></span><span class="line"><span class="ln">6</span><span class="cl"> ↓
</span></span><span class="line"><span class="ln">7</span><span class="cl">Peri-layernorm (선택적으로 적용)
</span></span><span class="line"><span class="ln">8</span><span class="cl"> ↓
</span></span><span class="line"><span class="ln">9</span><span class="cl">x_{t+1} (다음 step의 입력)</span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-0';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<hr>
<h2 id="-추가-해설-왜-이렇게-동작하는가">💡 추가 해설: 왜 이렇게 동작하는가?</h2>
<ul>
<li><strong>σ-MoE</strong>는 Sigmoid 기반 soft gating으로 top-K 전문가만 사용함으로써 sparse activation → compute 절약</li>
<li><strong>SwitchHead</strong>는 attention의 value/output 부분을 expert로 바꿔 parameter 수 증가 + compute sparse하게 만듦</li>
<li><strong>Layer Grouping</strong>은 연산의 sub-step을 레이어에 분할하게 하여 recurrent stack에서도 expressive power 확보</li>
<li><strong>Peri-layernorm</strong>은 pre/post의 장점은 살리고 단점은 제거한 새로운 normalization 위치 전략</li>
</ul>
<h1 id="q--이-논문에서-사용하는-방법을-학습하기-위하여-어떤-데이터셋이-필요할까-그리고-어떻게-학습을-진행하면-될지-예시를-들어서-아주-자세하게-설명해줘">Q : 이 논문에서 사용하는 방법을 학습하기 위하여 어떤 데이터셋이 필요할까? 그리고 어떻게 학습을 진행하면 될지 예시를 들어서 아주 자세하게 설명해줘</h1>
<p>좋습니다. 이 논문에서는 **MoEUT (Mixture-of-Experts Universal Transformer)**를 실제로 학습하기 위해 <strong>언어 모델링을 위한 표준 데이터셋</strong>을 활용하였으며, 학습 절차와 하이퍼파라미터는 상당히 정교하게 설계되어 있습니다. 아래에 <strong>데이터셋 요약</strong>, <strong>훈련 절차</strong>, <strong>세부 예시</strong>를 수치 기반으로 매우 자세하게 설명드립니다.</p>
<hr>
<h2 id="-1-사용한-주요-데이터셋">✅ 1. 사용한 주요 데이터셋</h2>
<table>
  <thead>
      <tr>
          <th>데이터셋</th>
          <th>목적</th>
          <th>특징</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>C4</strong> (Colossal Clean Crawled Corpus)</td>
          <td>일반 언어 모델링</td>
          <td>약 100GB 규모, 웹 크롤링 정제 데이터</td>
      </tr>
      <tr>
          <td><strong>SlimPajama</strong></td>
          <td>경량화된 RedPajama</td>
          <td>627B 토큰, 다양한 문체 포함</td>
      </tr>
      <tr>
          <td><strong>peS2o</strong></td>
          <td>학술 논문 기반 텍스트</td>
          <td>AI2 S2ORC에서 추출</td>
      </tr>
      <tr>
          <td><strong>The Stack</strong></td>
          <td>코드 생성 학습</td>
          <td>다양한 프로그래밍 언어 포함 (Python, Rust, HTML 등)</td>
      </tr>
  </tbody>
</table>

  <blockquote
    class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1">
    <div class="prose prose-sm max-w-none">
      <p>✅ 모두 <strong>auto-regressive LM 방식</strong>으로 사용됨 (e.g., next-token prediction)</p>
    </div>
  </blockquote>

<hr>
<h2 id="-2-학습-방식-및-구성요소">✅ 2. 학습 방식 및 구성요소</h2>
<h3 id="공통-학습-설정">공통 학습 설정</h3>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>값</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Batch size</td>
          <td>64 (global)</td>
      </tr>
      <tr>
          <td>Sequence length</td>
          <td>1024 tokens</td>
      </tr>
      <tr>
          <td>Optimizer</td>
          <td>AdamW (weight decay 0.01)</td>
      </tr>
      <tr>
          <td>LR schedule</td>
          <td>Cosine decay (start=2.5e-4 → end=2.5e-5)</td>
      </tr>
      <tr>
          <td>Gradient clipping</td>
          <td>κ = 0.25</td>
      </tr>
      <tr>
          <td>FP16 or BF16</td>
          <td>Mixed precision 사용</td>
      </tr>
      <tr>
          <td>Tokenizer</td>
          <td>SentencePiece (vocab size = 8,000)</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-3-전체-학습-파이프라인-예시">✅ 3. 전체 학습 파이프라인 예시</h2>
<h3 id="-step-by-step-학습-예시-예-c4-데이터-244m-모델">⚙️ Step-by-Step 학습 예시 (예: C4 데이터, 244M 모델)</h3>
<h4 id="1단계-데이터-준비">1단계: 데이터 준비</h4>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        BASH
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-1"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-1"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-1">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Hugging Face Datasets 사용 예시</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">from datasets import load_dataset
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nv">dataset</span> <span class="o">=</span> load_dataset<span class="o">(</span><span class="s2">&#34;c4&#34;</span>, <span class="s2">&#34;en&#34;</span>, <span class="nv">split</span><span class="o">=</span><span class="s2">&#34;train&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># 토큰화</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">from sentencepiece import SentencePieceProcessor
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nv">sp</span> <span class="o">=</span> SentencePieceProcessor<span class="o">()</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">sp.load<span class="o">(</span><span class="s2">&#34;c4_8k_tokenizer.model&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">def tokenize<span class="o">(</span>example<span class="o">)</span>:
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">return</span> <span class="o">{</span><span class="s2">&#34;input_ids&#34;</span>: sp.encode<span class="o">(</span>example<span class="o">[</span><span class="s2">&#34;text&#34;</span><span class="o">])}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nv">tokenized_dataset</span> <span class="o">=</span> dataset.map<span class="o">(</span>tokenize, <span class="nv">batched</span><span class="o">=</span>True<span class="o">)</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-1';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<h4 id="2단계-dataloader-구성-fixed-length-chunking">2단계: DataLoader 구성 (Fixed-length chunking)</h4>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PYTHON
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-2"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-2"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-2">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">def</span> <span class="nf">chunk_inputs</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">context_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">ids</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&#34;input_ids&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">context_length</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="o">-</span><span class="n">context_length</span><span class="p">,</span> <span class="n">context_length</span><span class="p">)]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;input_ids&#34;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="n">chunked_dataset</span> <span class="o">=</span> <span class="n">tokenized_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">chunk_inputs</span><span class="p">,</span> <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;text&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">chunked_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-2';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<hr>
<h4 id="3단계-모델-초기화">3단계: 모델 초기화</h4>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PYTHON
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-3"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-3"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-3">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">from</span> <span class="nn">moeut.modeling_moeut</span> <span class="kn">import</span> <span class="n">MoEUTConfig</span><span class="p">,</span> <span class="n">MoEUTModel</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">config</span> <span class="o">=</span> <span class="n">MoEUTConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">d_model</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">num_layers</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">num_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">group_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">num_ff_experts</span><span class="o">=</span><span class="mi">387</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">num_attn_experts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">expert_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">top_k_ff</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">top_k_attn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">peri_layernorm</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">MoEUTModel</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-3';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<hr>
<h4 id="4단계-학습-루프-perplexity-기반">4단계: 학습 루프 (perplexity 기반)</h4>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PYTHON
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-4"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-4"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-4">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">2.5e-4</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&#34;input_ids&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_ids</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">),</span> <span class="n">labels</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clip_grad_norm_</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="mf">0.25</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">: loss = </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-4';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>

  <blockquote
    class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1">
    <div class="prose prose-sm max-w-none">
      <p>💡 <strong>Entropy Regularization</strong> 항 추가 필요:</p>
    </div>
  </blockquote>

<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PYTHON
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-5"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-5"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-5">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">loss_total</span> <span class="o">=</span> <span class="n">loss_lm</span> <span class="o">+</span> <span class="n">γ</span> <span class="o">*</span> <span class="n">loss_entropy_ffn</span> <span class="o">+</span> <span class="n">δ</span> <span class="o">*</span> <span class="n">loss_entropy_attn</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-5';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
<hr>
<h2 id="-4-gpu하드웨어-요구사항">✅ 4. GPU/하드웨어 요구사항</h2>
<table>
  <thead>
      <tr>
          <th>모델 크기</th>
          <th>GPU 종류</th>
          <th>학습 시간 (대략)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>44M</td>
          <td>4x V100</td>
          <td>약 20시간</td>
      </tr>
      <tr>
          <td>244M</td>
          <td>8x V100</td>
          <td>약 30시간</td>
      </tr>
      <tr>
          <td>1B</td>
          <td>4x A100 80GB</td>
          <td>약 70시간</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-5-checkpoint-및-evaluation">✅ 5. Checkpoint 및 Evaluation</h2>
<ul>
<li><strong>Perplexity</strong>: held-out set에서 next-token prediction perplexity로 평가</li>
<li><strong>Zero-shot 평가</strong>: BLiMP, LAMBADA, PIQA 등에서 accuracy 측정</li>
</ul>
<hr>
<h2 id="-6-재현용-추천-스크립트">✅ 6. 재현용 추천 스크립트</h2>
<p>논문에서 제공한 공식 레포:</p>
<ul>
<li>📦 GitHub: <a href="https://github.com/robertcsordas/moeut">https://github.com/robertcsordas/moeut</a></li>
</ul>

  <blockquote
    class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1">
    <div class="prose prose-sm max-w-none">
      <p><code>train.py</code>, <code>modeling_moeut.py</code>, <code>config.yaml</code> 구성됨</p>
    </div>
  </blockquote>

<hr>
<h2 id="-정리">🎓 정리</h2>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>MoEUT 학습 시 필요한 구성</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>데이터셋</td>
          <td>언어 모델링 (C4, SlimPajama 등), 코드 (The Stack)</td>
      </tr>
      <tr>
          <td>입력 방식</td>
          <td>auto-regressive LM (1024 토큰)</td>
      </tr>
      <tr>
          <td>토큰화</td>
          <td>SentencePiece (8K)</td>
      </tr>
      <tr>
          <td>Loss 구성</td>
          <td>CrossEntropy + σ-MoE/attention entropy loss</td>
      </tr>
      <tr>
          <td>모델 구성</td>
          <td>σ-MoE FFN + SwitchHead Attention + Layer Grouping</td>
      </tr>
      <tr>
          <td>자원 요구</td>
          <td>최소 V100, 대규모 시 A100 필요</td>
      </tr>
      <tr>
          <td>성능 지표</td>
          <td>perplexity, zero-shot accuracy</td>
      </tr>
  </tbody>
</table>
<h1 id="q--이-논문에서-제시한-결과를-자세하게-보고-다른-방법론에-비하여-특출난-점과-논문에서-제기하는-어떠한-방법이-이러한-결과를-도출하게-되었는지-논문에서-제시하는-이유와-너의-생각을-알려줘">Q : 이 논문에서 제시한 결과를 자세하게 보고 다른 방법론에 비하여 특출난 점과 논문에서 제기하는 어떠한 방법이 이러한 결과를 도출하게 되었는지 논문에서 제시하는 이유와 너의 생각을 알려줘</h1>
<p>좋습니다. MoEUT 논문은 <strong>Universal Transformer의 layer-sharing 기반 일반화 성능</strong>과 <strong>Mixture-of-Experts(MoE)의 compute 효율성</strong>을 접목해 <strong>parameter efficiency와 compute efficiency 모두 달성</strong>하는 것을 목표로 했으며, 실험 결과는 그 목표에 부합합니다. 아래에 <strong>결과 요약</strong>, <strong>기존 방법과 비교해 특출난 점</strong>, <strong>기여한 핵심 기법</strong>, 그리고 <strong>제안의 타당성에 대한 제 의견</strong>까지 구조화해 설명드리겠습니다.</p>
<hr>
<h2 id="-1-주요-실험-결과-정리-표-기반-요약">✅ 1. 주요 실험 결과 정리 (표 기반 요약)</h2>
<h3 id="-language-modeling-perplexity-c4-기준-held-out-set">📊 Language Modeling Perplexity (C4 기준, held-out set)</h3>
<table>
  <thead>
      <tr>
          <th>모델 유형</th>
          <th>#파라미터</th>
          <th>Perplexity ↓</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Dense Transformer</td>
          <td>244M</td>
          <td>13.40</td>
      </tr>
      <tr>
          <td>σ-MoE (non-shared)</td>
          <td>244M</td>
          <td>13.70</td>
      </tr>
      <tr>
          <td><strong>MoEUT (shared)</strong></td>
          <td>243M</td>
          <td><strong>13.24</strong></td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>같은 파라미터 수 조건에서 가장 낮은 perplexity</strong>를 기록</li>
<li><strong>동일 compute (MACs) 조건</strong>에서도 MoEUT가 우수함</li>
</ul>
<h3 id="-zero-shot-downstream-성능-예-244m-모델-기준">📊 Zero-shot Downstream 성능 (예: 244M 모델 기준)</h3>
<table>
  <thead>
      <tr>
          <th>Task</th>
          <th>Transformer</th>
          <th>MoEUT</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LAMBADA</td>
          <td>33.1%</td>
          <td>30.6%</td>
      </tr>
      <tr>
          <td>BLiMP</td>
          <td>78.5%</td>
          <td><strong>79.7%</strong></td>
      </tr>
      <tr>
          <td>HellaSwag</td>
          <td>34.5%</td>
          <td><strong>35.7%</strong></td>
      </tr>
      <tr>
          <td>PIQA</td>
          <td>64.9%</td>
          <td><strong>65.2%</strong></td>
      </tr>
      <tr>
          <td>ARC-E</td>
          <td>36.9%</td>
          <td>36.4%</td>
      </tr>
      <tr>
          <td><strong>Average</strong></td>
          <td>55.6%</td>
          <td><strong>55.5%</strong></td>
      </tr>
  </tbody>
</table>
<ul>
<li>큰 차이는 아니지만 <strong>전반적으로 MoEUT가 더 나은 평균 성능</strong></li>
</ul>
<hr>
<h2 id="-2-기존-방법-대비-특출난-점-비교-관점">✅ 2. 기존 방법 대비 특출난 점 (비교 관점)</h2>
<table>
  <thead>
      <tr>
          <th>측면</th>
          <th>기존 Dense Transformer</th>
          <th>SUT (Sparse UT)</th>
          <th><strong>MoEUT</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Layer Sharing</td>
          <td>❌ (no recurrence)</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Expert 사용</td>
          <td>❌</td>
          <td>✅ (MoE 적용)</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Attention에 MoE</td>
          <td>❌</td>
          <td>✅</td>
          <td>✅ (SwitchHead)</td>
      </tr>
      <tr>
          <td>Layernorm 전략</td>
          <td>PreLN/PostLN</td>
          <td>PostLN</td>
          <td><strong>Peri-layernorm</strong></td>
      </tr>
      <tr>
          <td>Layer Grouping</td>
          <td>❌</td>
          <td>❌</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Compute Efficiency</td>
          <td>중간</td>
          <td>낮음 (ACT 병목)</td>
          <td><strong>우수</strong></td>
      </tr>
      <tr>
          <td>학습 속도</td>
          <td>빠름</td>
          <td>느림 (ACT)</td>
          <td>느림 (현재 커널 구현상)</td>
      </tr>
      <tr>
          <td>Memory 사용</td>
          <td>낮음</td>
          <td>높음</td>
          <td><strong>낮음</strong></td>
      </tr>
  </tbody>
</table>
<p>→ 특히 <strong>parameter-compute ratio 문제를 효과적으로 해결한 최초의 UT 구조</strong></p>
<hr>
<h2 id="-3-성능-향상에-기여한-핵심-기법-및-논문-주장">✅ 3. 성능 향상에 기여한 핵심 기법 및 논문 주장</h2>
<h3 id="-1-σ-moe-in-ffn">🔹 (1) σ-MoE in FFN</h3>
<ul>
<li><strong>수백 개의 작은 전문가 중 top-K만 활성화</strong></li>
<li><code>dexpert = 128</code>, <code>K = d_model / dexpert</code> 방식으로 <strong>fine-grained sparsity</strong></li>
<li>논문 주장: 작은 expert 사용이 학습 안정성과 compute 효율에 핵심적</li>
</ul>
<p>→ 실험적 증거:</p>
<ul>
<li>Fig. 13에서 작은 dexpert가 더 낮은 perplexity 유도</li>
</ul>
<hr>
<h3 id="-2-switchhead-moe-self-attention">🔹 (2) SwitchHead (MoE Self-Attention)</h3>
<ul>
<li>attention의 <strong>value/output projection에 expert 구조</strong> 삽입</li>
<li>각 head 별로 MoE 구성 → MoE-Attn 특화 기법</li>
</ul>
<p>→ MoE를 FFN 뿐만 아니라 attention까지 확대 적용한 사례로는 드묾</p>
<hr>
<h3 id="-3-layer-grouping-ex-a-b-a-b-스타일-반복">🔹 (3) Layer Grouping (ex: A-B-A-B 스타일 반복)</h3>
<ul>
<li>동일한 파라미터를 공유하지만 <strong>서로 다른 역할 수행하는 연속된 레이어</strong> 구성</li>
<li>sub-operation 분리 학습을 유도하여 expressive power 회복</li>
</ul>
<p>→ 실험: Fig. 6에서 G=2가 최적, G=1이나 AABB는 성능 저하</p>
<hr>
<h3 id="-4-peri-layernorm">🔹 (4) Peri-layernorm</h3>
<ul>
<li><strong>LayerNorm을 gating activation 앞에만 적용</strong></li>
<li>residual path에는 적용하지 않음</li>
<li>gradient flow와 residual norm 성장 문제를 동시에 해결</li>
</ul>
<p>→ Fig. 8에서 PeriLN이 PreLN/PostLN보다 낮은 perplexity 달성</p>
<hr>
<h2 id="-4-논문-주장에-대한-비판적-분석-및-내-생각">💭 4. 논문 주장에 대한 비판적 분석 및 내 생각</h2>
<h3 id="-타당한-점">💡 타당한 점</h3>
<ol>
<li><strong>shared-layer UT의 expressive power 문제를 잘 파악하고 대응</strong>
<ul>
<li>Layer grouping은 recurrence 구조 내 연산 구분을 명확히 해줌</li>
</ul>
</li>
<li><strong>SwitchHead와 σ-MoE의 결합</strong>은 attention과 FFN 모두에 sparse routing을 도입한 <strong>드문 설계</strong></li>
<li><strong>Peri-layernorm 설계</strong>는 기존 norm 전략의 단점을 피하며, 실험적 효과도 명확</li>
</ol>
<h3 id="보완-필요해-보이는-점">❗️보완 필요해 보이는 점</h3>
<ol>
<li>
<p><strong>학습 속도 및 커널 구현 최적화 미비</strong><br>
→ FlashAttention 수준의 커널이 탑재되면 학습 속도 1.7x 개선 예상</p>
</li>
<li>
<p><strong>Massive scale 실험 부재</strong><br>
→ 1B 파라미터 이상에서는 다른 특성이 나타날 수 있으므로, 실험 확장이 필요</p>
</li>
<li>
<p><strong>Downstream 성능 향상은 제한적</strong><br>
→ marginal 개선 수준, 여전히 zero-shot task에서 의미 있는 차이는 적음</p>
</li>
</ol>
<hr>
<h2 id="-결론-1">🔚 결론</h2>
<p>MoEUT는 <strong>기존 Universal Transformer가 갖는 compute 비효율성 문제를 MoE로 해결하고</strong>, 여기에 <strong>layer grouping과 peri-layernorm이라는 고유한 설계를 추가하여 학습 안정성과 expressive power를 확보</strong>한 구조입니다. <strong>같은 파라미터 조건 또는 같은 연산량 조건에서 성능이 우수</strong>하다는 점은 실험적으로 충분히 입증되었으며, <strong>앞으로 layer-sharing 기반 LLM 구조에서 중요한 기초 단위로 사용될 수 있는 설계</strong>라고 판단됩니다.</p>
<p>필요하시면 이 구조를 다른 LLM (예: LLaMA나 GPT 시리즈)와 통합하거나 파생 구조를 설계하는 방안도 제시드릴 수 있습니다.</p>
<h1 id="q--이-논문의-입력데이터와-추론-과정에-대해서-예시를-들어-아주-자세하게-설명해-주겠니-추가적으로-모델아키텍처의-구성-및-모델을-구성하는-연산과-메모리-요구량-컴퓨팅-요구량-대해서도-설명해줘">Q : 이 논문의 입력데이터와 추론 과정에 대해서 예시를 들어 아주 자세하게 설명해 주겠니? 추가적으로 모델아키텍처의 구성 및 모델을 구성하는 연산과 메모리 요구량 컴퓨팅 요구량 대해서도 설명해줘</h1>
<p>좋습니다. 아래는 MoEUT 논문에서의 <strong>입력–추론 과정</strong>, <strong>모델 아키텍처 구성</strong>, 그리고 <strong>각 구성 요소별 연산량 및 메모리/컴퓨팅 비용 분석</strong>을 <strong>구체적인 예시</strong>를 통해 아주 자세하게 정리한 내용입니다.</p>
<hr>
<h2 id="-1-입력-데이터와-추론-과정-예시-기반-설명">✅ 1. 입력 데이터와 추론 과정: 예시 기반 설명</h2>
<h3 id="-예시-입력">✏️ 예시 입력</h3>
<ul>
<li>
<p>입력 문장: <code>&quot;The cat sat on the mat.&quot;</code></p>
</li>
<li>
<p>토크나이저: SentencePiece, vocab size = 8000</p>
</li>
<li>
<p>예시 토큰화 결과:</p>
<div
  class="code-block-container border-border bg-card my-6 overflow-hidden rounded-xl border shadow-sm transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-md">
  
  <div
    class="code-block-header bg-muted/30 border-border flex items-center justify-between border-b px-4 py-3">
    
    <div class="flex items-center gap-2">
      <div class="text-muted-foreground flex-shrink-0">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
</svg>
      </div>
      <span class="text-muted-foreground text-sm font-medium">
        PYTHON
      </span>
    </div>

    
    <div class="flex items-center gap-2">
      <button
          class="collapse-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
          data-code-id="code-6"
          data-default-state="expanded"
          data-collapsed="false"
          data-auto-collapse-lines="30"
          data-auto-collapse-height="400"
          data-collapsed-height="120"
          title="접기"
          aria-label="접기">
          <span class="collapse-icon">
            
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z"/></svg>
          </span>
          <span class="collapse-text hidden sm:inline"
            >접기</span
          >
        </button>
      <button
        class="copy-code-btn text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium transition-all duration-200 ease-out focus:ring-2 focus:outline-none"
        data-code-id="code-6"
        title="복사"
        aria-label="복사">
        <span class="copy-icon">
          
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
        </span>
        <span class="copy-text hidden sm:inline"
          >복사</span
        >
      </button>
    </div>
  </div>

  
  <div class="code-block-content relative" id="code-6">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">[</span><span class="s2">&#34;▁The&#34;</span><span class="p">,</span> <span class="s2">&#34;▁cat&#34;</span><span class="p">,</span> <span class="s2">&#34;▁sat&#34;</span><span class="p">,</span> <span class="s2">&#34;▁on&#34;</span><span class="p">,</span> <span class="s2">&#34;▁the&#34;</span><span class="p">,</span> <span class="s2">&#34;▁mat&#34;</span><span class="p">,</span> <span class="s2">&#34;.&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="err">⇒</span> <span class="n">input_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1012</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">1543</span><span class="p">,</span> <span class="mi">1324</span><span class="p">,</span> <span class="mi">1091</span><span class="p">,</span> <span class="mi">2932</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span></span></span></code></pre></div>
    
    <div
      class="collapse-overlay to-card/90 pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent opacity-0 transition-opacity duration-300">
      <div
        class="text-muted-foreground bg-card/80 border-border/50 hover:bg-primary/10 hover:text-primary hover:border-primary/30 absolute bottom-4 left-1/2 -translate-x-1/2 cursor-pointer rounded-full border px-3 py-1.5 text-xs backdrop-blur-sm transition-all duration-200">
        클릭하여 더 보기
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  const codeId = 'code-6';
  const copyBtn = document.querySelector('.copy-code-btn[data-code-id="' + codeId + '"]');
  const collapseBtn = document.querySelector('.collapse-code-btn[data-code-id="' + codeId + '"]');
  const codeContainer = document.getElementById(codeId);

  if (!codeContainer) return;

  
  if (copyBtn) {
    const copyIcon = copyBtn.querySelector('.copy-icon');
    const copyText = copyBtn.querySelector('.copy-text');

    copyBtn.addEventListener('click', async function() {
      try {
        
        let codeText = '';

        
        const codeTableCell = codeContainer.querySelector('.lntd:last-child code');
        if (codeTableCell) {
          codeText = codeTableCell.textContent || codeTableCell.innerText;
        } else {
          
          const codeElement = codeContainer.querySelector('code');
          if (codeElement) {
            
            const hasInlineLineNumbers = codeElement.querySelector('.ln');
            if (hasInlineLineNumbers) {
              
              const codeLines = codeElement.querySelectorAll('.cl');
              if (codeLines.length > 0) {
                codeText = Array.from(codeLines)
                  .map(line => {
                    const text = line.textContent || line.innerText;
                    
                    return text.replace(/\n+$/, '');
                  })
                  .join('\n')
                  .replace(/\n+$/, ''); 
              } else {
                
                const allText = codeElement.textContent || codeElement.innerText;
                codeText = allText.replace(/^\d+/gm, '').replace(/^\s+/gm, '');
              }
            } else {
              
              codeText = codeElement.textContent || codeElement.innerText;
            }
          } else {
            
            codeText = codeContainer.textContent || codeContainer.innerText;
          }
        }

        
        codeText = codeText.trim();

        
        await navigator.clipboard.writeText(codeText);

        
        copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M5 13l4 4L19 7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (copyText) {
          copyText.textContent = '복사됨';
        }
        copyBtn.classList.add('text-green-600');

        
        setTimeout(() => {
          copyIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\u0022 \/\u003e\n\u003c\/svg\u003e`;
          if (copyText) {
            copyText.textContent = '복사';
          }
          copyBtn.classList.remove('text-green-600');
        }, 2000);

      } catch (err) {
        console.error('复制失败:', err);

        
        const range = document.createRange();
        const codeElement = codeContainer.querySelector('code') || codeContainer;
        range.selectNodeContents(codeElement);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        
        if (copyText) {
          copyText.textContent = '선택됨';
        }

        setTimeout(() => {
          if (copyText) {
            copyText.textContent = '복사';
          }
          selection.removeAllRanges();
        }, 2000);
      }
    });
  }

  
  if (collapseBtn) {
    const collapseIcon = collapseBtn.querySelector('.collapse-icon');
    const collapseText = collapseBtn.querySelector('.collapse-text');
    const collapseOverlay = codeContainer.querySelector('.collapse-overlay');

    
    let codeElement = codeContainer.querySelector('pre.chroma');
    if (!codeElement) {
      codeElement = codeContainer.querySelector('pre');
    }

    const defaultState = collapseBtn.dataset.defaultState || 'expanded';
    const isCollapsedAttr = collapseBtn.dataset.collapsed === 'true';
    const autoCollapseLines = parseInt(collapseBtn.dataset.autoCollapseLines) || 30;
    const autoCollapseHeight = parseInt(collapseBtn.dataset.autoCollapseHeight) || 400;
    const collapsedHeight = parseInt(collapseBtn.dataset.collapsedHeight) || 120;

    let isCollapsed = false;

    
    function initCollapse() {
      
      const shouldCollapse = isCollapsedAttr ||
                           defaultState === 'collapsed' ||
                           shouldAutoCollapse();

      if (shouldCollapse) {
        setCollapsed(true, false); 
      }
    }

    function shouldAutoCollapse() {
      
      if (codeElement) {
        const lines = codeElement.querySelectorAll('.line, .cl');
        const height = codeElement.offsetHeight;
        return lines.length > autoCollapseLines || height > autoCollapseHeight;
      }

      
      const containerHeight = codeContainer.offsetHeight;
      if (containerHeight > autoCollapseHeight) {
        return true;
      }

      
      const textContent = codeContainer.textContent || codeContainer.innerText || '';
      const estimatedLines = textContent.split('\n').length;
      return estimatedLines > autoCollapseLines;
    }

    function setCollapsed(collapsed, animate = true) {
      if (!collapseOverlay) return;

      isCollapsed = collapsed;

      if (collapsed) {
        
        codeContainer.style.maxHeight = collapsedHeight + 'px';
        codeContainer.style.overflow = 'hidden';
        collapseOverlay.style.opacity = '1';
        collapseOverlay.style.pointerEvents = 'auto';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath stroke-linecap=\u0022round\u0022 stroke-linejoin=\u0022round\u0022 stroke-width=\u00222\u0022 d=\u0022M19 9l-7 7-7-7\u0022 \/\u003e\n\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '펼치기';
        }
        collapseBtn.title = '펼치기';

      } else {
        
        codeContainer.style.maxHeight = '';
        codeContainer.style.overflow = '';
        collapseOverlay.style.opacity = '0';
        collapseOverlay.style.pointerEvents = 'none';

        
        collapseIcon.innerHTML = `\n  \u003csvg class=\u0022h-3 w-3\u0022\n    fill=\u0022none\u0022\n    stroke=\u0022currentColor\u0022\n    viewBox=\u00220 0 24 24\u0022\u003e\u003cpath fill=\u0022currentColor\u0022 d=\u0022M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\u0022\/\u003e\u003c\/svg\u003e`;
        if (collapseText) {
          collapseText.textContent = '접기';
        }
        collapseBtn.title = '접기';
      }

      
      if (animate) {
        codeContainer.style.transition = 'max-height 0.3s ease-out';
        setTimeout(() => {
          codeContainer.style.transition = '';
        }, 300);
      }
    }

    function toggleCollapse() {
      setCollapsed(!isCollapsed, true);
    }

    
    collapseBtn.addEventListener('click', toggleCollapse);

    
    if (collapseOverlay) {
      collapseOverlay.addEventListener('click', () => {
        if (isCollapsed) {
          setCollapsed(false, true);
        }
      });
    }

    
    initCollapse();
  }
})();
</script>
</li>
<li>
<p>시퀀스 길이: <code>L = 7</code></p>
</li>
<li>
<p>Embedding dimension: <code>d_model = 1024</code></p>
</li>
</ul>
<hr>
<h3 id="-추론-순서-simplified-inference-path">🔁 추론 순서 (Simplified Inference Path)</h3>
<h4 id="-input-embedding">① Input Embedding</h4>
<ul>
<li>입력: <code>input_ids ∈ ℤ⁷</code></li>
<li>Position Encoding: RoPE 적용</li>
<li>출력: <code>X ∈ ℝ^{7×1024}</code></li>
</ul>
<h4 id="-layer-group-반복-ex-g2-l18--9회-반복">② Layer Group 반복 (ex: G=2, L=18 → 9회 반복)</h4>
<p>각 group = [Layer A, Layer B] = [MoE-Attn + MoE-FFN] with shared weights</p>
<hr>
<h4 id="-step-by-step-single-moe-layer-예시">▶ Step-by-step: Single MoE Layer 예시</h4>
<h5 id="a-moe-self-attention-switchhead">A. <strong>MoE Self-Attention (SwitchHead)</strong></h5>
<ul>
<li>Head 수: 4 (dense 대비 감소)</li>
<li>각 head의 value/output projection은 MoE 구조</li>
</ul>
<p><strong>예를 들어</strong>, <code>head h</code>에서 토큰 <code>xₜ ∈ ℝ^{1024}</code>가 다음과 같이 처리됨:</p>
<ul>
<li>Query/Key는 dense 계산:
[
q_t^h = x_t W_Q^h, \quad k_t^h = x_t W_K^h \quad (\text{둘 다 } ℝ^{256})
]</li>
<li>Value: top-K MoE routing (ex: NA=10, K=2)
<ul>
<li>Expert gating score:<br>
[
s_t^h = σ(x_t W_{SV}^h) ∈ ℝ^{10}
\Rightarrow \text{Top-2 expert 선택}
]</li>
<li>각 expert의 value projection:
[
v_t^h = \sum_{e∈top2} s_t^h[e] · x_t W_V^{h,e} ∈ ℝ^{256}
]</li>
</ul>
</li>
<li>Output projection도 동일한 MoE 구조</li>
</ul>
<p>⇒ 각 토큰당 multi-head attention 수행 후 concat + projection → <code>ℝ^{1024}</code></p>
<hr>
<h5 id="b-σ-moe-feedforward">B. <strong>σ-MoE Feedforward</strong></h5>
<ul>
<li>
<p>Expert 수: NE = 387</p>
</li>
<li>
<p>Expert dimension: dexpert = 128</p>
</li>
<li>
<p>Top-K = 16</p>
</li>
<li>
<p>토큰 <code>x_t ∈ ℝ^{1024}</code> 처리:</p>
<ul>
<li>Gating score 계산:<br>
[
s_t = σ(x_t W_S) ∈ ℝ^{387}
\Rightarrow \text{Top-16 expert 선택}
]</li>
<li>각 expert의 연산:
[
v_t^e = ReLU(x_t W_1^e) W_2^e ∈ ℝ^{1024}
]</li>
<li>Weighted sum:
[
y_t = \sum_{e∈top16} s_t[e] · v_t^e
]</li>
</ul>
</li>
</ul>
<hr>
<h4 id="-residual--peri-layernorm">③ Residual + Peri-layernorm</h4>
<ul>
<li>LayerNorm은 <strong>Query/Key projection 및 gating 앞에만</strong> 적용됨</li>
<li>Main data path (V, ReLU 등)는 LayerNorm 없이 진행</li>
<li>Residual connection으로 <code>x_t + y_t</code> 조합</li>
</ul>
<hr>
<h4 id="-output-layer">④ Output Layer</h4>
<ul>
<li>마지막 hidden state → Linear → Softmax → 다음 토큰 예측 확률 분포</li>
</ul>
<hr>
<h2 id="-2-모델-아키텍처-구성-요약">✅ 2. 모델 아키텍처 구성 요약</h2>
<table>
  <thead>
      <tr>
          <th>컴포넌트</th>
          <th>구조</th>
          <th>특징</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Embedding</td>
          <td>Token + RoPE Positional</td>
          <td>RoFormer 스타일</td>
      </tr>
      <tr>
          <td>Layer</td>
          <td>Layer Group (A, B)</td>
          <td>Shared-weight 반복 구조</td>
      </tr>
      <tr>
          <td>Attention</td>
          <td>Multi-head + SwitchHead</td>
          <td>value/output에 MoE 적용</td>
      </tr>
      <tr>
          <td>FFN</td>
          <td>σ-MoE</td>
          <td>Top-K soft gating, fine-grained experts</td>
      </tr>
      <tr>
          <td>LayerNorm</td>
          <td>Peri-layernorm</td>
          <td>gating/score 계산 전용</td>
      </tr>
      <tr>
          <td>Output</td>
          <td>LM Head (Linear)</td>
          <td>token logits 예측</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-3-연산량-및-메모리-분석-per-token-기준">✅ 3. 연산량 및 메모리 분석 (per-token 기준)</h2>
<h3 id="-feedforward-σ-moe">✳️ Feedforward (σ-MoE)</h3>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>연산량</th>
          <th>메모리</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Gating (1 × 1024 × 387)</td>
          <td>396K MACs</td>
          <td>387 floats</td>
      </tr>
      <tr>
          <td>K=16 Expert 연산</td>
          <td>16 × (1024×128 + 128×1024) = 4.2M MACs</td>
          <td>16×W₁, W₂ (static)</td>
      </tr>
      <tr>
          <td>총합</td>
          <td><strong>~4.6M MACs</strong></td>
          <td>Expert 가중치 캐시 필요</td>
      </tr>
  </tbody>
</table>
<p>→ Sparse routing 덕분에 dense FFN 대비 compute 절반 이하</p>
<hr>
<h3 id="-moe-attention-switchhead">✳️ MoE Attention (SwitchHead)</h3>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>연산량</th>
          <th>메모리</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Q/K/V projection</td>
          <td>Q,K: 1×1024×256 = 262K × 2</td>
          <td>작음</td>
      </tr>
      <tr>
          <td>Value expert routing</td>
          <td>Top-2, 각 V proj 1024×256 → 2×262K = 524K</td>
          <td></td>
      </tr>
      <tr>
          <td>Attention score + weighted sum</td>
          <td>(T×T) scaled dot</td>
          <td>T 제한됨</td>
      </tr>
      <tr>
          <td>Output MoE projection</td>
          <td>2×(256×1024) = 524K</td>
          <td></td>
      </tr>
      <tr>
          <td>총합</td>
          <td><strong>~1.6M MACs</strong></td>
          <td>per-head, per-token</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-총-추론-비용-예-t1024-18-shared-layers-g2">🔢 총 추론 비용 (예: T=1024, 18 shared layers, G=2)</h3>
<ul>
<li>레이어 반복: 9회</li>
<li>총 연산량 (per-token 기준):<br>
[
9 × (MoEAttn + MoEFFN) ≈ 9 × (1.6M + 4.6M) ≈ 55.8M MACs/token
]</li>
</ul>
<p>→ 대형 모델에서 token-by-token 추론 시 매우 중요</p>
<hr>
<h2 id="-4-메모리-사용량-비교-실험-결과-기반">✅ 4. 메모리 사용량 비교 (실험 결과 기반)</h2>
<table>
  <thead>
      <tr>
          <th>모델</th>
          <th>파라미터 수</th>
          <th>Memory (8×V100 기준)</th>
          <th>학습 시간</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Transformer (dense)</td>
          <td>244M</td>
          <td>9.2 GB</td>
          <td>443 ms/batch</td>
      </tr>
      <tr>
          <td>MoEUT</td>
          <td>243M</td>
          <td><strong>9.0 GB</strong></td>
          <td><strong>772 ms/batch</strong></td>
      </tr>
      <tr>
          <td>SUT</td>
          <td>244M</td>
          <td>23.4 GB</td>
          <td>1344 ms/batch</td>
      </tr>
  </tbody>
</table>
<p>→ MoEUT는 <strong>메모리 효율은 dense와 유사</strong>, <strong>SUT보다 2.5배 빠름</strong></p>
<hr>
<h2 id="-결론-요약">✅ 결론 요약</h2>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>설명</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>입력 → 추론</td>
          <td>SentencePiece → Embedding → 반복 Group Layer (MoE + Attention) → Softmax</td>
      </tr>
      <tr>
          <td>아키텍처 핵심</td>
          <td>σ-MoE + SwitchHead + Grouping + PeriLayerNorm</td>
      </tr>
      <tr>
          <td>추론 경로</td>
          <td>각 token마다 MoE routing → expert 연산 → residual + attention</td>
      </tr>
      <tr>
          <td>연산량</td>
          <td>FFN &gt; Attention이며, 모두 sparse routing으로 효율화</td>
      </tr>
      <tr>
          <td>메모리</td>
          <td>Expert param은 공유, activation만 token-dependent로 캐시 가능</td>
      </tr>
  </tbody>
</table>
<h1 id="q--이-논문의-한계를-극복하기-위한-방법으로-어떤-연구흐름이-있는지-정리해서-자세하게-설명해-줘">Q : 이 논문의 한계를 극복하기 위한 방법으로 어떤 연구흐름이 있는지 정리해서 자세하게 설명해 줘</h1>
<p>좋습니다. MoEUT 논문은 Universal Transformer(UT)의 compute inefficiency 문제를 Mixture-of-Experts(MoE)로 극복한 구조적 혁신이지만, <strong>학습 속도</strong>, <strong>scaling 한계</strong>, <strong>downstream 성능</strong>, <strong>MoE 최적화 한계</strong> 등 여러 <strong>미해결 문제점</strong>도 존재합니다. 아래에는 이 한계를 극복하기 위한 <strong>연구 흐름 및 주요 접근 방법</strong>을 체계적으로 정리해드립니다.</p>
<hr>
<h2 id="-1-논문에서-언급한-한계-요약">✅ 1. 논문에서 언급한 한계 요약</h2>
<table>
  <thead>
      <tr>
          <th>한계 유형</th>
          <th>상세 설명</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>⚡ 속도 문제</td>
          <td>현재 MoE kernel (Triton) 비효율 → Dense Transformer보다 1.7~2x 느림</td>
      </tr>
      <tr>
          <td>📉 다운스트림 성능</td>
          <td>BLiMP, LAMBADA 등에서 성능 marginal함 (zero-shot에서 확실한 우위 없음)</td>
      </tr>
      <tr>
          <td>🧠 MoE 불안정성</td>
          <td>σ-MoE는 soft routing으로 gradient noise가 있음 (훈련 불안정)</td>
      </tr>
      <tr>
          <td>🏗️ 대규모 스케일링 부재</td>
          <td>1B 이상 scale에서의 성능 및 효율성 미검증</td>
      </tr>
      <tr>
          <td>🧩 ACT 미통합</td>
          <td>Adaptive Computation Time은 제외되어 있음 (UT의 핵심 특성 중 하나)</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-2-한계-극복을-위한-대표-연구-흐름">🔍 2. 한계 극복을 위한 대표 연구 흐름</h2>
<h3 id="-1-효율적인-moe-학습--커널-최적화">🧠 [1] 효율적인 MoE 학습 &amp; 커널 최적화</h3>
<table>
  <thead>
      <tr>
          <th>연구 흐름</th>
          <th>내용</th>
          <th>대표 연구</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Flash-MoE / Triton 개선</strong></td>
          <td>σ-MoE를 CUDA kernel 최적화로 구현 (문맥 병렬화, routing 가속)</td>
          <td>GShard [Lepikhin et al.], DeepSpeed-MoE</td>
      </tr>
      <tr>
          <td><strong>Routing-aware load balancing</strong></td>
          <td>Expert routing 시 token 분산을 균형 있게 유지</td>
          <td>BASE Layer [Lewis et al.]</td>
      </tr>
      <tr>
          <td><strong>Soft-to-hard routing 전환</strong></td>
          <td>σ-MoE → hard top-1 routing 또는 Gumbel-softmax 사용</td>
          <td>Switch Transformer [Fedus et al.]</td>
      </tr>
  </tbody>
</table>
<p>✅ <strong>MoEUT 적용 가능성</strong>: SwitchHead와 σ-MoE의 kernel이 최적화되면 <strong>학습 속도 1.5–2x 개선 기대</strong></p>
<hr>
<h3 id="-2-adaptive-computation-integration-ut-특화">🧠 [2] Adaptive Computation Integration (UT 특화)</h3>
<table>
  <thead>
      <tr>
          <th>연구 흐름</th>
          <th>내용</th>
          <th>대표 연구</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>ACT with MoE</strong></td>
          <td>MoE 기반 Layer에서 ACT 사용 (layer depth skip)</td>
          <td>SUT [Tan et al.]</td>
      </tr>
      <tr>
          <td><strong>Token-level depth control</strong></td>
          <td>각 token별로 다른 layer depth → token별 early exit</td>
          <td>UniversalTransformer [Dehghani et al.]</td>
      </tr>
  </tbody>
</table>
<p>✅ <strong>MoEUT 확장 가능성</strong>: ACT를 추가하면 <strong>layer recurrence를 더 효율적으로 제어 가능</strong> → 더 긴 컨텍스트 모델링 가능성 ↑</p>
<hr>
<h3 id="-3-expert-specialization-향상-dynamic-routing-개선">🧠 [3] Expert Specialization 향상 (Dynamic Routing 개선)</h3>
<table>
  <thead>
      <tr>
          <th>연구 흐름</th>
          <th>내용</th>
          <th>대표 연구</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Fine-grained MoE with learned expert roles</strong></td>
          <td>Expert가 특정 기능에 특화되도록 유도 (ex. syntax expert, entity expert)</td>
          <td>DeepSeekMoE [Dai et al.]</td>
      </tr>
      <tr>
          <td><strong>Token clustering 기반 expert 선택</strong></td>
          <td>token cluster (e.g., named entities)별 expert 지정</td>
          <td>SLaM [2024]</td>
      </tr>
      <tr>
          <td><strong>Routing collapse 방지</strong></td>
          <td>entropy regularization + balanced loss 개선</td>
          <td>V-MoE [Riquelme et al.]</td>
      </tr>
  </tbody>
</table>
<p>✅ MoEUT에서 이미 entropy regularization 사용 → <strong>토큰 특화 routing을 더 정교하게 제어하면 성능 개선 여지 있음</strong></p>
<hr>
<h3 id="-4-downstream-task-fine-tuning-zero-shot-한계-극복">🧠 [4] Downstream Task Fine-tuning (Zero-shot 한계 극복)</h3>
<table>
  <thead>
      <tr>
          <th>연구 흐름</th>
          <th>내용</th>
          <th>대표 연구</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>MoE adapter head</strong></td>
          <td>Pretrained MoE 본체 + 작은 task-specific adapter만 fine-tune</td>
          <td>MoE-A [Gao et al.]</td>
      </tr>
      <tr>
          <td><strong>LayerDrop or LoRA on experts</strong></td>
          <td>일부 expert만 활성화하여 미세 조정</td>
          <td>SparseAdapt [ICLR 2024]</td>
      </tr>
      <tr>
          <td><strong>Expert freezing or reordering</strong></td>
          <td>Pretraining expert 고정 + downstream에서 새로운 expert 추가</td>
          <td>HydraMoE [ICLR 2024]</td>
      </tr>
  </tbody>
</table>
<p>✅ MoEUT는 <strong>zero-shot 위주 평가만 진행됨</strong> → downstream 전이 학습 성능 강화 연구가 필요</p>
<hr>
<h3 id="-5-massive-scale-universal-moe-1b-스케일-확장">🧠 [5] Massive Scale Universal MoE (1B+ 스케일 확장)</h3>
<table>
  <thead>
      <tr>
          <th>연구 흐름</th>
          <th>내용</th>
          <th>대표 연구</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>UT 기반 10B+ MoE 실험</strong></td>
          <td>학습 안정성, routing saturation 방지 기법 필요</td>
          <td>Google PaLM-MoE, M6-T [Alibaba]</td>
      </tr>
      <tr>
          <td><strong>Expert shard-parallelism</strong></td>
          <td>전문가를 cross-device로 분산하여 더 많은 expert 활용</td>
          <td>GShard [Google], DeepSpeed-MoE</td>
      </tr>
  </tbody>
</table>
<p>✅ MoEUT는 1B까지 실험 → <strong>1B 이상의 sparse UT 구조 실험이 필요</strong></p>
<hr>
<h2 id="-내-제안-moeut의-한계-극복을-위한-통합-방향">🧠 내 제안: MoEUT의 한계 극복을 위한 통합 방향</h2>
<table>
  <thead>
      <tr>
          <th>제안</th>
          <th>설명</th>
          <th>기대 효과</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>✅ <strong>ACT + Layer Grouping 결합</strong></td>
          <td>각 그룹별 recurrence step을 ACT로 제어</td>
          <td>더 효율적인 계층 깊이 조정</td>
      </tr>
      <tr>
          <td>✅ <strong>Routing-aware loss 개선</strong></td>
          <td>σ-MoE의 entropy loss + token diversity penalty 추가</td>
          <td>expert collapse 방지</td>
      </tr>
      <tr>
          <td>✅ <strong>Expert affinity 학습 추가</strong></td>
          <td>token ↔ expert affinity matrix 학습</td>
          <td>토큰 특화 expert 역할 고정</td>
      </tr>
      <tr>
          <td>✅ <strong>Pretraining 후 LoRA fine-tuning</strong></td>
          <td>MoEUT에 low-rank adapter만 추가</td>
          <td>downstream 적응력 강화</td>
      </tr>
      <tr>
          <td>✅ <strong>CUDA kernel 최적화 (FlashMoE 통합)</strong></td>
          <td>FlashAttention + MoE fusion</td>
          <td>training/inference 속도 대폭 향상</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-정리-1">✅ 정리</h2>
<table>
  <thead>
      <tr>
          <th>극복 과제</th>
          <th>대표적 접근 흐름</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>학습 속도</td>
          <td>Triton kernel → FlashMoE, Switch-style hard routing</td>
      </tr>
      <tr>
          <td>zero-shot 한계</td>
          <td>Adapter 방식 downstream fine-tuning</td>
      </tr>
      <tr>
          <td>Expert collapse</td>
          <td>entropy 정규화 개선, token cluster routing</td>
      </tr>
      <tr>
          <td>ACT 부재</td>
          <td>token-level depth control 통합</td>
      </tr>
      <tr>
          <td>확장성 부족</td>
          <td>10B+ scale UT+MoE 실험, expert 분산 병렬화</td>
      </tr>
  </tbody>
</table>

  <blockquote
    class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1">
    <div class="prose prose-sm max-w-none">
      <p>✅ MoEUT는 기반이 매우 훌륭한 구조이므로, <strong>커널 최적화 + 동적 routing 제어 + ACT 확장 + fine-tuning 전략 통합</strong>만 잘 이루어지면 다음 세대 sparse UT로 진화 가능성이 큽니다.</p>
    </div>
  </blockquote>

<p>필요하시면 이러한 방향을 적용한 후속 연구 아이디어를 구체적 실험 설계나 논문 형태로 정리해드릴 수 있습니다.</p>
<p>물론입니다! 아래는 MoEUT 논문을 더 깊이 있게 이해하기 위한 <strong>핵심 질문 3가지</strong>입니다. 마크다운 문법 없이, 복붙하기 쉬운 형식으로 제공드립니다.</p>
<h1 id="q--moeut는-기존-universal-transformer의-parameter-compute-ratio-문제를-어떻게-해결하며-σ-moe와-switchhead의-구조적-차별점은-무엇인가">Q : MoEUT는 기존 Universal Transformer의 parameter-compute ratio 문제를 어떻게 해결하며, σ-MoE와 SwitchHead의 구조적 차별점은 무엇인가?</h1>
<p>아주 좋은 질문입니다. 아래에 <strong>정확하고 수치 기반으로 깊이 있게</strong> 설명드릴게요.</p>
<hr>
<h2 id="-질문-핵심-요약">✅ 질문 핵심 요약</h2>
<p><strong>Q1. MoEUT는 기존 Universal Transformer의 parameter-compute ratio 문제를 어떻게 해결하며, σ-MoE와 SwitchHead의 구조적 차별점은 무엇인가?</strong></p>
<hr>
<h2 id="1-기존-universal-transformer의-한계-parametercompute-ratio">1. 기존 Universal Transformer의 한계: parameter–compute ratio</h2>
<p><strong>문제 요약</strong>:<br>
UT는 <strong>레이어를 반복적으로 공유</strong>함으로써 recurrence를 도입하지만, 그 결과:</p>
<ul>
<li>총 파라미터 수가 감소함 (레이어가 공유되므로)</li>
<li>동일한 depth로 학습해도 expressiveness가 부족해짐</li>
<li>이를 해결하려면 레이어를 <strong>L배 넓게 만들어야 함 (dff, dmodel 확장)</strong><br>
→ 그럼 <strong>연산량, 메모리 cost 급증</strong></li>
</ul>
<p><strong>수식 예시</strong>:</p>
<ul>
<li>Dense Transformer: L layers × dmodel = 총 파라미터 수 O(L×d²)</li>
<li>UT: 1 layer 공유 → O(d²)</li>
<li>d를 √L 배 키워야 동일 expressiveness → O(L×d²) 연산량 → compute 터짐</li>
</ul>
<hr>
<h2 id="2-moeut의-해결책-sparse-expert-구조">2. MoEUT의 해결책: Sparse Expert 구조</h2>
<h3 id="-핵심-아이디어-파라미터-수는-늘리되-연산량은-그대로-또는-줄인다">🔹 핵심 아이디어: &ldquo;파라미터 수는 늘리되, 연산량은 그대로 또는 줄인다&rdquo;</h3>
<ul>
<li>
<p><strong>σ-MoE (feedforward)</strong>:</p>
<ul>
<li>NE개의 expert 중 <strong>Top-K만 활성화</strong></li>
<li>각 expert는 small: <code>d_model × d_expert (128) → d_expert × d_model</code></li>
<li>Soft routing (σ) 사용 → sparse하게만 연산</li>
</ul>
</li>
<li>
<p><strong>SwitchHead (self-attention)</strong>:</p>
<ul>
<li>각 attention head의 value/output projection을 MoE로 구성</li>
<li>역시 Top-K expert만 사용 → sparse attention projection</li>
</ul>
</li>
</ul>

  <blockquote
    class="border-primary bg-muted/30 hover:bg-muted/40 my-6 rounded-r-lg border-l-4 py-4 pr-4 pl-6 italic transition-all duration-200 ease-out hover:translate-x-1">
    <div class="prose prose-sm max-w-none">
      <p>결과적으로:</p>
    </div>
  </blockquote>

<ul>
<li><strong>레이어는 여전히 공유</strong> (UT 구조 유지)</li>
<li><strong>parameter는 많아짐 (많은 expert로)</strong></li>
<li><strong>연산량은 일부 expert만 계산하므로 증가하지 않음</strong></li>
</ul>
<hr>
<h2 id="3-σ-moe-vs-switchhead-구조-비교">3. σ-MoE vs SwitchHead: 구조 비교</h2>
<table>
  <thead>
      <tr>
          <th>요소</th>
          <th>σ-MoE (FFN)</th>
          <th>SwitchHead (Attention)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>적용 위치</td>
          <td>FFN (ReLU 포함된 MLP block)</td>
          <td>Attention value/output projection</td>
      </tr>
      <tr>
          <td>Expert 구성</td>
          <td>small expert들 (NE=100~500), d_expert=128</td>
          <td>각 head마다 NA개의 expert</td>
      </tr>
      <tr>
          <td>Routing 방식</td>
          <td>σ(x W_s) → Top-K 선택 (soft routing)</td>
          <td>σ(x W_sv) → Top-K per-head 선택</td>
      </tr>
      <tr>
          <td>Regularization</td>
          <td>Entropy loss 적용 (sequence 단위)</td>
          <td>동일한 entropy loss 적용 (value/output 각각)</td>
      </tr>
      <tr>
          <td>학습 시 불안정성</td>
          <td>σ-MoE는 gradient noise 큼 → batch 내부 regularization 필요</td>
          <td>더 fine-grained (head-wise) routing → 계산량 증가 소폭 있음</td>
      </tr>
  </tbody>
</table>
<p><strong>공통점</strong>:</p>
<ul>
<li>둘 다 <strong>fine-grained MoE</strong>, 즉 expert의 크기는 작고 개수는 많음</li>
<li>Top-K만 사용하므로 <strong>계산량 ≪ parameter 수</strong></li>
</ul>
<hr>
<h2 id="4-실험적-근거">4. 실험적 근거</h2>
<table>
  <thead>
      <tr>
          <th>모델</th>
          <th>Params</th>
          <th>MACs</th>
          <th>Perplexity (C4)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Dense</td>
          <td>244M</td>
          <td>기준점</td>
          <td>13.40</td>
      </tr>
      <tr>
          <td>σ-MoE (non-shared)</td>
          <td>244M</td>
          <td>↓</td>
          <td>13.70 (성능 ↓)</td>
      </tr>
      <tr>
          <td><strong>MoEUT</strong></td>
          <td>243M</td>
          <td>↓↓</td>
          <td><strong>13.24</strong> ✅</td>
      </tr>
  </tbody>
</table>
<p>→ 즉, MoEUT는 <strong>shared-layer 구조를 유지하면서도 σ-MoE + SwitchHead 덕분에 compute 효율을 크게 올리고</strong>, 동시에 <strong>parameter-rich 모델의 expressive power</strong>도 회복한 형태</p>
<hr>
<h2 id="-정리-2">✅ 정리</h2>
<p>MoEUT는 Universal Transformer의 핵심 한계인 <strong>parameter-compute ratio 문제</strong>를 **σ-MoE (FFN), SwitchHead (Attention)**를 도입함으로써 해결했다.<br>
이들은 각각 <strong>연산량을 유지한 채 파라미터 수를 증가</strong>시키는 구조이며,<br>
shared-layer 구조에서도 <strong>expressiveness와 efficiency를 동시에 확보</strong>하게 해주는 핵심 컴포넌트다.</p>
<p>필요하시면 σ-MoE와 SwitchHead의 forward path를 pseudocode로 구성해드릴 수 있습니다.</p>
<h1 id="q--layer-grouping과-peri-layernorm은-왜-shared-layer-구조에서-필수적인-설계로-간주되며-각각이-모델의-표현력과-학습-안정성에-미치는-구체적-기여는-무엇인가">Q : Layer Grouping과 Peri-layernorm은 왜 shared-layer 구조에서 필수적인 설계로 간주되며, 각각이 모델의 표현력과 학습 안정성에 미치는 구체적 기여는 무엇인가?</h1>
<p>좋습니다. 이 질문은 <strong>MoEUT의 설계에서 가장 중요한 구조적 기법 두 가지인 <code>Layer Grouping</code>과 <code>Peri-layernorm</code>의 도입 배경과 실효성</strong>을 이해하는 핵심 포인트입니다. 논문이 제시한 근거 + 실제 실험 + 이론적 설명을 함께 연결해서 정리해드리겠습니다.</p>
<hr>
<h2 id="-질문-핵심-요약-1">✅ 질문 핵심 요약</h2>
<p><strong>Q2. Layer Grouping과 Peri-layernorm은 왜 shared-layer 구조에서 필수적인 설계로 간주되며, 각각이 모델의 표현력과 학습 안정성에 미치는 구체적 기여는 무엇인가?</strong></p>
<hr>
<h2 id="1-layer-grouping-표현력expressiveness-회복을-위한-설계">1. Layer Grouping: 표현력(Expressiveness) 회복을 위한 설계</h2>
<h3 id="-문제-완전한-layer-sharing은-표현력이-약해짐">❗ 문제: 완전한 Layer Sharing은 표현력이 약해짐</h3>
<ul>
<li>UT는 동일한 레이어를 반복적으로 적용함 (f(f(f(&hellip;f(x)))) 구조)</li>
<li>하지만 레이어마다 **서로 다른 연산(sub-operation)**을 하는 것이 일반적인 Transformer의 학습 방식</li>
<li>따라서 <strong>모든 레이어가 동일한 파라미터를 공유할 경우</strong>, <strong>서로 다른 연산을 쪼개 수행하기 어려움</strong> → 표현력 제한</li>
</ul>
<hr>
<h3 id="-해결책-grouping된-레이어-블록을-반복-a-b-a-b">✅ 해결책: Grouping된 &ldquo;레이어 블록&quot;을 반복 (A-B-A-B&hellip;)</h3>
<ul>
<li>G개의 non-shared 레이어를 하나의 group으로 구성 → 그룹 단위로 파라미터를 공유</li>
<li>예: G=2일 때 [A, B]를 반복하여 A-B-A-B-A-B 구조로 수행</li>
</ul>
<p><strong>실험적 근거 (논문 Fig. 6):</strong></p>
<table>
  <thead>
      <tr>
          <th>Group Size G</th>
          <th>Perplexity ↓</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>G = 1 (완전 공유)</td>
          <td>13.85</td>
      </tr>
      <tr>
          <td>G = 2 (MoEUT 기본값)</td>
          <td><strong>13.24</strong> ✅</td>
      </tr>
      <tr>
          <td>G = 18 (non-shared σ-MoE)</td>
          <td>13.70</td>
      </tr>
  </tbody>
</table>
<ul>
<li>G=2일 때 성능 최적</li>
<li>Group 구조가 induction head-style sub-operation 분리와 aligned됨</li>
</ul>
<hr>
<h3 id="-요약-layer-grouping의-기여">💡 요약: Layer Grouping의 기여</h3>
<ul>
<li><strong>표현력 증가</strong>: 연속된 레이어에 서로 다른 역할 부여 가능</li>
<li><strong>recurrence 구조의 expressive bottleneck 해소</strong></li>
<li><strong>MoE와 결합 시 expert specialization 유도</strong></li>
</ul>
<hr>
<h2 id="2-peri-layernorm-학습-안정성--gradient-flow-개선">2. Peri-layernorm: 학습 안정성 + gradient flow 개선</h2>
<h3 id="-문제-standard-pre-layernorm은-shared-layer-구조에서-문제-발생">❗ 문제: Standard pre-layernorm은 shared-layer 구조에서 문제 발생</h3>
<table>
  <thead>
      <tr>
          <th>구조</th>
          <th>문제점</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Pre-LN</td>
          <td>residual이 계속 커지므로 shared-layer가 late depth에서 작동하기 어려움</td>
      </tr>
      <tr>
          <td>Post-LN</td>
          <td>gradient flow 불안정 (초기 학습 수렴 속도 느림)</td>
      </tr>
  </tbody>
</table>
<ul>
<li>Pre-LN의 경우 residual vector의 norm이 layer 깊이에 따라 점점 커짐<br>
→ shared-layer가 깊은 위치에서도 동일한 출력을 내기 위해선 <strong>출력 scaling이 어려움</strong></li>
</ul>
<hr>
<h3 id="-해결책-peri-layernorm-비선형-연산-앞에만-ln-삽입">✅ 해결책: Peri-layernorm (비선형 연산 앞에만 LN 삽입)</h3>
<p><strong>구체적으로 적용 위치:</strong></p>
<ul>
<li>Attention: Query/Key projection 전에만</li>
<li>FFN: σ-MoE의 gating score 계산 전에만</li>
<li>Main path (value projection, ReLU 이후 등)에는 <strong>layernorm 생략</strong></li>
</ul>
<p><strong>결과:</strong></p>
<ul>
<li><strong>Residual norm이 비정상적으로 커지는 현상 방지</strong></li>
<li><strong>Gradient flow는 유지되며</strong> → 깊은 network에서도 학습 안정화됨</li>
</ul>
<hr>
<h3 id="실험적-근거-논문-fig-8">실험적 근거 (논문 Fig. 8)</h3>
<table>
  <thead>
      <tr>
          <th>Norm Scheme</th>
          <th>Perplexity ↓ (C4, 244M)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Post-LN</td>
          <td>13.36</td>
      </tr>
      <tr>
          <td>Pre-LN</td>
          <td>13.59</td>
      </tr>
      <tr>
          <td><strong>Peri-LN</strong></td>
          <td><strong>13.24</strong> ✅</td>
      </tr>
  </tbody>
</table>
<ul>
<li>작은 모델일수록 gap이 크게 나타남</li>
<li>학습 초기에 더 빠른 수렴과 안정성 제공</li>
</ul>
<hr>
<h3 id="-요약-peri-layernorm의-기여">💡 요약: Peri-layernorm의 기여</h3>
<ul>
<li><strong>학습 안정성 향상</strong>: residual explosion 방지</li>
<li><strong>shared-layer 재사용 가능성 증가</strong>: depth에 관계없이 동일 회로 사용</li>
<li><strong>gradient flow 확보</strong> + <strong>MoE gating 연산 정규화</strong> 병행</li>
</ul>
<hr>
<h2 id="-전체-요약-정리">✅ 전체 요약 정리</h2>
<table>
  <thead>
      <tr>
          <th>요소</th>
          <th>왜 필요한가?</th>
          <th>무엇에 기여하는가?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Layer Grouping</td>
          <td>완전 공유 시 표현력 부족</td>
          <td>sub-operation 분리로 표현력 증가</td>
      </tr>
      <tr>
          <td>Peri-layernorm</td>
          <td>pre-LN: residual 폭주, post-LN: gradient flow 악화</td>
          <td>안정적 학습 + residual scaling 완화</td>
      </tr>
  </tbody>
</table>
<p>둘은 <strong>shared-layer 기반 Universal Transformer에서 expressive power와 optimization 안정성을 보완하기 위해 반드시 필요한 설계</strong>이며, 실험적으로도 <strong>없으면 성능 하락</strong>이 명확히 나타났습니다.</p>
<p>필요하시면 이를 구현하는 PyTorch Module 패턴이나 실제 ablation 실험 구성 방식도 정리해드릴 수 있습니다.</p>
<h1 id="q--동일한-파라미터-수-또는-compute-budget-조건에서-moeut가-dense-transformer-대비-더-나은-perplexity를-달성한-근본적인-이유는-무엇이며-이-성능-격차가-특정-구성-요소moe-routing-recurrence-normalization-등-중-어디에서-기인하는가">Q : 동일한 파라미터 수 또는 compute budget 조건에서 MoEUT가 dense Transformer 대비 더 나은 perplexity를 달성한 근본적인 이유는 무엇이며, 이 성능 격차가 특정 구성 요소(MoE routing, recurrence, normalization 등) 중 어디에서 기인하는가?</h1>
<p>아주 핵심적인 질문입니다. 이 질문은 MoEUT가 단순히 구조를 복잡하게 만든 것이 아니라, <strong>왜 실제 성능이 향상되는가</strong>, 즉 <strong>성능 격차의 본질적 원인</strong>을 파악하는 데 중요합니다. 아래에 논문에서 제시한 주장 + 실험적 증거 + 제 분석을 함께 종합해 설명드립니다.</p>
<hr>
<h2 id="-질문-핵심-요약-2">✅ 질문 핵심 요약</h2>
<p><strong>Q3. 동일한 파라미터 수 또는 compute budget 조건에서 MoEUT가 dense Transformer 대비 더 나은 perplexity를 달성한 근본적인 이유는 무엇이며, 이 성능 격차가 특정 구성 요소(MoE routing, recurrence, normalization 등) 중 어디에서 기인하는가?</strong></p>
<hr>
<h2 id="1-실험-결과-요약-같은-파라미터연산량-기준-비교">1. 실험 결과 요약: 같은 파라미터/연산량 기준 비교</h2>
<h3 id="-예-c4-언어-모델링-perplexity-비교">📌 예: C4 언어 모델링 Perplexity 비교</h3>
<table>
  <thead>
      <tr>
          <th>모델</th>
          <th>Params</th>
          <th>Perplexity ↓</th>
          <th>MACs</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Dense Transformer</td>
          <td>244M</td>
          <td>13.40</td>
          <td>기준치</td>
      </tr>
      <tr>
          <td>σ-MoE (non-shared)</td>
          <td>244M</td>
          <td>13.70</td>
          <td>↓</td>
      </tr>
      <tr>
          <td><strong>MoEUT (shared)</strong></td>
          <td>243M</td>
          <td><strong>13.24</strong> ✅</td>
          <td>↓↓</td>
      </tr>
  </tbody>
</table>
<p>→ 같은 파라미터 수 또는 compute(MACs) 기준에서 MoEUT가 항상 더 낮은 perplexity<br>
→ **σ-MoE(비공유 구조)**보다도 MoEUT(레이어 공유 구조)가 더 좋음 → 핵심적 포인트</p>
<hr>
<h2 id="2-근본-원인-요약-sparse-routing--recurrence의-결합-시너지">2. 근본 원인 요약: &ldquo;Sparse Routing + Recurrence의 결합 시너지&rdquo;</h2>
<p><strong>Dense Transformer</strong>는 모든 레이어에 동일한 파라미터를 모두 사용하며, 효율성과 유연성 간 trade-off 존재</p>
<p><strong>MoEUT</strong>는 다음 두 가지 축을 <strong>동시에 활용</strong>:</p>
<h3 id="-a-moe-routing으로-parameter-efficiency-확보-모델의-capacity-증가">🧠 A. MoE routing으로 parameter efficiency 확보 (모델의 capacity 증가)</h3>
<ul>
<li>σ-MoE, SwitchHead → Top-K expert만 사용</li>
<li>같은 연산량 대비 훨씬 많은 파라미터 사용 가능</li>
<li>→ <strong>Parameter efficiency ↑</strong></li>
<li>→ 특정 token에 <strong>전문화된 회로(expert) 사용 가능</strong> (e.g., 문법, 엔티티 등)</li>
</ul>
<p><strong>실험 증거</strong>:</p>
<ul>
<li>Fig. 13, 14: 전문가 수가 늘어나고 Top-K가 커질수록 perplexity 감소</li>
<li>Fig. 9–10: token마다 expert specialization 생김 → diversity 향상</li>
</ul>
<hr>
<h3 id="-b-recurrence-shared-layer로-inductive-bias-도입">🔁 B. Recurrence (shared-layer)로 inductive bias 도입</h3>
<ul>
<li>UT의 핵심 장점: f(f(f(&hellip;))) 구조 → <strong>compositional 연산 표현력 증가</strong></li>
<li>레이어 공유를 통해 <strong>일관된 회로 반복 적용</strong> → 구조적 일반화</li>
</ul>
<p><strong>실험 증거</strong>:</p>
<ul>
<li>Fig. 6: G=1 (완전 공유) vs G=18 (non-shared)보다 G=2 (recurrent group)에서 성능 최상</li>
<li>→ <strong>정해진 회로 반복 구조</strong>가 복잡한 추론에 유리</li>
</ul>
<hr>
<h2 id="3-성능-향상의-주요-기여-요소-분해">3. 성능 향상의 주요 기여 요소 분해</h2>
<h3 id="-ablation-기반-영향도-분석-정성적-순위">📊 Ablation 기반 영향도 분석 (정성적 순위)</h3>
<table>
  <thead>
      <tr>
          <th>구성 요소</th>
          <th>기여도</th>
          <th>근거</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>✅ σ-MoE Feedforward</td>
          <td>★★★★★</td>
          <td>가장 큰 perplexity 감소 요인 (fine-grained MoE)</td>
      </tr>
      <tr>
          <td>✅ Layer Grouping (Recurrence)</td>
          <td>★★★★☆</td>
          <td>G=2에서 best performance (Fig. 6)</td>
      </tr>
      <tr>
          <td>✅ SwitchHead Attention</td>
          <td>★★★☆☆</td>
          <td>attention head-wise routing → sparse + expressive attention</td>
      </tr>
      <tr>
          <td>✅ Peri-layernorm</td>
          <td>★★☆☆☆</td>
          <td>residual 폭주 방지 + gradient flow 개선</td>
      </tr>
      <tr>
          <td>❌ ACT</td>
          <td>없음</td>
          <td>MoEUT에서는 미사용 (SUT 비교에서 효율 낮음)</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="4-내-분석-왜-시너지-효과가-큰가">4. 내 분석: 왜 시너지 효과가 큰가?</h2>
<table>
  <thead>
      <tr>
          <th>Dense Transformer</th>
          <th>MoEUT</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>동일 파라미터 모두 사용 → 표현력은 있지만 generalization 어려움</td>
          <td>expert 선택 + recurrence → <strong>전문화 + 반복적 사고 구조</strong></td>
      </tr>
      <tr>
          <td>layer 개별 학습 → 일관성 부족</td>
          <td>파라미터 공유 → 의미 있는 반복 구조 학습 가능</td>
      </tr>
      <tr>
          <td>LayerNorm을 residual path에 모두 적용 → norm scaling 필요</td>
          <td>peri-norm 구조 → residual 성장 안정화</td>
      </tr>
  </tbody>
</table>
<p><strong>즉, MoEUT는</strong></p>
<ul>
<li>token별로 expert를 다르게 사용해 <strong>token-level 특화</strong>를 지원하고,</li>
<li>recurrence로 <strong>depth-wise structure</strong>를 학습하며,</li>
<li>normalization으로 <strong>gradient 안정화</strong>까지 동시에 실현한다는 점에서<br>
<strong>Dense Transformer보다 본질적으로 더 유연하면서도 안정적인 구조</strong>라고 볼 수 있습니다.</li>
</ul>
<hr>
<h2 id="-결론-요약-1">✅ 결론 요약</h2>
<p>MoEUT가 Dense Transformer 대비 동일 파라미터/compute 조건에서 더 나은 성능(perplexity)을 보이는 이유는,</p>
<ul>
<li>σ-MoE 및 SwitchHead를 통한 <strong>sparse expert routing</strong>으로 <strong>parameter 효율성 극대화</strong>,</li>
<li>Layer Grouping 기반 <strong>recurrence 구조</strong>로 <strong>compositional expressiveness 확보</strong>,</li>
<li>Peri-layernorm으로 <strong>학습 안정성과 gradient flow 보장</strong>이라는 3축 전략이 결합되었기 때문입니다.</li>
</ul>
<p>이러한 구조적 조합은 단일 구성요소보다 훨씬 강력한 <strong>상호보완적 효과</strong>를 만들어낸다고 판단됩니다.</p>

  </article>

  
  
  <div class="post-license bg-muted/30 border-border mb-8 rounded-xl border p-6">
    <div class="flex items-start gap-4">
      <div
        class="bg-primary/10 flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="라이선스"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
</svg>
      </div>

      <div class="flex-1">
        <h3 class="text-foreground mb-2 text-lg font-semibold">
          라이선스
        </h3>

        <div class="text-muted-foreground space-y-2 text-sm">
          
          <p>
            <strong>저작자:</strong>
            류재훈
          </p>
          

          <p>
            <strong>링크:</strong>
            <a
              href="http://192.168.1.11:1314/posts/MoEUT-Mixture-of-Experts-Universal-Transformers/"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              http://192.168.1.11:1314/posts/MoEUT-Mixture-of-Experts-Universal-Transformers/
            </a>
          </p>

          <p>
            <strong>라이선스:</strong>
            <a
              href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary hover:text-primary/80 transition-colors duration-200">
              CC BY-NC-SA 4.0
            </a>
          </p>

          <p class="text-xs">
            이 저작물은 크리에이티브 커먼즈 저작자표시-비영리-동일조건변경허락 4.0 국제 라이선스에 따라 이용할 수 있습니다. 출처를 표시하고, 비영리 목적으로만 사용하며, 동일한 라이선스를 유지해야 합니다.
          </p>
        </div>
      </div>
    </div>
  </div>


  
  





  <nav
    class="post-navigation mb-12"
    aria-label="게시글 네비게이션">
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
      
      <div class="nav-item">
        
          <a
            href="/posts/FLEX-ATTENTION-A-PROGRAMMING-MODEL-FOR-GENERATING-OPTIMIZED-ATTENTION-KERNELS/"
            class="group bg-card border-border hover:bg-primary/5 hover:border-primary/20 focus:ring-primary/20 flex min-h-[140px] flex-col justify-between rounded-xl border p-6 transition-all duration-300 ease-out hover:-translate-y-1 hover:scale-[1.02] hover:shadow-lg focus:ring-2 focus:outline-none">
            <div>
              <div class="mb-3 flex items-center gap-3">
                
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
</svg>
                <span class="text-muted-foreground text-sm font-medium">
                  이전
                </span>
              </div>

              <h3
                class="text-foreground group-hover:text-primary mb-3 line-clamp-2 text-lg leading-tight font-semibold transition-colors duration-200">
                FLEX ATTENTION: A PROGRAMMING MODEL FOR GENERATING OPTIMIZED ATTENTION KERNELS
              </h3>
            </div>

            <div
              class="text-muted-foreground mt-auto flex items-center gap-2 text-xs">
              
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
              <time datetime="2025-04-07">
                04月07日
              </time>
            </div>
          </a>
        
      </div>

      
      <div class="nav-item">
        
          <a
            href="/posts/Mirage-A-Multi-Level-Superoptimizer-for-Tensor-Programs/"
            class="group bg-card border-border hover:bg-primary/5 hover:border-primary/20 focus:ring-primary/20 flex min-h-[140px] flex-col justify-between rounded-xl border p-6 transition-all duration-300 ease-out hover:-translate-y-1 hover:scale-[1.02] hover:shadow-lg focus:ring-2 focus:outline-none">
            <div>
              <div class="mb-3 flex items-center justify-end gap-3">
                <span class="text-muted-foreground text-sm font-medium">
                  다음
                </span>
                
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg>
              </div>

              <h3
                class="text-foreground group-hover:text-primary mb-3 line-clamp-2 text-right text-lg leading-tight font-semibold transition-colors duration-200">
                Mirage: A Multi-Level Superoptimizer for Tensor Programs
              </h3>
            </div>

            <div
              class="text-muted-foreground mt-auto flex items-center justify-end gap-2 text-xs">
              <time datetime="2025-04-13">
                04月13日
              </time>
              
  <svg class="h-3 w-3"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
            </div>
          </a>
        
      </div>
    </div>
  </nav>




  
  










  
  


    </main>

    <footer class="mx-auto max-w-4xl px-4 py-8">
  <div class="px-6 py-6">
    
    
      <nav class="mb-6">
        <div class="flex flex-wrap items-center justify-center gap-1">
          
            
            
            
            <a
              href="/index.xml"
              
              class="nav-link hover:text-primary hover:bg-primary/10 text-muted-foreground flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105">
              
                
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="RSS Feed">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z" />

</svg>
              
              <span
                >
                  RSS Feed
                </span
              >
            </a>
          
        </div>
      </nav>
    


    
    
      <div class="border-border mb-6 border-t"></div>
    


    
    <div class="flex flex-col items-center justify-between gap-4 md:flex-row">
      
      <div class="text-muted-foreground text-sm">
        <p>
          &copy; 2025 Jaehun&#39;s Blog.
          모든 권리 보유.
        </p>
      </div>

      
      
        <div class="flex items-center gap-3">
          
            <a
              href="https://github.com/ryujaehun"
              
                target="_blank" rel="noopener noreferrer"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="GitHub"
              aria-label="GitHub">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="GitHub"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></svg>
              
            </a>
          
            <a
              href="https://www.linkedin.com/in/jaehunryu/"
              
                target="_blank" rel="noopener noreferrer"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="Linkedin"
              aria-label="Linkedin">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="Linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2a2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></g></svg>
              
            </a>
          
            <a
              href="mailto:jaehunryu@icloud.com"
              
              class="text-muted-foreground hover:text-primary focus:ring-primary/20 rounded-lg p-1 transition-all duration-300 ease-out hover:scale-110 focus:ring-2 focus:outline-none"
              title="Email"
              aria-label="Email">
              
                
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24" aria-label="Email">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />

</svg>
              
            </a>
          
        </div>
      

    </div>
  </div>
</footer>


    
    



<div
  id="dock"
  class="pointer-events-none fixed bottom-4 left-1/2 z-[9999] w-fit -translate-x-1/2 translate-y-24 opacity-0 transition-all duration-300 ease-out sm:right-0 sm:left-0 sm:mx-auto sm:translate-x-0"
  role="toolbar"
  aria-label="바로가기 도구 모음">
  <nav
    class="border-border bg-card/80 scrollbar-hide xs:px-3 xs:py-2 mx-auto flex max-w-[calc(100vw-2rem)] min-w-fit items-center justify-center overflow-x-auto rounded-2xl border px-4 py-3 shadow-lg backdrop-blur-sm sm:px-4 sm:py-3">
    
    
      <button
        id="dock-back"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
        title="뒤로"
        aria-label="뒤로">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path d="m12 19-7-7 7-7"/>
  <path d="M19 12H5"/>

</svg>
        <span class="hidden sm:inline"
          >뒤로</span
        >
      </button>

      
      <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>
    


    
    
      <button
        id="dock-toc"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
        title="목차"
        aria-label="목차">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <line x1="8" x2="21" y1="6" y2="6"/>
  <line x1="8" x2="21" y1="12" y2="12"/>
  <line x1="8" x2="21" y1="18" y2="18"/>
  <line x1="3" x2="3.01" y1="6" y2="6"/>
  <line x1="3" x2="3.01" y1="12" y2="12"/>
  <line x1="3" x2="3.01" y1="18" y2="18"/>

</svg>
        <span class="hidden sm:inline"
          >목차</span
        >
      </button>

      
      <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>
    


    
    <button
      id="dock-search"
      class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-3 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-4 sm:py-2"
      title="검색"
      aria-label="검색">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
      <span class="hidden md:inline"
        >검색</span
      >
    </button>

    
    <div class="bg-border xs:mx-1 mx-2 h-6 w-px sm:mx-2"></div>

    
    
    


    
    <button
      id="dock-top"
      class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 xs:px-2 xs:py-1.5 flex flex-shrink-0 items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none sm:px-3 sm:py-2"
      title="맨 위로"
      aria-label="맨 위로">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path d="m18 15-6-6-6 6"/>

</svg>
      <span class="hidden sm:inline"
        >맨 위로</span
      >
    </button>
  </nav>
</div>


    
      



<div
  id="toc-overlay"
  class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-all duration-300"
  role="dialog"
  aria-modal="true"
  aria-labelledby="toc-title"></div>


<div
  id="toc-card"
  class="pointer-events-none fixed inset-4 z-50 flex w-auto scale-95 items-center justify-center opacity-0 transition-all duration-300 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:block sm:w-full sm:max-w-md sm:-translate-x-1/2 sm:-translate-y-1/2"
  role="dialog"
  aria-modal="true"
  aria-labelledby="toc-title">
  <div
    class="bg-card border-border w-full max-w-sm overflow-hidden rounded-xl border shadow-xl sm:max-w-md">
    
    <div
      class="border-border bg-muted/30 flex items-center justify-between border-b p-4">
      <div class="flex items-center gap-3">
        
  <svg class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <line x1="8" x2="21" y1="6" y2="6"/>
  <line x1="8" x2="21" y1="12" y2="12"/>
  <line x1="8" x2="21" y1="18" y2="18"/>
  <line x1="3" x2="3.01" y1="6" y2="6"/>
  <line x1="3" x2="3.01" y1="12" y2="12"/>
  <line x1="3" x2="3.01" y1="18" y2="18"/>

</svg>
        <h2 id="toc-title" class="text-foreground text-lg font-semibold">
          목차
        </h2>
      </div>

      
      <button
        id="toc-close"
        class="text-muted-foreground hover:text-primary hover:bg-primary/10 focus:ring-primary/20 rounded-lg p-2 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:scale-105 focus:ring-2 focus:outline-none"
        title="닫기"
        aria-label="닫기">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
      </button>
    </div>

    
    <div class="max-h-96 overflow-y-auto p-4">
      <nav
        id="toc-nav"
        class="toc-scrollbar"
        aria-label="글 목차">
          
          <div id="toc-content">
            <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#-결론-요약-핵심-강점-독창성-핵심-메커니즘">✅ 결론 요약 (핵심 강점, 독창성, 핵심 메커니즘)</a></li>
        <li><a href="#-핵심-구성-요소와-알고리즘-설명-예시-포함">🔍 핵심 구성 요소와 알고리즘 설명 (예시 포함)</a>
          <ul>
            <li><a href="#1-σ-moe-기반-feedforward-block">1. σ-MoE 기반 Feedforward Block</a></li>
            <li><a href="#2-moe-self-attention-switchhead">2. MoE Self-Attention (SwitchHead)</a></li>
            <li><a href="#3-layer-grouping">3. Layer Grouping</a></li>
            <li><a href="#4-peri-layernorm">4. Peri-layernorm</a></li>
          </ul>
        </li>
        <li><a href="#-성능-비교-요약">📊 성능 비교 요약</a></li>
        <li><a href="#-논문의-강점-및-독창적-기여">🌟 논문의 강점 및 독창적 기여</a></li>
        <li><a href="#-한계점-및-개선-여지">⚠️ 한계점 및 개선 여지</a></li>
        <li><a href="#-결론">✅ 결론</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#-핵심-알고리즘-구성-요약-요소별-구조와-연결관계">✅ 핵심 알고리즘 구성 요약 (요소별 구조와 연결관계)</a></li>
    <li><a href="#-예시-기반-설명-σ-moe--moe-self-attention-경로">🧪 예시 기반 설명 (σ-MoE + MoE Self-Attention 경로)</a>
      <ul>
        <li><a href="#가정">가정</a></li>
        <li><a href="#-step-1-σ-moe-feedforward">🔹 Step 1: σ-MoE Feedforward</a>
          <ul>
            <li><a href="#1-1-expert-선택">1-1. Expert 선택</a></li>
            <li><a href="#1-2-선택된-expert-처리">1-2. 선택된 expert 처리</a></li>
          </ul>
        </li>
        <li><a href="#-step-2-moe-self-attention-switchhead">🔹 Step 2: MoE Self-Attention (SwitchHead)</a>
          <ul>
            <li><a href="#2-1-querykey-계산-dense">2-1. Query/Key 계산 (dense)</a></li>
            <li><a href="#2-2-valueoutput에-moe-적용">2-2. Value/Output에 MoE 적용</a></li>
          </ul>
        </li>
        <li><a href="#-step-3-residual--peri-layernorm">🔹 Step 3: Residual + Peri-layernorm</a></li>
      </ul>
    </li>
    <li><a href="#-요약-전체-연산-흐름">🧠 요약: 전체 연산 흐름</a></li>
    <li><a href="#-추가-해설-왜-이렇게-동작하는가">💡 추가 해설: 왜 이렇게 동작하는가?</a></li>
  </ul>

  <ul>
    <li><a href="#-1-사용한-주요-데이터셋">✅ 1. 사용한 주요 데이터셋</a></li>
    <li><a href="#-2-학습-방식-및-구성요소">✅ 2. 학습 방식 및 구성요소</a>
      <ul>
        <li><a href="#공통-학습-설정">공통 학습 설정</a></li>
      </ul>
    </li>
    <li><a href="#-3-전체-학습-파이프라인-예시">✅ 3. 전체 학습 파이프라인 예시</a>
      <ul>
        <li><a href="#-step-by-step-학습-예시-예-c4-데이터-244m-모델">⚙️ Step-by-Step 학습 예시 (예: C4 데이터, 244M 모델)</a>
          <ul>
            <li><a href="#1단계-데이터-준비">1단계: 데이터 준비</a></li>
            <li><a href="#2단계-dataloader-구성-fixed-length-chunking">2단계: DataLoader 구성 (Fixed-length chunking)</a></li>
            <li><a href="#3단계-모델-초기화">3단계: 모델 초기화</a></li>
            <li><a href="#4단계-학습-루프-perplexity-기반">4단계: 학습 루프 (perplexity 기반)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#-4-gpu하드웨어-요구사항">✅ 4. GPU/하드웨어 요구사항</a></li>
    <li><a href="#-5-checkpoint-및-evaluation">✅ 5. Checkpoint 및 Evaluation</a></li>
    <li><a href="#-6-재현용-추천-스크립트">✅ 6. 재현용 추천 스크립트</a></li>
    <li><a href="#-정리">🎓 정리</a></li>
  </ul>

  <ul>
    <li><a href="#-1-주요-실험-결과-정리-표-기반-요약">✅ 1. 주요 실험 결과 정리 (표 기반 요약)</a>
      <ul>
        <li><a href="#-language-modeling-perplexity-c4-기준-held-out-set">📊 Language Modeling Perplexity (C4 기준, held-out set)</a></li>
        <li><a href="#-zero-shot-downstream-성능-예-244m-모델-기준">📊 Zero-shot Downstream 성능 (예: 244M 모델 기준)</a></li>
      </ul>
    </li>
    <li><a href="#-2-기존-방법-대비-특출난-점-비교-관점">✅ 2. 기존 방법 대비 특출난 점 (비교 관점)</a></li>
    <li><a href="#-3-성능-향상에-기여한-핵심-기법-및-논문-주장">✅ 3. 성능 향상에 기여한 핵심 기법 및 논문 주장</a>
      <ul>
        <li><a href="#-1-σ-moe-in-ffn">🔹 (1) σ-MoE in FFN</a></li>
        <li><a href="#-2-switchhead-moe-self-attention">🔹 (2) SwitchHead (MoE Self-Attention)</a></li>
        <li><a href="#-3-layer-grouping-ex-a-b-a-b-스타일-반복">🔹 (3) Layer Grouping (ex: A-B-A-B 스타일 반복)</a></li>
        <li><a href="#-4-peri-layernorm">🔹 (4) Peri-layernorm</a></li>
      </ul>
    </li>
    <li><a href="#-4-논문-주장에-대한-비판적-분석-및-내-생각">💭 4. 논문 주장에 대한 비판적 분석 및 내 생각</a>
      <ul>
        <li><a href="#-타당한-점">💡 타당한 점</a></li>
        <li><a href="#보완-필요해-보이는-점">❗️보완 필요해 보이는 점</a></li>
      </ul>
    </li>
    <li><a href="#-결론-1">🔚 결론</a></li>
  </ul>

  <ul>
    <li><a href="#-1-입력-데이터와-추론-과정-예시-기반-설명">✅ 1. 입력 데이터와 추론 과정: 예시 기반 설명</a>
      <ul>
        <li><a href="#-예시-입력">✏️ 예시 입력</a></li>
        <li><a href="#-추론-순서-simplified-inference-path">🔁 추론 순서 (Simplified Inference Path)</a>
          <ul>
            <li><a href="#-input-embedding">① Input Embedding</a></li>
            <li><a href="#-layer-group-반복-ex-g2-l18--9회-반복">② Layer Group 반복 (ex: G=2, L=18 → 9회 반복)</a></li>
            <li><a href="#-step-by-step-single-moe-layer-예시">▶ Step-by-step: Single MoE Layer 예시</a></li>
            <li><a href="#-residual--peri-layernorm">③ Residual + Peri-layernorm</a></li>
            <li><a href="#-output-layer">④ Output Layer</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#-2-모델-아키텍처-구성-요약">✅ 2. 모델 아키텍처 구성 요약</a></li>
    <li><a href="#-3-연산량-및-메모리-분석-per-token-기준">✅ 3. 연산량 및 메모리 분석 (per-token 기준)</a>
      <ul>
        <li><a href="#-feedforward-σ-moe">✳️ Feedforward (σ-MoE)</a></li>
        <li><a href="#-moe-attention-switchhead">✳️ MoE Attention (SwitchHead)</a></li>
        <li><a href="#-총-추론-비용-예-t1024-18-shared-layers-g2">🔢 총 추론 비용 (예: T=1024, 18 shared layers, G=2)</a></li>
      </ul>
    </li>
    <li><a href="#-4-메모리-사용량-비교-실험-결과-기반">✅ 4. 메모리 사용량 비교 (실험 결과 기반)</a></li>
    <li><a href="#-결론-요약">✅ 결론 요약</a></li>
  </ul>

  <ul>
    <li><a href="#-1-논문에서-언급한-한계-요약">✅ 1. 논문에서 언급한 한계 요약</a></li>
    <li><a href="#-2-한계-극복을-위한-대표-연구-흐름">🔍 2. 한계 극복을 위한 대표 연구 흐름</a>
      <ul>
        <li><a href="#-1-효율적인-moe-학습--커널-최적화">🧠 [1] 효율적인 MoE 학습 &amp; 커널 최적화</a></li>
        <li><a href="#-2-adaptive-computation-integration-ut-특화">🧠 [2] Adaptive Computation Integration (UT 특화)</a></li>
        <li><a href="#-3-expert-specialization-향상-dynamic-routing-개선">🧠 [3] Expert Specialization 향상 (Dynamic Routing 개선)</a></li>
        <li><a href="#-4-downstream-task-fine-tuning-zero-shot-한계-극복">🧠 [4] Downstream Task Fine-tuning (Zero-shot 한계 극복)</a></li>
        <li><a href="#-5-massive-scale-universal-moe-1b-스케일-확장">🧠 [5] Massive Scale Universal MoE (1B+ 스케일 확장)</a></li>
      </ul>
    </li>
    <li><a href="#-내-제안-moeut의-한계-극복을-위한-통합-방향">🧠 내 제안: MoEUT의 한계 극복을 위한 통합 방향</a></li>
    <li><a href="#-정리-1">✅ 정리</a></li>
  </ul>

  <ul>
    <li><a href="#-질문-핵심-요약">✅ 질문 핵심 요약</a></li>
    <li><a href="#1-기존-universal-transformer의-한계-parametercompute-ratio">1. 기존 Universal Transformer의 한계: parameter–compute ratio</a></li>
    <li><a href="#2-moeut의-해결책-sparse-expert-구조">2. MoEUT의 해결책: Sparse Expert 구조</a>
      <ul>
        <li><a href="#-핵심-아이디어-파라미터-수는-늘리되-연산량은-그대로-또는-줄인다">🔹 핵심 아이디어: &ldquo;파라미터 수는 늘리되, 연산량은 그대로 또는 줄인다&rdquo;</a></li>
      </ul>
    </li>
    <li><a href="#3-σ-moe-vs-switchhead-구조-비교">3. σ-MoE vs SwitchHead: 구조 비교</a></li>
    <li><a href="#4-실험적-근거">4. 실험적 근거</a></li>
    <li><a href="#-정리-2">✅ 정리</a></li>
  </ul>

  <ul>
    <li><a href="#-질문-핵심-요약-1">✅ 질문 핵심 요약</a></li>
    <li><a href="#1-layer-grouping-표현력expressiveness-회복을-위한-설계">1. Layer Grouping: 표현력(Expressiveness) 회복을 위한 설계</a>
      <ul>
        <li><a href="#-문제-완전한-layer-sharing은-표현력이-약해짐">❗ 문제: 완전한 Layer Sharing은 표현력이 약해짐</a></li>
        <li><a href="#-해결책-grouping된-레이어-블록을-반복-a-b-a-b">✅ 해결책: Grouping된 &ldquo;레이어 블록&quot;을 반복 (A-B-A-B&hellip;)</a></li>
        <li><a href="#-요약-layer-grouping의-기여">💡 요약: Layer Grouping의 기여</a></li>
      </ul>
    </li>
    <li><a href="#2-peri-layernorm-학습-안정성--gradient-flow-개선">2. Peri-layernorm: 학습 안정성 + gradient flow 개선</a>
      <ul>
        <li><a href="#-문제-standard-pre-layernorm은-shared-layer-구조에서-문제-발생">❗ 문제: Standard pre-layernorm은 shared-layer 구조에서 문제 발생</a></li>
        <li><a href="#-해결책-peri-layernorm-비선형-연산-앞에만-ln-삽입">✅ 해결책: Peri-layernorm (비선형 연산 앞에만 LN 삽입)</a></li>
        <li><a href="#실험적-근거-논문-fig-8">실험적 근거 (논문 Fig. 8)</a></li>
        <li><a href="#-요약-peri-layernorm의-기여">💡 요약: Peri-layernorm의 기여</a></li>
      </ul>
    </li>
    <li><a href="#-전체-요약-정리">✅ 전체 요약 정리</a></li>
  </ul>

  <ul>
    <li><a href="#-질문-핵심-요약-2">✅ 질문 핵심 요약</a></li>
    <li><a href="#1-실험-결과-요약-같은-파라미터연산량-기준-비교">1. 실험 결과 요약: 같은 파라미터/연산량 기준 비교</a>
      <ul>
        <li><a href="#-예-c4-언어-모델링-perplexity-비교">📌 예: C4 언어 모델링 Perplexity 비교</a></li>
      </ul>
    </li>
    <li><a href="#2-근본-원인-요약-sparse-routing--recurrence의-결합-시너지">2. 근본 원인 요약: &ldquo;Sparse Routing + Recurrence의 결합 시너지&rdquo;</a>
      <ul>
        <li><a href="#-a-moe-routing으로-parameter-efficiency-확보-모델의-capacity-증가">🧠 A. MoE routing으로 parameter efficiency 확보 (모델의 capacity 증가)</a></li>
        <li><a href="#-b-recurrence-shared-layer로-inductive-bias-도입">🔁 B. Recurrence (shared-layer)로 inductive bias 도입</a></li>
      </ul>
    </li>
    <li><a href="#3-성능-향상의-주요-기여-요소-분해">3. 성능 향상의 주요 기여 요소 분해</a>
      <ul>
        <li><a href="#-ablation-기반-영향도-분석-정성적-순위">📊 Ablation 기반 영향도 분석 (정성적 순위)</a></li>
      </ul>
    </li>
    <li><a href="#4-내-분석-왜-시너지-효과가-큰가">4. 내 분석: 왜 시너지 효과가 큰가?</a></li>
    <li><a href="#-결론-요약-1">✅ 결론 요약</a></li>
  </ul>
</nav>
          </div>
      </nav>
    </div>

    
    <div class="border-border bg-muted/20 border-t px-4 py-3">
      <div class="text-muted-foreground text-center text-xs">
        <span>제목을 클릭하면 해당 위치로 이동합니다</span>
      </div>
    </div>
  </div>
</div>

    


  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
    integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP"
    crossorigin="anonymous" />
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
    integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"
    crossorigin="anonymous"></script>
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
    integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh"
    crossorigin="anonymous"></script>

<script>
    
    function initKaTeX() {
        if (typeof renderMathInElement === 'undefined') {
            setTimeout(initKaTeX, 100);
            return;
        }

        var delimiters = [{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"}];

        renderMathInElement(document.body, {
            delimiters: delimiters,
            throwOnError: false,
            errorColor: '#cc0000',
            fleqn: false,
            leqno: false,
            trust: false
        });
    }

    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initKaTeX);
    } else {
        initKaTeX();
    }
</script>
    



    
    
<div
  id="search-overlay"
  class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 transition-opacity duration-300"></div>


<div
  id="search-modal"
  class="bg-card border-border pointer-events-none fixed top-1/2 left-1/2 z-50 max-h-[80vh] w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 scale-95 transform overflow-hidden rounded-xl border opacity-0 shadow-xl transition-all duration-300">
  
  <div class="border-border flex items-center gap-3 border-b p-4">
    
    <div class="text-muted-foreground h-5 w-5 flex-shrink-0">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
    </div>

    
    <div class="relative flex-1">
      
      <button
        id="search-clear"
        class="text-muted-foreground hover:text-foreground hover:bg-muted/50 pointer-events-none absolute top-1/2 left-0 z-10 h-5 w-5 -translate-y-1/2 rounded opacity-0 transition-all duration-200"
        title="지우기"
        aria-label="지우기">
        
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
      </button>

      
      <input
        id="search-input"
        type="text"
        placeholder="게시글 검색..."
        class="text-foreground placeholder:text-muted-foreground w-full border-none bg-transparent pl-8 text-lg outline-none"
        autocomplete="off"
        spellcheck="false" />
    </div>

    
    <button
      id="search-close"
      class="text-muted-foreground hover:text-foreground hover:bg-muted/50 flex h-6 w-6 items-center justify-center rounded-md p-0.5 transition-all duration-200"
      title="닫기"
      aria-label="닫기">
      
  <svg class="h-4 w-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

</svg>
    </button>
  </div>

  
  <div id="search-results" class="max-h-96 overflow-y-auto">
    
    <div
      id="search-empty"
      class="flex flex-col items-center justify-center py-12 text-center">
      <div
        class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />

</svg>
      </div>
      <h3 class="text-foreground mb-2 text-lg font-semibold">
        검색 시작
      </h3>
      <p class="text-muted-foreground text-sm">
        검색어를 입력하세요
      </p>
    </div>

    
    <div
      id="search-loading"
      class="flex hidden items-center justify-center py-8">
      <div
        class="mr-3 h-6 w-6 animate-spin rounded-full border-2 border-current border-t-transparent"></div>
      <span class="text-muted-foreground"
        >검색 중...</span
      >
    </div>

    
    <div
      id="search-no-results"
      class="flex hidden flex-col items-center justify-center py-12 text-center">
      <div
        class="bg-muted/50 mb-4 flex h-16 w-16 items-center justify-center rounded-full">
        
  <svg class="h-6 w-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
</svg>
      </div>
      <h3 class="text-foreground mb-2 text-lg font-semibold">
        검색 결과 없음
      </h3>
      <p class="text-muted-foreground text-sm">
        다른 검색어로 시도해보세요
      </p>
    </div>

    
    <div id="search-results-list" class="hidden">
      
      <div
        id="search-stats"
        class="text-muted-foreground border-border border-b px-4 py-3 text-sm"
        data-template="%d개의 결과 찾음">
      </div>

      
      <div id="search-items" class="divide-border divide-y">
        
      </div>
    </div>
  </div>

  
  <div class="border-border bg-muted/20 border-t px-4 py-3">
    <div
      class="text-muted-foreground flex items-center justify-between text-xs">
      <div class="flex items-center gap-2 md:gap-4">
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >↑↓</kbd
          >
          <span class="hidden sm:inline"
            >이동</span
          >
        </div>
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >↵</kbd
          >
          <span class="hidden sm:inline"
            >선택</span
          >
        </div>
        <div class="flex items-center gap-1">
          <kbd
            class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
            >ESC</kbd
          >
          <span class="hidden sm:inline"
            >닫기</span
          >
        </div>
      </div>
      <div class="search-hint-desktop flex items-center gap-1">
        <kbd class="bg-muted border-border rounded border px-1.5 py-0.5 text-xs"
          >⌘K</kbd
        >
        <span>단축키</span>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
